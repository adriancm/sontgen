(function(q){q.URL=q.URL||q.webkitURL;if(q.Blob&&q.URL)try{new Blob;return}catch(w){}var F=q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||function(q){var w=function(q){return Object.prototype.toString.call(q).match(/^\[object\s(.*)\]$/)[1]},I=function(){this.data=[]},F=function(q,w,C){this.data=q;this.size=q.length;this.type=w;this.encoding=C},U=I.prototype,L=F.prototype,N=q.FileReaderSync,H=function(q){this.code=this[this.name=q]},K="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),
R=K.length,D=q.URL||q.webkitURL||q,W=D.createObjectURL,fa=D.revokeObjectURL,ga=D,Y=q.btoa,S=q.atob,la=q.ArrayBuffer,ca=q.Uint8Array;for(F.fake=L.fake=!0;R--;)H.prototype[K[R]]=R+1;D.createObjectURL||(ga=q.URL={});ga.createObjectURL=function(q){var w=q.type;null===w&&(w="application/octet-stream");if(q instanceof F)return w="data:"+w,"base64"===q.encoding?w+";base64,"+q.data:"URI"===q.encoding?w+","+decodeURIComponent(q.data):Y?w+";base64,"+Y(q.data):w+","+encodeURIComponent(q.data);if(W)return W.call(D,
q)};ga.revokeObjectURL=function(q){"data:"!==q.substring(0,5)&&fa&&fa.call(D,q)};U.append=function(q){var C=this.data;if(ca&&(q instanceof la||q instanceof ca)){var D="";q=new ca(q);for(var I=0,K=q.length;I<K;I++)D+=String.fromCharCode(q[I]);C.push(D)}else if("Blob"===w(q)||"File"===w(q))if(N)D=new N,C.push(D.readAsBinaryString(q));else throw new H("NOT_READABLE_ERR");else q instanceof F?"base64"===q.encoding&&S?C.push(S(q.data)):"URI"===q.encoding?C.push(decodeURIComponent(q.data)):"raw"===q.encoding&&
C.push(q.data):("string"!==typeof q&&(q+=""),C.push(unescape(encodeURIComponent(q))))};U.getBlob=function(q){arguments.length||(q=null);return new F(this.data.join(""),q,"raw")};U.toString=function(){return"[object BlobBuilder]"};L.slice=function(q,w,C){var D=arguments.length;3>D&&(C=null);return new F(this.data.slice(q,1<D?w:this.data.length),C,this.encoding)};L.toString=function(){return"[object Blob]"};L.close=function(){this.size=0;delete this.data};return I}(q);q.Blob=function(q,w){var I=w?w.type||
"":"",V=new F;if(q)for(var U=0,L=q.length;U<L;U++)V.append(q[U]);return V.getBlob(I)}})("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content||this);var saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(q){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var w=q.document,F=w.createElementNS("http://www.w3.org/1999/xhtml","a"),C=!q.externalHost&&"download"in F,J=function(C){var D=w.createEvent("MouseEvents");D.initMouseEvent("click",!0,!1,q,0,0,0,0,0,!1,!1,!1,!1,0,null);C.dispatchEvent(D)},I=q.webkitRequestFileSystem,V=q.requestFileSystem||
I||q.mozRequestFileSystem,U=function(w){(q.setImmediate||q.setTimeout)(function(){throw w;},0)},L=0,N=[],H=function(){for(var w=N.length;w--;){var C=N[w];"string"===typeof C?(q.URL||q.webkitURL||q).revokeObjectURL(C):C.remove()}N.length=0},K=function(q,w,C){w=[].concat(w);for(var D=w.length;D--;){var I=q["on"+w[D]];if("function"===typeof I)try{I.call(q,C||q)}catch(F){U(F)}}},R=function(w,D){var H=this,S=w.type,U=!1,R,W,ja=function(){var C=(q.URL||q.webkitURL||q).createObjectURL(w);N.push(C);return C},
ka=function(){K(H,["writestart","progress","write","writeend"])},ba=function(){if(U||!R)R=ja(w);W?W.location.href=R:window.open(R,"_blank");H.readyState=H.DONE;ka()},X=function(q){return function(){if(H.readyState!==H.DONE)return q.apply(this,arguments)}},Q={create:!0,exclusive:!1},ma;H.readyState=H.INIT;D||(D="download");if(C)R=ja(w),F.href=R,F.download=D,J(F),H.readyState=H.DONE,ka();else{q.chrome&&S&&"application/octet-stream"!==S&&(ma=w.slice||w.webkitSlice,w=ma.call(w,0,w.size,"application/octet-stream"),
U=!0);I&&"download"!==D&&(D+=".download");if("application/octet-stream"===S||I)W=q;V?(L+=w.size,V(q.TEMPORARY,L,X(function(q){q.root.getDirectory("saved",Q,X(function(q){var b=function(){q.getFile(D,Q,X(function(b){b.createWriter(X(function(e){e.onwriteend=function(f){W.location.href=b.toURL();N.push(b);H.readyState=H.DONE;K(H,"writeend",f)};e.onerror=function(){var b=e.error;b.code!==b.ABORT_ERR&&ba()};["writestart","progress","write","abort"].forEach(function(b){e["on"+b]=H["on"+b]});e.write(w);
H.abort=function(){e.abort();H.readyState=H.DONE};H.readyState=H.WRITING}),ba)}),ba)};q.getFile(D,{create:!1},X(function(d){d.remove();b()}),X(function(d){d.code===d.NOT_FOUND_ERR?b():ba()}))}),ba)}),ba)):ba()}},D=R.prototype,W=function(q,w){return new R(q,w)};D.abort=function(){this.readyState=this.DONE;K(this,"abort")};D.readyState=D.INIT=0;D.WRITING=1;D.DONE=2;D.error=D.onwritestart=D.onprogress=D.onwrite=D.onabort=D.onerror=D.onwriteend=null;q.addEventListener("unload",H,!1);W.unload=function(){H();
q.removeEventListener("unload",H,!1)};return W}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&null!==module?module.exports=saveAs:"undefined"!==typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});(function(){function q(){if(!(this instanceof q))return new q;for(var a in W)this[a]=W[a]}function w(a){if(!(this instanceof w))return new w(a);a=a||{};this._lexer=a.lexer||new q;this._blankNodes=Object.create(null);this._blankNodeCount=0;this._tripleStack=[];if(a.documentURI){if(0<a.documentURI.indexOf("#"))throw Error("Invalid document URI");this._baseURI=a.documentURI;this._baseURIPath=this._baseURI.replace(ra,"");this._baseURIRoot=this._baseURI.match(ja)[0]}else this._baseURIPath=this._baseURI=
null}function F(a){switch(a[0]){case '"':return{literal:a};case "_":return{blank:a.replace("b","")};default:return{token:"uri",value:a,prefix:null,suffix:null}}}"undefined"==typeof console&&(console={log:function(a){}});window.process={};process.nextTick=function(a){setTimeout(a,0)};var C={"extends":function(a,b){b.prototype=new a},stackCounterLimit:1E3,stackCounter:0,recur:function(a){C.stackCounter===C.stackCounterLimit?(C.stackCounter=0,setTimeout(a,0)):(C.stackCounter++,a())},clone:function(a){return JSON.parse(JSON.stringify(a))},
shuffle:function(a){for(var b,n,d=a.length;d;b=parseInt(Math.random()*d),n=a[--d],a[d]=a[b],a[b]=n);return a},include:function(a,b,n){for(var d=a.length-1;0<=d;d--){var z=!1,z=null==n?a[d]===b:0===n(a[d],b);if(!0===z)return!0}return!1},remove:function(a,b){for(var n=[],d=0;d<a.length;d++)a[d]!==b&&n.push(a[d]);return n},repeat:function(a,b,n,d,z){4===arguments.length&&(z={});a<b?(z._i=a,n(function(n,z){C.recur(function(){C.repeat(a+1,b,n,d,z)})},z)):d(z)},meanwhile:function(a,b,n,d){3===arguments.length&&
(d={});null==d._stack_counter&&(d._stack_counter=0);!0===a?b(function(a,b,m){39==m._stack_counter%40?(m._stack_counter+=1,setTimeout(function(){C.neanwhile(a,b,n,m)},0)):(m._stack_counter+=1,C.meanwhile(a,b,n,m))},d):n(d)},seq:function(){var a=arguments;return function(b){C.repeat(0,a.length,function(b,m){var d=arguments.callee;a[m._i](function(){b(d,m)})},function(){b()})}},partition:function(a,b){for(var n=a.length%b,d=[],z=0;z<n;z++)d.push(null);n=[];for(z=0;z<a.length;z++)d.push(a[z]),0==d.length%
b&&(n.push(d),d=[]);return n},keys:function(a){var b=[],n;for(n in a)b.push(n);return b},iso8601:function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"},parseStrictISO8601:function(a){var b=a.match(/([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/);a=0;var n=new Date(b[1],0,1);if(b[3])n.setMonth(b[3]-
1);else throw"missing ISO8061 component";if(b[5])n.setDate(b[5]);else throw"missing ISO8061 component";if(b[7])n.setHours(b[7]);else throw"missing ISO8061 component";if(b[8])n.setMinutes(b[8]);else throw"missing ISO8061 component";if(b[10])n.setSeconds(b[10]);else throw"missing ISO8061 component";b[12]&&n.setMilliseconds(1E3*Number("0."+b[12]));b[14]&&(a=60*Number(b[16])+Number(b[17]),a*="-"==b[15]?1:-1);a-=n.getTimezoneOffset();b=new Date;b.setTime(Number(Number(n)+6E4*a));return b},parseISO8601:function(a){var b=
a.match(/([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/);a=0;var n=new Date(b[1],0,1);b[3]&&n.setMonth(b[3]-1);b[5]&&n.setDate(b[5]);b[7]&&n.setHours(b[7]);b[8]&&n.setMinutes(b[8]);b[10]&&n.setSeconds(b[10]);b[12]&&n.setMilliseconds(1E3*Number("0."+b[12]));b[14]&&(a=60*Number(b[16])+Number(b[17]),a*="-"==b[15]?1:-1);a-=n.getTimezoneOffset();b=new Date;b.setTime(Number(Number(n)+6E4*a));return b},parseISO8601Components:function(a){a=
a.match(/([0-9]{4})(-([0-9]{2}))(-([0-9]{2}))(T([0-9]{2}):([0-9]{2})(:([0-9]{2}))?(.([0-9]+))?)?(Z|([-+])([0-9]{2})(:([0-9]{2}))?)?/);var b,n,d,z,f,e,g,k;b=Number(a[1]);n=a[3]-1;d=Number(a[5]);z=Number(a[7]);f=Number(a[8]);e=Number(a[10]);a[12]&&(g=1E3*Number("0."+a[12]));"Z"===a[13]?k=0:a[14]?(k=0,a[17]&&(k=Number(a[17])),k+=60*Number(a[15]),k*="-"==a[14]?-1:1):null==a[14]&&a[11]&&(k=60*Number(a[12]));return{year:isNaN(b)?null:b,month:isNaN(n)?null:n,date:isNaN(d)?null:d,hours:isNaN(z)?null:z,minutes:isNaN(f)?
null:f,seconds:isNaN(e)?null:e,millisecs:isNaN(g)?null:g,timezone:isNaN(k)?null:k}},compareDateComponents:function(a,b){var n=C.parseISO8601Components(a),d=C.parseISO8601Components(b);if(null==n.timezone&&null==d.timezone||null!=n.timezone&&null!=d.timezone)return n=C.parseISO8601(a),d=C.parseISO8601(b),n.getTime()==d.getTime()?0:n.getTime()<d.getTime()?-1:1;if(null!=n.timezone&&null==d.timezone){var n=C.parseISO8601(a),d=C.parseISO8601(b),n=n.getTime(),d=d.getTime(),z=50400;return n<d&&n<d+z?-1:
n>d&&n>d-z?1:null}n=C.parseISO8601(a);d=C.parseISO8601(b);n=n.getTime();d=d.getTime();z=50400;return n<d&&n+z<d?-1:n>d&&n+z>d?1:null},lexicalFormLiteral:function(a,b){var n=a.value,d=a.lang,z=a.type,f=null;null!=n&&null!=z&&"string"!=typeof z?(n=z.value,null==n&&(n=z.suffix,z=b.namespaces[z.prefix],a.type=z+n,n=z+n),f=-1!=n.indexOf("hexBinary")?'"'+a.value.toLowerCase()+'"^^<'+n+">":'"'+a.value+'"^^<'+n+">"):f=null==d&&null==z?'"'+n+'"':null==z?'"'+n+'"@'+d:-1!=z.indexOf("hexBinary")?'"'+a.value.toLowerCase()+
'"^^<'+z+">":'"'+a.value+'"^^<'+z+">";return f},lexicalFormBaseUri:function(a,b){var n=null;b=b||{};if(null==a.value)var n=a.prefix,d=a.suffix,z=b.namespaces[n],n=null!=z?z+d:n+":"+d;else n=a.value;if(null===n)return null;-1==n.indexOf(":")&&(n=(b.base||"")+n);return n},lexicalFormTerm:function(a,b){if("uri"===a.token)return{uri:C.lexicalFormBaseUri(a,b)};if("literal"===a.token)return{literal:C.lexicalFormLiteral(a,b)};if("blank"===a.token)return{blank:"_:"+a.value};throw"Error, cannot get lexical form of unknown token: "+
a.token;},normalizeUnicodeLiterals:function(a){for(var b=a.match(/\\u[0-9abcdefABCDEF]{4,4}/g)||[],n={},d=0;d<b.length;d++)null==n[b[d]]&&(n[b[d]]=!0,a=a.replace(new RegExp("\\"+b[d],"g"),eval("'"+b[d]+"'")));return a},hashTerm:function(a){try{if(null==a)return"";if("uri"===a.token)return"u"+a.value;if("blank"===a.token)return"b"+a.value;if("literal"===a.token){var b="l"+a.value,b=b+(a.type||"");return b+=a.lang||""}}catch(n){if("object"===typeof a){b="";for(p in a)b=b+p+a[p];return b}return a}}},
J;J=function(a){var b=[],n={},d=!1,z,f=a.maxSize||10;z=function(a,b){return n[b].priority-n[a].priority};var e=function(){b.sort(z);d=!0};return{debugContents:b,debugStore:n,debugSort:e,push:function(a,z){if(b.length===f){d||e();if(null==n[a]){delete n[b[0]];b[0]=a;var g=n[b[b.length-1]].priority-1;n[a]={object:z,priority:g}}else g=n[b[b.length-1]].priority-1,n[a].priority=g;d=!1}else 0===b.length?(b.push(a),n[a]={object:z,priority:1E3}):(g=n[b[b.length-1]].priority-1,null==n[a]?(n[a]={object:z,priority:g},
b.push(a)):(n[a].priority=g,d=!1))},remove:function(a){if(null!=n[a]){delete n[a];for(var d=null,z=0;z<b.length;z++)if(b[z]===a){d=z;break}null!=d&&b.splice(d,1)}},fetch:function(a){var z=n[a];return null!=n[a]?(d||e(),n[a].priority=n[b[b.length-1]].priority-1,d=!1,z.object):null}}};var I={Tree:function(a,b,n,d){if(0!=arguments.length){var z=null;if(!0===n)try{if(z=window.localStorage,null==z)throw"not found";}catch(f){throw"Local storage is not present, cannot create persistent storage";}null==z&&
(z=function(){var a={};return{setItem:function(b,n){a[b]=n},getItem:function(b){return a[b]||null},removeItem:function(b){delete a[b]},get:function(b){var n=0,m;for(m in a){if(b===n)return m;n++}return""},length:a.length}}());this.storage=z;this.order=a;this.name=b;this.diskManager=new I.LocalStorageManager(b,z,d);this.root=this.diskManager._readRootNode();null==this.root?(this.root=this._allocateNode(),this.root.isLeaf=!0,this.root.level=0,this._diskWrite(this.root),this._updateRootNode(this.root),
this.root=this.root.pointer):this.root=this.diskManager._diskRead(this.root).pointer;this.comparator=function(a,b){return a<b?-1:a>b?1:0};this.merger=null}}};I.Tree.prototype._allocateNode=function(){return new I.Node};I.Tree.prototype._diskWrite=function(a){this.diskManager._diskWrite(a)};I.Tree.prototype._diskRead=function(a){return this.diskManager._diskRead(a)};I.Tree.prototype._diskDelete=function(a){this.diskManager._diskDelete(a)};I.Tree.prototype._updateRootNode=function(a){this.diskManager._updateRootNode(a);
return a};I.Tree.prototype.search=function(a,b){for(var n=!0,d=this._diskRead(this.root);n;){for(var z=0;z<d.numberActives&&1===this.comparator(a,d.keys[z].key);)z++;if(z<d.numberActives&&0===this.comparator(d.keys[z].key,a))return null!=b&&1==b?!0:d.keys[z].data;!0===d.isLeaf?n=!1:d=this._diskRead(d.children[z])}return null};I.Tree.prototype.walk=function(a){this._walk(a,this._diskRead(this.root))};I.Tree.prototype._walk=function(a,b){if(b.isLeaf)for(var n=0;n<b.numberActives;n++)a(b.keys[n]);else{for(n=
0;n<b.numberActives;n++)this._walk(a,this._diskRead(b.children[n])),a(b.keys[n]);this._walk(a,this._diskRead(b.children[b.numberActives]))}};I.Tree.prototype.walkNodes=function(a){this._walkNodes(a,this._diskRead(this.root))};I.Tree.prototype._walkNodes=function(a,b){if(b.isLeaf)a(b);else{a(b);for(var n=0;n<b.numberActives;n++)this._walkNodes(a,this._diskRead(b.children[n]));this._walkNodes(a,this._diskRead(b.children[b.numberActives]))}};I.Tree.prototype._splitChild=function(a,b,n){var d=this._allocateNode();
d.isLeaf=n.isLeaf;d.level=n.level;d.numberActives=this.order-1;var z=n.keys[this.order-1];n.keys[this.order-1]=null;for(var f=0;f<this.order-1;f++)d.keys[f]=n.keys[f+this.order],n.keys[f+this.order]=null,n.isLeaf||(d.children[f]=n.children[f+this.order],n.children[f+this.order]=null);n.isLeaf||(d.children[f]=n.children[f+this.order],n.children[f+this.order]=null);n.numberActives=this.order-1;for(f=a.numberActives+1;f>b+1;f--)a.children[f]=a.children[f-1];this._diskWrite(d);a.children[b+1]=d.pointer;
for(f=a.numberActives;f>b;f--)a.keys[f]=a.keys[f-1];a.keys[b]=z;a.numberActives++;this._diskWrite(a);this._diskWrite(n)};I.Tree.prototype.insert=function(a,b){var n=this._diskRead(this.root);if(n.numberActives===2*this.order-1){var d=this._allocateNode();d.isLeaf=!1;d.level=n.level+1;d.numberActives=0;d.children[0]=n.pointer;this._diskWrite(d);this._splitChild(d,0,n);this.root=d.pointer;this._updateRootNode(d);this._insertNonFull(d,a,b)}else this._insertNonFull(n,a,b)};I.Tree.prototype._insertNonFull=
function(a,b,n){for(var d=a.numberActives-1;!a.isLeaf;){for(;0<=d&&-1===this.comparator(b,a.keys[d].key);)d--;d++;var z=this._diskRead(a.children[d]);z.numberActives===2*this.order-1&&(this._splitChild(a,d,z),1===this.comparator(b,a.keys[d].key)&&d++);a=this._diskRead(a.children[d]);d=a.numberActives-1}for(;0<=d&&-1===this.comparator(b,a.keys[d].key);)a.keys[d+1]=a.keys[d],d--;a.keys[d+1]={key:b,data:n};a.numberActives++;this._diskWrite(a)};I.Tree.prototype["delete"]=function(a){for(var b=this._diskRead(this.root),
n=null,d=!0,z=null,f=null,e=null,g=!0;!0===g;){for(g=!1;!0===d;){s=0;if(0===b.numberActives)return!1;for(;s<b.numberActives&&1===this.comparator(a,b.keys[s].key);)s++;z=s;s<b.numberActives&&0===this.comparator(a,b.keys[s].key)&&(d=!1);if(!0===d){if(!0===b.isLeaf)return!1;n=b;b=this._diskRead(b.children[s]);if(null===b)return!1;z===n.numberActives?(f=this._diskRead(n.children[z-1]),e=null):0===z?(f=null,e=this._diskRead(n.children[1])):(f=this._diskRead(n.children[z-1]),e=this._diskRead(n.children[z+
1]));b.numberActives===this.order-1&&null!=n&&(null!=e&&e.numberActives>this.order-1?(this._moveKey(n,s,-1),b=this._diskRead(b.pointer)):null!=f&&f.numberActives>this.order-1?(this._moveKey(n,s,1),b=this._diskRead(b.pointer)):null!=f&&f.numberActives===this.order-1?b=this._mergeSiblings(n,s,-1):null!=e&&e.numberActives===this.order-1&&(b=this._mergeSiblings(n,s,1)))}}if(b.isLeaf&&b.numberActives>this.order-1||b.isLeaf&&b.pointer===this.root)return this._deleteKeyFromNode(b,z),!0;try{if(!1===b.isLeaf)if(f=
n=null,(n=this._diskRead(b.children[z])).numberActives>this.order-1){var k=this._getMaxKeyPos(n);a=k.node.keys[k.index];b.keys[z]=a;this._diskWrite(b);b=n;a=a.key;d=g=!0}else if((n=this._diskRead(b.children[z+1])).numberActives>this.order-1)k=this._getMinKeyPos(n),a=k.node.keys[k.index],b.keys[z]=a,this._diskWrite(b),b=n,a=a.key,d=g=!0;else if((n=this._diskRead(b.children[z])).numberActives===this.order-1&&(f=this._diskRead(b.children[z+1])).numberActives===this.order-1){var l=this._mergeNodes(n,
b.keys[z],f);b.children[z]=l.pointer;z++;for(var s=z;s<b.numberActives;s++)b.children[s]=b.children[s+1],b.keys[s-1]=b.keys[s];b.children[s]=null;b.keys[s-1]=null;b.numberActives--;0===b.numberActives&&this.root===b.pointer&&(this.root=l.pointer,this._updateRootNode(l));this._diskWrite(b);b=l;d=g=!0}}catch(q){console.log("!!!"),console.log(q)}b.isLeaf&&b.numberActives>this.order-1&&!1===d&&this._deleteKeyFromNode(b,z);if(!1===g)return!0}};I.Tree.prototype._moveKey=function(a,b,n){1===n&&b--;var d=
this._diskRead(a.children[b]),f=this._diskRead(a.children[b+1]);if(-1==n){d.keys[d.numberActives]=a.keys[b];d.children[d.numberActives+1]=f.children[0];f.children[0]=null;d.numberActives++;a.keys[b]=f.keys[0];for(n=1;n<f.numberActives;n++)f.keys[n-1]=f.keys[n],f.children[n-1]=f.children[n];f.children[f.numberActives-1]=f.children[f.numberActives];f.numberActives--}else{f.children[f.numberActives+1]=f.children[f.numberActives];for(n=f.numberActives;0<n;n--)f.children[n]=f.children[n-1],f.keys[n]=f.keys[n-
1];f.keys[0]=null;f.children[0]=null;f.children[0]=d.children[d.numberActives];f.keys[0]=a.keys[b];f.numberActives++;d.children[d.numberActives]=null;a.keys[b]=d.keys[d.numberActives-1];d.keys[d.numberActives-1]=null;d.numberActives--}this._diskWrite(d);this._diskWrite(f);this._diskWrite(a)};I.Tree.prototype._mergeSiblings=function(a,b,n){var d,f;b===a.numberActives?(b--,n=this._diskRead(a.children[a.numberActives-1]),f=this._diskRead(a.children[a.numberActives])):(n=this._diskRead(a.children[b]),
f=this._diskRead(a.children[b+1]));var e=this._allocateNode();e.isLeaf=n.isLeaf;e.level=n.level;for(d=0;d<this.order-1;d++)e.keys[d]=n.keys[d],e.children[d]=n.children[d];e.keys[this.order-1]=a.keys[b];e.children[this.order-1]=n.children[this.order-1];for(d=0;d<this.order-1;d++)e.keys[d+this.order]=f.keys[d],e.children[d+this.order]=f.children[d];e.children[2*this.order-1]=f.children[this.order-1];this._diskWrite(e);a.children[b]=e.pointer;for(d=b;d<a.numberActives;d++)a.keys[d]=a.keys[d+1],a.children[d+
1]=a.children[d+2];e.numberActives=n.numberActives+f.numberActives+1;a.numberActives--;for(b=a.numberActives;b<2*this.order-1;b++)a.keys[b]=null;0===a.numberActives&&this.root===a.pointer&&(this.root=e.pointer,e.isLeaf=e.level?!1:!0);this._diskWrite(e);this.root===e.pointer&&this._updateRootNode(e);this._diskWrite(a);this._diskDelete(n);this._diskDelete(f);return e};I.Tree.prototype._deleteKeyFromNode=function(a,b){var n=2*this.order-1;a.numberActives<n&&(n=a.numberActives);var d;if(!1===a.isLeaf)return!1;
for(d=b;d<n-1;d++)a.keys[d]=a.keys[d+1];a.keys.splice(n-1,a.keys.length-(n-1));a.numberActives--;this._diskWrite(a);return!0};I.Tree.prototype._mergeNodes=function(a,b,n){var d,f;d=this._allocateNode();d.isLeaf=!0;for(f=0;f<a.numberActives;f++)d.keys[f]=a.keys[f],d.children[f]=a.children[f];d.children[a.numberActives]=a.children[a.numberActives];d.keys[a.numberActives]=b;for(f=0;f<n.numberActives;f++)d.keys[f+a.numberActives+1]=n.keys[f],d.children[f+a.numberActives+1]=n.children[f];d.children[2*
this.order-1]=n.children[n.numberActives];d.numberActives=a.numberActives+n.numberActives+1;d.isLeaf=a.isLeaf;d.level=a.level;this._diskWrite(d);this._diskDelete(a);this._diskDelete(n);return d};I.Tree.prototype.audit=function(a){var b=[],n=[],d=this,f=function(f){for(var e=0;e<n.length;e++)if(0===d.comparator(n[e],f)){var z=" !!! duplicated key "+f;!0===a&&console.log(z);b.push(z)}},e=null,d=this;this.walkNodes(function(g){!0===a&&(console.log("--- Node at "+g.level+" level"),console.log(" - pointer: "+
g.pointer),console.log(" - leaf? "+g.isLeaf),console.log(" - num actives? "+g.numberActives),console.log(" - keys: "));for(var k=g.numberActives;k<g.keys.length;k++)null!=g.keys[k]&&!0===a&&(console.log(" * warning : redundant key data"),b.push(" * warning : redundant key data"));for(k=g.numberActives+1;k<g.children.length;k++)null!=g.children[k]&&!0===a&&(console.log(" * warning : redundant children data"),b.push(" * warning : redundant key data"));if(!1===g.isLeaf)for(k=0;k<g.numberActives;k++){var l=
d._diskRead(g.children[k]).keys[d._diskRead(g.children[k]).numberActives-1].key,s=d._diskRead(g.children[k+1]).keys[0].key;!0===a&&console.log("   "+g.keys[k].key+"("+l+","+s+")");if(-1===d.comparator(g.keys[k].key,l)){var q=" !!! value max left "+l+" > key "+g.keys[k].key;!0===a&&console.log(q);b.push(q)}1===d.comparator(g.keys[k].key,s)&&(q=" !!! value min right "+s+" < key "+g.keys[k].key,!0===a&&console.log(q),b.push(q));f(g.keys[k].key);n.push(g.keys[k].key)}else for(null===e?e=g.level:e!=g.level&&
(q=" !!! Leaf node with wrong level value",!0===a&&console.log(q),b.push(q)),k=0;k<g.numberActives;k++)!0===a&&console.log(" "+g.keys[k].key),f(g.keys[k].key),n.push(g.keys[k].key);g.pointer!=d.root&&(g.numberActives>2*d.order-1&&(!0===a&&(q=" !!!! MAX num keys restriction violated "),console.log(q),b.push(q)),g.numberActives<d.order-1&&(!0===a&&(q=" !!!! MIN num keys restriction violated "),console.log(q),b.push(q)))});return b};I.Tree.prototype.clear=function(){this.diskManager.clear();this.root=
this._allocateNode();this.root.isLeaf=!0;this.root.level=0;this._diskWrite(this.root);this._updateRootNode(this.root);this.root=this.root.pointer};I.Tree.prototype._getMaxKeyPos=function(a){for(var b={};null!==a;)if(!0===a.isLeaf){b.node=a;b.index=a.numberActives-1;break}else b.node=a,b.index=a.numberActives-1,a=this._diskRead(a.children[a.numberActives]);return b};I.Tree.prototype._getMinKeyPos=function(a){for(var b={};null!==a;)if(!0===a.isLeaf){b.node=a;b.index=0;break}else b.node=a,b.index=0,
a=this._diskRead(a.children[0]);return b};I.Node=function(){this.numberActives=0;this.isLeaf=null;this.keys=[];this.children=[];this.level=0};I.LocalStorageManager=function(a,b,n){this.name=a;this.storage=b;this.maxSize=n;this.bufferCache=new J({maxSize:n});this.counter=this.storage.getItem("__"+this.name+"__ID_COUNTER__")||0};I.LocalStorageManager.prototype.clear=function(){for(var a=this.storage.length,b=[],n=0;n<a;n++){var d=this.storage.key(n);0!=d.indexOf(this.name)&&0!=d.indexOf("__"+this.name)||
b.push(d)}for(n=0;n<b.length;n++)this.storage.removeItem(b[n]);this.bufferCache=new J({maxSize:this.maxSize})};I.LocalStorageManager.prototype._genIndex=function(){var a=this.name+this.counter;this.counter++;this.storage.setItem("__"+this.name+"__ID_COUNTER__",this.counter);return a};I.LocalStorageManager.prototype._diskRead=function(a){"object"===typeof a&&(a=a.pointer);var b=this.bufferCache.fetch(a);null==b&&(b=this.storage.getItem(a),null!=b&&(b=this._decode(b),b.pointer=a,this.bufferCache.push(a,
b)));return b};I.LocalStorageManager.prototype._diskWrite=function(a){null==a.pointer&&(a.pointer=this._genIndex());var b=a.children,n=[];if(!1===a.isLeaf)for(var d=0;d<b.length;d++)null==b[d]?n.push(null):"object"===typeof b[d]?n.push(b[d].pointer):n.push(b[d]);a.children=n;this.storage.setItem(a.pointer,this._encode(a));a.children=b;this.bufferCache.push(a.pointer,a)};I.LocalStorageManager.prototype._diskDelete=function(a){this.storage.removeItem(a.pointer);this.bufferCache.remove(a.pointer)};I.LocalStorageManager.prototype._updateRootNode=
function(a){if(a.pointer)this.storage.setItem("__"+this.name+"__ROOT_NODE__",a.pointer);else throw"Cannot set as root of the b-tree a node without pointer";};I.LocalStorageManager.prototype._readRootNode=function(){var a=this.storage.getItem("__"+this.name+"__ROOT_NODE__");return null==a?null:this._diskRead(a)};I.LocalStorageManager.prototype._encode=function(a){for(var b=""+a.numberActives,b=b+":"+a.pointer,b=b+":"+a.level,b=b+":"+(a.isLeaf?1:0),n=0,d="",f=0;f<a.keys.length;f++)null!=a.keys[f]&&
(d="number"===typeof a.keys[f].key?d+":"+a.keys[f].key:d+":"+("_"+(a.keys[f].key.subject||"")+"_"+(a.keys[f].key.predicate||"")+"_"+(a.keys[f].key.object||"")+"_"+(a.keys[f].key.graph||"")),d=null==a.keys[f].data?d+":n:":"string"==typeof a.keys[f].data?d+":s:"+a.keys[f].data:"number"==typeof a.keys[f].data?0==a.keys[f]%1?d+":i:"+a.keys[f].data:d+":f:"+a.keys[f].data:d+":o:"+JSON.stringify(a.keys[f].data).replace(":","&colon;"),n++);b=b+":"+n+d;if(!1===a.isLeaf){n="";for(f=d=0;f<a.children.length;f++)null!=
a.children[f]&&(n=n+":"+a.children[f],d++);b=b+":"+d+n}return b};I.LocalStorageManager.prototype._decode=function(a){var b=new I.Node;a=a.split(":");b.numberActives=parseInt(a[0]);b.pointer=a[1];b.level=parseInt(a[2]);b.isLeaf="1"===a[3]?!0:!1;for(var n=parseInt(a[4]),d=5,f,e,g,k=0;k<n;k++)f=a[d],"_"==f[0]?(f=f.split("_"),f={subject:parseInt(f[1])||null,predicate:parseInt(f[2])||null,object:parseInt(f[3])||null,graph:parseInt(f[4]||null)}):f=parseInt(a[d]),e=a[d+1],g=a[d+2],"n"===e?g=void 0:"i"===
e?g=parseInt(g):"f"===e?g=parseFloat(g):"o"===e&&(g=JSON.parse(g.replace("&colon;",":"))),b.keys.push({key:f,data:g}),d+=3;if(!1===b.isLeaf)for(n=parseInt(a[d]),d++,k=0;k<n;k++)b.children[k]=a[d],d++;return b};var V,U;V=function(a,b){this.subject=a.subject;this.predicate=a.predicate;this.object=a.object;this.graph=a.graph;this.order=b};V.prototype.comparator=function(a){for(var b=0;b<this.order.length;b++){var n=this.order[b];if(null==a[n])break;else{if(this[n]<a[n])return-1;if(this[n]>a[n])return 1}}return 0};
U=function(a){this.subject=a.subject;this.predicate=a.predicate;this.object=a.object;this.graph=a.graph;this.indexKey=[];this.keyComponents={};var b=[],n=[];a=["subject","predicate","object","graph"];for(var d=0;d<a.length;d++)"string"===typeof this[a[d]]?(n.push(a[d]),this.keyComponents[a[d]]=null):(b.push(a[d]),this.keyComponents[a[d]]=this[a[d]],this.indexKey.push(a[d]));this.order=b.concat(n);this.key=new V(this.keyComponents,this.order)};var L;L=function(a,b){0!=arguments&&(this.componentOrder=
a.componentOrder,I.Tree.call(this,a.order,a.name,a.persistent,a.cacheMaxSize),this.comparator=function(a,b){for(var d=0;d<this.componentOrder.length;d++){var f=this.componentOrder[d],m=a[f],f=b[f];if(m<f)return-1;if(m>f)return 1}return 0},this.rangeComparator=function(a,b){for(var d=0;d<this.componentOrder.length;d++){var f=this.componentOrder[d];if(null==b[f]||null==a[f])break;else{if(a[f]<b[f])return-1;if(a[f]>b[f])return 1}}return 0},null!=b&&b(this))};C["extends"](I.Tree,L);L.prototype.insert=
function(a,b){I.Tree.prototype.insert.call(this,a,null);b&&b(!0);return!0};L.prototype.search=function(a,b){var n=I.Tree.prototype.search.call(this,a,!0);b&&b(n);return n};L.prototype.range=function(a,b){var n=null,n="string"===typeof this.root?this._rangeTraverse(this,this._diskRead(this.root),a):this._rangeTraverse(this,this.root,a);b&&b(n);return n};L.prototype._rangeTraverse=function(a,b,n){n=n.key;for(var d=[],f=[b],e;0<f.length;){b=f.shift();for(e=0;e<b.numberActives&&-1===a.rangeComparator(b.keys[e].key,
n);)e++;if(!0===b.isLeaf)for(;e<b.numberActives&&0===a.rangeComparator(b.keys[e].key,n);)d.push(b.keys[e].key),e++;else{var g=a._diskRead(b.children[e]);for(f.push(g);;)if(e<b.numberActives&&0===a.rangeComparator(b.keys[e].key,n))d.push(b.keys[e].key),e++,g=a._diskRead(b.children[e]),f.push(g);else break}}return d};var N;N=function(a,b){if(0!=arguments){this.indexMap={};this.treeOrder=a.treeOrder;this.indices="SPOG GP OGS POG GSP OS".split(" ");this.componentOrders={SPOG:["subject","predicate","object",
"graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]};for(var n=0;n<this.indices.length;n++){var d=this.indices[n];this.indexMap[d]=new L({order:this.treeOrder,componentOrder:this.componentOrders[d],persistent:a.persistent,name:(a.name||"")+d,cacheMaxSize:a.cacheMaxSize})}b&&b(this)}};N.prototype.clear=function(){for(var a=
0;a<this.indices.length;a++)this.indexMap[this.indices[a]].clear()};N.prototype._indexForPattern=function(a){a=a.indexKey;for(var b=this.indices,n=0;n<b.length;n++)for(var d=b[n],f=this.componentOrders[d],e=0;e<f.length&&!1!==C.include(a,f[e]);e++)if(e==a.length-1)return d;return"SPOG"};N.prototype.index=function(a,b){for(var n=0;n<this.indices.length;n++)this.indexMap[this.indices[n]].insert(a);b&&b(!0);return!0};N.prototype.range=function(a,b){var n=this._indexForPattern(a),n=this.indexMap[n].range(a);
b&&b(n);return n};N.prototype.search=function(a,b){var n=this.indexMap[this.indices[0]].search(a);b&&b(null!=n);return null!=n};N.prototype["delete"]=function(a,b){for(var n,d=0;d<this.indices.length;d++)n=this.indices[d],n=this.indexMap[n],n["delete"](a);b&&b(!0);return!0};var H;H=function(a,b){this.name=b||"";this.storage=null;try{this.storage=window.localStorage}catch(n){}null==this.storage&&(this.storage={setItem:function(a,b){},getItem:function(a){return null},removeItem:function(a){},key:function(a){return""},
length:0});this.uriToOID={};this.OIDToUri={};this.literalToOID={};this.OIDToLiteral={};this.blankToOID={};this.OIDToBlank={};this.defaultGraphOid=0;this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph";this.defaultGraphUriTerm={token:"uri",prefix:null,suffix:null,value:this.defaultGraphUri,oid:this.defaultGraphOid};this.oidCounter=parseInt(this.storage.getItem(this.pointer("oidCounter")))||1;null==this.storage.getItem(this.pointer("knownGraphs"))?(this.knownGraphs={},
this.storage.setItem(this.pointer("knownGraphs"),JSON.stringify(this.knownGraphs))):this.knownGraphs=JSON.parse(this.storage.getItem(this.pointer("knownGraphs")));null!=a&&a(this)};H.prototype.updateAfterWrite=function(){this.storage.setItem(this.pointer("oidCounter"),""+this.oidCounter)};H.prototype.pointer=function(a,b){"uriToOID"==a?a="uo":"OIDToUri"==a?a="ou":"literalToOID"==a?a="lo":"OIDToLiteral"==a?a="ok":"blankToOID"==a?a="bo":"OIDToBlank"==a&&(a="ob");return null==b?this.name+"_l_"+a:this.name+
"_l_"+a+"_"+b};H.prototype.clear=function(){this.uriToOID={};this.OIDToUri={};this.literalToOID={};this.OIDToLiteral={};this.blankToOID={};this.OIDToBlank={};for(var a=this.storage.length,b=this.name+"_l_",n=[],d=0;d<a;d++){var f=this.storage.key(d);0==f.indexOf(b)&&n.push(f)}for(d=0;d<n.length;d++)this.storage.removeItem(n[d])};H.prototype.registerGraph=function(a){a!=this.defaultGraphOid&&(this.knownGraphs[a]=!0,this.storage.setItem(this.pointer("knownGraphs"),JSON.stringify(this.knownGraphs)));
return!0};H.prototype.registeredGraphs=function(a){var b=[],n;for(n in this.knownGraphs)!0===a?b.push(this.retrieve(n)):b.push(n);return b};H.prototype.registerUri=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;if(null==this.uriToOID[a]){var b=this.storage.getItem(this.pointer("uriToOID",a));if(null==b){var b=this.oidCounter,n="u"+b;this.oidCounter++;this.uriToOID[a]=[b,0];this.OIDToUri[n]=a;this.storage.setItem(this.pointer("uriToOID",a),b+":0");this.storage.setItem(this.pointer("OIDToUri",
n),a)}else{var d=b.split(":"),b=parseInt(d[0]),n="u"+b,d=parseInt(d[1])+1;this.uriToOID[a]=[b,d];this.OIDToUri[n]=a;this.storage.setItem(this.pointer("uriToOID",a),b+":0")}}else n=this.uriToOID[a],b=n[0],d=n[1]+1,this.uriToOID[a]=[b,d],this.storage.setItem(this.pointer("uriToOID",a),b+":"+d);return b};H.prototype.resolveUri=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;var b=this.uriToOID[a];if(null!=b)return b[0];b=this.storage.getItem(this.pointer("uriToOID",a));if(null==b)return-1;
var n=b.split(":"),b=parseInt(n[0]),d="u"+b,n=parseInt(n[1]);this.uriToOID[a]=[b,n];this.OIDToUri[d]=a;return b};H.prototype.resolveUriCost=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;a=this.uriToOID[a];return null!=a?a[1]:-1};H.prototype.registerBlank=function(a){a=this.oidCounter;this.oidCounter++;a=""+a;this.storage.setItem(this.pointer("OIDToBlank",a),!0);this.OIDToBlank[a]=!0;return a};H.prototype.resolveBlank=function(a){a=this.oidCounter;this.oidCounter++;return""+a};
H.prototype.resolveBlankCost=function(a){return 0};H.prototype.registerLiteral=function(a){if(null==this.literalToOID[a]){var b=this.storage.getItem(this.pointer("literalToOID",a));if(null==b){var b=this.oidCounter,n="l"+b;this.oidCounter++;this.literalToOID[a]=[b,0];this.OIDToLiteral[n]=a;this.storage.setItem(this.pointer("literalToOID",a),b+":0");this.storage.setItem(this.pointer("OIDToLiteral",n),a)}else n=b.split(":"),b=parseInt(n[0]),n=parseInt(n[1])+1,this.literalToOID[a]=[b,n],this.storage.setItem(this.pointer("literalToOID",
a),b+":"+n)}else n=this.literalToOID[a],b=n[0],n=n[1]+1,this.storage.setItem(this.pointer("literalToOID",a),b+":"+n),this.literalToOID[a]=[b,n];return b};H.prototype.resolveLiteral=function(a){var b=this.literalToOID[a];if(null!=b)return b[0];var n=this.storage.getItem(this.pointer("literalToOID",a));return null!=n?(b=n.split(":"),n=parseInt(b[0]),b=parseInt(b[1]),this.literalToOID[a]=[n,b],this.OIDToLiteral["l"+n]=a,n):-1};H.prototype.resolveLiteralCost=function(a){a=this.literalToOID[a];return null!=
a?a[1]:0};H.prototype.parseLiteral=function(a){var b=a.lastIndexOf("@");if(-1!=b&&'"'===a[b-1]){var n=a.substring(1,b-1);a=a.substring(b+1,a.length);return{token:"literal",value:n,lang:a}}b=a.lastIndexOf("^^");if(-1!=b&&'"'===a[b-1]&&"<"===a[b+2]&&">"===a[a.length-1])return n=a.substring(1,b-1),a=a.substring(b+3,a.length-1),{token:"literal",value:n,type:a};n=a.substring(1,a.length-1);return{token:"literal",value:n}};H.prototype.parseUri=function(a){return{token:"uri",value:a}};H.prototype.retrieve=
function(a){var b;try{if(a===this.defaultGraphOid)return{token:"uri",value:this.defaultGraphUri,prefix:null,suffix:null,defaultGraph:!0};var n=this.OIDToUri["u"+a];if(null!=n)return this.parseUri(n);var d=this.OIDToLiteral["l"+a];if(null!=d)return this.parseLiteral(d);var f=this.OIDToBlank[""+a];if(null!=f)return{token:"blank",value:"_:"+a};n=this.storage.getItem(this.pointer("OIDToUri","u"+a));if(null!=n){this.OIDToUri["u"+a]=n;b=this.storage.getItem(this.pointer("uriToOID",n));var e=b.split(":"),
g=parseInt(e[1]);this.uriToOID[n]=[a,g];return this.parseUri(n)}d=this.storage.getItem(this.pointer("OIDToLiteral","l"+a));if(null!=d){this.OIDToLiteral["l"+a]=d;b=this.storage.getItem(this.pointer("literalToOID",d));var k=b.split(":");a=parseInt(k[0]);g=parseInt(k[1]);this.literalToOID[d]=[a,g];return this.parseLiteral(d)}f=this.storage.getItem(this.pointer("OIDToBlank",""+a));if(null!=f)return this.OIDToBlank[""+a]=!0,{token:"blank",value:"_:"+a};throw"Null value for OID";}catch(l){throw console.log("error in lexicon retrieving OID:"),
console.log(a),l.message&&console.log(l.message),l.stack&&console.log(l.stack),Error("Unknown retrieving OID in lexicon:"+a);}};H.prototype.unregister=function(a,b){try{return this.unregisterTerm(a.subject.token,b.subject),this.unregisterTerm(a.predicate.token,b.predicate),this.unregisterTerm(a.object.token,b.object),null!=a.graph&&this.unregisterTerm(a.graph.token,b.graph),!0}catch(n){return console.log("Error unregistering quad"),console.log(n.message),!1}};H.prototype.unregisterTerm=function(a,
b){if("uri"===a){if(b!=this.defaultGraphOid){var n="u"+b,d=this.OIDToUri[n],f=this.uriToOID[d],e=f[1];if(""+f[0]===""+b)0===e?(delete this.OIDToUri[n],delete this.uriToOID[d],delete this.knownGraphs[b]):this.uriToOID[d]=[b,e-1];else throw"Not matching OID : "+b+" vs "+f[0];}}else if("literal"===a)if(this.oidCounter++,n="l"+b,d=this.OIDToLiteral[n],f=this.literalToOID[d],e=f[1],""+f[0]===""+b)0===e?(delete this.OIDToLiteral[n],delete this.literalToOID[d]):this.literalToOID[d]=[b,e-1];else throw"Not matching OID : "+
b+" vs "+f[0];else"blank"===a&&delete this.OIDToBlank[""+b]};var K={load:function(a,b,n,d){jQuery.ajax({url:a,headers:{Accept:b},success:function(a,b,d){if("2"==(""+d.status)[0]){b=d.getAllResponseHeaders().split("\n");d={};for(var f=0;f<b.length;f++){var e=b[f].split(":");d[e[0]]=e[1]}n(!0,{headers:d,data:a})}},error:function(a,d,f){"3"==(""+a.status)[0]?0==redirection?n(!1,500):(a=a.getAllResponseHeaders().Location||a.getAllResponseHeaders().location,null!=a?K.load(a,b,n,redirection-1):n(!1,500)):
n(!1,a.statusCode())}})}},R=null;(function(){var a=function(a,b){a.stack="";for(var n in b)a[n]=b[n]};if("undefined"!==typeof window){var b=window.jsonld=window.jsonld||{};Exception=function(b){a(this,b)};Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var b=[],n;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&b.push(n);return b});Array.prototype.filter||(Array.prototype.filter=function(a,b){if(null==this)throw new TypeError;var n=
Object(this),d=n.length>>>0;if("function"!=typeof a)throw new TypeError;for(var f=[],e=0;e<d;e++)if(e in n){var m=n[e];a.call(b,m,e,n)&&f.push(m)}return f})}else"undefined"!==typeof module&&module.exports&&(b={},Exception=function(b){a(this,b);this.stack=Error().stack});R=b;var n={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",
cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},d={"boolean":"http://www.w3.org/2001/XMLSchema#boolean","double":"http://www.w3.org/2001/XMLSchema#double",
integer:"http://www.w3.org/2001/XMLSchema#integer"},f=function(a,b,n){b in a?a[b].constructor===Array?a[b].push(n):a[b]=[a[b],n]:a[b]=n},e=function(a){var b;if(a.constructor===Object){b={};var n=Object.keys(a).sort(),d;for(d in n){var f=n[d];b[f]=e(a[f])}}else if(a.constructor===Array)for(d in b=[],a)b[d]=e(a[d]);else b=a;return b},g=function(a){var b={"@id":"@id","@language":"@language","@literal":"@literal","@type":"@type"};if(a){var n={},d;for(d in a)a[d].constructor===String&&a[d]in b&&(n[a[d]]=
d);for(d in n)b[d]=n[d]}return b},k=function(a,b){var n=null;b in a&&(a[b].constructor===String?n=a[b]:a[b].constructor===Object&&"@id"in a[b]&&(n=a[b]["@id"]));return n},l=function(a,b,n){var d=null,f;for(f in a)if(0<f.length&&"@"!==f[0]&&b===k(a,f)){d=f;null!==n&&(n[f]=e(a[f]));break}null===d&&"@type"===b&&(d=g(a)["@type"]);if(null===d)for(f in a)if(0<f.length&&"@"!==f[0]){var m=k(a,f);if(null!==m&&0===b.indexOf(m)&&b.length>m.length){d=f+":"+b.substr(m.length);null!==n&&(n[f]=e(a[f]));break}}null===
d&&(d=b);return d},s=function(a,b,n){var d=b,f=g(a),m=b.indexOf(":");if(-1!==m)f=b.substr(0,m),f in a&&(d=k(a,f)+b.substr(m+1),null!==n&&(n[f]=e(a[f])));else if(b in a)d=k(a,b),null!==n&&(n[b]=e(a[b]));else for(var z in f)if(b===f[z]){d=z;break}return d},q=function(a){var b=!1;null===a||a.constructor!==Object||"@literal"in a||(b=1<Object.keys(a).length||!("@id"in a));return b};b.normalize=function(a){return(new t).normalize(a)};b.expand=function(a){return(new t).expand({},null,a)};b.compact=function(a,
n){var d=null;if(null!==n){n=b.expand(n);var f;n.constructor===Array?(d=[],f=n):f=[n];a.constructor===Array&&(a=b.mergeContexts({},a));for(var z in f){var g={},k=(new t).compact(e(a),null,f[z],g);if(0<Object.keys(g).length){var v=g,g={},l=Object.keys(v).sort(),x=void 0;for(x in l){var s=l[x];g[s]=v[s]}v=Object.keys(k);v.sort();v.unshift("@context");k["@context"]=g;var g={},q;for(q in v)l=v[q],g[l]=k[l];k=g}null===d?d=k:d.push(k)}}return d};b.mergeContexts=function(a,n){a.constructor===Array&&(a=b.mergeContexts({},
a));var d=e(a);if(n.constructor===Array)for(var f in n)d=b.mergeContexts(d,n[f]);else{for(var z in n)if(0!==z.indexOf("@"))for(var g in d)if(d[g]===n[z]){delete d[g];break}for(z in n)d[z]=e(n[z])}return d};b.expandTerm=s;b.compactIri=function(a,b){return l(a,b,null)};b.frame=function(a,b,n){return(new t).frame(a,b,n)};b.toTriples=function(a,n,d){var f=null;a=b.normalize(a);d=d||null;null===d&&(f=[],d=function(a,b,d){f.push({subject:C.lexicalFormTerm(a),predicate:C.lexicalFormTerm(b),object:C.lexicalFormTerm(d),
graph:n})});var e=!1,z;for(z in a){var g=a[z],k=g["@id"],k="_"==k[0]?{token:"blank",value:k.split(":")[1]}:{token:"uri",value:k},v;for(v in g)if("@id"!==v){var l=g[v];l.constructor!==Array&&(l=[l]);for(var x in l)if(e=l[x],"@type"===v||"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===v?(v="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",e={token:"uri",value:e}):"string"===typeof e?e={token:"literal",value:e}:null!=e["@id"]?e="_"==e["@id"][0]?{token:"blank",value:e["@id"].split(":")[1]}:{token:"uri",
value:e["@id"]}:null!=e["@type"]?e={token:"literal",value:e["@literal"],type:e["@type"]}:null!=e["@language"]&&(e={token:"literal",value:e["@literal"],lang:e["@language"]}),e=!1===d(k,{token:"uri",value:v},e))break;if(e)break}if(e)break}return f};b.resolve=function(a,b,n){var d={},f=function(a,b){if(a.constructor===Array)for(var n in a)f(a[n]);else if(a.constructor===Object)for(var e in a)if("@context"===e)if(a[e].constructor===Array){var m=a[e];for(n in m)m[n].constructor===String&&(b?m[n]=d[m[n]]:
d[m[n]]={})}else a[e].constructor===String&&(b?a[e]=d[a[e]]:d[a[e]]={})};f(a,!1);var e=Object.keys(d).length,m=null;if(0===e)n(a,m);else for(var z in d)b(z,function(b,g){--e;if(null===b)m=m||[],m.push({url:z,error:g});else try{d[z]=b.constructor===String?JSON.parse(b)["@context"]:b["@context"]}catch(k){m=m||[],m.push({url:z,error:k})}0===e&&(null===m&&f(a,!0),n(a,m))})};var t=function(){};t.prototype.compact=function(a,b,n,f){var m,z=g(a);if(null===n)m=null,this.getCoerceType(a,b,f);else if(n.constructor===
Array){m=[];for(var k in n)m.push(this.compact(a,b,n[k],f))}else if(n.constructor===Object&&"@id"in n&&n["@id"].constructor===Array)m={},m[z["@id"]]=this.compact(a,b,n["@id"],f);else if(q(n)){m={};for(var s in n)"@context"!==n[s]&&(z=l(a,s,f),z===s&&z in m||(m[z]=this.compact(a,s,n[s],f)))}else{b=this.getCoerceType(a,b,f);k=null;n.constructor===Object?"@language"in n||(k="@type"in n?n["@type"]:"@id"in n?"@id":b):n.constructor===String&&(k=b);null!==b||k!==d["boolean"]&&k!==d.integer&&k!==d["double"]||
(b=k);if(null!==b){if(null===k)throw{message:"Cannot coerce type when a language is specified. The language information would be lost."};if(k!==b)throw new Exception({message:"Cannot coerce type because the type does not match.",type:k,expected:b});n.constructor===Object?"@id"in n?m=n["@id"]:"@literal"in n&&(m=n["@literal"]):m=n;b===d["boolean"]?m="true"===m||0!=m:b===d["double"]?m=parseFloat(m):b===d.integer&&(m=parseInt(m))}else if(n.constructor===Object)for(s in m={},n)m[z[s]]=n[s];else m=e(n);
"@id"===k&&(m.constructor===Object?m[z["@id"]]=l(a,m[z["@id"]],f):m=l(a,m,f))}return m};t.prototype.expand=function(a,n,k){var l;if(null===k)l=null;else if(null===n&&k.constructor===String)l=s(a,k,null);else if(k.constructor===Array){l=[];for(var q in k)l.push(this.expand(a,n,k[q]))}else if(k.constructor===Object){"@context"in k&&(a=b.mergeContexts(a,k["@context"]));l={};for(var A in k)"@embed"===A||"@explicit"===A||"@default"===A||"@omitDefault"===A?f(l,A,e(k[A])):"@context"!==A&&f(l,s(a,A,null),
this.expand(a,A,k[A]))}else q=this.getCoerceType(a,n,null),l=g(a),null!==q||k.constructor!==Number&&k.constructor!==Boolean||(q=k.constructor===Boolean?d["boolean"]:-1==(""+k).indexOf(".")?d.integer:d["double"]),n===l["@id"]||n===l["@type"]?l=s(a,k,null):null!==q?(l={},"@id"===q?l["@id"]=s(a,k,null):(l["@type"]=q,q===d["double"]&&(k=k.toExponential(6).replace(/(e(?:\+|-))([0-9])$/,"$10$2")),l["@literal"]=""+k)):l=""+k;return l};t.prototype.normalize=function(a){var b=[];if(null!==a){this.ng={tmp:null,
c14n:null};var d=this.expand(n,null,a);this.nameBlankNodes(d);a={};J(null,null,d,a);for(var f in a){var d=a[f],e={},m=Object.keys(d).sort(),z;for(z in m){var g=m[z];e[g]=d[g]}b.push(e)}this.canonicalizeBlankNodes(b);b.sort(function(a,b){return y(a["@id"],b["@id"])})}return b};t.prototype.getCoerceType=function(a,b,n){var d=null;b=s(a,b,null);"@id"===b||"@type"===b?d="@id":(b=l(a,b,null),b in a&&a[b].constructor===Object&&"@type"in a[b]&&(d=s(a,a[b]["@type"],n),null!==n&&(n[b]=e(a[b]))));return d};
var w=function(a){return 0===a.indexOf("_:")},Ca=function(a){return a.constructor===Object&&"@id"in a&&w(a["@id"])},y=function(a,b){var n=0;if(a.constructor===Array&&b.constructor===Array)for(var d=0;d<a.length&&0===n;++d)n=y(a[d],b[d]);else n=a<b?-1:a>b?1:0;return n},D=function(a,b,n){var d=0;n in a?d=n in b?y(a[n],b[n]):-1:n in b&&(d=1);return d},I=function(a,b){var n=0;a.constructor===String?n=b.constructor!==String?-1:y(a,b):b.constructor===String?n=1:(n=D(a,b,"@literal"),0===n&&("@literal"in
a?(n=D(a,b,"@type"),0===n&&(n=D(a,b,"@language"))):n=y(a["@id"],b["@id"])));return n},H=function(a,b){var n=0,d;for(d in a)if("@id"!==d){n=y(a[d].constructor===Array?a[d].length:1,b[d].constructor===Array?b[d].length:1);if(0===n){var f=a[d],e=b[d];f.constructor!==Array&&(f=[f],e=[e]);f=f.filter(function(a){return!Ca(a)});e=e.filter(function(a){return!Ca(a)});n=y(f.length,e.length)}if(0===n){f.sort(I);e.sort(I);for(var m=0;m<f.length&&0===n;++m)n=I(f[m],e[m])}if(0!==n)break}return n},T=function(a){var b=
-1,n={next:function(){++b;return n.current()},current:function(){return"_:"+a+b},inNamespace:function(b){return 0===b.indexOf("_:"+a)}};return n},F=function(a,b,n){if(null!==a)if(a.constructor===Array)for(var d in a)F(a[d],b,n);else if(a.constructor===Object){"@id"in a?a["@id"].constructor==Array?F(a["@id"],b,n):q(a)&&(b[a["@id"]]=a):!q(a)||"@id"in a&&!Ca(a)||n.push(a);for(var f in a)F(a[f],b,n)}},J=function(a,b,n,d){var f=null;if(null!==n)if(n.constructor===Array)for(var m in n)J(a,b,n[m],d);else if(n.constructor===
Object)if("@literal"in n||"@type"===b)f=e(n);else if(n["@id"].constructor===Array){if(null!==a)throw{message:"Embedded graph literals cannot be flattened."};for(var z in n["@id"])J(a,b,n["@id"][z],d)}else{n["@id"]in d?m=d[n["@id"]]:(m={"@id":n["@id"]},d[n["@id"]]=m);var f={"@id":m["@id"]},g;for(g in n)z=n[g],null!==z&&"@id"!==g&&(g in m?m[g].constructor!==Array&&(m[g]=[m[g]]):m[g]=[],J(m[g],g,z,d),1===m[g].length&&(m[g]=m[g][0]))}else f=n;null!==f&&null!==a&&(a.constructor===Array?(b=!1,f.constructor===
Object&&"@id"in f&&(b=0<a.filter(function(a){return a.constructor===Object&&"@id"in a&&a["@id"]===f["@id"]}).length),b||a.push(f)):a[b]=f)};t.prototype.nameBlankNodes=function(a){var b=this.ng.tmp=T("tmp"),n={},d=[];F(a,n,d);for(var f in d)if(a=d[f],!("@id"in a)){for(;b.next()in n;);a["@id"]=b.current();n[b.current()]=a}};t.prototype.renameBlankNode=function(a,b){var n=a["@id"];a["@id"]=b;var d=this.subjects;d[b]=d[n];delete d[n];this.edges.refs[b]=this.edges.refs[n];this.edges.props[b]=this.edges.props[n];
delete this.edges.refs[n];delete this.edges.props[n];var f=this.edges.refs[b].all,e;for(e in f){var m=f[e].s;m===n&&(m=b);var z=d[m],g=this.edges.props[m].all,k;for(k in g)if(g[k].s===n){g[k].s=b;var m=g[k].p,m=z[m].constructor===Object?[z[m]]:z[m].constructor===Array?z[m]:[],v;for(v in m)m[v].constructor===Object&&"@id"in m[v]&&m[v]["@id"]===n&&(m[v]["@id"]=b)}}g=this.edges.props[b].all;for(e in g){var m=g[e].s,f=this.edges.refs[m].all,l;for(l in f)f[l].s===n&&(f[l].s=b)}};t.prototype.canonicalizeBlankNodes=
function(a){this.renamed={};this.mappings={};this.serializations={};var b=this.edges={refs:{},props:{}},n=this.subjects={},d=[],f;for(f in a){var e=a[f]["@id"];n[e]=a[f];b.refs[e]={all:[],bnodes:[]};b.props[e]={all:[],bnodes:[]};w(e)&&d.push(a[f])}this.collectEdges();a=this.ng.c14n=T("c14n");var m=this.ng.tmp;for(f in d){var z=d[f],e=z["@id"];if(a.inNamespace(e)){for(;m.next()in n;);this.renameBlankNode(z,m.current());e=z["@id"]}this.serializations[e]={props:null,refs:null}}for(var m=!0,g=this;0<
d.length;){m&&(m=!1,d.sort(function(a,b){return g.deepCompareBlankNodes(a,b)}));var z=d.shift(),e=z["@id"],z=["props","refs"],k;for(k in z){var v=z[k];if(null===this.serializations[e][v]){var l={};l[e]="s1"}else l=this.serializations[e][v].m;var x=Object.keys(l);x.sort(function(a,b){return y(l[a],l[b])});var s=[];for(f in x){var G=x[f];!a.inNamespace(e)&&G in n&&(this.renameBlankNode(n[G],a.next()),s.push(G))}x=d;d=[];for(f in x){var G=x[f],q=G["@id"];if(!a.inNamespace(q)){for(var A in s)this.markSerializationDirty(q,
s[A],v)&&(m=!0);d.push(G)}}}}for(var t in b.props)if(0<b.props[t].bnodes.length){var z=n[t],B;for(B in z)0!==B.indexOf("@")&&z[B].constructor===Array&&z[B].sort(I)}};MappingBuilder=function(){this.count=1;this.processed={};this.mapping={};this.adj={};this.keyStack=[{keys:["s1"],idx:0}];this.done={};this.s=""};MappingBuilder.prototype.copy=function(){var a=new MappingBuilder;a.count=this.count;a.processed=e(this.processed);a.mapping=e(this.mapping);a.adj=e(this.adj);a.keyStack=e(this.keyStack);a.done=
e(this.done);a.s=this.s;return a};MappingBuilder.prototype.mapNode=function(a){a in this.mapping||(0===a.indexOf("_:c14n")?this.mapping[a]="c"+a.substr(6):this.mapping[a]="s"+this.count++);return this.mapping[a]};MappingBuilder.prototype.serialize=function(a,b){if(0<this.keyStack.length)for(var n=this.keyStack.pop();n.idx<n.keys.length;++n.idx){var d=n.keys[n.idx];if(!(d in this.adj)){this.keyStack.push(n);break}if(d in this.done)this.s+="_"+d;else{this.done[d]=!0;var f=d,d=this.adj[d],e=d.i;if(e in
a){var m=a[e],z="",g=!0,k=void 0;for(k in m)if("@id"!==k){g?g=!1:z+="|";var z=z+("<"+k+">"),v=m[k].constructor===Array?m[k]:[m[k]],l;for(l in v){var x=v[l];x.constructor===Object?"@id"in x?z=w(x["@id"])?z+"_:":z+("<"+x["@id"]+">"):(z+='"'+x["@literal"]+'"',"@type"in x?z+="^^<"+x["@type"]+">":"@language"in x&&(z+="@"+x["@language"])):z+='"'+x+'"'}}var f=f+("["+z+"]"),m=!0,f=f+"[",e=b.refs[e].all,s;for(s in e)m?m=!1:f+="|",f+="<"+e[s].p+">",f+=w(e[s].s)?"_:":"<"+e[s].s+">";f+="]"}f+=d.k.join("");this.s+=
f;this.keyStack.push({keys:d.k,idx:0});this.serialize(a,b)}}};t.prototype.markSerializationDirty=function(a,b,n){var d=!1;a=this.serializations[a];null!==a[n]&&b in a[n].m&&(a[n]=null,d=!0);return d};var K=function(a,b){var n=0;return n=a.length==b.length?y(a,b):a.length>b.length?y(a.substr(0,b.length),b):y(a,b.substr(0,a.length))};t.prototype.serializeCombos=function(a,b,n,d,f,m,z){if(0<z.length){m=e(m);m[d.mapNode(z[0].s)]=z[0].s;var g=d.copy();z=z.slice(1);for(var k=Math.max(1,z.length),v=0;v<
k;++v){var l=0===v?d:g.copy();this.serializeCombos(a,b,n,l,f,m,z);z.unshift.apply(z,z.splice(1,z.length))}}else if(z=Object.keys(m).sort(),d.adj[n]={i:b,k:z,m:m},d.serialize(this.subjects,this.edges),null===a[f]||0>=K(d.s,a[f].s)){for(g in z)this.serializeBlankNode(a,m[z[g]],d,f);d.serialize(this.subjects,this.edges);if(null===a[f]||0>=K(d.s,a[f].s)&&d.s.length>=a[f].s.length)a[f]={s:d.s,m:d.mapping}}};t.prototype.serializeBlankNode=function(a,b,n,d){if(!(b in n.processed)){n.processed[b]=!0;var f=
n.mapNode(b),e=n.copy(),m=this.edges[d][b].bnodes,z={},g=[],k;for(k in m)m[k].s in n.mapping?z[n.mapping[m[k].s]]=m[k].s:g.push(m[k]);m=Math.max(1,g.length);for(k=0;k<m;++k){var v=0===k?n:e.copy();this.serializeCombos(a,b,f,v,d,z,g)}}};t.prototype.deepCompareBlankNodes=function(a,b){var n=0,d=a["@id"],f=b["@id"];if(d===f)n=0;else if(n=this.shallowCompareBlankNodes(a,b),0===n)for(var m=["props","refs"],z=0;0===n&&z<m.length;++z){var n=m[z],g=this.serializations[d],k=this.serializations[f];if(null===
g[n]){var v=new MappingBuilder;"refs"===n&&(v.mapping=e(g.props.m),v.count=Object.keys(v.mapping).length+1);this.serializeBlankNode(g,d,v,n)}null===k[n]&&(v=new MappingBuilder,"refs"===n&&(v.mapping=e(k.props.m),v.count=Object.keys(v.mapping).length+1),this.serializeBlankNode(k,f,v,n));n=y(g[n].s,k[n].s)}return n};t.prototype.shallowCompareBlankNodes=function(a,b){var n=0,d=Object.keys(a),f=Object.keys(b),n=y(d.length,f.length);0===n&&(n=y(d.sort(),f.sort()));0===n&&(n=H(a,b));if(0===n)var e=this.edges.refs[a["@id"]].all,
m=this.edges.refs[b["@id"]].all,n=y(e.length,m.length);if(0===n)for(d=0;d<e.length&&0===n;++d)n=this.compareEdges(e[d],m[d]);return n};t.prototype.compareEdges=function(a,b){var n=0,d=w(a.s),f=w(b.s),e=this.ng.c14n;d!=f?n=d?1:-1:(d||(n=y(a.s,b.s)),0===n&&(n=y(a.p,b.p)),0===n&&null!==e&&(d=e.inNamespace(a.s),e=e.inNamespace(b.s),d!=e?n=d?1:-1:d&&(n=y(a.s,b.s))));return n};t.prototype.collectEdges=function(){var a=this.edges.refs,b=this.edges.props,n;for(n in this.subjects){var d=this.subjects[n],f;
for(f in d)if("@id"!==f){var e=d[f],e=e.constructor!==Array?[e]:e,m;for(m in e){var z=e[m];z.constructor===Object&&"@id"in z&&z["@id"]in this.subjects&&(z=z["@id"],a[z].all.push({s:n,p:f}),b[n].all.push({s:z,p:f}))}}}var g=this;for(n in a)a[n].all.sort(function(a,b){return g.compareEdges(a,b)}),a[n].bnodes=a[n].all.filter(function(a){return w(a.s)});for(n in b)b[n].all.sort(function(a,b){return g.compareEdges(a,b)}),b[n].bnodes=b[n].all.filter(function(a){return w(a.s)})};var N=function(a,b){var n=
!1;if(!("@type"in b)){var d=Object.keys(b).filter(function(a){return 0!==a.indexOf("@")});if(0===d.length)n=!0;else if(a.constructor===Object&&"@id"in a){var n=!0,f;for(f in d)if(!(d[f]in a)){n=!1;break}}}return n},L=function(a,b,n,d,f,e,m,z){var g=b["@id"],k=g in d?d[g]:null;if(("@embed"in n&&n["@embed"]||!("@embed"in n)&&z.defaults.embedOn)&&(null===k||k.autoembed&&!f)){if(null===k)k={},d[g]=k;else if(null!==k.parent){if(k.parent[k.key].constructor===Array){var v=k.parent[k.key],l;for(l in v)if(v[l].constructor===
Object&&"@id"in v[l]&&v[l]["@id"]===g){v[l]={"@id":b["@id"]};break}}else k.parent[k.key]={"@id":b["@id"]};var x=function(a){var b=Object.keys(d),n;for(n in b)n=b[n],n in d&&null!==d[n].parent&&d[n].parent["@id"]===a&&(delete d[n],x(n))};x(g)}k.autoembed=f;k.parent=e;k.key=m;if(!0===n["@explicit"]||z.defaults.explicitOn)for(s in b)"@id"===s||s in n||delete b[s];f=Object.keys(b);for(l in f){var s=f[l];if(0!==s.indexOf("@")){s in n?(e=n[s],m=!1):(e=b[s].constructor===Array?[]:{},m=!0);var g=b[s],g=g.constructor===
Array?g:[g],G;for(G in g)g[G].constructor===Object&&"@id"in g[G]&&g[G]["@id"]in a&&(g[G]=a[g[G]["@id"]]);b[s]=V(a,g,e,d,m,b,s,z)}}for(s in n)0===s.indexOf("@")||s in b&&null!==b[s]||(e=n[s],e.constructor===Array?b[s]=[]:(e.constructor===Array&&(e=0<e.length?e[0]:{}),!0===e["@omitDefault"]||z.defaults.omitDefaultOn||(b[s]="@default"in e?e["@default"]:null)))}else b={"@id":b["@id"]};return b},V=function(a,b,n,d,f,e,m,z){var g=null,k=-1,v;n.constructor===Array?(g=[],v=n,0===v.length&&v.push({})):(v=
[n],k=1);for(var l=[],x=0;x<v.length&&0!==k;++x){n=v[x];if(n.constructor!==Object)throw{message:"Invalid JSON-LD frame. Frame must be an object or an array.",frame:n};l[x]=[];for(var s=0;s<b.length&&0!==k;++s){var G=b[s],A=!1,t="@type";if("@type"in n&&G.constructor===Object&&t in G)for(var M=G[t].constructor===Array?G[t]:[G[t]],E=n[t].constructor===Array?n[t]:[n[t]],w=0;w<E.length&&!A;++w){var t=E[w],y;for(y in M)if(M[y]===t){A=!0;break}}if(A||N(G,n))l[x].push(G),--k}}for(var C in l)for(var ha in l[C])n=
v[C],b=l[C][ha],q(b)&&(b=L(a,b,n,d,f,e,m,z)),null===g?g=b:(n=null!==b&&b.constructor===Object&&"@id"in b&&1===Object.keys(b).length&&b["@id"]in d,null===e&&n||g.push(b));return g};t.prototype.frame=function(a,n,d){a=b.normalize(a);var f=null;if("@context"in n)f=e(n["@context"]),n=b.expand(n);else if(n.constructor===Array){0<n.length&&"@context"in n[0]&&(f=e(n[0]["@context"]));d=[];for(var z in n)d.push(b.expand(n[z]));n=d}d={defaults:{embedOn:!0,explicitOn:!1,omitDefaultOn:!1}};var g={};for(z in a)g[a[z]["@id"]]=
a[z];a=V(g,a,n,{},!1,null,null,d);null!==f&&null!==a&&(a=b.compact(f,a));return a}})();var D;D={parse:function(a,b){"string"===typeof a&&(a=JSON.parse(a));return R.toTriples(a,b)}};var W={_explicituri:/^<((?:[^\x00-\x20<>\\"\{\}\|\^\`]|\\[uU])*)>/,_string:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\.\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=\s|<)/,
_qname:/^((?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\.\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=[\s;,)#]|\.[\s#\(\[<"'])/,
_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d+\.\d+|\.\d+|\d+)(?=\s*[\s\.;,)#])/,_boolean:/^(?:true|false)(?=[\s#,;.])/,_dot:/^\.(?!\d)/,_punctuation:/^[;,\[\]\(\)]/,_fastString:/^"[^"\\]+"(?=[^"\\])/,_keyword:/^@[a-z]+(?=\s)/,_sparqlKeyword:/^(?:PREFIX|BASE)(?=\s)/i,_type:/^\^\^(?:<([^>]*)>|([A-Z_a-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c-\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd][\-0-9A-Z_a-z\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]*)?:([A-Z_a-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c-\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd][\-0-9A-Z_a-z\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]*)(?=[\s\.;,)#]))/,
_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_nonwhitespace:/^\S*/,_endOfFile:/^(?:#[^\n\r]*)?$/},fa=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,ga={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},Y=/[\x00-\x20<>\\"\{\}\|\^\`]/,S={".":"dot",";":"semicolon",",":"comma",
"[":"bracketopen","]":"bracketclose","(":"liststart",")":"listend"},la="function"===typeof setImmediate?setImmediate:function(a){setTimeout(a,0)};q.prototype={_tokenizeToEnd:function(a,b){function n(b){g=b._nonwhitespace.exec(d);b._input=null;a(Error('Syntax error: unexpected "'+g[0]+'" on line '+b._line+"."))}for(var d=this._input;;){for(var f;f=this._newline.exec(d);)d=d.substr(f[0].length,d.length),this._line++;if(f=this._whitespace.exec(d))d=d.substr(f[0].length,d.length);f={line:this._line,type:"",
value:"",prefix:""};if(this._endOfFile.test(d))return b&&(d=null,f.type="eof",a(null,f)),this._input=d;var e=d[0],g=null,k=!1;switch(e){case "<":if(g=this._explicituri.exec(d)){e=this._unescape(g[1]);if(null===e||Y.test(e))return n(this);f.type="explicituri";f.value=e}break;case '"':case "'":if(g=this._fastString.exec(d))f.type="literal",f.value=g[0];else if(g=this._string.exec(d)){e=this._unescape(g[0]);if(null===e)return n(this);f.type="literal";f.value=e.replace(/^'|'$/g,'"')}else if(g=this._tripleQuotedString.exec(d)){e=
g[1]||g[2];this._line+=e.split(/\r\n|\r|\n/).length-1;e=this._unescape(e);if(null===e)return n(this);f.type="literal";f.value=e.replace(/^'|'$/g,'"')}break;case "@":if("literal"===this._prevTokenType&&(g=this._langcode.exec(d)))f.type="langcode",f.value=g[1];else if(g=this._keyword.exec(d))f.type=g[0];break;case "^":if(g=this._type.exec(d))f.type="type",g[2]?(f.prefix=g[2],f.value=g[3]):f.value=g[1];break;case ".":if(g=this._dot.test(d)){f.type="dot";g=["."];break}case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":case "+":case "-":if(g=
this._number.exec(d))f.type="literal",f.value='"'+g[0]+'"^^<http://www.w3.org/2001/XMLSchema#'+(g[1]?"double>":/^[+\-]?\d+$/.test(g[0])?"integer>":"decimal>");break;case "B":case "b":case "p":case "P":(g=this._sparqlKeyword.exec(d))?f.type=g[0].toUpperCase():k=!0;break;case "f":case "t":(g=this._boolean.exec(d))?(f.type="literal",f.value='"'+g[0]+'"^^<http://www.w3.org/2001/XMLSchema#boolean>'):k=!0;break;case "a":(g=this._shortPredicates.exec(d))?(f.type="abbreviation",f.value="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):
k=!0;break;case ",":case ";":case "[":case "]":case "(":case ")":g=this._punctuation.exec(e);f.type=S[e];break;default:k=!0}if(k)if(("@prefix"===this._prevTokenType||"PREFIX"===this._prevTokenType)&&(g=this._prefix.exec(d)))f.type="prefix",f.value=g[1]||"";else if((g=this._qname.exec(d))||b&&(g=this._qname.exec(d+" ")))f.type="qname",f.prefix=g[1]||"",f.value=this._unescape(g[2]);if(null===g)return b||!/^'''|^"""/.test(d)&&/\n|\r/.test(d)?n(this):this._input=d;a(null,f);this._prevTokenType=f.type;
d=d.substr(g[0].length,d.length)}},_unescape:function(a){try{return a.replace(fa,function(a,b,d,f){if(b){a=parseInt(b,16);if(isNaN(a))throw Error();return String.fromCharCode(a)}if(d){a=parseInt(d,16);if(isNaN(a))throw Error();return 65535>a?String.fromCharCode(a):String.fromCharCode(Math.floor((a-65536)/1024)+55296)+String.fromCharCode((a-65536)%1024+56320)}a=ga[f];if(!a)throw Error();return a})}catch(b){return null}},tokenize:function(a,b){function n(a){null!==f._input&&(f._input+=a,f._tokenizeToEnd(b,
!1))}function d(){null!==f._input&&f._tokenizeToEnd(b,!0)}var f=this;this._line=1;"string"===typeof a?(this._input=a,la(function(){f._tokenizeToEnd(b,!0)})):(this._input="",a&&"function"!==typeof a?("function"===typeof a.setEncoding&&a.setEncoding("utf8"),a.on("data",n),a.on("end",d)):(this.addChunk=n,this.end=d,b||(b=a)))}};var ca=/^[a-z]+:/,ra=/[^\/]*$/,ja=/^(?:[a-z]+:\/*)?[^\/]*/,ka=function(){};w.prototype={_readInTopContext:function(a){switch(a.type){case "eof":return this._callback(null,null,
this._prefixes);case "@prefix":return this._sparqlStyle=!1,this._readPrefix;case "PREFIX":return this._sparqlStyle=!0,this._readPrefix;case "@base":return this._sparqlStyle=!1,this._readBaseURI;case "BASE":return this._sparqlStyle=!0,this._readBaseURI;default:return this._readSubject(a)}},_readSubject:function(a){switch(a.type){case "explicituri":null===this._baseURI||ca.test(a.value)?this._subject=a.value:this._subject=this._resolveURI(a.value);break;case "qname":if("_"===a.prefix)this._subject=
this._blankNodes[a.value]||(this._blankNodes[a.value]="_:b"+this._blankNodeCount++);else{var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._subject=b+a.value}break;case "bracketopen":return this._subject="_:b"+this._blankNodeCount++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case "liststart":return this._tripleStack.push({subject:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",
predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;default:return this._error("Expected subject but got "+a.type,a)}this._subjectHasPredicate=!1;return this._readPredicate},_readPredicate:function(a){switch(a.type){case "explicituri":case "abbreviation":null===this._baseURI||ca.test(a.value)?this._predicate=a.value:this._predicate=this._resolveURI(a.value);break;case "qname":if("_"===a.prefix)return this._error("Disallowed blank node as predicate",a);var b=this._prefixes[a.prefix];
if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._predicate=b+a.value;break;case "bracketclose":return this._readBlankNodeTail(a,!0);case "dot":return this._subjectHasPredicate?this._readPunctuation(a,!0):this._error("Unexpected dot",a);case "semicolon":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',a)}this._subjectHasPredicate=!0;return this._readObject},_readObject:function(a){switch(a.type){case "explicituri":null===
this._baseURI||ca.test(a.value)?this._object=a.value:this._object=this._resolveURI(a.value);break;case "qname":if("_"===a.prefix)this._object=this._blankNodes[a.value]||(this._blankNodes[a.value]="_:b"+this._blankNodeCount++);else{var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._object=b+a.value}break;case "literal":return this._object=a.value,this._readDataTypeOrLang;case "bracketopen":return a="_:b"+this._blankNodeCount++,this._tripleStack.push({subject:this._subject,
predicate:this._predicate,object:a,type:"blank"}),this._subject=a,this._readBlankNodeHead;case "liststart":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',a)}return this._getTripleEndReader()},_readBlankNodeHead:function(a){return"bracketclose"===a.type?this._readBlankNodeTail(a,!0):this._readPredicate(a)},
_readBlankNodeTail:function(a,b){if("bracketclose"!==a.type)return this._readPunctuation(a);!0!==b&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,context:"n3/contexts#default"});var n=this._tripleStack.pop();this._subject=n.subject;return null!==n.object?(this._predicate=n.predicate,this._object=n.object,this._getTripleEndReader()):this._readPredicate},_readDataTypeOrLang:function(a){switch(a.type){case "type":if(""===a.prefix)a=a.value;else{var b=this._prefixes[a.prefix];
if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);a=b+a.value}this._object+="^^<"+a+">";return this._getTripleEndReader();case "langcode":return this._object+="@"+a.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,a)}},_readListItem:function(a){var b=null,n=null,d=this._subject,f=this._tripleStack,e=f[f.length-1],g=this._readListItem;switch(a.type){case "explicituri":b=a.value;break;case "qname":if("_"===a.prefix)b=this._blankNodes[a.value]||
(this._blankNodes[a.value]="_:b"+this._blankNodeCount++);else{b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);b+=a.value}break;case "literal":b=a.value;g=this._readDataTypeOrLang;break;case "bracketopen":n="_:b"+this._blankNodeCount++;b="_:b"+this._blankNodeCount++;f.push({subject:n,predicate:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",object:b,type:"blank"});this._subject=b;g=this._readBlankNodeHead;break;case "liststart":n="_:b"+this._blankNodeCount++;
f.push({subject:n,predicate:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",object:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",type:"list"});this._subject=null;g=this._readListItem;break;case "listend":f.pop();0!==f.length&&"list"===f[f.length-1].type&&this._callback(null,{subject:e.subject,predicate:e.predicate,object:e.object,context:"n3/contexts#default"});this._subject=e.subject;if(null===e.predicate){if(g=this._readPredicate,"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"===e.subject)return g}else if(this._predicate=
e.predicate,this._object=e.object,g=this._getTripleEndReader(),"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"===e.object)return g;n="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil";break;default:return this._error('Expected list item instead of "'+a.type+'"',a)}null===n&&(this._subject=n="_:b"+this._blankNodeCount++);null===d?"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"===e.object?e.object=n:e.subject=n:this._callback(null,{subject:d,predicate:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",
object:n,context:"n3/contexts#default"});null!==b&&this._callback(null,{subject:n,predicate:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",object:b,context:"n3/contexts#default"});return g},_readPunctuation:function(a,b){var n;switch(a.type){case "dot":n=this._readInTopContext;break;case "semicolon":n=this._readPredicate;break;case "comma":n=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',a)}b||this._callback(null,{subject:this._subject,predicate:this._predicate,
object:this._object,context:"n3/contexts#default"});return n},_readPrefix:function(a){if("prefix"!==a.type)return this._error("Expected prefix to follow @prefix",a);this._prefix=a.value;return this._readPrefixURI},_readPrefixURI:function(a){if("explicituri"!==a.type)return this._error('Expected explicituri to follow prefix "'+this._prefix+':"',a);a=null===this._baseURI||ca.test(a.value)?a.value:this._resolveURI(a.value);this._prefixes[this._prefix]=a;this._prefixCallback(this._prefix,a);return this._readDeclarationPunctuation},
_readBaseURI:function(a){if("explicituri"!==a.type)return this._error("Expected explicituri to follow base declaration",a);if(0<a.value.indexOf("#"))return this._error("Invalid base URI",a);null===this._baseURI||ca.test(a.value)?this._baseURI=a.value:this._baseURI=this._resolveURI(a.value);this._baseURIPath=this._baseURI.replace(ra,"");this._baseURIRoot=this._baseURI.match(ja)[0];return this._readDeclarationPunctuation},_readDeclarationPunctuation:function(a){return this._sparqlStyle?this._readInTopContext(a):
"dot"!==a.type?this._error("Expected declaration to end with a dot",a):this._readInTopContext},_getTripleEndReader:function(){var a=this._tripleStack;if(0===a.length)return this._readPunctuation;switch(a[a.length-1].type){case "blank":return this._readBlankNodeTail;case "list":return this._readListItem}},_error:function(a,b){this._callback(Error(a+" at line "+b.line+"."))},_resolveURI:function(a){switch(a[0]){case void 0:return this._baseURI;case "#":return this._baseURI+a;case "?":return this._baseURI.replace(/(?:\?.*)?$/,
a);case "/":return this._baseURIRoot+a;default:return this._baseURIPath+a}},parse:function(a,b,n){this._readCallback=this._readInTopContext;this._prefixes={};"function"===typeof a&&(n=b,b=a,a=null);this._callback=b||ka;this._prefixCallback=n||ka;var d=this;this._lexer.tokenize(a,function(a,b){void 0!==d._readCallback&&(null!==a?d._callback(a):d._readCallback=d._readCallback(b))});a||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}};var ba;ba={async:!0,parse:function(a,b,n,d){d||(d=n,
n=b,b=null);b&&"string"===typeof b&&(b={token:"uri",value:b,prefix:null,suffix:null});n&&n.baseURI&&(n.documentURI=n.baseURI);var f=[];(new w(n)).parse(a,function(a,n){a?d(!1,a):n?f.push({subject:F(n.subject),predicate:F(n.predicate),object:F(n.object),graph:b}):d(!0,f)})}};var X;X=function(a){this.precedences=["text/turtle","text/n3","application/ld+json","application/json"];this.parsers={"text/turtle":ba,"text/n3":ba,"application/ld+json":D,"application/json":D};if(null!=a)for(var b in a.parsers)this.parsers[b]=
a.parsers[b];if(a&&null!=a.precedences)for(b in this.precedences=a.precedences,a.parsers)C.include(this.precedences,b)||this.precedences.push(b);this.acceptHeaderValue="";for(a=0;a<this.precedences.length;a++)this.acceptHeaderValue=0!=a?this.acceptHeaderValue+","+this.precedences[a]:this.acceptHeaderValue+this.precedences[a]};X.prototype.registerParser=function(a,b){this.parsers[a]=b;this.precedences.push(a)};X.prototype.unregisterParser=function(a){delete this.parsers[a];for(var b=[],n=0;n<this.precedences.length;n++)this.precedences[n]!=
a&&b.push(this.precedences[n]);this.precedences=b};X.prototype.setAcceptHeaderPrecedence=function(a){this.precedences=a};X.prototype.load=function(a,b,n){var d=this;K.load(a,this.acceptHeaderValue,function(f,e){if(1==f){var g=e.headers["Content-Type"]||e.headers["content-type"],k=e.data;if(null!=g){var g=g.split(";")[0],l;for(l in d.parsers)if(-1!=l.indexOf("/")){var s=l.split("/");if("*"===s[1]){if(-1!=g.indexOf(s[0]))return d.tryToParse(d.parsers[l],b,k,{documentURI:a},n)}else if(-1!=g.indexOf(l)||
-1!=g.indexOf(s[1]))return d.tryToParse(d.parsers[l],b,k,{documentURI:a},n)}else if(-1!=g.indexOf(l))return d.tryToParse(d.parsers[l],b,k,{documentURI:a},n);n(!1,"Unknown media type : "+g)}else console.log("Unknown media type"),console.log(e.headers),n(!1,"Uknown media type")}else n(!1,"Network error: "+e)})};X.prototype.loadFromFile=function(a,b,n,d){try{var f=this;require("fs").readFile(n.split("file:/")[1],function(e,g){if(e)throw e;g=g.toString("utf8");f.tryToParse(a,b,g,{documentURI:n},d)})}catch(e){d(!1,
e)}};X.prototype.tryToParse=function(a,b,n,d,f){try{if("string"===typeof n&&(n=C.normalizeUnicodeLiterals(n)),a.async)a.parse(n,b,d,f);else{var e=a.parse(n,b,d);null!=e?f(!0,e):f(!1,"parsing error")}}catch(g){console.log(g.message),console.log(g.stack),f(!1,"parsing error with mime type : "+g)}};var Q={AbstractQueryTree:function(){}};Q.AbstractQueryTree.prototype.parseQueryString=function(a){return ma.parser.parse(a)};Q.AbstractQueryTree.prototype.parseExecutableUnit=function(a){if("select"===a.kind||
"ask"===a.kind||"modify"===a.kind||"construct"===a.kind)return this.parseSelect(a);if("insertdata"===a.kind||"deletedata"===a.kind)return this.parseInsertData(a);if("load"===a.kind||"clear"===a.kind||"drop"===a.kind||"create"===a.kind)return a;throw Error("unknown executable unit: "+a.kind);};Q.AbstractQueryTree.prototype.parseSelect=function(a){if(null==a)return console.log("error parsing query"),null;a.pattern=this.build(a.pattern,{freshCounter:0});return a};Q.AbstractQueryTree.prototype.parseInsertData=
function(a){return null==a?(console.log("error parsing query"),null):a};Q.AbstractQueryTree.prototype.build=function(a,b){if("groupgraphpattern"===a.token)return this._buildGroupGraphPattern(a,b);if("basicgraphpattern"===a.token){var n={kind:"BGP",value:a.triplesContext};return n=Q.translatePathExpressionsInBGP(n,b)}if("graphunionpattern"===a.token){var n=this.build(a.value[0],b),d=this.build(a.value[1],b);return{kind:"UNION",value:[n,d]}}if("graphgraphpattern"===a.token)return{kind:"GRAPH",value:this.build(a.value,
b),graph:a.graph};throw Error("not supported token in query:"+a.token);};Q.translatePathExpressionsInBGP=function(a,b){var n,d=[],f,e;for(e=0;e<a.value.length;e++)if(a.value[e].predicate&&"path"===a.value[e].predicate.token){n=a.value[e];f=a.value.slice(e+1);var g=Q.translatePathExpression(n,b);n=null;if("BGP"===g.kind)d=d.concat(g.value);else{if("ZERO_OR_MORE_PATH"===g.kind||"ONE_OR_MORE_PATH"===g.kind){e=0<d.length?{kind:"JOIN",lvalue:{kind:"BGP",value:d},rvalue:g}:g;if("ZERO_OR_MORE_PATH"===g.kind)if("var"===
g.y.token&&0===g.y.value.indexOf("fresh:")&&"var"===g.x.token&&0===g.x.value.indexOf("fresh:"))for(var k=0;k<a.value.length;k++)a.value[k].object&&"var"===a.value[k].object.token&&a.value[k].object.value===g.x.value&&(n=C.clone(a.value[k]),n.object=g.y);else if("var"===g.y.token&&0===g.y.value.indexOf("fresh:"))for(k=0;k<a.value.length;k++)a.value[k].subject&&"var"===a.value[k].subject.token&&a.value[k].subject.value===g.y.value&&(n=C.clone(a.value[k]),n.subject=g.x);return 0<f.length?(g=Q.translatePathExpressionsInBGP({kind:"BGP",
value:f},b),null!=n?(d=d.concat([n]).concat(f),{kind:"UNION",value:[{kind:"JOIN",lvalue:e,rvalue:g},{kind:"BGP",value:d}]}):{kind:"JOIN",lvalue:e,rvalue:g}):e}return g}}else d.push(a.value[e]);a.value=d;return a};Q.translatePathExpression=function(a,b){if("element"===a.predicate.kind){if("+"===a.predicate.modifier){a.predicate.modifier=null;var n=Q.translatePathExpression(a,b);return{kind:"ONE_OR_MORE_PATH",path:n,x:a.subject,y:a.object}}if("*"===a.predicate.modifier)return a.predicate.modifier=null,
n=Q.translatePathExpression(a,b),{kind:"ZERO_OR_MORE_PATH",path:n,x:a.subject,y:a.object};a.predicate=a.predicate.value;return{kind:"BGP",value:[a]}}if("sequence"===a.predicate.kind){for(var n=a.subject,d=a.object,f=a.graph,e,g,k=[],l=0;l<a.predicate.value.length;l++)l!=a.predicate.value.length-1?(e={token:"var",value:"fresh:"+b.freshCounter},b.freshCounter++):e=d,g={subject:n,predicate:a.predicate.value[l],object:e},null!=f&&(g.graph=C.clone(f)),k.push(g),l!=a.predicate.value.length-1&&(n=C.clone(e));
return Q.translatePathExpressionsInBGP({kind:"BGP",value:k},b)}};Q.AbstractQueryTree.prototype._buildGroupGraphPattern=function(a,b){for(var n=a.filters||[],d={kind:"EMPTY_PATTERN"},f=0;f<a.patterns.length;f++){var e=a.patterns[f];"optionalgraphpattern"===e.token?(e=this.build(e.value,b),d="FILTER"===e.kind?{kind:"LEFT_JOIN",lvalue:d,rvalue:e.value,filter:e.filter}:{kind:"LEFT_JOIN",lvalue:d,rvalue:e,filter:!0}):(e=this.build(e,b),d="EMPTY_PATTERN"==d.kind?e:{kind:"JOIN",lvalue:d,rvalue:e})}if(0!=
n.length){if("EMPTY_PATTERN"===d.kind||"LEFT_JOIN"===d.kind&&!0===d.filter||"LEFT_JOIN"===d.kind||"JOIN"===d.kind||"UNION"===d.kind||"GRAPH"===d.kind||"BGP"===d.kind)return{kind:"FILTER",filter:n,value:d};throw Error("Unknow kind of algebra expression: "+d.kind);}return d};Q.AbstractQueryTree.prototype.collectBasicTriples=function(a,b){null==b&&(b=[]);if("select"===a.kind)b=this.collectBasicTriples(a.pattern,b);else if("BGP"===a.kind)b=b.concat(a.value);else if("ZERO_OR_MORE_PATH"===a.kind)b=this.collectBasicTriples(a.path);
else if("UNION"===a.kind)b=this.collectBasicTriples(a.value[0],b),b=this.collectBasicTriples(a.value[1],b);else if("GRAPH"===a.kind)b=this.collectBasicTriples(a.value,b);else if("LEFT_JOIN"===a.kind||"JOIN"===a.kind)b=this.collectBasicTriples(a.lvalue,b),b=this.collectBasicTriples(a.rvalue,b);else if("FILTER"===a.kind)b=this.collectBasicTriples(a.value,b);else if("construct"===a.kind)b=this.collectBasicTriples(a.pattern,b);else if("EMPTY_PATTERN"!==a.kind)throw"Unknown pattern: "+a.kind;return b};
Q.AbstractQueryTree.prototype.bind=function(a,b){null!=a.graph&&a.graph.token&&"var"===a.graph.token&&null!=b[a.graph.value]&&(a.graph=b[a.graph.value]);if(null!=a.filter){for(var n=[],d=0;d<a.filter.length;d++)a.filter[d].value=this._bindFilter(a.filter[d].value,b),n.push(a.filter[d]);a.filter=n}if("select"===a.kind)a.pattern=this.bind(a.pattern,b);else if("BGP"===a.kind)a.value=this._bindTripleContext(a.value,b);else if("ZERO_OR_MORE_PATH"===a.kind)a.path=this._bindTripleContext(a.path,b),a.x&&
"var"===a.x.token&&null!=b[a.x.value]&&(a.x=b[a.x.value]),a.y&&"var"===a.y.token&&null!=b[a.y.value]&&(a.y=b[a.y.value]);else if("UNION"===a.kind)a.value[0]=this.bind(a.value[0],b),a.value[1]=this.bind(a.value[1],b);else if("GRAPH"===a.kind)a.value=this.bind(a.value,b);else if("LEFT_JOIN"===a.kind||"JOIN"===a.kind)a.lvalue=this.bind(a.lvalue,b),a.rvalue=this.bind(a.rvalue,b);else if("FILTER"===a.kind)a.filter=this._bindFilter(a.filter[d].value,b);else if("EMPTY_PATTERN"!==a.kind)throw"Unknown pattern: "+
a.kind;return a};Q.AbstractQueryTree.prototype._bindTripleContext=function(a,b){for(var n=0;n<a.length;n++){delete a[n].graph;delete a[n].variables;for(var d in a[n]){var f=a[n][d];"var"===f.token&&null!=b[f.value]&&(a[n][d]=b[f.value])}}return a};Q.AbstractQueryTree.prototype._bindFilter=function(a,b){if(null!=a.expressionType){var n=a.expressionType;if("relationalexpression"==n)a.op1=this._bindFilter(a.op1,b),a.op2=this._bindFilter(a.op2,b);else if("conditionalor"==n||"conditionaland"==n)for(n=
0;n<a.operands.length;n++)a.operands[n]=this._bindFilter(a.operands[n],b);else if("additiveexpression"==n)for(a.summand=this._bindFilter(a.summand,b),n=0;n<a.summands.length;n++)a.summands[n].expression=this._bindFilter(a.summands[n].expression,b);else if("builtincall"==n)for(n=0;n<a.args.length;n++)a.args[n]=this._bindFilter(a.args[n],b);else if("multiplicativeexpression"==n)for(a.factor=this._bindFilter(a.factor,b),n=0;n<a.factors.length;n++)a.factors[n].expression=this._bindFilter(a.factors[n].expression,
b);else if("unaryexpression"==n)a.expression=this._bindFilter(a.expression,b);else if("irireforfunction"==n)for(n=0;n<a.factors.args;n++)a.args[n]=this._bindFilter(a.args[n],b);else"atomic"==n&&"var"==a.primaryexpression&&null!=b[a.value.value]&&(n=b[a.value.value],a.primaryexpression="uri"===n.token?"iri":"literal",a.value=n)}return a};Q.AbstractQueryTree.prototype.replace=function(a,b,n,d){null!=a.graph&&a.graph.token&&a.graph.token===b.token&&a.graph.value==b.value&&(a.graph=C.clone(n));if(null!=
a.filter){for(var f=[],e=0;e<a.filter.length;e++)a.filter[e].value=this._replaceFilter(a.filter[e].value,b,n,d),f.push(a.filter[e]);a.filter=f}if("select"===a.kind)a.pattern=this.replace(a.pattern,b,n,d);else if("BGP"===a.kind)a.value=this._replaceTripleContext(a.value,b,n,d);else if("ZERO_OR_MORE_PATH"===a.kind)a.path=this._replaceTripleContext(a.path,b,n,d),a.x&&a.x.token===b.token&&a.value===b.value&&(a.x=C.clone(n)),a.y&&a.y.token===b.token&&a.value===b.value&&(a.y=C.clone(n));else if("UNION"===
a.kind)a.value[0]=this.replace(a.value[0],b,n,d),a.value[1]=this.replace(a.value[1],b,n,d);else if("GRAPH"===a.kind)a.value=this.replace(a.value,b,n);else if("LEFT_JOIN"===a.kind||"JOIN"===a.kind)a.lvalue=this.replace(a.lvalue,b,n,d),a.rvalue=this.replace(a.rvalue,b,n,d);else if("FILTER"===a.kind)a.value=this._replaceFilter(a.value,b,n,d);else if("EMPTY_PATTERN"!==a.kind)throw"Unknown pattern: "+a.kind;return a};Q.AbstractQueryTree.prototype._replaceTripleContext=function(a,b,n,d){for(var f=0;f<a.length;f++)for(var e in a[f]){var g=
a[f][e];"var"===g.token&&"var"===b.token&&g.value===b.value?a[f][e]=n:"blank"===g.token&&"blank"===b.token&&g.value===b.value?a[f][e]=n:"literal"!==g.token&&"uri"!==g.token||"literal"!==b.token&&"uri"!==b.token||g.token!==b.token||C.lexicalFormTerm(g,d)[g.token]!==C.lexicalFormTerm(b,d)[g.token]||(a[f][e]=n)}return a};Q.AbstractQueryTree.prototype._replaceFilter=function(a,b,n,d){if(null!=a.expressionType){var f=a.expressionType;if("relationalexpression"==f)a.op1=this._replaceFilter(a.op1,b,n,d),
a.op2=this._replaceFilter(a.op2,b,n,d);else if("conditionalor"==f||"conditionaland"==f)for(f=0;f<a.operands.length;f++)a.operands[f]=this._replaceFilter(a.operands[f],b,n,d);else if("additiveexpression"==f)for(a.summand=this._replaceFilter(a.summand,b,n,d),f=0;f<a.summands.length;f++)a.summands[f].expression=this._replaceFilter(a.summands[f].expression,b,n,d);else if("builtincall"==f)for(f=0;f<a.args.length;f++)a.args[f]=this._replaceFilter(a.args[f],b,n,d);else if("multiplicativeexpression"==f)for(a.factor=
this._replaceFilter(a.factor,b,n,d),f=0;f<a.factors.length;f++)a.factors[f].expression=this._replaceFilter(a.factors[f].expression,b,n,d);else if("unaryexpression"==f)a.expression=this._replaceFilter(a.expression,b,n,d);else if("irireforfunction"==f)for(f=0;f<a.factors.args;f++)a.args[f]=this._replaceFilter(a.args[f],b,n,d);else"atomic"==f&&(d=null,a.primaryexpression==b.token&&a.value==b.value?d=n.value:"iri"==a.primaryexpression&&"uri"==b.token&&a.value==b.value&&(d=n.value),null!=d&&(a.primaryexpression=
"uri"===n.token?"iri":n.token,a.value=d))}return a};Q.AbstractQueryTree.prototype.treeWithUnion=function(a){if(null==a||null==a.kind)return!1;if("select"===a.kind)return this.treeWithUnion(a.pattern);if("BGP"===a.kind)return this.treeWithUnion(a.value);if("ZERO_OR_MORE_PATH"===a.kind)return!1;if("UNION"===a.kind)if(null!=a.value[0].value&&null!=a.value[0].value.variables&&null!=a.value[1].value&&null!=a.value[1].value.variables){if(a.value[0].variables.join("/")===a.values[1].variables.join("/"))return this.treeWithUnion(a.value[0])?
!0:this.treeWithUnion(a.value[1])}else return!0;else{if("GRAPH"===a.kind||"LEFT_JOIN"!==a.kind&&"JOIN"!==a.kind)return!1;if(this.treeWithUnion(a.lvalue))return!0;this.treeWithUnion(a.rvalue)}};var ma={};ma.parser=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,d){function f(b){h<
Da||(h>Da&&(Da=h,hb=[]),hb.push(b))}function e(){var b,a,d,n;r++;n=d=h;b=g();null!==b?(a=l(),null===a&&(a=t(),null===a&&(a=w(),null===a&&(a=y()))),null!==a?b=[b,a]:(b=null,h=n)):(b=null,h=n);null!==b&&(b={token:"query",kind:"query",prologue:b[0],units:[b[1]]});null===b&&(h=d);r--;0===r&&null===b&&f("[2] Query");return b}function g(){var b,a,d,e,n,l;r++;l=n=h;b=m();b=null!==b?b:"";if(null!==b){a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a){d=[];for(e=k();null!==e;)d.push(e),e=k();null!==d?b=
[b,a,d]:(b=null,h=l)}else b=null,h=l}else b=null,h=l;null!==b&&(b={token:"prologue",base:b[0],prefixes:b[2]});null===b&&(h=n);r--;0===r&&null===b&&f("[3] Prologue");return b}function m(){var a,d,e,g,k,l;r++;l=k=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("BASE"===b.substr(h,4)?(d="BASE",h+=4):(d=null,0===r&&f('"BASE"')),null===d&&("base"===b.substr(h,4)?(d="base",h+=4):(d=null,0===r&&f('"base"'))),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();null!==e?(g=La(),null!==g?a=[a,d,e,
g]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l;null!==a&&(d={token:"base"},d.value=a[3],a=d);null===a&&(h=k);r--;0===r&&null===a&&f("[4] BaseDecl");return a}function k(){var a,d,e,g,m,l,v,x;r++;x=v=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("PREFIX"===b.substr(h,6)?(d="PREFIX",h+=6):(d=null,0===r&&f('"PREFIX"')),null===d&&("prefix"===b.substr(h,6)?(d="prefix",h+=6):(d=null,0===r&&f('"prefix"'))),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();if(null!==e)if(g=Ma(),
null!==g){m=[];for(l=u();null!==l;)m.push(l),l=u();null!==m?(l=La(),null!==l?a=[a,d,e,g,m,l]:(a=null,h=x)):(a=null,h=x)}else a=null,h=x;else a=null,h=x}else a=null,h=x;else a=null,h=x;null!==a&&(d=a[5],e={token:"prefix"},e.prefix=a[3],e.local=d,a=e);null===a&&(h=v);r--;0===r&&null===a&&f("[5] PrefixDecl");return a}function l(){var b,a,d,e,n,g,m,k,v,x,s;r++;s=x=h;b=q();if(null!==b){a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a){d=[];for(e=C();null!==e;)d.push(e),e=C();if(null!==d){e=[];for(n=
u();null!==n;)e.push(n),n=u();if(null!==e)if(n=T(),null!==n){g=[];for(m=u();null!==m;)g.push(m),m=u();if(null!==g)if(m=H(),null!==m){k=[];for(v=u();null!==v;)k.push(v),v=u();null!==k?(v=S(),null!==v?b=[b,a,d,e,n,g,m,k,v]:(b=null,h=s)):(b=null,h=s)}else b=null,h=s;else b=null,h=s}else b=null,h=s;else b=null,h=s}else b=null,h=s}else b=null,h=s}else b=null,h=s;if(null!==b){a=b[0];e=b[2];d=b[4];b=b[6];n={named:[],implicit:[]};for(g=0;g<e.length;g++)m=e[g],"default"===m.kind?n.implicit.push(m.graph):n.named.push(m.graph);
0===n.named.length&&0===n.implicit.length&&n.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});e={kind:"select",token:"executableunit"};e.dataset=n;e.projection=a.vars;e.modifier=a.modifier;e.pattern=d;null!=b&&null!=b.limit&&(e.limit=b.limit);null!=b&&null!=b.offset&&(e.offset=b.offset);null!=b&&null!=b.order&&""!=b.order&&(e.order=b.order);null!=b&&null!=b.group&&(e.group=b.group);b=e}null===b&&(h=x);r--;0===r&&null===b&&f("[6] SelectQuery");
return b}function s(){var b,a,d,e;r++;e=h;b=q();null!==b?(a=T(),null!==a?(d=H(),null!==d?b=[b,a,d]:(b=null,h=e)):(b=null,h=e)):(b=null,h=e);r--;0===r&&null===b&&f("[7] SubSelect");return b}function q(){var a,d,e,g,m,k,l,v,x,s,G,t,A,B,M,E,w,C,y,ha,O;r++;ha=y=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("SELECT"===b.substr(h,6)?(d="SELECT",h+=6):(d=null,0===r&&f('"SELECT"')),null===d&&("select"===b.substr(h,6)?(d="select",h+=6):(d=null,0===r&&f('"select"'))),null!==d){e=[];for(g=u();null!==
g;)e.push(g),g=u();if(null!==e)if("DISTINCT"===b.substr(h,8)?(g="DISTINCT",h+=8):(g=null,0===r&&f('"DISTINCT"')),null===g&&("distinct"===b.substr(h,8)?(g="distinct",h+=8):(g=null,0===r&&f('"distinct"'))),null===g&&("REDUCED"===b.substr(h,7)?(g="REDUCED",h+=7):(g=null,0===r&&f('"REDUCED"')),null===g&&("reduced"===b.substr(h,7)?(g="reduced",h+=7):(g=null,0===r&&f('"reduced"')))),g=null!==g?g:"",null!==g){m=[];for(k=u();null!==k;)m.push(k),k=u();if(null!==m){O=h;l=[];for(v=u();null!==v;)l.push(v),v=
u();if(null!==l)if(v=Z(),null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();null!==x?l=[l,v,x]:(l=null,h=O)}else l=null,h=O;else l=null,h=O;if(null===l){O=h;l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(40===b.charCodeAt(h)?(v="(",h++):(v=null,0===r&&f('"("')),null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();if(null!==x)if(s=P(),null!==s){G=[];for(t=u();null!==t;)G.push(t),t=u();if(null!==G)if("AS"===b.substr(h,2)?(t="AS",h+=2):(t=null,0===r&&f('"AS"')),null===t&&("as"===b.substr(h,2)?
(t="as",h+=2):(t=null,0===r&&f('"as"'))),null!==t){A=[];for(B=u();null!==B;)A.push(B),B=u();if(null!==A)if(B=Z(),null!==B){M=[];for(E=u();null!==E;)M.push(E),E=u();if(null!==M)if(41===b.charCodeAt(h)?(E=")",h++):(E=null,0===r&&f('")"')),null!==E){w=[];for(C=u();null!==C;)w.push(C),C=u();null!==w?l=[l,v,x,s,G,t,A,B,M,E,w]:(l=null,h=O)}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=O}if(null!==
l)for(k=[];null!==l;){k.push(l);O=h;l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(v=Z(),null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();null!==x?l=[l,v,x]:(l=null,h=O)}else l=null,h=O;else l=null,h=O;if(null===l){O=h;l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(40===b.charCodeAt(h)?(v="(",h++):(v=null,0===r&&f('"("')),null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();if(null!==x)if(s=P(),null!==s){G=[];for(t=u();null!==t;)G.push(t),t=u();if(null!==G)if("AS"===b.substr(h,2)?
(t="AS",h+=2):(t=null,0===r&&f('"AS"')),null===t&&("as"===b.substr(h,2)?(t="as",h+=2):(t=null,0===r&&f('"as"'))),null!==t){A=[];for(B=u();null!==B;)A.push(B),B=u();if(null!==A)if(B=Z(),null!==B){M=[];for(E=u();null!==E;)M.push(E),E=u();if(null!==M)if(41===b.charCodeAt(h)?(E=")",h++):(E=null,0===r&&f('")"')),null!==E){w=[];for(C=u();null!==C;)w.push(C),C=u();null!==w?l=[l,v,x,s,G,t,A,B,M,E,w]:(l=null,h=O)}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=
O}else l=null,h=O;else l=null,h=O}else l=null,h=O;else l=null,h=O}}else k=null;if(null===k){O=h;k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(42===b.charCodeAt(h)?(l="*",h++):(l=null,0===r&&f('"*"')),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();null!==v?k=[k,l,v]:(k=null,h=O)}else k=null,h=O;else k=null,h=O}null!==k?a=[a,d,e,g,m,k]:(a=null,h=ha)}else a=null,h=ha}else a=null,h=ha;else a=null,h=ha}else a=null,h=ha;else a=null,h=ha;if(null!==a)if(d=a[3],a=a[5],e=[],3===a.length&&"*"===
a[1])a={vars:[{token:"variable",kind:"*"}],modifier:ub(d)};else{for(g=0;g<a.length;g++)m=a[g],3===m.length?e.push({token:"variable",kind:"var",value:m[1]}):e.push({token:"variable",kind:"aliased",expression:m[3],alias:m[7]});a={vars:e,modifier:ub(d)}}null===a&&(h=y);r--;0===r&&null===a&&f("[8] SelectClause");return a}function t(){var a,d,e,g,m,k,l,v,x,s,q,G;r++;G=q=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("CONSTRUCT"===b.substr(h,9)?(d="CONSTRUCT",h+=9):(d=null,0===r&&f('"CONSTRUCT"')),
null===d&&("construct"===b.substr(h,9)?(d="construct",h+=9):(d=null,0===r&&f('"construct"'))),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();if(null!==e)if(g=vb(),null!==g){m=[];for(k=u();null!==k;)m.push(k),k=u();if(null!==m){k=[];for(l=C();null!==l;)k.push(l),l=C();if(null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(v=T(),null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();null!==x?(s=H(),null!==s?a=[a,d,e,g,m,k,l,v,x,s]:(a=null,h=G)):(a=null,h=G)}else a=null,h=G;else a=null,
h=G}else a=null,h=G}else a=null,h=G}else a=null,h=G;else a=null,h=G}else a=null,h=G;else a=null,h=G;if(null!==a){d=a[3];g=a[5];e=a[7];a=a[9];m={named:[],implicit:[]};for(k=0;k<g.length;k++)l=g[k],"default"===l.kind?m.implicit.push(l.graph):m.named.push(l.graph);0===m.named.length&&0===m.implicit.length&&m.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});g={kind:"construct",token:"executableunit"};g.dataset=m;g.template=d;g.pattern=
e;null!=a&&null!=a.limit&&(g.limit=a.limit);null!=a&&null!=a.offset&&(g.offset=a.offset);null!=a&&null!=a.order&&""!=a.order&&(g.order=a.order);a=g}null===a&&(h=q);r--;0===r&&null===a&&f("[9] ConstructQuery");return a}function w(){var a,d,e,g,m,k;r++;k=h;"DESCRIBE"===b.substr(h,8)?(a="DESCRIBE",h+=8):(a=null,0===r&&f('"DESCRIBE"'));if(null!==a){e=ta();if(null!==e)for(d=[];null!==e;)d.push(e),e=ta();else d=null;null===d&&(42===b.charCodeAt(h)?(d="*",h++):(d=null,0===r&&f('"*"')));if(null!==d){e=[];
for(g=C();null!==g;)e.push(g),g=C();null!==e?(g=T(),g=null!==g?g:"",null!==g?(m=H(),null!==m?a=[a,d,e,g,m]:(a=null,h=k)):(a=null,h=k)):(a=null,h=k)}else a=null,h=k}else a=null,h=k;r--;0===r&&null===a&&f("[10] DescribeQuery");return a}function y(){var a,d,e,g,m,k,l,v;r++;v=l=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("ASK"===b.substr(h,3)?(d="ASK",h+=3):(d=null,0===r&&f('"ASK"')),null===d&&("ask"===b.substr(h,3)?(d="ask",h+=3):(d=null,0===r&&f('"ask"'))),null!==d){e=[];for(g=u();null!==
g;)e.push(g),g=u();if(null!==e){g=[];for(m=C();null!==m;)g.push(m),m=C();if(null!==g){m=[];for(k=u();null!==k;)m.push(k),k=u();null!==m?(k=T(),null!==k?a=[a,d,e,g,m,k]:(a=null,h=v)):(a=null,h=v)}else a=null,h=v}else a=null,h=v}else a=null,h=v;else a=null,h=v;if(null!==a){d=a[3];a=a[5];e={named:[],implicit:[]};for(g=0;g<d.length;g++)m=d[g],"implicit"===m.kind?e.implicit.push(m.graph):e.named.push(m.graph);0===e.named.length&&0===e.implicit.length&&e.implicit.push({token:"uri",prefix:null,suffix:null,
value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});d={kind:"ask",token:"executableunit"};d.dataset=e;d.pattern=a;a=d}null===a&&(h=l);r--;0===r&&null===a&&f("[11] AskQuery");return a}function C(){var a,d,e,g,m,k,l;r++;l=k=h;"FROM"===b.substr(h,4)?(a="FROM",h+=4):(a=null,0===r&&f('"FROM"'));null===a&&("from"===b.substr(h,4)?(a="from",h+=4):(a=null,0===r&&f('"from"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=D(),null===e&&(e=I()),null!==e){g=[];for(m=
u();null!==m;)g.push(m),m=u();null!==g?a=[a,d,e,g]:(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a=a[2]);null===a&&(h=k);r--;0===r&&null===a&&f("[12] DatasetClause");return a}function D(){var b,a,d,e;r++;e=d=h;b=[];for(a=u();null!==a;)b.push(a),a=u();null!==b?(a=aa(),null!==a?b=[b,a]:(b=null,h=e)):(b=null,h=e);null!==b&&(b={graph:b[1],kind:"default",token:"graphClause"});null===b&&(h=d);r--;0===r&&null===b&&f("[13] DefaultGraphClause");return b}function I(){var a,d,e,g,m;
r++;m=g=h;"NAMED"===b.substr(h,5)?(a="NAMED",h+=5):(a=null,0===r&&f('"NAMED"'));null===a&&("named"===b.substr(h,5)?(a="named",h+=5):(a=null,0===r&&f('"named"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=aa(),null!==e?a=[a,d,e]:(a=null,h=m)):(a=null,h=m)}else a=null,h=m;null!==a&&(a={graph:a[2],kind:"named",token:"graphCluase"});null===a&&(h=g);r--;0===r&&null===a&&f("[14] NamedGraphClause");return a}function T(){var a,d,e,g,m,k,l;r++;l=k=h;"WHERE"===b.substr(h,5)?(a="WHERE",
h+=5):(a=null,0===r&&f('"WHERE"'));null===a&&("where"===b.substr(h,5)?(a="where",h+=5):(a=null,0===r&&f('"where"')));a=null!==a?a:"";if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=ea(),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?a=[a,d,e,g]:(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a=a[2]);null===a&&(h=k);r--;0===r&&null===a&&f("[16] WhereClause");return a}function H(){var b,a,d,e,n,g;r++;g=n=h;b=F();b=null!==b?b:"";null!==b?(a=
K(),a=null!==a?a:"",null!==a?(d=N(),d=null!==d?d:"",null!==d?(e=V(),e=null!==e?e:"",null!==e?b=[b,a,d,e]:(b=null,h=g)):(b=null,h=g)):(b=null,h=g)):(b=null,h=g);null!==b&&(a=b[0],d=b[2],b=b[3],e={},null!=b&&(null!=b.limit&&(e.limit=b.limit),null!=b.offset&&(e.offset=b.offset)),null!=a&&(e.group=a),e.order=d,b=e);null===b&&(h=n);r--;0===r&&null===b&&f("[17] SolutionModifier");return b}function F(){var a,d,e,g,m,k,l,v;r++;v=l=h;"GROUP"===b.substr(h,5)?(a="GROUP",h+=5):(a=null,0===r&&f('"GROUP"'));null===
a&&("group"===b.substr(h,5)?(a="group",h+=5):(a=null,0===r&&f('"group"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("BY"===b.substr(h,2)?(e="BY",h+=2):(e=null,0===r&&f('"BY"')),null===e&&("by"===b.substr(h,2)?(e="by",h+=2):(e=null,0===r&&f('"by"'))),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();if(null!==g){k=J();if(null!==k)for(m=[];null!==k;)m.push(k),k=J();else m=null;null!==m?a=[a,d,e,g,m]:(a=null,h=v)}else a=null,h=v}else a=null,h=v;else a=null,h=v}else a=null,
h=v;null!==a&&(a=a[4]);null===a&&(h=l);r--;0===r&&null===a&&f("[18] GroupClause");return a}function J(){var a,d,e,g,m,k,l,v,x,s,q,G;r++;G=q=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(d=Na(),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();null!==e?a=[a,d,e]:(a=null,h=G)}else a=null,h=G;else a=null,h=G;null!==a&&(a=a[1]);null===a&&(h=q);if(null===a){G=q=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(d=ib(),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();null!==e?a=[a,
d,e]:(a=null,h=G)}else a=null,h=G;else a=null,h=G;null!==a&&(a=a[1]);null===a&&(h=q);if(null===a){G=q=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(40===b.charCodeAt(h)?(d="(",h++):(d=null,0===r&&f('"("')),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();if(null!==e)if(g=P(),null!==g){m=[];for(k=u();null!==k;)m.push(k),k=u();if(null!==m){x=h;"AS"===b.substr(h,2)?(k="AS",h+=2):(k=null,0===r&&f('"AS"'));null===k&&("as"===b.substr(h,2)?(k="as",h+=2):(k=null,0===r&&f('"as"')));if(null!==
k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?(v=Z(),null!==v?k=[k,l,v]:(k=null,h=x)):(k=null,h=x)}else k=null,h=x;k=null!==k?k:"";if(null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(41===b.charCodeAt(h)?(v=")",h++):(v=null,0===r&&f('")"')),null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();null!==x?a=[a,d,e,g,m,k,l,v,x]:(a=null,h=G)}else a=null,h=G;else a=null,h=G}else a=null,h=G}else a=null,h=G}else a=null,h=G;else a=null,h=G}else a=null,h=G;else a=null,h=G;null!==a&&(d=
a[3],a=a[5],a=0!=a.length?{token:"aliased_expression",expression:d,alias:a[2]}:d);null===a&&(h=q);if(null===a){G=q=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(d=Z(),null!==d){e=[];for(g=u();null!==g;)e.push(g),g=u();null!==e?a=[a,d,e]:(a=null,h=G)}else a=null,h=G;else a=null,h=G;null!==a&&(a=a[1]);null===a&&(h=q)}}}r--;0===r&&null===a&&f("[19] GroupCondition");return a}function K(){var a,d,e,g;r++;g=h;"HAVING"===b.substr(h,6)?(a="HAVING",h+=6):(a=null,0===r&&f('"HAVING"'));if(null!==
a){e=Ea();if(null!==e)for(d=[];null!==e;)d.push(e),e=Ea();else d=null;null!==d?a=[a,d]:(a=null,h=g)}else a=null,h=g;r--;0===r&&null===a&&f("[20] HavingClause");return a}function N(){var a,d,e,g,m,k,l,v,x;r++;x=v=h;"ORDER"===b.substr(h,5)?(a="ORDER",h+=5):(a=null,0===r&&f('"ORDER"'));null===a&&("order"===b.substr(h,5)?(a="order",h+=5):(a=null,0===r&&f('"order"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("BY"===b.substr(h,2)?(e="BY",h+=2):(e=null,0===r&&f('"BY"')),null===
e&&("by"===b.substr(h,2)?(e="by",h+=2):(e=null,0===r&&f('"by"'))),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();if(null!==g){k=L();if(null!==k)for(m=[];null!==k;)m.push(k),k=L();else m=null;if(null!==m){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?a=[a,d,e,g,m,k]:(a=null,h=x)}else a=null,h=x}else a=null,h=x}else a=null,h=x;else a=null,h=x}else a=null,h=x;null!==a&&(a=a[4]);null===a&&(h=v);r--;0===r&&null===a&&f("[22] OrderClause");return a}function L(){var a,d,e,g,m,k,l;r++;l=k=h;"ASC"===
b.substr(h,3)?(a="ASC",h+=3):(a=null,0===r&&f('"ASC"'));null===a&&("asc"===b.substr(h,3)?(a="asc",h+=3):(a=null,0===r&&f('"asc"')),null===a&&("DESC"===b.substr(h,4)?(a="DESC",h+=4):(a=null,0===r&&f('"DESC"')),null===a&&("desc"===b.substr(h,4)?(a="desc",h+=4):(a=null,0===r&&f('"desc"')))));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=Oa(),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?a=[a,d,e,g]:(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==
a&&(a=function(a,b,f){return{direction:b.toUpperCase(),expression:f}}(k,a[0],a[2]));null===a&&(h=k);if(null===a){l=k=h;a=Ea();null===a&&(a=Z());if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?a=[a,d]:(a=null,h=l)}else a=null,h=l;null!==a&&(a=function(a,b){"var"===b.token&&(b={token:"expression",expressionType:"atomic",primaryexpression:"var",value:b});return{direction:"ASC",expression:b}}(k,a[0]));null===a&&(h=k)}r--;0===r&&null===a&&f("[23] OrderCondition");return a}function V(){var a,
b,d,e;r++;e=d=h;a=U();null!==a?(b=R(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,h=e)):(a=null,h=e);null===a&&(e=h,a=R(),null!==a?(b=U(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,h=e)):(a=null,h=e));if(null!==a){b={};for(e=0;e<a.length;e++){var n=a[e];null!=n.limit?b.limit=n.limit:null!=n.offset&&(b.offset=n.offset)}a=b}null===a&&(h=d);r--;0===r&&null===a&&f("[24] LimitOffsetClauses");return a}function U(){var a,d,e,g,m,k,l;r++;l=k=h;"LIMIT"===b.substr(h,5)?(a="LIMIT",h+=5):(a=null,0===r&&f('"LIMIT"'));
null===a&&("limit"===b.substr(h,5)?(a="limit",h+=5):(a=null,0===r&&f('"limit"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=oa(),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?a=[a,d,e,g]:(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a={limit:parseInt(a[2].value)});null===a&&(h=k);r--;0===r&&null===a&&f("[25] LimitClause");return a}function R(){var a,d,e,g,m,k,l;r++;l=k=h;"OFFSET"===b.substr(h,6)?(a="OFFSET",h+=6):(a=null,0===r&&
f('"OFFSET"'));null===a&&("offset"===b.substr(h,6)?(a="offset",h+=6):(a=null,0===r&&f('"offset"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=oa(),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?a=[a,d,e,g]:(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a={offset:parseInt(a[2].value)});null===a&&(h=k);r--;0===r&&null===a&&f("[26] OffsetClause");return a}function S(){var a,d,e,g,m,k,l,v,x;r++;v=h;"BINDINGS"===b.substr(h,8)?(a="BINDINGS",
h+=8):(a=null,0===r&&f('"BINDINGS"'));if(null!==a){d=[];for(e=Z();null!==e;)d.push(e),e=Z();if(null!==d)if(123===b.charCodeAt(h)?(e="{",h++):(e=null,0===r&&f('"{"')),null!==e){g=[];x=h;40===b.charCodeAt(h)?(m="(",h++):(m=null,0===r&&f('"("'));if(null!==m){l=Q();if(null!==l)for(k=[];null!==l;)k.push(l),l=Q();else k=null;null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?m=[m,k,l]:(m=null,h=x)):(m=null,h=x)}else m=null,h=x;for(null===m&&(m=ua());null!==m;){g.push(m);x=h;40===
b.charCodeAt(h)?(m="(",h++):(m=null,0===r&&f('"("'));if(null!==m){l=Q();if(null!==l)for(k=[];null!==l;)k.push(l),l=Q();else k=null;null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?m=[m,k,l]:(m=null,h=x)):(m=null,h=x)}else m=null,h=x;null===m&&(m=ua())}null!==g?(125===b.charCodeAt(h)?(m="}",h++):(m=null,0===r&&f('"}"')),null!==m?a=[a,d,e,g,m]:(a=null,h=v)):(a=null,h=v)}else a=null,h=v;else a=null,h=v}else a=null,h=v;a=null!==a?a:"";r--;0===r&&null===a&&f("[27] BindingsClause");
return a}function Q(){var a;r++;a=aa();null===a&&(a=Pa(),null===a&&(a=Qa(),null===a&&(a=Ra(),null===a&&("UNDEF"===b.substr(h,5)?(a="UNDEF",h+=5):(a=null,0===r&&f('"UNDEF"'))))));r--;0===r&&null===a&&f("[28] BindingValue");return a}function W(){var a,d,e,m,k,l,v,s,q,G;r++;q=s=h;a=g();if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=X(),null!==e){G=h;m=[];for(k=u();null!==k;)m.push(k),k=u();if(null!==m)if(59===b.charCodeAt(h)?(k=";",h++):(k=null,0===r&&f('";"')),null!==k){l=[];
for(v=u();null!==v;)l.push(v),v=u();null!==l?(v=W(),v=null!==v?v:"",null!==v?m=[m,k,l,v]:(m=null,h=G)):(m=null,h=G)}else m=null,h=G;else m=null,h=G;m=null!==m?m:"";null!==m?a=[a,d,e,m]:(a=null,h=q)}else a=null,h=q;else a=null,h=q}else a=null,h=q;null!==a&&(m=a[2],d=a[3],e={token:"query",kind:"update"},e.prologue=a[0],a=[m],null!=d.length&&null!=d[3]&&null!=d[3].units&&(a=a.concat(d[3].units)),e.units=a,a=e);null===a&&(h=s);r--;0===r&&null===a&&f("[30] Update");return a}function X(){var a;r++;a=Y();
null===a&&(a=ba(),null===a&&(a=ca(),null===a&&(a=fa(),null===a&&(a=ga(),null===a&&(a=ja(),null===a&&(a=ka(),null===a&&(a=la())))))));r--;0===r&&null===a&&f("[31] Update1");return a}function Y(){var a,d,e,g,m,k,l,v,x,s;r++;x=v=h;"LOAD"===b.substr(h,4)?(a="LOAD",h+=4):(a=null,0===r&&f('"LOAD"'));null===a&&("load"===b.substr(h,4)?(a="load",h+=4):(a=null,0===r&&f('"load"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=aa(),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();
if(null!==g){s=h;"INTO"===b.substr(h,4)?(m="INTO",h+=4):(m=null,0===r&&f('"INTO"'));null===m&&("into"===b.substr(h,4)?(m="into",h+=4):(m=null,0===r&&f('"into"')));if(null!==m){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=Ka(),null!==l?m=[m,k,l]:(m=null,h=s)):(m=null,h=s)}else m=null,h=s;m=null!==m?m:"";null!==m?a=[a,d,e,g,m]:(a=null,h=x)}else a=null,h=x}else a=null,h=x;else a=null,h=x}else a=null,h=x;null!==a&&(d=a[4],e={kind:"load",token:"executableunit"},e.sourceGraph=a[2],e.destinyGraph=
d[2],a=e);null===a&&(h=v);r--;0===r&&null===a&&f("[32] Load");return a}function ba(){var a,d,e,g,m,k,l;r++;l=k=h;"CLEAR"===b.substr(h,5)?(a="CLEAR",h+=5):(a=null,0===r&&f('"CLEAR"'));null===a&&("clear"===b.substr(h,5)?(a="clear",h+=5):(a=null,0===r&&f('"clear"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("SILENT"===b.substr(h,6)?(e="SILENT",h+=6):(e=null,0===r&&f('"SILENT"')),null===e&&("silent"===b.substr(h,6)?(e="silent",h+=6):(e=null,0===r&&f('"silent"'))),e=null!==
e?e:"",null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?(m=cb(),null!==m?a=[a,d,e,g,m]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(d={kind:"clear",token:"executableunit"},d.destinyGraph=a[4],a=d);null===a&&(h=k);r--;0===r&&null===a&&f("[33] Clear");return a}function ca(){var a,d,e,g,m,k,l;r++;l=k=h;"DROP"===b.substr(h,4)?(a="DROP",h+=4):(a=null,0===r&&f('"DROP"'));null===a&&("drop"===b.substr(h,4)?(a="drop",h+=4):(a=null,0===r&&f('"drop"')));if(null!==
a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("SILENT"===b.substr(h,6)?(e="SILENT",h+=6):(e=null,0===r&&f('"SILENT"')),null===e&&("silent"===b.substr(h,6)?(e="silent",h+=6):(e=null,0===r&&f('"silent"'))),e=null!==e?e:"",null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?(m=cb(),null!==m?a=[a,d,e,g,m]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(d={kind:"drop",token:"executableunit"},d.destinyGraph=a[4],a=d);null===a&&(h=k);r--;0===r&&
null===a&&f("[34] Drop");return a}function fa(){var a,d,e,g,m,k,l;r++;l=k=h;"CREATE"===b.substr(h,6)?(a="CREATE",h+=6):(a=null,0===r&&f('"CREATE"'));null===a&&("create"===b.substr(h,6)?(a="create",h+=6):(a=null,0===r&&f('"create"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("SILENT"===b.substr(h,6)?(e="SILENT",h+=6):(e=null,0===r&&f('"SILENT"')),null===e&&("silent"===b.substr(h,6)?(e="silent",h+=6):(e=null,0===r&&f('"silent"'))),e=null!==e?e:"",null!==e){g=[];for(m=u();null!==
m;)g.push(m),m=u();null!==g?(m=Ka(),null!==m?a=[a,d,e,g,m]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(d={kind:"create",token:"executableunit"},d.destinyGraph=a[4],a=d);null===a&&(h=k);r--;0===r&&null===a&&f("[35] Create");return a}function ga(){var a,d,e,g,m,k,l;r++;l=k=h;"INSERT"===b.substr(h,6)?(a="INSERT",h+=6):(a=null,0===r&&f('"INSERT"'));null===a&&("insert"===b.substr(h,6)?(a="insert",h+=6):(a=null,0===r&&f('"insert"')));if(null!==a){d=[];for(e=u();null!==
e;)d.push(e),e=u();if(null!==d)if("DATA"===b.substr(h,4)?(e="DATA",h+=4):(e=null,0===r&&f('"DATA"')),null===e&&("data"===b.substr(h,4)?(e="data",h+=4):(e=null,0===r&&f('"data"'))),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?(m=fb(),null!==m?a=[a,d,e,g,m]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(d={kind:"insertdata",token:"executableunit"},d.quads=a[4],a=d);null===a&&(h=k);r--;0===r&&null===a&&f("[36] InsertData");return a}function ja(){var a,
d,e,g,m,k;r++;k=m=h;"DELETE"===b.substr(h,6)?(a="DELETE",h+=6):(a=null,0===r&&f('"DELETE"'));null===a&&("delete"===b.substr(h,6)?(a="delete",h+=6):(a=null,0===r&&f('"delete"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?("DATA"===b.substr(h,4)?(e="DATA",h+=4):(e=null,0===r&&f('"DATA"')),null===e&&("data"===b.substr(h,4)?(e="data",h+=4):(e=null,0===r&&f('"data"'))),null!==e?(g=fb(),null!==g?a=[a,d,e,g]:(a=null,h=k)):(a=null,h=k)):(a=null,h=k)}else a=null,h=k;null!==a&&(d={kind:"deletedata",
token:"executableunit"},d.quads=a[3],a=d);null===a&&(h=m);r--;0===r&&null===a&&f("[37] DeleteData");return a}function ka(){var a,d,e,g,m,k,l;r++;l=k=h;"DELETE"===b.substr(h,6)?(a="DELETE",h+=6):(a=null,0===r&&f('"DELETE"'));null===a&&("delete"===b.substr(h,6)?(a="delete",h+=6):(a=null,0===r&&f('"delete"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("WHERE"===b.substr(h,5)?(e="WHERE",h+=5):(e=null,0===r&&f('"WHERE"')),null===e&&("where"===b.substr(h,5)?(e="where",h+=5):(e=
null,0===r&&f('"where"'))),null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?(m=ea(),null!==m?a=[a,d,e,g,m]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;if(null!==a){e=a[4];a={kind:"modify"};a.pattern=e;a["with"]=null;a.using=null;d=[];e=e.patterns[0];e=null==e.triplesContext&&null!=e.patterns?e.patterns[0].triplesContext:e.triplesContext;for(g=0;g<e.length;g++)m={},l=e[g],m.subject=l.subject,m.predicate=l.predicate,m.object=l.object,m.graph=l.graph,d.push(m);
a["delete"]=d}null===a&&(h=k);r--;0===r&&null===a&&f("[38] DeleteWhere");return a}function la(){var a,d,e,g,m,k,l,v,x,s,q,G,t;r++;k=t=G=h;"WITH"===b.substr(h,4)?(a="WITH",h+=4):(a=null,0===r&&f('"WITH"'));null===a&&("with"===b.substr(h,4)?(a="with",h+=4):(a=null,0===r&&f('"with"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=aa(),null!==e?a=[a,d,e]:(a=null,h=k)):(a=null,h=k)}else a=null,h=k;a=null!==a?a:"";if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d){k=
h;e=ma();if(null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();null!==g?(m=ra(),m=null!==m?m:"",null!==m?e=[e,g,m]:(e=null,h=k)):(e=null,h=k)}else e=null,h=k;null===e&&(e=ra());if(null!==e){g=[];for(m=u();null!==m;)g.push(m),m=u();if(null!==g){m=[];for(k=eb();null!==k;)m.push(k),k=eb();if(null!==m){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if("WHERE"===b.substr(h,5)?(l="WHERE",h+=5):(l=null,0===r&&f('"WHERE"')),null===l&&("where"===b.substr(h,5)?(l="where",h+=5):(l=null,0===r&&f('"where"'))),
null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(x=ea(),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?a=[a,d,e,g,m,k,l,v,x,s]:(a=null,h=t)}else a=null,h=t;else a=null,h=t}else a=null,h=t;else a=null,h=t}else a=null,h=t}else a=null,h=t}else a=null,h=t}else a=null,h=t}else a=null,h=t;null!==a&&(d=a[0],e=a[2],g=a[4],a=a[8],m={kind:"modify"},m["with"]=""!=d?d[2]:null,3===e.length&&""===e[2]?(m["delete"]=e[0],m.insert=null):3===e.length&&null!=e[0].length&&null!=e[1].length&&
null!=e[2].length?(m["delete"]=e[0],m.insert=e[2]):(m.insert=e,m["delete"]=null),""!=g&&(m.using=g),m.pattern=a,a=m);null===a&&(h=G);r--;0===r&&null===a&&f("[39] Modify");return a}function ma(){var a,d,e,m;r++;m=e=h;"DELETE"===b.substr(h,6)?(a="DELETE",h+=6):(a=null,0===r&&f('"DELETE"'));null===a&&("delete"===b.substr(h,6)?(a="delete",h+=6):(a=null,0===r&&f('"delete"')));null!==a?(d=db(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1]);null===a&&(h=e);r--;0===r&&null===a&&f("[40] DeleteClause");
return a}function ra(){var a,d,e,m;r++;m=e=h;"INSERT"===b.substr(h,6)?(a="INSERT",h+=6):(a=null,0===r&&f('"INSERT"'));null===a&&("insert"===b.substr(h,6)?(a="insert",h+=6):(a=null,0===r&&f('"insert"')));null!==a?(d=db(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1]);null===a&&(h=e);r--;0===r&&null===a&&f("[41] InsertClause");return a}function eb(){var a,d,e,m,g,k,l,v,x;r++;v=l=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("USING"===b.substr(h,5)?(d="USING",h+=5):(d=null,
0===r&&f('"USING"')),null===d&&("using"===b.substr(h,5)?(d="using",h+=5):(d=null,0===r&&f('"using"'))),null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e){m=aa();if(null===m)if(x=h,"NAMED"===b.substr(h,5)?(m="NAMED",h+=5):(m=null,0===r&&f('"NAMED"')),null===m&&("named"===b.substr(h,5)?(m="named",h+=5):(m=null,0===r&&f('"named"'))),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=aa(),null!==k?m=[m,g,k]:(m=null,h=x)):(m=null,h=x)}else m=null,h=x;null!==m?a=[a,d,e,m]:(a=null,
h=v)}else a=null,h=v}else a=null,h=v;else a=null,h=v;null!==a&&(a=a[3],a=null!=a.length?{kind:"named",uri:a[2]}:{kind:"default",uri:a});null===a&&(h=l);r--;0===r&&null===a&&f("[42] UsingClause");return a}function Ka(){var a,d,e,m,g;r++;g=m=h;"GRAPH"===b.substr(h,5)?(a="GRAPH",h+=5):(a=null,0===r&&f('"GRAPH"'));null===a&&("graph"===b.substr(h,5)?(a="graph",h+=5):(a=null,0===r&&f('"graph"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=aa(),null!==e?a=[a,d,e]:(a=null,h=g)):(a=
null,h=g)}else a=null,h=g;null!==a&&(a=a[2]);null===a&&(h=m);r--;0===r&&null===a&&f("[43] GraphRef");return a}function cb(){var a,d;r++;d=h;a=Ka();null===a&&(h=d);null===a&&(d=h,"DEFAULT"===b.substr(h,7)?(a="DEFAULT",h+=7):(a=null,0===r&&f('"DEFAULT"')),null===a&&("default"===b.substr(h,7)?(a="default",h+=7):(a=null,0===r&&f('"default"'))),null!==a&&(a="default"),null===a&&(h=d),null===a&&(d=h,"NAMED"===b.substr(h,5)?(a="NAMED",h+=5):(a=null,0===r&&f('"NAMED"')),null===a&&("named"===b.substr(h,5)?
(a="named",h+=5):(a=null,0===r&&f('"named"'))),null!==a&&(a="named"),null===a&&(h=d),null===a&&(d=h,"ALL"===b.substr(h,3)?(a="ALL",h+=3):(a=null,0===r&&f('"ALL"')),null===a&&("all"===b.substr(h,3)?(a="all",h+=3):(a=null,0===r&&f('"all"'))),null!==a&&(a="all"),null===a&&(h=d))));r--;0===r&&null===a&&f("[44] GraphRefAll");return a}function db(){var a,d,e,m,g,k,l,v,x,s;r++;s=x=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(123===b.charCodeAt(h)?(d="{",h++):(d=null,0===r&&f('"{"')),null!==
d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(m=gb(),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(125===b.charCodeAt(h)?(k="}",h++):(k=null,0===r&&f('"}"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=s)}else a=null,h=s;else a=null,h=s}else a=null,h=s;else a=null,h=s}else a=null,h=s;else a=null,h=s;null!==a&&(a=a[3].quadsContext);null===a&&(h=x);r--;0===r&&null===a&&f("[45] QuadPattern");return a}function fb(){var a,d,e,
m,g,k,l,v,x,s;r++;s=x=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(123===b.charCodeAt(h)?(d="{",h++):(d=null,0===r&&f('"{"')),null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(m=gb(),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(125===b.charCodeAt(h)?(k="}",h++):(k=null,0===r&&f('"}"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=s)}else a=null,h=s;else a=null,h=s}else a=null,h=s;else a=null,h=s}else a=null,
h=s;else a=null,h=s;null!==a&&(a=a[3].quadsContext);null===a&&(h=x);r--;0===r&&null===a&&f("[46] QuadData");return a}function gb(){var a,d,e,m,g,k,l,v;r++;l=k=h;a=wa();a=null!==a?a:"";if(null!==a){d=[];v=h;e=jb();null!==e?(46===b.charCodeAt(h)?(m=".",h++):(m=null,0===r&&f('"."')),m=null!==m?m:"",null!==m?(g=wa(),g=null!==g?g:"",null!==g?e=[e,m,g]:(e=null,h=v)):(e=null,h=v)):(e=null,h=v);for(;null!==e;)d.push(e),v=h,e=jb(),null!==e?(46===b.charCodeAt(h)?(m=".",h++):(m=null,0===r&&f('"."')),m=null!==
m?m:"",null!==m?(g=wa(),g=null!==g?g:"",null!==g?e=[e,m,g]:(e=null,h=v)):(e=null,h=v)):(e=null,h=v);null!==d?a=[a,d]:(a=null,h=l)}else a=null,h=l;if(null!==a){d=a[0];a=a[1];e=[];if(null!=d.triplesContext&&null!=d.triplesContext)for(m=0;m<d.triplesContext.length;m++)g=d.triplesContext[m],g.graph=null,e.push(g);if(a&&0<a.length&&0<a[0].length&&(e=e.concat(a[0][0].quadsContext),null!=a[0][2]&&null!=a[0][2].triplesContext))for(m=0;m<a[0][2].triplesContext.length;m++)g=a[0][2].triplesContext[m],g.graph=
null,e.push(g);a={token:"quads",quadsContext:e}}null===a&&(h=k);r--;0===r&&null===a&&f("[47] Quads");return a}function jb(){var a,d,e,m,g,k,l,v,x,s,q,G,t,A;r++;A=t=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("GRAPH"===b.substr(h,5)?(d="GRAPH",h+=5):(d=null,0===r&&f('"GRAPH"')),null===d&&("graph"===b.substr(h,5)?(d="graph",h+=5):(d=null,0===r&&f('"graph"'))),null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(m=ta(),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==
g)if(123===b.charCodeAt(h)?(k="{",h++):(k=null,0===r&&f('"{"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(v=wa(),v=null!==v?v:"",null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();if(null!==x)if(125===b.charCodeAt(h)?(s="}",h++):(s=null,0===r&&f('"}"')),null!==s){q=[];for(G=u();null!==G;)q.push(G),G=u();null!==q?a=[a,d,e,m,g,k,l,v,x,s,q]:(a=null,h=A)}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,
h=A}else a=null,h=A;else a=null,h=A;if(null!==a){d=a[3];a=a[7];e=[];for(m=0;m<a.triplesContext.length;m++)g=a.triplesContext[m],g.graph=d,e.push(g);a={token:"quadsnottriples",quadsContext:e}}null===a&&(h=t);r--;0===r&&null===a&&f("[48] QuadsNotTriples");return a}function wa(){var a,d,e,m,g,k,l,v;r++;l=k=h;a=kb();if(null!==a){v=h;d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(46===b.charCodeAt(h)?(e=".",h++):(e=null,0===r&&f('"."')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();null!==
m?(g=wa(),g=null!==g?g:"",null!==g?d=[d,e,m,g]:(d=null,h=v)):(d=null,h=v)}else d=null,h=v;else d=null,h=v;d=null!==d?d:"";null!==d?a=[a,d]:(a=null,h=l)}else a=null,h=l;null!==a&&(d=a[1],a=a[0].triplesContext,"object"===typeof d&&null!=d.length&&null!=d[3].triplesContext&&(a=a.concat(d[3].triplesContext)),a={token:"triplestemplate",triplesContext:a});null===a&&(h=k);r--;0===r&&null===a&&f("[49] TriplesTemplate");return a}function ea(){var a,d,e,m,g,k,l;r++;l=k=h;123===b.charCodeAt(h)?(a="{",h++):(a=
null,0===r&&f('"{"'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=s(),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();null!==m?(125===b.charCodeAt(h)?(g="}",h++):(g=null,0===r&&f('"}"')),null!==g?a=[a,d,e,m,g]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a=a[2]);null===a&&(h=k);if(null===a){l=k=h;123===b.charCodeAt(h)?(a="{",h++):(a=null,0===r&&f('"{"'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=wb(),
null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();null!==m?(125===b.charCodeAt(h)?(g="}",h++):(g=null,0===r&&f('"}"')),null!==g?a=[a,d,e,m,g]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a=a[2]);null===a&&(h=k)}r--;0===r&&null===a&&f("[50] GroupGraphPattern");return a}function wb(){var a,d,e,m,g,k,l,v,x,s,q;r++;s=x=h;a=Fa();a=null!==a?a:"";if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d){e=[];q=h;m=lb();if(null!==m){g=[];for(k=u();null!==
k;)g.push(k),k=u();if(null!==g)if(46===b.charCodeAt(h)?(k=".",h++):(k=null,0===r&&f('"."')),k=null!==k?k:"",null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?(v=Fa(),v=null!==v?v:"",null!==v?m=[m,g,k,l,v]:(m=null,h=q)):(m=null,h=q)}else m=null,h=q;else m=null,h=q}else m=null,h=q;for(;null!==m;)if(e.push(m),q=h,m=lb(),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(46===b.charCodeAt(h)?(k=".",h++):(k=null,0===r&&f('"."')),k=null!==k?k:"",null!==k){l=[];for(v=u();null!==
v;)l.push(v),v=u();null!==l?(v=Fa(),v=null!==v?v:"",null!==v?m=[m,g,k,l,v]:(m=null,h=q)):(m=null,h=q)}else m=null,h=q;else m=null,h=q}else m=null,h=q;null!==e?a=[a,d,e]:(a=null,h=s)}else a=null,h=s}else a=null,h=s;if(null!==a){d=a[0];m=a[2];a=[];null!=d&&d!=[]&&a.push(d);for(d=0;d<m.length;d++)for(e=0;e<m[d].length;e++)null!=m[d][e].token&&a.push(m[d][e]);m=[];g=[];k=[];for(d=0;d<a.length;d++)if("triplespattern"!=a[d].token&&"filter"!=a[d].token){if(0!=g.length||0!=k.length){l=[];for(e=0;e<g.length;e++)l=
l.concat(g[e].triplesContext);0<l.length&&m.push({token:"basicgraphpattern",triplesContext:l});g=[]}m.push(a[d])}else"triplespattern"===a[d].token?g.push(a[d]):k.push(a[d]);if(0!=g.length||0!=k.length){l=[];for(e=0;e<g.length;e++)l=l.concat(g[e].triplesContext);0<l.length&&m.push({token:"basicgraphpattern",triplesContext:l})}a={token:"groupgraphpattern",patterns:m,filters:k}}null===a&&(h=x);r--;0===r&&null===a&&f("[51] GroupGraphPatternSub");return a}function Fa(){var a,d,e,m,g,k,l;r++;k=g=h;a=xb();
if(null!==a){l=h;d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(46===b.charCodeAt(h)?(e=".",h++):(e=null,0===r&&f('"."')),null!==e?(m=Fa(),m=null!==m?m:"",null!==m?d=[d,e,m]:(d=null,h=l)):(d=null,h=l)):(d=null,h=l);d=null!==d?d:"";null!==d?a=[a,d]:(a=null,h=k)}else a=null,h=k;null!==a&&(d=a[1],a=a[0].triplesContext,"object"===typeof d&&null!=d.length&&null!=d[2].triplesContext&&(a=a.concat(d[2].triplesContext)),a={token:"triplespattern",triplesContext:a});null===a&&(h=g);r--;0===r&&null===a&&
f("[54] TriplesBlock");return a}function lb(){var a;r++;a=yb();null===a&&(a=zb(),null===a&&(a=Ab(),null===a&&(a=Bb(),null===a&&(a=Cb(),null===a&&(a=Db())))));r--;0===r&&null===a&&f("[53] GraphPatternNotTriples");return a}function zb(){var a,d,e,m,g,k;r++;k=g=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("OPTIONAL"===b.substr(h,8)?(d="OPTIONAL",h+=8):(d=null,0===r&&f('"OPTIONAL"')),null===d&&("optional"===b.substr(h,8)?(d="optional",h+=8):(d=null,0===r&&f('"optional"'))),null!==d){e=[];
for(m=u();null!==m;)e.push(m),m=u();null!==e?(m=ea(),null!==m?a=[a,d,e,m]:(a=null,h=k)):(a=null,h=k)}else a=null,h=k;else a=null,h=k;null!==a&&(a={token:"optionalgraphpattern",value:a[3]});null===a&&(h=g);r--;0===r&&null===a&&f("[54] OptionalGraphPattern");return a}function Bb(){var a,d,e,m,g,k,l,v;r++;v=l=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("GRAPH"===b.substr(h,5)?(d="GRAPH",h+=5):(d=null,0===r&&f('"GRAPH"')),null===d&&("graph"===b.substr(h,5)?(d="graph",h+=5):(d=null,0===r&&
f('"graph"'))),null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(m=ta(),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=ea(),null!==k?a=[a,d,e,m,g,k]:(a=null,h=v)):(a=null,h=v)}else a=null,h=v;else a=null,h=v}else a=null,h=v;else a=null,h=v;if(null!==a){d=a[3];a=a[5];for(e=0;e<a.patterns.length;e++)for(m=a.patterns[e],g=0;g<m.triplesContext.length;g++)m.triplesContext[g].graph=d;a.token="groupgraphpattern"}null===a&&(h=l);r--;0===r&&null===a&&f("[55] GraphGraphPattern");
return a}function Cb(){var a,d,e,m,g;r++;g=m=h;"SERVICE"===b.substr(h,7)?(a="SERVICE",h+=7):(a=null,0===r&&f('"SERVICE"'));null!==a?(d=ta(),null!==d?(e=ea(),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)):(a=null,h=g);null!==a&&(a={token:"servicegraphpattern",status:"todo",value:[a[1],a[2]]});null===a&&(h=m);r--;0===r&&null===a&&f("[56] ServiceGraphPattern");return a}function Ab(){var a,d,e,m;r++;m=e=h;"MINUS"===b.substr(h,5)?(a="MINUS",h+=5):(a=null,0===r&&f('"MINUS"'));null!==a?(d=ea(),null!==d?
a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a={token:"minusgraphpattern",status:"todo",value:a[1]});null===a&&(h=e);r--;0===r&&null===a&&f("[57] MinusGraphPattern");return a}function yb(){var a,d,e,m,g,k,l,v,x;r++;v=l=h;a=ea();if(null!==a){d=[];x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("UNION"===b.substr(h,5)?(m="UNION",h+=5):(m=null,0===r&&f('"UNION"')),null===m&&("union"===b.substr(h,5)?(m="union",h+=5):(m=null,0===r&&f('"union"'))),null!==m){g=[];for(k=u();null!==k;)g.push(k),
k=u();null!==g?(k=ea(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x;for(;null!==e;){d.push(e);x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("UNION"===b.substr(h,5)?(m="UNION",h+=5):(m=null,0===r&&f('"UNION"')),null===m&&("union"===b.substr(h,5)?(m="union",h+=5):(m=null,0===r&&f('"union"'))),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=ea(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x}null!==d?a=[a,
d]:(a=null,h=v)}else a=null,h=v;if(null!==a){d=a[0];a=a[1];if(0!==a.length)for(d={token:"graphunionpattern",value:[d]},e=0;e<a.length;e++)e==a.length-1?d.value.push(a[e][3]):(d.value.push(a[e][3]),d={token:"graphunionpattern",value:[d]});a=d}null===a&&(h=l);r--;0===r&&null===a&&f("[58] GroupOrUnionGraphPattern");return a}function Db(){var a,d,e,m,g,k;r++;k=g=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if("FILTER"===b.substr(h,6)?(d="FILTER",h+=6):(d=null,0===r&&f('"FILTER"')),null===d&&
("filter"===b.substr(h,6)?(d="filter",h+=6):(d=null,0===r&&f('"filter"'))),null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();null!==e?(m=Ea(),null!==m?a=[a,d,e,m]:(a=null,h=k)):(a=null,h=k)}else a=null,h=k;else a=null,h=k;null!==a&&(a={token:"filter",value:a[3]});null===a&&(h=g);r--;0===r&&null===a&&f("[59] Filter");return a}function Ea(){var a;r++;a=Oa();null===a&&(a=Na(),null===a&&(a=ib()));r--;0===r&&null===a&&f("[60] Constraint");return a}function ib(){var a,b,d,e;r++;e=d=h;a=aa();null!==a?(b=
mb(),null!==b?a=[a,b]:(a=null,h=e)):(a=null,h=e);null!==a&&(b=a[1],e={token:"expression",expressionType:"irireforfunction"},e.iriref=a[0],e.args=b.value,a=e);null===a&&(h=d);r--;0===r&&null===a&&f("[61] FunctionCall");return a}function mb(){var a,d,e,m,g,k,l,v,x;r++;l=h;a=ua();null!==a&&(a={token:"args",value:[]});null===a&&(h=l);if(null===a){v=l=h;40===b.charCodeAt(h)?(a="(",h++):(a=null,0===r&&f('"("'));if(null!==a)if("DISTINCT"===b.substr(h,8)?(d="DISTINCT",h+=8):(d=null,0===r&&f('"DISTINCT"')),
null===d&&("distinct"===b.substr(h,8)?(d="distinct",h+=8):(d=null,0===r&&f('"distinct"'))),d=null!==d?d:"",null!==d)if(e=P(),null!==e){m=[];x=h;44===b.charCodeAt(h)?(g=",",h++):(g=null,0===r&&f('","'));null!==g?(k=P(),null!==k?g=[g,k]:(g=null,h=x)):(g=null,h=x);for(;null!==g;)m.push(g),x=h,44===b.charCodeAt(h)?(g=",",h++):(g=null,0===r&&f('","')),null!==g?(k=P(),null!==k?g=[g,k]:(g=null,h=x)):(g=null,h=x);null!==m?(41===b.charCodeAt(h)?(g=")",h++):(g=null,0===r&&f('")"')),null!==g?a=[a,d,e,m,g]:(a=
null,h=v)):(a=null,h=v)}else a=null,h=v;else a=null,h=v;else a=null,h=v;if(null!==a){d=a[1];e=a[2];m=a[3];a=[];for(g=0;g<m.length;g++)a.push(m[g][1]);m={token:"args"};m.value=[e].concat(a);null!=d&&"DISTINCT"===d.toUpperCase()?m.distinct=!0:m.distinct=!1;a=m}null===a&&(h=l)}r--;0===r&&null===a&&f("[62] ArgList");return a}function xa(){var a,d,e,m,g,k,l,v,x,s;r++;v=h;a=ua();null!==a&&(a={token:"args",value:[]});null===a&&(h=v);if(null===a){x=v=h;40===b.charCodeAt(h)?(a="(",h++):(a=null,0===r&&f('"("'));
if(null!==a)if(d=P(),null!==d){e=[];s=h;m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(44===b.charCodeAt(h)?(g=",",h++):(g=null,0===r&&f('","')),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=P(),null!==l?m=[m,g,k,l]:(m=null,h=s)):(m=null,h=s)}else m=null,h=s;else m=null,h=s;for(;null!==m;){e.push(m);s=h;m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(44===b.charCodeAt(h)?(g=",",h++):(g=null,0===r&&f('","')),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==
k?(l=P(),null!==l?m=[m,g,k,l]:(m=null,h=s)):(m=null,h=s)}else m=null,h=s;else m=null,h=s}null!==e?(41===b.charCodeAt(h)?(m=")",h++):(m=null,0===r&&f('")"')),null!==m?a=[a,d,e,m]:(a=null,h=x)):(a=null,h=x)}else a=null,h=x;else a=null,h=x;if(null!==a){d=a[1];e=a[2];a=[];for(m=0;m<e.length;m++)a.push(e[m][3]);e={token:"args"};e.value=[d].concat(a);a=e}null===a&&(h=v)}r--;0===r&&null===a&&f("[63] ExpressionList");return a}function vb(){var a,d,e,m,g,k,l;r++;l=k=h;123===b.charCodeAt(h)?(a="{",h++):(a=
null,0===r&&f('"{"'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=nb(),e=null!==e?e:"",null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();null!==m?(125===b.charCodeAt(h)?(g="}",h++):(g=null,0===r&&f('"}"')),null!==g?a=[a,d,e,m,g]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a=a[2]);null===a&&(h=k);r--;0===r&&null===a&&f("[64] ConstructTemplate");return a}function nb(){var a,d,e,m,g,k,l,v;r++;l=k=h;a=kb();if(null!==a){v=h;d=[];for(e=
u();null!==e;)d.push(e),e=u();if(null!==d)if(46===b.charCodeAt(h)?(e=".",h++):(e=null,0===r&&f('"."')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();null!==m?(g=nb(),g=null!==g?g:"",null!==g?d=[d,e,m,g]:(d=null,h=v)):(d=null,h=v)}else d=null,h=v;else d=null,h=v;d=null!==d?d:"";null!==d?a=[a,d]:(a=null,h=l)}else a=null,h=l;null!==a&&(d=a[1],a=a[0].triplesContext,"object"===typeof d&&null!=d.length&&null!=d[3].triplesContext&&(a=a.concat(d[3].triplesContext)),a={token:"triplestemplate",triplesContext:a});
null===a&&(h=k);r--;0===r&&null===a&&f("[65] ConstructTriples");return a}function kb(){var a,b,d,e,m,g;r++;g=m=h;a=[];for(b=u();null!==b;)a.push(b),b=u();if(null!==a)if(b=Sa(),null!==b){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Ga(),null!==e?a=[a,b,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;else a=null,h=g;null!==a&&(a=function(a,b,d){a=d.triplesContext;if(d.pairs)for(var f=0;f<d.pairs.length;f++){var h=d.pairs[f],e=null;null!=h[1].length&&(h[1]=h[1][0]);b.token&&"triplesnodecollection"===
b.token?(e={subject:b.chainSubject[0],predicate:h[0],object:h[1]},a.push(e),a=a.concat(b.triplesContext)):(e={subject:b,predicate:h[0],object:h[1]},a.push(e))}d={token:"triplessamesubject"};d.triplesContext=a;d.chainSubject=b;return d}(m,a[1],a[3]));null===a&&(h=m);if(null===a){g=m=h;a=[];for(b=u();null!==b;)a.push(b),b=u();if(null!==a)if(b=Ta(),null!==b){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Eb(),null!==e?a=[a,b,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;else a=null,h=g;null!==
a&&(a=function(a,b,d){a=b.triplesContext;var f=b.chainSubject;if(d.pairs)for(var h=0;h<d.pairs.length;h++){var e=d.pairs[h];null!=e[1].length&&(e[1]=e[1][0]);if("triplesnodecollection"===b.token)for(var m=0;m<f.length;m++){var g=f[m];if(null!=g.triplesContext){var n={subject:g.chainSubject,predicate:e[0],object:e[1]};a.concat(g.triplesContext)}else n={subject:f[m],predicate:e[0],object:e[1]},a.push(n)}else n={subject:f,predicate:e[0],object:e[1]},a.push(n)}b={token:"triplessamesubject"};b.triplesContext=
a;b.chainSubject=f;return b}(m,a[1],a[3]));null===a&&(h=m)}r--;0===r&&null===a&&f("[66] TriplesSameSubject");return a}function Ga(){var a,d,e,m,g,k,l,v,x,s,q,G,t,A;r++;G=q=h;a=Ua();if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=va(),null!==e){m=[];t=h;g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(59===b.charCodeAt(h)?(k=";",h++):(k=null,0===r&&f('";"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l){A=h;v=Ua();if(null!==v){x=[];for(s=u();null!==s;)x.push(s),
s=u();null!==x?(s=va(),null!==s?v=[v,x,s]:(v=null,h=A)):(v=null,h=A)}else v=null,h=A;v=null!==v?v:"";null!==v?g=[g,k,l,v]:(g=null,h=t)}else g=null,h=t}else g=null,h=t;else g=null,h=t;for(;null!==g;){m.push(g);t=h;g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(59===b.charCodeAt(h)?(k=";",h++):(k=null,0===r&&f('";"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l){A=h;v=Ua();if(null!==v){x=[];for(s=u();null!==s;)x.push(s),s=u();null!==x?(s=va(),null!==s?v=[v,x,s]:(v=null,h=
A)):(v=null,h=A)}else v=null,h=A;v=null!==v?v:"";null!==v?g=[g,k,l,v]:(g=null,h=t)}else g=null,h=t}else g=null,h=t;else g=null,h=t}null!==m?a=[a,d,e,m]:(a=null,h=G)}else a=null,h=G;else a=null,h=G}else a=null,h=G;if(null!==a){k=a[0];l=a[2];a=a[3];d={token:"propertylist"};e=[];m=[];for(g=0;g<l.length;g++)null!=l[g].triplesContext?(e=e.concat(l[g].triplesContext),"triplesnodecollection"===l[g].token&&null!=l[g].chainSubject.length?m.push([k,l[g].chainSubject[0]]):m.push([k,l[g].chainSubject])):m.push([k,
l[g]]);for(g=0;g<a.length;g++)for(l=a[g][3],k=l[0],l=l[2]||[],v=0;v<l.length;v++)null!=l[v].triplesContext?(e=e.concat(l[v].triplesContext),m.push([k,l[v].chainSubject])):m.push([k,l[v]]);d.pairs=m;d.triplesContext=e;a=d}null===a&&(h=q);r--;0===r&&null===a&&f("[67] PropertyListNotEmpty");return a}function Eb(){var a;r++;a=Ga();a=null!==a?a:"";r--;0===r&&null===a&&f("[68] PropertyList");return a}function va(){var a,d,e,m,g,k,l,v,x;r++;v=l=h;a=ya();if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=
u();if(null!==d){e=[];x=h;44===b.charCodeAt(h)?(m=",",h++):(m=null,0===r&&f('","'));if(null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=ya(),null!==k?m=[m,g,k]:(m=null,h=x)):(m=null,h=x)}else m=null,h=x;for(;null!==m;)if(e.push(m),x=h,44===b.charCodeAt(h)?(m=",",h++):(m=null,0===r&&f('","')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=ya(),null!==k?m=[m,g,k]:(m=null,h=x)):(m=null,h=x)}else m=null,h=x;null!==e?a=[a,d,e]:(a=null,h=v)}else a=null,h=v}else a=null,h=v;
if(null!==a){d=a[2];e=[];e.push(a[0]);for(a=0;a<d.length;a++)for(m=0;m<d[a].length;m++)"object"==typeof d[a][m]&&null!=d[a][m].token&&e.push(d[a][m]);a=e}null===a&&(h=l);r--;0===r&&null===a&&f("[69] ObjectList");return a}function Ua(){var a,d;r++;a=ta();null===a&&(d=h,97===b.charCodeAt(h)?(a="a",h++):(a=null,0===r&&f('"a"')),null!==a&&(a={token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}),null===a&&(h=d));r--;0===r&&null===a&&f("[71] Verb");return a}function xb(){var a,
b,d,e,m,g;r++;g=m=h;a=[];for(b=u();null!==b;)a.push(b),b=u();if(null!==a)if(b=Sa(),null!==b){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Fb(),null!==e?a=[a,b,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;else a=null,h=g;null!==a&&(a=function(a,b,d){a=d.triplesContext;if(d.pairs)for(var f=0;f<d.pairs.length;f++){var h=d.pairs[f],e=null;null!=h[1].length&&(h[1]=h[1][0]);b.token&&"triplesnodecollection"===b.token?(e={subject:b.chainSubject[0],predicate:h[0],object:h[1]},a.push(e),a=a.concat(b.triplesContext)):
(e={subject:b,predicate:h[0],object:h[1]},a.push(e))}d={token:"triplessamesubject"};d.triplesContext=a;d.chainSubject=b;return d}(m,a[1],a[3]));null===a&&(h=m);if(null===a){g=m=h;a=[];for(b=u();null!==b;)a.push(b),b=u();if(null!==a)if(b=Ta(),null!==b){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Gb(),null!==e?a=[a,b,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;else a=null,h=g;null!==a&&(a=function(a,b,d){a=b.triplesContext;var f=b.chainSubject;if(d.pairs)for(var h=0;h<d.pairs.length;h++){var e=
d.pairs[h];null!=e[1].length&&(e[1]=e[1][0]);if("triplesnodecollection"===b.token)for(var m=0;m<f.length;m++){var g=f[m];if(null!=g.triplesContext){var n={subject:g.chainSubject,predicate:e[0],object:e[1]};a.concat(g.triplesContext)}else n={subject:f[m],predicate:e[0],object:e[1]},a.push(n)}else n={subject:f,predicate:e[0],object:e[1]},a.push(n)}b={token:"triplessamesubject"};b.triplesContext=a;b.chainSubject=f;return b}(m,a[1],a[3]));null===a&&(h=m)}r--;0===r&&null===a&&f("[72] TriplesSameSubjectPath");
return a}function Fb(){var a,d,e,m,g,k,l,v,x,s,q,G,t;r++;q=s=h;a=Va();null===a&&(a=Z());if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=va(),null!==e){m=[];G=h;g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(59===b.charCodeAt(h)?(k=";",h++):(k=null,0===r&&f('";"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?(t=h,v=Va(),null===v&&(v=Z()),null!==v?(x=va(),null!==x?v=[v,x]:(v=null,h=t)):(v=null,h=t),v=null!==v?v:"",null!==v?g=[g,k,l,v]:(g=null,h=G)):(g=
null,h=G)}else g=null,h=G;else g=null,h=G;for(;null!==g;){m.push(g);G=h;g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(59===b.charCodeAt(h)?(k=";",h++):(k=null,0===r&&f('";"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?(t=h,v=Va(),null===v&&(v=Z()),null!==v?(x=va(),null!==x?v=[v,x]:(v=null,h=t)):(v=null,h=t),v=null!==v?v:"",null!==v?g=[g,k,l,v]:(g=null,h=G)):(g=null,h=G)}else g=null,h=G;else g=null,h=G}null!==m?a=[a,d,e,m]:(a=null,h=q)}else a=null,h=q;else a=null,h=q}else a=
null,h=q;if(null!==a){g=a[0];k=a[2];a=a[3];token={token:"propertylist"};d=[];e=[];for(m=0;m<k.length;m++)null!=k[m].triplesContext?(d=d.concat(k[m].triplesContext),"triplesnodecollection"===k[m].token&&null!=k[m].chainSubject.length?e.push([g,k[m].chainSubject[0]]):e.push([g,k[m].chainSubject])):e.push([g,k[m]]);for(m=0;m<a.length;m++)for(k=a[m][3],g=k[0],k=k[1]||[],l=0;l<k.length;l++)null!=k[l].triplesContext?(d=d.concat(k[l].triplesContext),e.push([g,k[l].chainSubject])):e.push([g,k[l]]);token.pairs=
e;token.triplesContext=d;a=token}null===a&&(h=s);r--;0===r&&null===a&&f("[73] PropertyListNotEmptyPath");return a}function Gb(){var a;r++;a=Ga();a=null!==a?a:"";r--;0===r&&null===a&&f("[74] PropertyListPath");return a}function Va(){var a,b;r++;b=h;a=ob();null===a&&(h=b);r--;0===r&&null===a&&f("[75]");return a}function ob(){var a,d,e,m,g,k,l;r++;k=g=h;a=Wa();if(null!==a){d=[];l=h;124===b.charCodeAt(h)?(e="|",h++):(e=null,0===r&&f('"|"'));null!==e?(m=Wa(),null!==m?e=[e,m]:(e=null,h=l)):(e=null,h=l);
for(;null!==e;)d.push(e),l=h,124===b.charCodeAt(h)?(e="|",h++):(e=null,0===r&&f('"|"')),null!==e?(m=Wa(),null!==m?e=[e,m]:(e=null,h=l)):(e=null,h=l);null!==d?a=[a,d]:(a=null,h=k)}else a=null,h=k;if(null!==a)if(d=a[1],null==d||0===d.length)a=a[0];else{a=[];for(e=0;e<d.length;e++)a.push(d[1]);d={token:"path",kind:"alternative"};d.value=a;a=d}null===a&&(h=g);r--;0===r&&null===a&&f("[78] PathAlternative");return a}function Wa(){var a,d,e,m,g,k,l;r++;k=g=h;a=Xa();if(null!==a){d=[];l=h;47===b.charCodeAt(h)?
(e="/",h++):(e=null,0===r&&f('"/"'));null!==e?(m=Xa(),null!==m?e=[e,m]:(e=null,h=l)):(e=null,h=l);for(;null!==e;)d.push(e),l=h,47===b.charCodeAt(h)?(e="/",h++):(e=null,0===r&&f('"/"')),null!==e?(m=Xa(),null!==m?e=[e,m]:(e=null,h=l)):(e=null,h=l);null!==d?a=[a,d]:(a=null,h=k)}else a=null,h=k;if(null!==a)if(d=a[0],a=a[1],null==a||0===a.length)a=d;else{d=[d];for(e=0;e<a.length;e++)d.push(a[e][1]);a={token:"path",kind:"sequence"};a.value=d}null===a&&(h=g);r--;0===r&&null===a&&f("[79] PathSequence");return a}
function pb(){var a,b,d,e;r++;e=d=h;a=Hb();null!==a?(b=Ib(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,h=e)):(a=null,h=e);if(null!==a)if(b=a[0],a=a[1],b.token&&"path"!=b.token&&""==a)a=b;else if(b.token&&b.token!=m&&""!=a){var m={token:"path",kind:"element"};m.value=b;m.modifier=a;a=m}else b.modifier=a,a=b;null===a&&(h=d);r--;0===r&&null===a&&f("[88] PathElt");return a}function Xa(){var a,d,e,m;r++;a=pb();null===a&&(m=e=h,94===b.charCodeAt(h)?(a="^",h++):(a=null,0===r&&f('"^"')),null!==a?(d=pb(),null!==
d?a=[a,d]:(a=null,h=m)):(a=null,h=m),null!==a&&(d={token:"path",kind:"inversePath"},d.value=a[1],a=d),null===a&&(h=e));r--;0===r&&null===a&&f("[81] PathEltOrInverse");return a}function Ib(){var a,d,e,m,g,k,l,v,x;r++;42===b.charCodeAt(h)?(a="*",h++):(a=null,0===r&&f('"*"'));null===a&&(63===b.charCodeAt(h)?(a="?",h++):(a=null,0===r&&f('"?"')),null===a&&(43===b.charCodeAt(h)?(a="+",h++):(a=null,0===r&&f('"+"')),null===a&&(k=h,123===b.charCodeAt(h)?(a="{",h++):(a=null,0===r&&f('"{"')),null!==a?(l=h,d=
oa(),null!==d?(v=h,44===b.charCodeAt(h)?(e=",",h++):(e=null,0===r&&f('","')),null!==e?(125===b.charCodeAt(h)?(m="}",h++):(m=null,0===r&&f('"}"')),null===m&&(x=h,m=oa(),null!==m?(125===b.charCodeAt(h)?(g="}",h++):(g=null,0===r&&f('"}"')),null!==g?m=[m,g]:(m=null,h=x)):(m=null,h=x)),null!==m?e=[e,m]:(e=null,h=v)):(e=null,h=v),null===e&&(125===b.charCodeAt(h)?(e="}",h++):(e=null,0===r&&f('"}"'))),null!==e?d=[d,e]:(d=null,h=l)):(d=null,h=l),null===d&&(l=h,44===b.charCodeAt(h)?(d=",",h++):(d=null,0===
r&&f('","')),null!==d?(e=oa(),null!==e?(125===b.charCodeAt(h)?(m="}",h++):(m=null,0===r&&f('"}"')),null!==m?d=[d,e,m]:(d=null,h=l)):(d=null,h=l)):(d=null,h=l)),null!==d?a=[a,d]:(a=null,h=k)):(a=null,h=k))));r--;0===r&&null===a&&f("[82] PathMod");return a}function Hb(){var a,d,e,m,g;r++;a=aa();null===a&&(m=h,97===b.charCodeAt(h)?(a="a",h++):(a=null,0===r&&f('"a"')),null!==a&&(a={token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}),null===a&&(h=m),null===a&&
(m=h,33===b.charCodeAt(h)?(a="!",h++):(a=null,0===r&&f('"!"')),null!==a?(d=Jb(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m),null===a&&(g=m=h,40===b.charCodeAt(h)?(a="(",h++):(a=null,0===r&&f('"("')),null!==a?(d=ob(),null!==d?(41===b.charCodeAt(h)?(e=")",h++):(e=null,0===r&&f('")"')),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)):(a=null,h=g),null!==a&&(a=a[1]),null===a&&(h=m))));r--;0===r&&null===a&&f("[83] PathPrimary");return a}function Jb(){var a,d,e,m,g,k,l,v;a=Ha();if(null===a)if(k=h,40===b.charCodeAt(h)?
(a="(",h++):(a=null,0===r&&f('"("')),null!==a){l=h;d=Ha();if(null!==d){e=[];v=h;124===b.charCodeAt(h)?(m="|",h++):(m=null,0===r&&f('"|"'));null!==m?(g=Ha(),null!==g?m=[m,g]:(m=null,h=v)):(m=null,h=v);for(;null!==m;)e.push(m),v=h,124===b.charCodeAt(h)?(m="|",h++):(m=null,0===r&&f('"|"')),null!==m?(g=Ha(),null!==g?m=[m,g]:(m=null,h=v)):(m=null,h=v);null!==e?d=[d,e]:(d=null,h=l)}else d=null,h=l;d=null!==d?d:"";null!==d?(41===b.charCodeAt(h)?(e=")",h++):(e=null,0===r&&f('")"')),null!==e?a=[a,d,e]:(a=
null,h=k)):(a=null,h=k)}else a=null,h=k;return a}function Ha(){var a,d,e;r++;a=aa();null===a&&(97===b.charCodeAt(h)?(a="a",h++):(a=null,0===r&&f('"a"')),null===a&&(e=h,94===b.charCodeAt(h)?(a="^",h++):(a=null,0===r&&f('"^"')),null!==a?(d=aa(),null===d&&(97===b.charCodeAt(h)?(d="a",h++):(d=null,0===r&&f('"a"'))),null!==d?a=[a,d]:(a=null,h=e)):(a=null,h=e)));r--;0===r&&null===a&&f("[85] PathOneInPropertySet");return a}function Ta(){var a,b;r++;b=h;a=Kb();if(null!==a){for(var d=[],e=[],m=null,g=0;g<
a.length;g++)pa++,m=null,null==a[g].chainSubject&&null==a[g].triplesContext?m=a[g]:(m=a[g].chainSubject,d=d.concat(nextSubject.triplesContext)),m={subject:{token:"blank",value:"_:"+pa},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"},object:m},0==g&&e.push(m.subject),d.push(m),m=g===a.length-1?{subject:{token:"blank",value:"_:"+pa},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"uri",
prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}}:{subject:{token:"blank",value:"_:"+pa},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"blank",value:"_:"+(pa+1)}},d.push(m);a={token:"triplesnodecollection",triplesContext:d,chainSubject:e}}null===a&&(h=b);null===a&&(a=Lb());r--;0===r&&null===a&&f("[87] TriplesNode");return a}function Lb(){var a,d,e,m,g,k,l,v,x,s;r++;s=x=h;a=[];for(d=u();null!==d;)a.push(d),
d=u();if(null!==a)if(91===b.charCodeAt(h)?(d="[",h++):(d=null,0===r&&f('"["')),null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(m=Ga(),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(93===b.charCodeAt(h)?(k="]",h++):(k=null,0===r&&f('"]"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=s)}else a=null,h=s;else a=null,h=s}else a=null,h=s;else a=null,h=s}else a=null,h=s;else a=null,h=s;if(null!==a){a=a[3];pa++;d={token:"blank",
value:"_:"+pa};e=[];for(m=0;m<a.pairs.length;m++)g=a.pairs[m],k={},k.subject=d,k.predicate=g[0],null!=g[1].length&&(g[1]=g[1][0]),k.object=g[1],e.push(k);a={token:"triplesnode",kind:"blanknodepropertylist",triplesContext:a.triplesContext.concat(e),chainSubject:d}}null===a&&(h=x);r--;0===r&&null===a&&f("[88] BlankNodePropertyList");return a}function Kb(){var a,d,e,m,g,k,l,v,x,s;r++;s=x=h;a=[];for(d=u();null!==d;)a.push(d),d=u();if(null!==a)if(40===b.charCodeAt(h)?(d="(",h++):(d=null,0===r&&f('"("')),
null!==d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e){g=ya();if(null!==g)for(m=[];null!==g;)m.push(g),g=ya();else m=null;if(null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();if(null!==g)if(41===b.charCodeAt(h)?(k=")",h++):(k=null,0===r&&f('")"')),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=s)}else a=null,h=s;else a=null,h=s}else a=null,h=s}else a=null,h=s}else a=null,h=s;else a=null,h=s;null!==a&&(a=a[3]);null===a&&(h=x);r--;0===r&&null===a&&
f("[89] Collection");return a}function ya(){var a,b,d,e,m,g;r++;g=m=h;a=[];for(b=u();null!==b;)a.push(b),b=u();if(null!==a)if(b=Sa(),null!==b){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?a=[a,b,d]:(a=null,h=g)}else a=null,h=g;else a=null,h=g;if(null===a){g=h;a=[];for(b=u();null!==b;)a.push(b),b=u();if(null!==a)if(b=Ta(),null!==b){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?a=[a,b,d]:(a=null,h=g)}else a=null,h=g;else a=null,h=g}null!==a&&(a=a[1]);null===a&&(h=m);r--;0===r&&null===a&&f("[90] GraphNode");
return a}function Sa(){var a;r++;a=Z();null===a&&(a=Mb());r--;0===r&&null===a&&f("[91] VarOrTerm");return a}function ta(){var a;r++;a=Z();null===a&&(a=aa());r--;0===r&&null===a&&f("[92] VarOrIRIref");return a}function Z(){var a,b;r++;b=h;a=Nb();null===a&&(a=Ob());if(null!==a){var d={token:"var"};d.value=a;a=d}null===a&&(h=b);r--;0===r&&null===a&&f("[93] Var");return a}function Mb(){var a;r++;a=aa();null===a&&(a=Pa(),null===a&&(a=Qa(),null===a&&(a=Ra(),null===a&&(a=Pb(),null===a&&(a=ua())))));r--;
0===r&&null===a&&f("[94] GraphTerm");return a}function P(){var a,d,e,m,g,k,l,v,x;r++;v=l=h;a=Ya();if(null!==a){d=[];x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("||"===b.substr(h,2)?(m="||",h+=2):(m=null,0===r&&f('"||"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=Ya(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x;for(;null!==e;){d.push(e);x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("||"===b.substr(h,2)?(m="||",h+=
2):(m=null,0===r&&f('"||"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=Ya(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x}null!==d?a=[a,d]:(a=null,h=v)}else a=null,h=v;if(null!==a)if(e=a[0],a=a[1],0===a.length)a=e;else{d={token:"expression",expressionType:"conditionalor"};e=[e];for(m=0;m<a.length;m++)e.push(a[m][3]);d.operands=e;a=d}null===a&&(h=l);r--;0===r&&null===a&&f("[96] ConditionalOrExpression");return a}function Ya(){var a,d,e,m,g,k,l,
v,x;r++;v=l=h;a=Za();if(null!==a){d=[];x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("&&"===b.substr(h,2)?(m="&&",h+=2):(m=null,0===r&&f('"&&"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=Za(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x;for(;null!==e;){d.push(e);x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("&&"===b.substr(h,2)?(m="&&",h+=2):(m=null,0===r&&f('"&&"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=
u();null!==g?(k=Za(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x}null!==d?a=[a,d]:(a=null,h=v)}else a=null,h=v;if(null!==a)if(e=a[0],a=a[1],0===a.length)a=e;else{d={token:"expression",expressionType:"conditionaland"};e=[e];for(m=0;m<a.length;m++)e.push(a[m][3]);d.operands=e;a=d}null===a&&(h=l);r--;0===r&&null===a&&f("[97] ConditionalAndExpression");return a}function Za(){var a,d,e,m,g,k,l,v,x,s,q,G,t,A;r++;t=G=h;a=da();if(null!==a){d=[];A=h;e=[];for(m=u();null!==
m;)e.push(m),m=u();if(null!==e)if(61===b.charCodeAt(h)?(m="=",h++):(m=null,0===r&&f('"="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("!="===b.substr(h,2)?(m="!=",h+=2):(m=null,0===r&&f('"!="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,
h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(60===b.charCodeAt(h)?(m="<",h++):(m=null,0===r&&f('"<"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(62===b.charCodeAt(h)?(m=">",h++):(m=null,0===r&&f('">"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==
k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("<="===b.substr(h,2)?(m="<=",h+=2):(m=null,0===r&&f('"<="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(">="===b.substr(h,2)?(m=">=",h+=2):(m=null,0===r&&f('">="')),null!==m){g=
[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(73===b.charCodeAt(h)?(m="I",h++):(m=null,0===r&&f('"I"')),null===m&&(105===b.charCodeAt(h)?(m="i",h++):(m=null,0===r&&f('"i"'))),null!==m)if(78===b.charCodeAt(h)?(g="N",h++):(g=null,0===r&&f('"N"')),null===g&&(110===b.charCodeAt(h)?(g="n",h++):(g=null,0===r&&f('"n"'))),null!==g){k=[];for(l=u();null!==
l;)k.push(l),l=u();null!==k?(l=xa(),null!==l?e=[e,m,g,k,l]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(78===b.charCodeAt(h)?(m="N",h++):(m=null,0===r&&f('"N"')),null===m&&(110===b.charCodeAt(h)?(m="n",h++):(m=null,0===r&&f('"n"'))),null!==m)if(79===b.charCodeAt(h)?(g="O",h++):(g=null,0===r&&f('"O"')),null===g&&(111===b.charCodeAt(h)?(g="o",h++):(g=null,0===r&&f('"o"'))),null!==g)if(84===b.charCodeAt(h)?
(k="T",h++):(k=null,0===r&&f('"T"')),null===k&&(116===b.charCodeAt(h)?(k="t",h++):(k=null,0===r&&f('"t"'))),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(73===b.charCodeAt(h)?(v="I",h++):(v=null,0===r&&f('"I"')),null===v&&(105===b.charCodeAt(h)?(v="i",h++):(v=null,0===r&&f('"i"'))),null!==v)if(78===b.charCodeAt(h)?(x="N",h++):(x=null,0===r&&f('"N"')),null===x&&(110===b.charCodeAt(h)?(x="n",h++):(x=null,0===r&&f('"n"'))),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==
s?(q=xa(),null!==q?e=[e,m,g,k,l,v,x,s,q]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;else e=null,h=A}else e=null,h=A;else e=null,h=A;else e=null,h=A;else e=null,h=A}}}}}}}for(;null!==e;){d.push(e);A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(61===b.charCodeAt(h)?(m="=",h++):(m=null,0===r&&f('"="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=
u();null!==m;)e.push(m),m=u();if(null!==e)if("!="===b.substr(h,2)?(m="!=",h+=2):(m=null,0===r&&f('"!="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(60===b.charCodeAt(h)?(m="<",h++):(m=null,0===r&&f('"<"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=
null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(62===b.charCodeAt(h)?(m=">",h++):(m=null,0===r&&f('">"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if("<="===b.substr(h,2)?(m="<=",h+=2):(m=null,0===r&&f('"<="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=
da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(">="===b.substr(h,2)?(m=">=",h+=2):(m=null,0===r&&f('">="')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=da(),null!==k?e=[e,m,g,k]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(73===b.charCodeAt(h)?(m="I",h++):(m=null,0===r&&f('"I"')),null===
m&&(105===b.charCodeAt(h)?(m="i",h++):(m=null,0===r&&f('"i"'))),null!==m)if(78===b.charCodeAt(h)?(g="N",h++):(g=null,0===r&&f('"N"')),null===g&&(110===b.charCodeAt(h)?(g="n",h++):(g=null,0===r&&f('"n"'))),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=xa(),null!==l?e=[e,m,g,k,l]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;else e=null,h=A;if(null===e){A=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(78===b.charCodeAt(h)?(m="N",h++):(m=null,0===r&&f('"N"')),
null===m&&(110===b.charCodeAt(h)?(m="n",h++):(m=null,0===r&&f('"n"'))),null!==m)if(79===b.charCodeAt(h)?(g="O",h++):(g=null,0===r&&f('"O"')),null===g&&(111===b.charCodeAt(h)?(g="o",h++):(g=null,0===r&&f('"o"'))),null!==g)if(84===b.charCodeAt(h)?(k="T",h++):(k=null,0===r&&f('"T"')),null===k&&(116===b.charCodeAt(h)?(k="t",h++):(k=null,0===r&&f('"t"'))),null!==k){l=[];for(v=u();null!==v;)l.push(v),v=u();if(null!==l)if(73===b.charCodeAt(h)?(v="I",h++):(v=null,0===r&&f('"I"')),null===v&&(105===b.charCodeAt(h)?
(v="i",h++):(v=null,0===r&&f('"i"'))),null!==v)if(78===b.charCodeAt(h)?(x="N",h++):(x=null,0===r&&f('"N"')),null===x&&(110===b.charCodeAt(h)?(x="n",h++):(x=null,0===r&&f('"n"'))),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?(q=xa(),null!==q?e=[e,m,g,k,l,v,x,s,q]:(e=null,h=A)):(e=null,h=A)}else e=null,h=A;else e=null,h=A;else e=null,h=A}else e=null,h=A;else e=null,h=A;else e=null,h=A;else e=null,h=A}}}}}}}}null!==d?a=[a,d]:(a=null,h=t)}else a=null,h=t;if(null!==a)if(d=a[0],g=a[1],0===
g.length)a=d;else if("i"===g[0][1]||"I"===g[0][1]||"n"===g[0][1]||"N"===g[0][1]){a={};"i"===g[0][1]||"I"===g[0][1]?(e="=",a.expressionType="conditionalor"):(e="!=",a.expressionType="conditionaland");m=[];for(k=0;k<g[0].length;k++)if("args"===g[0][k].token){m=g[0][k].value;break}a.token="expression";a.operands=[];for(g=0;g<m.length;g++)k={token:"expression",expressionType:"relationalexpression"},k.operator=e,k.op1=d,k.op2=m[g],a.operands.push(k)}else a={expressionType:"relationalexpression"},a.operator=
g[0][1],a.op1=d,a.op2=g[0][3],a.token="expression";null===a&&(h=G);r--;0===r&&null===a&&f("[99] RelationalExpression");return a}function da(){var a,d,e,m,g,k,l,v,x,s,q;r++;x=v=h;a=za();if(null!==a){d=[];s=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(43===b.charCodeAt(h)?(m="+",h++):(m=null,0===r&&f('"+"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=za(),null!==k?e=[e,m,g,k]:(e=null,h=s)):(e=null,h=s)}else e=null,h=s;else e=null,h=s;if(null===e){s=h;e=[];for(m=u();null!==
m;)e.push(m),m=u();if(null!==e)if(45===b.charCodeAt(h)?(m="-",h++):(m=null,0===r&&f('"-"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=za(),null!==k?e=[e,m,g,k]:(e=null,h=s)):(e=null,h=s)}else e=null,h=s;else e=null,h=s;if(null===e)if(s=h,e=Aa(),null===e&&(e=Aa()),null!==e){q=h;m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(42===b.charCodeAt(h)?(g="*",h++):(g=null,0===r&&f('"*"')),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=na(),null!==l?m=[m,g,k,l]:
(m=null,h=q)):(m=null,h=q)}else m=null,h=q;else m=null,h=q;if(null===m){q=h;m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(47===b.charCodeAt(h)?(g="/",h++):(g=null,0===r&&f('"/"')),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=na(),null!==l?m=[m,g,k,l]:(m=null,h=q)):(m=null,h=q)}else m=null,h=q;else m=null,h=q}m=null!==m?m:"";null!==m?e=[e,m]:(e=null,h=s)}else e=null,h=s}for(;null!==e;){d.push(e);s=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(43===b.charCodeAt(h)?
(m="+",h++):(m=null,0===r&&f('"+"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=za(),null!==k?e=[e,m,g,k]:(e=null,h=s)):(e=null,h=s)}else e=null,h=s;else e=null,h=s;if(null===e){s=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(45===b.charCodeAt(h)?(m="-",h++):(m=null,0===r&&f('"-"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=za(),null!==k?e=[e,m,g,k]:(e=null,h=s)):(e=null,h=s)}else e=null,h=s;else e=null,h=s;if(null===e)if(s=h,e=Aa(),null===e&&(e=
Aa()),null!==e){q=h;m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(42===b.charCodeAt(h)?(g="*",h++):(g=null,0===r&&f('"*"')),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=na(),null!==l?m=[m,g,k,l]:(m=null,h=q)):(m=null,h=q)}else m=null,h=q;else m=null,h=q;if(null===m){q=h;m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(47===b.charCodeAt(h)?(g="/",h++):(g=null,0===r&&f('"/"')),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=na(),null!==l?m=[m,g,k,l]:
(m=null,h=q)):(m=null,h=q)}else m=null,h=q;else m=null,h=q}m=null!==m?m:"";null!==m?e=[e,m]:(e=null,h=s)}else e=null,h=s}}null!==d?a=[a,d]:(a=null,h=x)}else a=null,h=x;if(null!==a)if(e=a[0],a=a[1],0===a.length)a=e;else{d={token:"expression",expressionType:"additiveexpression"};d.summand=e;d.summands=[];for(e=0;e<a.length;e++)g=a[e],m={},4==g.length&&"string"===typeof g[1]?(m.operator=g[1],m.expression=g[3]):(g={},k=m[0],l=m[1][1],x=m[1][3],l=null,0>k.value?(m.operator="-",k.value=-k.value):m.operator=
"+",g.token="expression",g.expressionType="multiplicativeexpression",g.operator=k,g.factors=[{operator:l,expression:x}],m.expression=g),d.summands.push(m);a=d}null===a&&(h=v);r--;0===r&&null===a&&f("[101] AdditiveExpression");return a}function za(){var a,d,e,m,g,k,l,v,x;r++;v=l=h;a=na();if(null!==a){d=[];x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(42===b.charCodeAt(h)?(m="*",h++):(m=null,0===r&&f('"*"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=na(),null!==k?
e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x;if(null===e){x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(47===b.charCodeAt(h)?(m="/",h++):(m=null,0===r&&f('"/"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=na(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x}for(;null!==e;){d.push(e);x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(42===b.charCodeAt(h)?(m="*",h++):(m=null,0===r&&f('"*"')),null!==
m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=na(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x;if(null===e){x=h;e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(47===b.charCodeAt(h)?(m="/",h++):(m=null,0===r&&f('"/"')),null!==m){g=[];for(k=u();null!==k;)g.push(k),k=u();null!==g?(k=na(),null!==k?e=[e,m,g,k]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x}}null!==d?a=[a,d]:(a=null,h=v)}else a=null,h=v;if(null!==a)if(e=a[0],a=a[1],0===a.length)a=
e;else{d={token:"expression",expressionType:"multiplicativeexpression"};d.factor=e;d.factors=[];for(e=0;e<a.length;e++)m=a[e],g={},g.operator=m[1],g.expression=m[3],d.factors.push(g);a=d}null===a&&(h=l);r--;0===r&&null===a&&f("[102] MultiplicativeExpression");return a}function na(){var a,d,e,m,g;r++;g=m=h;33===b.charCodeAt(h)?(a="!",h++):(a=null,0===r&&f('"!"'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Ia(),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==
a&&(a=function(a,b){var d={token:"expression",expressionType:"unaryexpression",unaryexpression:"!"};d.expression=b;return d}(m,a[2]));null===a&&(h=m);if(null===a){g=m=h;43===b.charCodeAt(h)?(a="+",h++):(a=null,0===r&&f('"+"'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Ia(),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"unaryexpression",unaryexpression:"+"};d.expression=b;return d}(m,a[2]));
null===a&&(h=m);if(null===a){g=m=h;45===b.charCodeAt(h)?(a="-",h++):(a=null,0===r&&f('"-"'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=Ia(),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"unaryexpression",unaryexpression:"-"};d.expression=b;return d}(m,a[2]));null===a&&(h=m);null===a&&(a=Ia())}}r--;0===r&&null===a&&f("[103] UnaryExpression");return a}function Ia(){var a,b;r++;a=Oa();null===a&&
(a=Na(),null===a&&(a=Qb(),null===a&&(b=h,a=Pa(),null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"rdfliteral"};d.value=b;return d}(b,a)),null===a&&(h=b),null===a&&(b=h,a=Qa(),null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"numericliteral"};d.value=b;return d}(b,a)),null===a&&(h=b),null===a&&(b=h,a=Ra(),null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"booleanliteral"};
d.value=b;return d}(b,a)),null===a&&(h=b),null===a&&(a=Rb(),null===a&&(b=h,a=Z(),null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"var"};d.value=b;return d}(b,a)),null===a&&(h=b))))))));r--;0===r&&null===a&&f("[104] PrimaryExpression");return a}function Oa(){var a,d,e,m,g,k,l;r++;l=k=h;40===b.charCodeAt(h)?(a="(",h++):(a=null,0===r&&f('"("'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(e=P(),null!==e){m=[];for(g=u();null!==g;)m.push(g),
g=u();null!==m?(41===b.charCodeAt(h)?(g=")",h++):(g=null,0===r&&f('")"')),null!==g?a=[a,d,e,m,g]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(a=a[2]);null===a&&(h=k);r--;0===r&&null===a&&f("[105] BrackettedExpression");return a}function Na(){var a,d,e,m,g,k,l,v,x,s,q,G,A,t,B,M,E;r++;E=M=h;"STR"===b.substr(h,3)?(a="STR",h+=3):(a=null,0===r&&f('"STR"'));null===a&&("str"===b.substr(h,3)?(a="str",h+=3):(a=null,0===r&&f('"str"')));if(null!==a){d=[];for(e=u();null!==
e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"str"};
d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"LANG"===b.substr(h,4)?(a="LANG",h+=4):(a=null,0===r&&f('"LANG"'));null===a&&("lang"===b.substr(h,4)?(a="lang",h+=4):(a=null,0===r&&f('"lang"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):
(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"lang"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"LANGMATCHES"===b.substr(h,11)?(a="LANGMATCHES",h+=11):(a=null,0===r&&f('"LANGMATCHES"'));null===a&&("langmatches"===b.substr(h,11)?(a="langmatches",h+=11):(a=null,0===r&&f('"langmatches"')));
if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(44===b.charCodeAt(h)?(l=",",h++):(l=null,0===r&&f('","')),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(x=P(),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?(41===b.charCodeAt(h)?(q=")",h++):(q=null,0===
r&&f('")"')),null!==q?a=[a,d,e,m,g,k,l,v,x,s,q]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b,d){a={token:"expression",expressionType:"builtincall",builtincall:"langmatches"};a.args=[b,d];return a}(M,a[4],a[8]));null===a&&(h=M);if(null===a){E=M=h;"DATATYPE"===b.substr(h,8)?(a="DATATYPE",h+=8):(a=null,0===r&&f('"DATATYPE"'));null===a&&("datatype"===
b.substr(h,8)?(a="datatype",h+=8):(a=null,0===r&&f('"datatype"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=
E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"datatype"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"BOUND"===b.substr(h,5)?(a="BOUND",h+=5):(a=null,0===r&&f('"BOUND"'));null===a&&("bound"===b.substr(h,5)?(a="bound",h+=5):(a=null,0===r&&f('"bound"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),
g=u();if(null!==m)if(g=Z(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"bound"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"IRI"===b.substr(h,3)?(a="IRI",h+=3):(a=null,0===r&&f('"IRI"'));
null===a&&("iri"===b.substr(h,3)?(a="iri",h+=3):(a=null,0===r&&f('"iri"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=
null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"iri"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"URI"===b.substr(h,3)?(a="URI",h+=3):(a=null,0===r&&f('"URI"'));null===a&&("uri"===b.substr(h,3)?(a="uri",h+=3):(a=null,0===r&&f('"uri"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),
g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"uri"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"BNODE"===b.substr(h,5)?(a="BNODE",h+=5):(a=null,0===r&&
f('"BNODE"'));null===a&&("bnode"===b.substr(h,5)?(a="bnode",h+=5):(a=null,0===r&&f('"bnode"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d){x=h;40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("'));if(null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?e=[e,m,g,k,l]:(e=null,h=x)):(e=null,h=x)}else e=null,h=x;else e=null,h=x}else e=
null,h=x;null===e&&(e=ua());null!==e?a=[a,d,e]:(a=null,h=E)}else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"bnode"};d.args=5===b.length?[b[2]]:null;return d}(M,a[2]));null===a&&(h=M);if(null===a){E=M=h;"COALESCE"===b.substr(h,8)?(a="COALESCE",h+=8):(a=null,0===r&&f('"COALESCE"'));null===a&&("coalesce"===b.substr(h,8)?(a="coalesce",h+=8):(a=null,0===r&&f('"coalesce"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=
u();null!==d?(e=xa(),null!==e?a=[a,d,e]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"coalesce"};d.args=b;return d}(M,a[2]));null===a&&(h=M);if(null===a){E=M=h;"IF"===b.substr(h,2)?(a="IF",h+=2):(a=null,0===r&&f('"IF"'));null===a&&("if"===b.substr(h,2)?(a="if",h+=2):(a=null,0===r&&f('"if"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&
f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(44===b.charCodeAt(h)?(l=",",h++):(l=null,0===r&&f('","')),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(x=P(),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();if(null!==s)if(44===b.charCodeAt(h)?(q=",",h++):(q=null,0===r&&f('","')),null!==q){G=[];for(A=u();null!==A;)G.push(A),A=u();if(null!==G)if(A=P(),null!==A){t=[];for(B=u();null!==
B;)t.push(B),B=u();null!==t?(41===b.charCodeAt(h)?(B=")",h++):(B=null,0===r&&f('")"')),null!==B?a=[a,d,e,m,g,k,l,v,x,s,q,G,A,t,B]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b,d,e){a={token:"expression",expressionType:"builtincall",builtincall:"if"};a.args=[b,d,e];return a}(M,a[4],a[8],
a[12]));null===a&&(h=M);if(null===a){E=M=h;"ISLITERAL"===b.substr(h,9)?(a="ISLITERAL",h+=9):(a=null,0===r&&f('"ISLITERAL"'));null===a&&("isliteral"===b.substr(h,9)?(a="isliteral",h+=9):(a=null,0===r&&f('"isliteral"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=
")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"isliteral"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"ISBLANK"===b.substr(h,7)?(a="ISBLANK",h+=7):(a=null,0===r&&f('"ISBLANK"'));null===a&&("isblank"===b.substr(h,7)?(a="isblank",h+=7):(a=null,0===r&&f('"isblank"')));
if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",
expressionType:"builtincall",builtincall:"isblank"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"SAMETERM"===b.substr(h,8)?(a="SAMETERM",h+=8):(a=null,0===r&&f('"SAMETERM"'));null===a&&("sameterm"===b.substr(h,8)?(a="sameterm",h+=8):(a=null,0===r&&f('"sameterm"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];
for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(44===b.charCodeAt(h)?(l=",",h++):(l=null,0===r&&f('","')),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(x=P(),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?(41===b.charCodeAt(h)?(q=")",h++):(q=null,0===r&&f('")"')),null!==q?a=[a,d,e,m,g,k,l,v,x,s,q]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,
h=E;null!==a&&(a=function(a,b,d){a={token:"expression",expressionType:"builtincall",builtincall:"sameterm"};a.args=[b,d];return a}(M,a[4],a[8]));null===a&&(h=M);if(null===a){E=M=h;"ISURI"===b.substr(h,5)?(a="ISURI",h+=5):(a=null,0===r&&f('"ISURI"'));null===a&&("isuri"===b.substr(h,5)?(a="isuri",h+=5):(a=null,0===r&&f('"isuri"')),null===a&&("ISIRI"===b.substr(h,5)?(a="ISIRI",h+=5):(a=null,0===r&&f('"ISIRI"')),null===a&&("isiri"===b.substr(h,5)?(a="isiri",h+=5):(a=null,0===r&&f('"isiri"')))));if(null!==
a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(41===b.charCodeAt(h)?(l=")",h++):(l=null,0===r&&f('")"')),null!==l?a=[a,d,e,m,g,k,l]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",
builtincall:"isuri"};d.args=[b];return d}(M,a[4]));null===a&&(h=M);if(null===a){E=M=h;"custom:"===b.substr(h,7)?(a="custom:",h+=7):(a=null,0===r&&f('"custom:"'));null===a&&("CUSTOM:"===b.substr(h,7)?(a="CUSTOM:",h+=7):(a=null,0===r&&f('"CUSTOM:"')));if(null!==a){/^[a-zA-Z0-9_]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[a-zA-Z0-9_]"));if(null!==e)for(d=[];null!==e;)d.push(e),/^[a-zA-Z0-9_]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[a-zA-Z0-9_]"));else d=null;if(null!==
d){e=[];for(m=u();null!==m;)e.push(m),m=u();if(null!==e)if(40===b.charCodeAt(h)?(m="(",h++):(m=null,0===r&&f('"("')),null!==m){g=[];x=h;k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=P(),null!==l?(44===b.charCodeAt(h)?(v=",",h++):(v=null,0===r&&f('","')),null!==v?k=[k,l,v]:(k=null,h=x)):(k=null,h=x)):(k=null,h=x);for(;null!==k;){g.push(k);x=h;k=[];for(l=u();null!==l;)k.push(l),l=u();null!==k?(l=P(),null!==l?(44===b.charCodeAt(h)?(v=",",h++):(v=null,0===r&&f('","')),null!==v?k=[k,l,v]:(k=null,
h=x)):(k=null,h=x)):(k=null,h=x)}if(null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(l=P(),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();null!==v?(41===b.charCodeAt(h)?(x=")",h++):(x=null,0===r&&f('")"')),null!==x?a=[a,d,e,m,g,k,l,v,x]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E;else a=null,h=E}else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E}else a=null,h=E;null!==a&&(a=function(a,b,d,e){a={token:"expression",expressionType:"custom"};a.name=b.join("");b=[];for(var f=
0;f<d.length;f++)b.push(d[f][1]);b.push(e);a.args=b;return a}(M,a[1],a[4],a[6]));null===a&&(h=M);null===a&&(a=Sb(),null===a&&(a=Tb(),null===a&&(a=Ub())))}}}}}}}}}}}}}}r--;0===r&&null===a&&f("[106] BuiltInCall");return a}function Sb(){var a,d,e,m,g,k,l,v,x,s,q,G,A,t,E,B;r++;E=t=h;"REGEX"===b.substr(h,5)?(a="REGEX",h+=5):(a=null,0===r&&f('"REGEX"'));null===a&&("regex"===b.substr(h,5)?(a="regex",h+=5):(a=null,0===r&&f('"regex"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===
b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if(g=P(),null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(44===b.charCodeAt(h)?(l=",",h++):(l=null,0===r&&f('","')),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(x=P(),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();if(null!==s){B=h;44===b.charCodeAt(h)?(q=",",h++):(q=null,0===r&&f('","'));if(null!==q){G=[];for(A=u();null!==A;)G.push(A),A=u();
null!==G?(A=P(),null!==A?q=[q,G,A]:(q=null,h=B)):(q=null,h=B)}else q=null,h=B;q=null!==q?q:"";if(null!==q){G=[];for(A=u();null!==A;)G.push(A),A=u();null!==G?(41===b.charCodeAt(h)?(A=")",h++):(A=null,0===r&&f('")"')),null!==A?a=[a,d,e,m,g,k,l,v,x,s,q,G,A]:(a=null,h=E)):(a=null,h=E)}else a=null,h=E}else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;else a=null,h=E}else a=null,h=E;null!==a&&(d=a[8],e=a[10],m={token:"expression",
expressionType:"regex"},m.text=a[4],m.pattern=d,m.flags=e[2],a=m);null===a&&(h=t);r--;0===r&&null===a&&f("[107] RegexExpression");return a}function Tb(){var a,d,e,m,g;r++;g=m=h;"EXISTS"===b.substr(h,6)?(a="EXISTS",h+=6):(a=null,0===r&&f('"EXISTS"'));null===a&&("exists"===b.substr(h,6)?(a="exists",h+=6):(a=null,0===r&&f('"exists"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(e=ea(),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(d={token:"expression",
expressionType:"builtincall",builtincall:"exists"},d.args=[a[2]],a=d);null===a&&(h=m);r--;0===r&&null===a&&f("[108] ExistsFunc");return a}function Ub(){var a,d,e,m,g,k,l;r++;l=k=h;"NOT"===b.substr(h,3)?(a="NOT",h+=3):(a=null,0===r&&f('"NOT"'));null===a&&("not"===b.substr(h,3)?(a="not",h+=3):(a=null,0===r&&f('"not"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if("EXISTS"===b.substr(h,6)?(e="EXISTS",h+=6):(e=null,0===r&&f('"EXISTS"')),null===e&&("exists"===b.substr(h,6)?(e=
"exists",h+=6):(e=null,0===r&&f('"exists"'))),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();null!==m?(g=ea(),null!==g?a=[a,d,e,m,g]:(a=null,h=l)):(a=null,h=l)}else a=null,h=l;else a=null,h=l}else a=null,h=l;null!==a&&(d={token:"expression",expressionType:"builtincall",builtincall:"notexists"},d.args=[a[4]],a=d);null===a&&(h=k);r--;0===r&&null===a&&f("[109] NotExistsFunc");return a}function Rb(){var a,d,e,m,g,k,l,v,x,s,q,G,A;r++;A=G=h;"COUNT"===b.substr(h,5)?(a="COUNT",h+=5):(a=null,0===r&&f('"COUNT"'));
null===a&&("count"===b.substr(h,5)?(a="count",h+=5):(a=null,0===r&&f('"count"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if("DISTINCT"===b.substr(h,8)?(g="DISTINCT",h+=8):(g=null,0===r&&f('"DISTINCT"')),null===g&&("distinct"===b.substr(h,8)?(g="distinct",h+=8):(g=null,0===r&&f('"distinct"'))),g=null!==g?g:"",null!==g){k=[];for(l=u();null!==l;)k.push(l),
l=u();if(null!==k)if(42===b.charCodeAt(h)?(l="*",h++):(l=null,0===r&&f('"*"')),null===l&&(l=P()),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(41===b.charCodeAt(h)?(x=")",h++):(x=null,0===r&&f('")"')),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?a=[a,d,e,m,g,k,l,v,x,s]:(a=null,h=A)}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;null!==a&&(a=function(a,b,d){a={token:"expression",
expressionType:"aggregate",aggregateType:"count"};a.distinct=""!=b?"DISTINCT":b;a.expression=d;return a}(G,a[4],a[6]));null===a&&(h=G);if(null===a){A=G=h;"SUM"===b.substr(h,3)?(a="SUM",h+=3):(a=null,0===r&&f('"SUM"'));null===a&&("sum"===b.substr(h,3)?(a="sum",h+=3):(a=null,0===r&&f('"sum"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if("DISTINCT"===b.substr(h,
8)?(g="DISTINCT",h+=8):(g=null,0===r&&f('"DISTINCT"')),null===g&&("distinct"===b.substr(h,8)?(g="distinct",h+=8):(g=null,0===r&&f('"distinct"'))),g=null!==g?g:"",null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(l=P(),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(41===b.charCodeAt(h)?(x=")",h++):(x=null,0===r&&f('")"')),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?a=[a,d,e,m,g,k,l,v,x,s]:(a=null,h=A)}else a=null,h=A;else a=null,h=A}else a=null,h=
A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;null!==a&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"sum"};a.distinct=""!=b?"DISTINCT":b;a.expression=d;return a}(G,a[4],a[6]));null===a&&(h=G);if(null===a){A=G=h;"MIN"===b.substr(h,3)?(a="MIN",h+=3):(a=null,0===r&&f('"MIN"'));null===a&&("min"===b.substr(h,3)?(a="min",h+=3):(a=null,0===r&&f('"min"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==
d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if("DISTINCT"===b.substr(h,8)?(g="DISTINCT",h+=8):(g=null,0===r&&f('"DISTINCT"')),null===g&&("distinct"===b.substr(h,8)?(g="distinct",h+=8):(g=null,0===r&&f('"distinct"'))),g=null!==g?g:"",null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(l=P(),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(41===b.charCodeAt(h)?(x=")",h++):(x=null,0===r&&
f('")"')),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?a=[a,d,e,m,g,k,l,v,x,s]:(a=null,h=A)}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;null!==a&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"min"};a.distinct=""!=b?"DISTINCT":b;a.expression=d;return a}(G,a[4],a[6]));null===a&&(h=G);if(null===a){A=G=h;"MAX"===b.substr(h,3)?(a="MAX",h+=3):(a=null,0===
r&&f('"MAX"'));null===a&&("max"===b.substr(h,3)?(a="max",h+=3):(a=null,0===r&&f('"max"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if("DISTINCT"===b.substr(h,8)?(g="DISTINCT",h+=8):(g=null,0===r&&f('"DISTINCT"')),null===g&&("distinct"===b.substr(h,8)?(g="distinct",h+=8):(g=null,0===r&&f('"distinct"'))),g=null!==g?g:"",null!==g){k=[];for(l=u();null!==
l;)k.push(l),l=u();if(null!==k)if(l=P(),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(41===b.charCodeAt(h)?(x=")",h++):(x=null,0===r&&f('")"')),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?a=[a,d,e,m,g,k,l,v,x,s]:(a=null,h=A)}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;null!==a&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"max"};
a.distinct=""!=b?"DISTINCT":b;a.expression=d;return a}(G,a[4],a[6]));null===a&&(h=G);if(null===a){A=G=h;"AVG"===b.substr(h,3)?(a="AVG",h+=3):(a=null,0===r&&f('"AVG"'));null===a&&("avg"===b.substr(h,3)?(a="avg",h+=3):(a=null,0===r&&f('"avg"')));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();if(null!==d)if(40===b.charCodeAt(h)?(e="(",h++):(e=null,0===r&&f('"("')),null!==e){m=[];for(g=u();null!==g;)m.push(g),g=u();if(null!==m)if("DISTINCT"===b.substr(h,8)?(g="DISTINCT",h+=8):(g=null,0===r&&f('"DISTINCT"')),
null===g&&("distinct"===b.substr(h,8)?(g="distinct",h+=8):(g=null,0===r&&f('"distinct"'))),g=null!==g?g:"",null!==g){k=[];for(l=u();null!==l;)k.push(l),l=u();if(null!==k)if(l=P(),null!==l){v=[];for(x=u();null!==x;)v.push(x),x=u();if(null!==v)if(41===b.charCodeAt(h)?(x=")",h++):(x=null,0===r&&f('")"')),null!==x){s=[];for(q=u();null!==q;)s.push(q),q=u();null!==s?a=[a,d,e,m,g,k,l,v,x,s]:(a=null,h=A)}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=null,h=A;else a=null,h=A}else a=
null,h=A;else a=null,h=A}else a=null,h=A;null!==a&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"avg"};a.distinct=""!=b?"DISTINCT":b;a.expression=d;return a}(G,a[4],a[6]));null===a&&(h=G)}}}}r--;0===r&&null===a&&f("[110] Aggregate");return a}function Qb(){var a,b,d,e;r++;e=d=h;a=aa();null!==a?(b=mb(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,h=e)):(a=null,h=e);null!==a&&(b=a[1],e={token:"expression",expressionType:"irireforfunction"},e.iriref=a[0],e.args=b.value,
a=e);null===a&&(h=d);r--;0===r&&null===a&&f("[117] IRIrefOrFunction");return a}function Pa(){var a,d,e,m,g,k;r++;g=m=h;a=Vb();null!==a?(d=Wb(),null===d&&(k=h,"^^"===b.substr(h,2)?(d="^^",h+=2):(d=null,0===r&&f('"^^"')),null!==d?(e=aa(),null!==e?d=[d,e]:(d=null,h=k)):(d=null,h=k)),d=null!==d?d:"",null!==d?a=[a,d]:(a=null,h=g)):(a=null,h=g);null!==a&&(d=a[0],a=a[1],"string"===typeof a&&0<a.length?a={token:"literal",value:d.value,lang:a.slice(1),type:null}:"object"===typeof a?(a.shift(),a={token:"literal",
value:d.value,lang:null,type:a[0]}):a={token:"literal",value:d.value,lang:null,type:null});null===a&&(h=m);r--;0===r&&null===a&&f("[112] RDFLiteral");return a}function Qa(){var a;r++;a=Xb();null===a&&(a=Yb(),null===a&&(a=Aa()));r--;0===r&&null===a&&f("[113] NumericLiteral");return a}function Xb(){var a;r++;a=$a();null===a&&(a=ab(),null===a&&(a=oa()));r--;0===r&&null===a&&f("[114] NumericLiteralUnsigned");return a}function Yb(){var a;r++;a=Zb();null===a&&(a=$b(),null===a&&(a=ac()));r--;0===r&&null===
a&&f("[115] NumericLiteralPositive");return a}function Aa(){var a;r++;a=bc();null===a&&(a=cc(),null===a&&(a=dc()));r--;0===r&&null===a&&f("[116] NumericLiteralNegative");return a}function Ra(){var a,d;r++;d=h;"TRUE"===b.substr(h,4)?(a="TRUE",h+=4):(a=null,0===r&&f('"TRUE"'));null===a&&("true"===b.substr(h,4)?(a="true",h+=4):(a=null,0===r&&f('"true"')));null!==a&&(a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0});null===a&&(h=d);null===a&&(d=h,"FALSE"===b.substr(h,
5)?(a="FALSE",h+=5):(a=null,0===r&&f('"FALSE"')),null===a&&("false"===b.substr(h,5)?(a="false",h+=5):(a=null,0===r&&f('"false"'))),null!==a&&(a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1}),null===a&&(h=d));r--;0===r&&null===a&&f("[117] BooleanLiteral");return a}function Vb(){var a,b;r++;b=h;a=ec();null!==a&&(a={token:"string",value:a});null===a&&(h=b);null===a&&(b=h,a=fc(),null!==a&&(a={token:"string",value:a}),null===a&&(h=b),null===a&&(b=h,a=gc(),null!==
a&&(a={token:"string",value:a}),null===a&&(h=b),null===a&&(b=h,a=hc(),null!==a&&(a={token:"string",value:a}),null===a&&(h=b))));r--;0===r&&null===a&&f("[118] String");return a}function aa(){var a,b;r++;b=h;a=La();null!==a&&(a={token:"uri",prefix:null,suffix:null,value:a});null===a&&(h=b);null===a&&(b=h,a=ic(),null===a&&(h=b));r--;0===r&&null===a&&f("[119] IRIref");return a}function ic(){var a,b;r++;b=h;a=jc();null!==a&&(a={token:"uri",prefix:a[0],suffix:a[1],value:null});null===a&&(h=b);null===a&&
(b=h,a=Ma(),null!==a&&(a={token:"uri",prefix:a,suffix:"",value:null}),null===a&&(h=b));r--;0===r&&null===a&&f("[120] PrefixedName");return a}function Pb(){var a,b;r++;b=h;a=kc();null!==a&&(a={token:"blank",value:a});null===a&&(h=b);null===a&&(b=h,a=lc(),null!==a&&(pa++,a={token:"blank",value:"_:"+pa}),null===a&&(h=b));r--;0===r&&null===a&&f("[121] BlankNode");return a}function La(){var a,d,e,m,g;r++;g=m=h;60===b.charCodeAt(h)?(a="<",h++):(a=null,0===r&&f('"<"'));if(null!==a){d=[];/^[^<>"{}|^`\\]/.test(b.charAt(h))?
(e=b.charAt(h),h++):(e=null,0===r&&f('[^<>"{}|^`\\\\]'));for(;null!==e;)d.push(e),/^[^<>"{}|^`\\]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f('[^<>"{}|^`\\\\]'));null!==d?(62===b.charCodeAt(h)?(e=">",h++):(e=null,0===r&&f('">"')),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a=a[1].join(""));null===a&&(h=m);r--;0===r&&null===a&&f("[122] IRI_REF");return a}function Ma(){var a,d,e,m;r++;m=e=h;a=mc();a=null!==a?a:"";null!==a?(58===b.charCodeAt(h)?(d=":",h++):(d=
null,0===r&&f('":"')),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[0]);null===a&&(h=e);r--;0===r&&null===a&&f("[123] PNAME_NS");return a}function jc(){var a,b,d,e;r++;e=d=h;a=Ma();null!==a?(b=qb(),null!==b?a=[a,b]:(a=null,h=e)):(a=null,h=e);null!==a&&(a=[a[0],a[1]]);null===a&&(h=d);r--;0===r&&null===a&&f("[124] PNAME_LN");return a}function kc(){var a,d,e,m;r++;m=e=h;"_:"===b.substr(h,2)?(a="_:",h+=2):(a=null,0===r&&f('"_:"'));null!==a?(d=qb(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=
m);null!==a&&(a=a[1]);null===a&&(h=e);r--;0===r&&null===a&&f("[125] BLANK_NODE_LABEL");return a}function Nb(){var a,d,e,m;r++;m=e=h;63===b.charCodeAt(h)?(a="?",h++):(a=null,0===r&&f('"?"'));null!==a?(d=rb(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1]);null===a&&(h=e);r--;0===r&&null===a&&f("[126] VAR1");return a}function Ob(){var a,d,e,m;r++;m=e=h;36===b.charCodeAt(h)?(a="$",h++):(a=null,0===r&&f('"$"'));null!==a?(d=rb(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1]);
null===a&&(h=e);r--;0===r&&null===a&&f("[127] VAR2");return a}function Wb(){var a,d,e,m,g,k,l,v,x;r++;v=l=h;64===b.charCodeAt(h)?(a="@",h++):(a=null,0===r&&f('"@"'));if(null!==a){/^[a-zA-Z]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[a-zA-Z]"));if(null!==e)for(d=[];null!==e;)d.push(e),/^[a-zA-Z]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[a-zA-Z]"));else d=null;if(null!==d){e=[];x=h;45===b.charCodeAt(h)?(m="-",h++):(m=null,0===r&&f('"-"'));if(null!==m){/^[a-zA-Z0-9]/.test(b.charAt(h))?
(k=b.charAt(h),h++):(k=null,0===r&&f("[a-zA-Z0-9]"));if(null!==k)for(g=[];null!==k;)g.push(k),/^[a-zA-Z0-9]/.test(b.charAt(h))?(k=b.charAt(h),h++):(k=null,0===r&&f("[a-zA-Z0-9]"));else g=null;null!==g?m=[m,g]:(m=null,h=x)}else m=null,h=x;for(;null!==m;)if(e.push(m),x=h,45===b.charCodeAt(h)?(m="-",h++):(m=null,0===r&&f('"-"')),null!==m){/^[a-zA-Z0-9]/.test(b.charAt(h))?(k=b.charAt(h),h++):(k=null,0===r&&f("[a-zA-Z0-9]"));if(null!==k)for(g=[];null!==k;)g.push(k),/^[a-zA-Z0-9]/.test(b.charAt(h))?(k=
b.charAt(h),h++):(k=null,0===r&&f("[a-zA-Z0-9]"));else g=null;null!==g?m=[m,g]:(m=null,h=x)}else m=null,h=x;null!==e?a=[a,d,e]:(a=null,h=v)}else a=null,h=v}else a=null,h=v;null!==a&&(d=a[1],a=a[2],a=0===a.length?("@"+d.join("")).toLowerCase():("@"+d.join("")+"-"+a[0][1].join("")).toLowerCase());null===a&&(h=l);r--;0===r&&null===a&&f("[128] LANGTAG");return a}function oa(){var a,d,e;r++;e=h;/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));if(null!==d)for(a=[];null!==d;)a.push(d),
/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));else a=null;null!==a&&(d={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#integer"},d.value=ia(a),a=d);null===a&&(h=e);r--;0===r&&null===a&&f("[129] INTEGER");return a}function ab(){var a,d,e,m,g,k;r++;k=g=h;/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));if(null!==d)for(a=[];null!==d;)a.push(d),/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));else a=null;if(null!==
a)if(46===b.charCodeAt(h)?(d=".",h++):(d=null,0===r&&f('"."')),null!==d){e=[];/^[0-9]/.test(b.charAt(h))?(m=b.charAt(h),h++):(m=null,0===r&&f("[0-9]"));for(;null!==m;)e.push(m),/^[0-9]/.test(b.charAt(h))?(m=b.charAt(h),h++):(m=null,0===r&&f("[0-9]"));null!==e?a=[a,d,e]:(a=null,h=k)}else a=null,h=k;else a=null,h=k;null!==a&&(a=function(a,b,d,e){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#decimal"};a.value=ia([b,d,e]);return a}(g,a[0],a[1],a[2]));null===a&&(h=g);if(null===a){k=
g=h;46===b.charCodeAt(h)?(a=".",h++):(a=null,0===r&&f('"."'));if(null!==a){/^[0-9]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[0-9]"));if(null!==e)for(d=[];null!==e;)d.push(e),/^[0-9]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[0-9]"));else d=null;null!==d?a=[a,d]:(a=null,h=k)}else a=null,h=k;null!==a&&(a=function(a,b,d){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#decimal"};a.value=ia([b,d]);return a}(g,a[0],a[1]));null===a&&(h=g)}r--;0===r&&null===
a&&f("[130] DECIMAL");return a}function $a(){var a,d,e,m,g,k;r++;k=g=h;/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));if(null!==d)for(a=[];null!==d;)a.push(d),/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));else a=null;if(null!==a)if(46===b.charCodeAt(h)?(d=".",h++):(d=null,0===r&&f('"."')),null!==d){e=[];/^[0-9]/.test(b.charAt(h))?(m=b.charAt(h),h++):(m=null,0===r&&f("[0-9]"));for(;null!==m;)e.push(m),/^[0-9]/.test(b.charAt(h))?(m=b.charAt(h),
h++):(m=null,0===r&&f("[0-9]"));null!==e?(m=bb(),null!==m?a=[a,d,e,m]:(a=null,h=k)):(a=null,h=k)}else a=null,h=k;else a=null,h=k;null!==a&&(a=function(a,b,d,e,f){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};a.value=ia([b,d,e,f]);return a}(g,a[0],a[1],a[2],a[3]));null===a&&(h=g);if(null===a){k=g=h;46===b.charCodeAt(h)?(a=".",h++):(a=null,0===r&&f('"."'));if(null!==a){/^[0-9]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[0-9]"));if(null!==e)for(d=[];null!==
e;)d.push(e),/^[0-9]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[0-9]"));else d=null;null!==d?(e=bb(),null!==e?a=[a,d,e]:(a=null,h=k)):(a=null,h=k)}else a=null,h=k;null!==a&&(a=function(a,b,d,e){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};a.value=ia([b,d,e]);return a}(g,a[0],a[1],a[2]));null===a&&(h=g);if(null===a){k=g=h;/^[0-9]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));if(null!==d)for(a=[];null!==d;)a.push(d),/^[0-9]/.test(b.charAt(h))?
(d=b.charAt(h),h++):(d=null,0===r&&f("[0-9]"));else a=null;null!==a?(d=bb(),null!==d?a=[a,d]:(a=null,h=k)):(a=null,h=k);null!==a&&(a=function(a,b,d){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};a.value=ia([b,d]);return a}(g,a[0],a[1]));null===a&&(h=g)}}r--;0===r&&null===a&&f("[131] DOUBLE");return a}function ac(){var a,d,e,m;r++;m=e=h;43===b.charCodeAt(h)?(a="+",h++):(a=null,0===r&&f('"+"'));null!==a?(d=oa(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=
a[1],a.value="+"+a.value);null===a&&(h=e);r--;0===r&&null===a&&f("[132] INTEGER_POSITIVE");return a}function $b(){var a,d,e,m;r++;m=e=h;43===b.charCodeAt(h)?(a="+",h++):(a=null,0===r&&f('"+"'));null!==a?(d=ab(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1],a.value="+"+a.value);null===a&&(h=e);r--;0===r&&null===a&&f("[133] DECIMAL_POSITIVE");return a}function Zb(){var a,d,e,m;r++;m=e=h;43===b.charCodeAt(h)?(a="+",h++):(a=null,0===r&&f('"+"'));null!==a?(d=$a(),null!==d?a=[a,d]:(a=null,
h=m)):(a=null,h=m);null!==a&&(a=a[1],a.value="+"+a.value);null===a&&(h=e);r--;0===r&&null===a&&f("[134] DOUBLE_POSITIVE");return a}function dc(){var a,d,e,m;r++;m=e=h;45===b.charCodeAt(h)?(a="-",h++):(a=null,0===r&&f('"-"'));null!==a?(d=oa(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1],a.value="-"+a.value);null===a&&(h=e);r--;0===r&&null===a&&f("[135] INTEGER_NEGATIVE");return a}function cc(){var a,d,e,m;r++;m=e=h;45===b.charCodeAt(h)?(a="-",h++):(a=null,0===r&&f('"-"'));null!==a?
(d=ab(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1],a.value="-"+a.value);null===a&&(h=e);r--;0===r&&null===a&&f("[136] DECIMAL_NEGATIVE");return a}function bc(){var a,d,e,m;r++;m=e=h;45===b.charCodeAt(h)?(a="-",h++):(a=null,0===r&&f('"-"'));null!==a?(d=$a(),null!==d?a=[a,d]:(a=null,h=m)):(a=null,h=m);null!==a&&(a=a[1],a.value="-"+a.value);null===a&&(h=e);r--;0===r&&null===a&&f("[137] DOUBLE_NEGATIVE");return a}function bb(){var a,d,e,m,g,k;r++;k=g=h;/^[eE]/.test(b.charAt(h))?(a=
b.charAt(h),h++):(a=null,0===r&&f("[eE]"));if(null!==a)if(/^[+\-]/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[+\\-]")),d=null!==d?d:"",null!==d){/^[0-9]/.test(b.charAt(h))?(m=b.charAt(h),h++):(m=null,0===r&&f("[0-9]"));if(null!==m)for(e=[];null!==m;)e.push(m),/^[0-9]/.test(b.charAt(h))?(m=b.charAt(h),h++):(m=null,0===r&&f("[0-9]"));else e=null;null!==e?a=[a,d,e]:(a=null,h=k)}else a=null,h=k;else a=null,h=k;null!==a&&(a=ia([a[0],a[1],a[2]]));null===a&&(h=g);r--;0===r&&null===a&&f("[138] EXPONENT");
return a}function gc(){var a,d,e,m,g;r++;g=m=h;39===b.charCodeAt(h)?(a="'",h++):(a=null,0===r&&f('"\'"'));if(null!==a){d=[];/^[^'\\\n\r]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[^'\\\\\\n\\r]"));for(null===e&&(e=qa());null!==e;)d.push(e),/^[^'\\\n\r]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[^'\\\\\\n\\r]")),null===e&&(e=qa());null!==d?(39===b.charCodeAt(h)?(e="'",h++):(e=null,0===r&&f('"\'"')),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&
(a=ia(a[1]));null===a&&(h=m);r--;0===r&&null===a&&f("[139] STRING_LITERAL1");return a}function hc(){var a,d,e,m,g;r++;g=m=h;34===b.charCodeAt(h)?(a='"',h++):(a=null,0===r&&f('"\\""'));if(null!==a){d=[];/^[^"\\\n\r]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f('[^"\\\\\\n\\r]'));for(null===e&&(e=qa());null!==e;)d.push(e),/^[^"\\\n\r]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f('[^"\\\\\\n\\r]')),null===e&&(e=qa());null!==d?(34===b.charCodeAt(h)?(e='"',h++):(e=null,0===r&&f('"\\""')),
null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a=ia(a[1]));null===a&&(h=m);r--;0===r&&null===a&&f("[140] STRING_LITERAL2");return a}function ec(){var a,d,e,m,g;r++;g=m=h;"'''"===b.substr(h,3)?(a="'''",h+=3):(a=null,0===r&&f("\"'''\""));if(null!==a){d=[];/^[^'\\]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[^'\\\\]"));for(null===e&&(e=qa());null!==e;)d.push(e),/^[^'\\]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[^'\\\\]")),null===e&&(e=qa());null!==
d?("'''"===b.substr(h,3)?(e="'''",h+=3):(e=null,0===r&&f("\"'''\"")),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a=ia(a[1]));null===a&&(h=m);r--;0===r&&null===a&&f("[141] STRING_LITERAL_LONG1");return a}function fc(){var a,d,e,m,g;r++;g=m=h;'"""'===b.substr(h,3)?(a='"""',h+=3):(a=null,0===r&&f('"\\"\\"\\""'));if(null!==a){d=[];/^[^"\\]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f('[^"\\\\]'));for(null===e&&(e=qa());null!==e;)d.push(e),/^[^"\\]/.test(b.charAt(h))?
(e=b.charAt(h),h++):(e=null,0===r&&f('[^"\\\\]')),null===e&&(e=qa());null!==d?('"""'===b.substr(h,3)?(e='"""',h+=3):(e=null,0===r&&f('"\\"\\"\\""')),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a=ia(a[1]));null===a&&(h=m);r--;0===r&&null===a&&f("[142] STRING_LITERAL_LONG2");return a}function qa(){var a,d,e;r++;e=h;92===b.charCodeAt(h)?(a="\\",h++):(a=null,0===r&&f('"\\\\"'));null!==a?(/^[tbnrf"']/.test(b.charAt(h))?(d=b.charAt(h),h++):(d=null,0===r&&f("[tbnrf\"']")),null!==
d?a=[a,d]:(a=null,h=e)):(a=null,h=e);r--;0===r&&null===a&&f("[143] ECHAR");return a}function ua(){var a,d,e,m,g;r++;g=m=h;40===b.charCodeAt(h)?(a="(",h++):(a=null,0===r&&f('"("'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();null!==d?(41===b.charCodeAt(h)?(e=")",h++):(e=null,0===r&&f('")"')),null!==e?a=[a,d,e]:(a=null,h=g)):(a=null,h=g)}else a=null,h=g;null!==a&&(a={token:"triplesnodecollection",triplesContext:[],chainSubject:[{token:"uri",value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}]});
null===a&&(h=m);r--;0===r&&null===a&&f("[144] NIL");return a}function u(){var a;r++;/^[ ]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[ ]"));null===a&&(/^[\t]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\t]")),null===a&&(/^[\r]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\r]")),null===a&&(/^[\n]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\n]")),null===a&&(a=nc()))));r--;0===r&&null===a&&f("[145] WS");return a}function nc(){var a,d,e,m;r++;
m=h;35===b.charCodeAt(h)?(a="#",h++):(a=null,0===r&&f('"#"'));if(null!==a){d=[];/^[^\n\r]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[^\\n\\r]"));for(;null!==e;)d.push(e),/^[^\n\r]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[^\\n\\r]"));null!==d?a=[a,d]:(a=null,h=m)}else a=null,h=m;r--;0===r&&null===a&&f(" COMMENT");return a}function lc(){var a,d,e,m;r++;m=h;91===b.charCodeAt(h)?(a="[",h++):(a=null,0===r&&f('"["'));if(null!==a){d=[];for(e=u();null!==e;)d.push(e),e=u();
null!==d?(93===b.charCodeAt(h)?(e="]",h++):(e=null,0===r&&f('"]"')),null!==e?a=[a,d,e]:(a=null,h=m)):(a=null,h=m)}else a=null,h=m;r--;0===r&&null===a&&f("[146] ANON");return a}function sb(){var a;r++;/^[A-Z]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[A-Z]"));null===a&&(/^[a-z]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[a-z]")),null===a&&(/^[\xC0-\xD6]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\xC0-\\xD6]")),null===a&&(/^[\xD8-\xF6]/.test(b.charAt(h))?
(a=b.charAt(h),h++):(a=null,0===r&&f("[\\xD8-\\xF6]")),null===a&&(/^[\xF8-\u02FF]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\xF8-\\u02FF]")),null===a&&(/^[\u0370-\u037D]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u0370-\\u037D]")),null===a&&(/^[\u037F-\u1FFF]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u037F-\\u1FFF]")),null===a&&(/^[\u200C-\u200D]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u200C-\\u200D]")),null===a&&(/^[\u2070-\u218F]/.test(b.charAt(h))?
(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u2070-\\u218F]")),null===a&&(/^[\u2C00-\u2FEF]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u2C00-\\u2FEF]")),null===a&&(/^[\u3001-\uD7FF]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u3001-\\uD7FF]")),null===a&&(/^[\uF900-\uFDCF]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\uF900-\\uFDCF]")),null===a&&(/^[\uFDF0-\uFFFD]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\uFDF0-\\uFFFD]")),null===a&&(/^[\u1000-\uEFFF]/.test(b.charAt(h))?
(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u1000-\\uEFFF]")))))))))))))));r--;0===r&&null===a&&f("[147] PN_CHARS_BASE");return a}function Ba(){var a;r++;a=sb();null===a&&(95===b.charCodeAt(h)?(a="_",h++):(a=null,0===r&&f('"_"')));r--;0===r&&null===a&&f("[148] PN_CHARS_U");return a}function rb(){var a,d,e,m,g;r++;g=m=h;a=Ba();null===a&&(/^[0-9]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[0-9]")));if(null!==a){d=[];e=Ba();null===e&&(/^[0-9]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,
0===r&&f("[0-9]")),null===e&&(/^[\xB7]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[\\xB7]")),null===e&&(/^[\u0300-\u036F]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[\\u0300-\\u036F]")),null===e&&(/^[\u203F-\u2040]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[\\u203F-\\u2040]"))))));for(;null!==e;)d.push(e),e=Ba(),null===e&&(/^[0-9]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[0-9]")),null===e&&(/^[\xB7]/.test(b.charAt(h))?(e=b.charAt(h),h++):
(e=null,0===r&&f("[\\xB7]")),null===e&&(/^[\u0300-\u036F]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[\\u0300-\\u036F]")),null===e&&(/^[\u203F-\u2040]/.test(b.charAt(h))?(e=b.charAt(h),h++):(e=null,0===r&&f("[\\u203F-\\u2040]"))))));null!==d?a=[a,d]:(a=null,h=g)}else a=null,h=g;null!==a&&(a=a[0]+a[1].join(""));null===a&&(h=m);r--;0===r&&null===a&&f("[149] VARNAME");return a}function Ja(){var a;r++;a=Ba();null===a&&(45===b.charCodeAt(h)?(a="-",h++):(a=null,0===r&&f('"-"')),null===a&&
(/^[0-9]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[0-9]")),null===a&&(/^[\xB7]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\xB7]")),null===a&&(/^[\u0300-\u036F]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u0300-\\u036F]")),null===a&&(/^[\u203F-\u2040]/.test(b.charAt(h))?(a=b.charAt(h),h++):(a=null,0===r&&f("[\\u203F-\\u2040]")))))));r--;0===r&&null===a&&f("[150] PN_CHARS");return a}function mc(){var a,d,e,m,g;r++;g=m=h;a=sb();if(null!==a){d=[];e=Ja();
null===e&&(46===b.charCodeAt(h)?(e=".",h++):(e=null,0===r&&f('"."')));for(;null!==e;)d.push(e),e=Ja(),null===e&&(46===b.charCodeAt(h)?(e=".",h++):(e=null,0===r&&f('"."')));null!==d?a=[a,d]:(a=null,h=g)}else a=null,h=g;if(null!==a){d=a[1];if("."==d[d.length-1])throw Error("Wrong PN_PREFIX, cannot finish with '.'");a=a[0]+d.join("")}null===a&&(h=m);r--;0===r&&null===a&&f("[151] PN_PREFIX");return a}function qb(){var a,d,e,m,g;r++;g=m=h;a=Ba();null===a&&(/^[0-9]/.test(b.charAt(h))?(a=b.charAt(h),h++):
(a=null,0===r&&f("[0-9]")));if(null!==a){d=[];for(e=Ja();null!==e;)d.push(e),e=Ja();null!==d?a=[a,d]:(a=null,h=g)}else a=null,h=g;null!==a&&(a=a[0]+a[1].join(""));null===a&&(h=m);r--;0===r&&null===a&&f("[152] PN_LOCAL");return a}function rc(a){a.sort();for(var b=null,d=[],e=0;e<a.length;e++)a[e]!==b&&(d.push(a[e]),b=a[e]);return d}function sc(){for(var a=1,d=1,e=!1,m=0;m<Math.max(h,Da);m++){var f=b.charAt(m);"\n"===f?(e||a++,d=1,e=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,d=1,e=!0):(d++,e=!1)}return{line:a,
column:d}}var oc={SPARQL:function(){var a;a=e();null===a&&(a=W());return a},Query:e,Prologue:g,BaseDecl:m,PrefixDecl:k,SelectQuery:l,SubSelect:s,SelectClause:q,ConstructQuery:t,DescribeQuery:w,AskQuery:y,DatasetClause:C,DefaultGraphClause:D,NamedGraphClause:I,WhereClause:T,SolutionModifier:H,GroupClause:F,GroupCondition:J,HavingClause:K,OrderClause:N,OrderCondition:L,LimitOffsetClauses:V,LimitClause:U,OffsetClause:R,BindingsClause:S,BindingValue:Q,Update:W,Update1:X,Load:Y,Clear:ba,Drop:ca,Create:fa,
InsertData:ga,DeleteData:ja,DeleteWhere:ka,Modify:la,DeleteClause:ma,InsertClause:ra,UsingClause:eb,GraphRef:Ka,GraphRefAll:cb,QuadPattern:db,QuadData:fb,Quads:gb,QuadsNotTriples:jb,TriplesTemplate:wa,GroupGraphPattern:ea,GroupGraphPatternSub:wb,TriplesBlock:Fa,GraphPatternNotTriples:lb,OptionalGraphPattern:zb,GraphGraphPattern:Bb,ServiceGraphPattern:Cb,MinusGraphPattern:Ab,GroupOrUnionGraphPattern:yb,Filter:Db,Constraint:Ea,FunctionCall:ib,ArgList:mb,ExpressionList:xa,ConstructTemplate:vb,ConstructTriples:nb,
TriplesSameSubject:kb,PropertyListNotEmpty:Ga,PropertyList:Eb,ObjectList:va,Verb:Ua,TriplesSameSubjectPath:xb,PropertyListNotEmptyPath:Fb,PropertyListPath:Gb,VerbPath:Va,PathAlternative:ob,PathSequence:Wa,PathElt:pb,PathEltOrInverse:Xa,PathMod:Ib,PathPrimary:Hb,PathNegatedPropertySet:Jb,PathOneInPropertySet:Ha,TriplesNode:Ta,BlankNodePropertyList:Lb,Collection:Kb,GraphNode:ya,VarOrTerm:Sa,VarOrIRIref:ta,Var:Z,GraphTerm:Mb,ConditionalOrExpression:P,ConditionalAndExpression:Ya,RelationalExpression:Za,
AdditiveExpression:da,MultiplicativeExpression:za,UnaryExpression:na,PrimaryExpression:Ia,BrackettedExpression:Oa,BuiltInCall:Na,RegexExpression:Sb,ExistsFunc:Tb,NotExistsFunc:Ub,Aggregate:Rb,IRIrefOrFunction:Qb,RDFLiteral:Pa,NumericLiteral:Qa,NumericLiteralUnsigned:Xb,NumericLiteralPositive:Yb,NumericLiteralNegative:Aa,BooleanLiteral:Ra,String:Vb,IRIref:aa,PrefixedName:ic,BlankNode:Pb,IRI_REF:La,PNAME_NS:Ma,PNAME_LN:jc,BLANK_NODE_LABEL:kc,VAR1:Nb,VAR2:Ob,LANGTAG:Wb,INTEGER:oa,DECIMAL:ab,DOUBLE:$a,
INTEGER_POSITIVE:ac,DECIMAL_POSITIVE:$b,DOUBLE_POSITIVE:Zb,INTEGER_NEGATIVE:dc,DECIMAL_NEGATIVE:cc,DOUBLE_NEGATIVE:bc,EXPONENT:bb,STRING_LITERAL1:gc,STRING_LITERAL2:hc,STRING_LITERAL_LONG1:ec,STRING_LITERAL_LONG2:fc,ECHAR:qa,NIL:ua,WS:u,COMMENT:nc,ANON:lc,PN_CHARS_BASE:sb,PN_CHARS_U:Ba,VARNAME:rb,PN_CHARS:Ja,PN_PREFIX:mc,PN_LOCAL:qb};if(void 0!==d){if(void 0===oc[d])throw Error("Invalid rule name: "+a(d)+".");}else d="SPARQL";var h=0,r=0,Da=0,hb=[],ia=function(a){for(var b="",d=0;d<a.length;d++)b=
"string"===typeof a[d]?b+a[d]:b+a[d].join("");return b},pa=0,ub=function(a){for(var b="",d=0;d<a.length;d++)b+=a[d];return b.toUpperCase()},pc=oc[d]();if(null===pc||h!==b.length){var tb=Math.max(h,Da),tc=tb<b.length?b.charAt(tb):null,qc=sc();throw new this.SyntaxError(rc(hb),tc,tb,qc.line,qc.column);}return pc},toSource:function(){return this._source},SyntaxError:function(b,d,e,m,f){this.name="SyntaxError";this.expected=b;this.found=d;switch(b.length){case 0:b="end of input";break;case 1:b=b[0];break;
default:b=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}d=d?a(d):"end of input";this.message="Expected "+b+" but "+d+" found.";this.offset=e;this.line=m;this.column=f}};b.SyntaxError.prototype=Error.prototype;return b}();var y={defaultContext:{rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",
vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},UrisMap:function(){this.defaultNs="";this.interfaceProperties="get remove set setDefault addAll resolve shrink".split(" ")}};y.UrisMap.prototype.values=
function(){var a={},b;for(b in this)C.include(this.interfaceProperties,b)||"function"===typeof this[b]||"defaultNs"===b||"interfaceProperties"===b||(a[b]=this[b]);return a};y.UrisMap.prototype.get=function(a){if(-1!=a.indexOf(" "))throw"Prefix must not contain any whitespaces";return this[a]};y.UrisMap.prototype.remove=function(a){if(-1!=a.indexOf(" "))throw"Prefix must not contain any whitespaces";delete this[a];return null};y.UrisMap.prototype.set=function(a,b){if(-1!=a.indexOf(" "))throw"Prefix must not contain any whitespaces";
this[a]=b};y.UrisMap.prototype.setDefault=function(a){this.defaultNs=a};y.UrisMap.prototype.addAll=function(a,b){for(var d in a)C.include(this.interfaceProperties,d)||(null!=this[d]?!0===b&&(this[d]=a[d]):this[d]=a[d]);return this};y.UrisMap.prototype.resolve=function(a){var b=a.split(":");a=b[0];b=b[1];return""===a?null==this.defaultNs?null:this.defaultNs+b:this.hasOwnProperty(a)?this[a]+b:null};y.UrisMap.prototype.shrink=function(a){for(var b in this){var d=this[b];if(0===a.indexOf(d)&&""!==d&&
"defaultNs"!=b)return a=a.split(d)[1],b+":"+a}return a};y.Profile=function(){this.prefixes=new y.UrisMap;this.terms=new y.UrisMap};y.Profile.prototype.importProfile=function(a,b){this.prefixes.addAll(a.prefixes,b);this.terms.addAll(a.terms,b)};y.Profile.prototype.resolve=function(a){return-1!=a.indexOf(":")?this.prefixes.resolve(a):null!=this.terms[a]?this.terms.resolve(a):null};y.Profile.prototype.setDefaultPrefix=function(a){this.prefixes.setDefault(a)};y.Profile.prototype.setDefaultVocabulary=
function(a){this.terms.setDefault(a)};y.Profile.prototype.setPrefix=function(a,b){this.prefixes.set(a,b)};y.Profile.prototype.setTerm=function(a,b){this.terms.set(a,b)};y.RDFEnvironment=function(){this.blankNodeCounter=0;var a=this;this.filters={s:function(a){return function(b){return b.subject.equals(a)}},p:function(a){return function(b){return b.predicate.equals(a)}},o:function(a){return function(b){return b.object.equals(a)}},sp:function(a,b){return function(d){return d.subject.equals(a)&&d.predicate.equals(b)}},
so:function(a,b){return function(d){return d.subject.equals(a)&&d.object.equals(b)}},po:function(a,b){return function(d){return d.predicate.equals(a)&&d.object.equals(b)}},spo:function(a,b,d){return function(e){return e.subject.equals(a)&&e.predicate.equals(b)&&e.object.equals(d)}},describes:function(a){return function(b){return b.subject.equals(a)||b.object.equals(a)}},type:function(b){var d=a.resolve("rdf:type");return function(a){return a.predicate.equals(d)&&a.object.equals(b)}}};for(var b in y.defaultContext)this.prefixes.set(b,
y.defaultContext[b])};C["extends"](y.Profile,y.RDFEnvironment);y.RDFEnvironment.prototype.createBlankNode=function(){var a=new y.BlankNode(this.blankNodeCounter);this.blankNodeCounter++;return a};y.RDFEnvironment.prototype.createNamedNode=function(a){var b=this.resolve(a);return null!=b?new y.NamedNode(b):new y.NamedNode(a)};y.RDFEnvironment.prototype.createLiteral=function(a,b,d){return null!=d?new y.Literal(a,b,d.toString()):new y.Literal(a,b,d)};y.RDFEnvironment.prototype.createTriple=function(a,
b,d){return new y.Triple(a,b,d)};y.RDFEnvironment.prototype.createGraph=function(a){var b=new y.Graph;if(null!=a)for(var d=0;d<a.length;d++)b.add(a[d]);return b};y.RDFEnvironment.prototype.createAction=function(a,b){return function(d){return a(d)?b(d):d}};y.RDFEnvironment.prototype.createProfile=function(a){if(!0===a)return new y.RDFEnvironment.Profile;a=new y.RDFEnvironment.Profile;a.importProfile(this);return a};y.RDFEnvironment.prototype.createTermMap=function(a){if(!0===a)return new y.UrisMap;
a=this.terms.values();var b=new y.UrisMap,d;for(d in a)b[d]=a[d];return b};y.RDFEnvironment.prototype.createPrefixMap=function(a){if(!0===a)return new y.UrisMap;a=this.prefixes.values();var b=new y.UrisMap,d;for(d in a)b[d]=a[d];return b};y.RDFNode=function(a){this.interfaceName=a;this.attributes=["interfaceName","nominalValue"]};y.RDFNode.prototype.equals=function(a){if(null==a.interfaceName)return this.valueOf()==a;for(var b in this.attributes){var d=this.attributes[b];if(this[d]!=a[d])return!1}return!0};
y.BlankNode=function(a){y.RDFNode.call(this,"BlankNode");this.nominalValue="_:"+a;this.bnodeId=a};C["extends"](y.RDFNode,y.BlankNode);y.BlankNode.prototype.toString=function(){return this.nominalValue};y.BlankNode.prototype.toNT=function(){return this.nominalValue};y.BlankNode.prototype.valueOf=function(){return this.nominalValue};y.Literal=function(a,b,d){y.RDFNode.call(this,"Literal");this.nominalValue=a;null!=b?this.language=b:null!=d&&(this.datatype=d)};C["extends"](y.RDFNode,y.Literal);y.Literal.prototype.toString=
function(){var a='"'+this.nominalValue+'"';if(null!=this.language)a=a+"@"+this.language;else if(null!=this.datatype||this.type)a=a+"^^<"+(this.datatype||this.type)+">";return a};y.Literal.prototype.toNT=function(){return this.toString()};y.Literal.prototype.valueOf=function(){return t.effectiveTypeValue({token:"literal",type:this.type||this.datatype,value:this.nominalValue,language:this.language})};y.NamedNode=function(a){y.RDFNode.call(this,"NamedNode");this.nominalValue=null!=a.value?a.value:a};
C["extends"](y.RDFNode,y.NamedNode);y.NamedNode.prototype.toString=function(){return this.nominalValue};y.NamedNode.prototype.toNT=function(){return"<"+this.toString()+">"};y.NamedNode.prototype.valueOf=function(){return this.nominalValue};y.Triple=function(a,b,d){this.subject=a;this.predicate=b;this.object=d};y.Triple.prototype.equals=function(a){return this.subject.equals(a.subject)&&this.predicate.equals(a.predicate)&&this.object.equals(a.object)};y.Triple.prototype.toString=function(){return this.subject.toNT()+
" "+this.predicate.toNT()+" "+this.object.toNT()+" . \r\n"};y.Graph=function(){this.triples=[];this.duplicates={};this.actions=[];this.length=0};y.Graph.prototype.add=function(a){for(var b=0;b<this.actions.length;b++)a=this.actions[b](a);b=a.subject.toString()+a.predicate.toString()+a.object.toString();this.duplicates[b]||(this.duplicates[b]=!0,this.triples.push(a));this.length=this.triples.length;return this};y.Graph.prototype.addAction=function(a,b){this.actions.push(a);if(1==b)for(var d=0;d<this.triples.length;d++)this.triples[d]=
a(this.triples[d]);return this};y.Graph.prototype.addAll=function(a){a=a.toArray();for(var b=0;b<a.length;b++)this.add(a[b]);this.length=this.triples.length;return this};y.Graph.prototype.remove=function(a){for(var b=null,d=0;d<this.triples.length;d++)if(this.triples[d].equals(a)){delete this.duplicates[a.subject.toString()+a.predicate.toString()+a.object.toString()];b=d;break}null!=b&&this.triples.splice(b,1);this.length=this.triples.length;return this};y.Graph.prototype.toArray=function(){return this.triples};
y.Graph.prototype.some=function(a){for(var b=0;b<this.triples.length;b++)if(!0===a(this.triples[b],this))return!0;return!1};y.Graph.prototype.every=function(a){for(var b=0;b<this.triples.length;b++)if(!1===a(this.triples[b],this))return!1;return!0};y.Graph.prototype.filter=function(a){for(var b=new y.Graph,d=0;d<this.triples.length;d++)!0===a(this.triples[d],this)&&b.add(this.triples[d]);return b};y.Graph.prototype.forEach=function(a){for(var b=0;b<this.triples.length;b++)a(this.triples[b],this)};
y.Graph.prototype.merge=function(a){a=new y.Graph;for(var b=0;b<this.triples.length;b++)a.add(this.triples[b]);return a};y.Graph.prototype.match=function(a,b,d,e){for(var f=new y.Graph,g=0,k=0;k<this.triples.length;k++){var l=this.triples[k];if(null==a||l.subject.equals(a))if(null==b||l.predicate.equals(b))if(null==d||l.object.equals(d))if(null==e||g<e)g++,f.add(l);else break}return f};y.Graph.prototype.removeMatches=function(a,b,d){for(var e=[],f=0;f<this.triples.length;f++){var g=this.triples[f];
if(null==a||g.subject.equals(a))null!=b&&!g.predicate.equals(b)||null!=d&&!g.object.equals(d)||e.push(g)}for(f=0;f<e.length;f++)this.remove(e[f]);return this};y.Graph.prototype.toNT=function(){var a="";this.forEach(function(b){a+=b.toString()});return a};y.buildRDFResource=function(a,b,d,e){return"blank"===a.token?y.buildBlankNode(a,b,d,e):"literal"===a.token?y.buildLiteral(a,b,d,e):"uri"===a.token?y.buildNamedNode(a,b,d,e):"var"===a.token?(a=b[a.value],null!=a?y.buildRDFResource(a,b,d,e):null):null};
y.buildBlankNode=function(a,b,d,e){null!=a.valuetmp&&(a.value=a.valuetmp);0===a.value.indexOf("_:")&&(a.value=a.value.split("_:")[1]);return new y.BlankNode(a.value)};y.buildLiteral=function(a,b,d,e){return new y.Literal(a.value,a.lang,a.type)};y.buildNamedNode=function(a,b,d,e){null==a.value&&null!=a.prefix&&(b=d.resolveNsInEnvironment(a.prefix,e),a.value=b+a.suffix);return new y.NamedNode(a)};y.rdf=new y.RDFEnvironment;var t={checkFilters:function(a,b,d,e,f,g){var k=a.filter,l=[];if(null==k||null!=
a.length)return b;for(a=0;a<k.length;a++){b=t.run(k[a].value,b,d,e,f,g);for(var s=[],q=0;q<b.length;q++)null!=b[q].__nullify__?l.push(b[q]):s.push(b[q]);b=s}return b.concat(l)},boundVars:function(a){if(null!=a.expressionType){var b=a.expressionType;if("relationalexpression"==b)return b=a.op2,t.boundVars(a.op1)+t.boundVars(b);if("conditionalor"==b||"conditionaland"==b){for(var d=[],b=0;b<a.operands;b++)d=d.concat(t.boundVars(a.operands[b]));return d}if("builtincall"==b){if(null==a.args)return[];d=
[];for(b=0;b<a.args.length;b++)d=d.concat(t.boundVars(a.args[b]));return d}if("multiplicativeexpression"==b){d=t.boundVars(a.factor);for(b=0;b<a.factors.length;b++)d=d.concat(t.boundVars(a.factors[b].expression));return d}if("additiveexpression"==b){d=t.boundVars(a.summand);for(b=0;b<a.summands.length;b++)d=d.concat(t.boundVars(a.summands[b].expression));return d}if("regex"==b)return d=t.boundVars(a.expression1),d.concat(t.boundVars(a.expression2));if("unaryexpression"==b)return t.boundVars(a.expression);
if("atomic"==b)return"var"==a.primaryexpression?[a.value]:[]}else throw console.log("ERROR"),console.log(a),"Cannot find bound expressions in a no expression token";},run:function(a,b,d,e,f,g){for(var k=g.copyDenormalizedBindings(b,f.outCache),l=[],s=0;s<b.length;s++){var q=t.runFilter(a,k[s],g,e,f),q=t.ebv(q);t.isEbvError(q)?d&&(q={__nullify__:!0,bindings:b[s]},l.push(q)):!0===q?l.push(b[s]):d&&(q={__nullify__:!0,bindings:b[s]},l.push(q))}return l},collect:function(a,b,d,e,f,g){g=f.copyDenormalizedBindings(b,
e.outCache);for(var k=[],l=0;l<g.length;l++){var s=t.runFilter(a,g[l],f,d,e);k.push({binding:b[l],value:s})}return k},runDistinct:function(a,b){},runAggregator:function(a,b,d,e,f){if(null==b||0===b.length)return t.ebvError();if("variable"===a.token&&"var"==a.kind)return b[0][a.value.value];if("variable"===a.token&&"aliased"===a.kind){if("atomic"===a.expression.expressionType&&"var"===a.expression.primaryexpression)return b[0][a.expression.value.value];if("aggregate"===a.expression.expressionType){if("max"===
a.expression.aggregateType){for(var g=null,k=0;k<b.length;k++){var l=b[k],l=t.runFilter(a.expression.expression,l,d,e,f);t.isEbvError(l)||(null===g?g=l:!0===t.runLtFunction(g,l).value&&(g=l))}return null===g?t.ebvError():g}if("min"===a.expression.aggregateType){g=null;for(k=0;k<b.length;k++)l=b[k],l=t.runFilter(a.expression.expression,l,d,e,f),t.isEbvError(l)||(null===g?g=l:!0===t.runGtFunction(g,l).value&&(g=l));return null===g?t.ebvError():g}if("count"===a.expression.aggregateType){var g={},s=0;
if("*"===a.expression.expression)if(null!=a.expression.distinct&&""!=a.expression.distinct)for(k=0;k<b.length;k++){var l=b[k],q=C.hashTerm(l);null==g[q]&&(g[q]=!0,s++)}else s=b.length;else for(k=0;k<b.length;k++)l=b[k],l=t.runFilter(a.expression.expression,l,d,e,f),t.isEbvError(l)||(null!=a.expression.distinct&&""!=a.expression.distinct?(q=C.hashTerm(l),null==g[q]&&(g[q]=!0,s++)):s++);return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+s}}if("avg"===a.expression.aggregateType){for(var g=
{},B={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"},k=s=0;k<b.length;k++)l=b[k],l=t.runFilter(a.expression.expression,l,d,e,f),t.isEbvError(l)||(null!=a.expression.distinct&&""!=a.expression.distinct?(q=C.hashTerm(l),null==g[q]&&(g[q]=!0,t.isNumeric(l)&&(B=t.runSumFunction(B,l),s++))):t.isNumeric(l)&&(B=t.runSumFunction(B,l),s++));a=t.runDivFunction(B,{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+s});a.value=""+a.value;return a}if("sum"===a.expression.aggregateType){g=
{};B={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"};for(k=0;k<b.length;k++)l=b[k],l=t.runFilter(a.expression.expression,l,d,e,f),t.isEbvError(l)||(null!=a.expression.distinct&&""!=a.expression.distinct?(q=C.hashTerm(l),null==g[q]&&(g[q]=!0,t.isNumeric(l)&&(B=t.runSumFunction(B,l)))):t.isNumeric(l)&&(B=t.runSumFunction(B,l)));B.value=""+B.value;return B}return l=t.runFilter(aggregate.expression,b[0],e,{blanks:{},outCache:{}})}}},runFilter:function(a,b,d,e,f){if(null!=a.expressionType){var g=
a.expressionType;if("relationalexpression"==g){var g=t.runFilter(a.op1,b,d,e,f),k=t.runFilter(a.op2,b,d,e,f);return t.runRelationalFilter(a,g,k,b,d,e,f)}if("conditionalor"==g)return t.runOrFunction(a,b,d,e,f);if("conditionaland"==g)return t.runAndFunction(a,b,d,e,f);if("additiveexpression"==g)return t.runAddition(a.summand,a.summands,b,d,e,f);if("builtincall"==g)return t.runBuiltInCall(a.builtincall,a.args,b,d,e,f);if("multiplicativeexpression"==g)return t.runMultiplication(a.factor,a.factors,b,d,
e,f);if("unaryexpression"==g)return t.runUnaryExpression(a.unaryexpression,a.expression,b,d,e,f);if("irireforfunction"==g)return t.runIriRefOrFunction(a.iriref,a.args,b,d,e,f);if("regex"==g)return t.runRegex(a.text,a.pattern,a.flags,b,d,e,f);if("custom"==g)return t.runBuiltInCall(a.name,a.args,b,d,e,f);if("atomic"==g){if("var"==a.primaryexpression)return b[a.value.value];"object"==typeof a.value&&null!=a.value.type&&"object"==typeof a.value.type&&(a.value.type=C.lexicalFormBaseUri(a.value.type,f));
return a.value}throw"Unknown filter expression type";}throw"Cannot find bound expressions in a no expression token";},isRDFTerm:function(a){return null==a?!1:a.token&&"literal"==a.token||a.token&&"uri"==a.token||a.token&&"blank"==a.token?!0:!1},RDFTermEquality:function(a,b,d,e){return"literal"===a.token&&"literal"===b.token?a.lang==b.lang&&a.type==b.type&&a.value==b.value?!0:null!=a.type&&null!=b.type?t.ebvError():t.isSimpleLiteral(a)&&null!=b.type?t.ebvError():t.isSimpleLiteral(b)&&null!=a.type?
t.ebvError():!1:"uri"===a.token&&"uri"===b.token?C.lexicalFormBaseUri(a,e)==C.lexicalFormBaseUri(b,e):"blank"===a.token&&"blank"===b.token?a.value==b.value:!1},isInteger:function(a){return null==a?!1:"literal"===a.token?"http://www.w3.org/2001/XMLSchema#integer"==a.type||"http://www.w3.org/2001/XMLSchema#decimal"==a.type||"http://www.w3.org/2001/XMLSchema#double"==a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==
a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type?
!0:!1:!1},isFloat:function(a){return null==a?!1:"literal"===a.token?"http://www.w3.org/2001/XMLSchema#float"==a.type?!0:!1:!1},isDecimal:function(a){return null==a?!1:"literal"===a.token?"http://www.w3.org/2001/XMLSchema#decimal"==a.type?!0:!1:!1},isDouble:function(a){return null==a?!1:"literal"===a.token?"http://www.w3.org/2001/XMLSchema#double"==a.type?!0:!1:!1},isNumeric:function(a){return null==a?!1:"literal"===a.token?"http://www.w3.org/2001/XMLSchema#integer"==a.type||"http://www.w3.org/2001/XMLSchema#decimal"==
a.type||"http://www.w3.org/2001/XMLSchema#float"==a.type||"http://www.w3.org/2001/XMLSchema#double"==a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==
a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type?!0:!1:!1},isSimpleLiteral:function(a){return a&&"literal"==a.token?null==a.type&&null==a.lang?!0:!1:!1},isXsdType:function(a,b){return b&&"literal"==b.token?b.type=="http://www.w3.org/2001/XMLSchema#"+a:!1},ebv:function(a){if(null==a||t.isEbvError(a))return t.ebvError();
if(a.token&&"literal"===a.token){if("http://www.w3.org/2001/XMLSchema#integer"==a.type||"http://www.w3.org/2001/XMLSchema#decimal"==a.type||"http://www.w3.org/2001/XMLSchema#double"==a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==
a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type){var b=parseFloat(a.value);return isNaN(b)?!1:0!=parseFloat(a.value)}return"http://www.w3.org/2001/XMLSchema#boolean"===a.type?"true"===a.value||
!0===a.value||"True"===a.value:"http://www.w3.org/2001/XMLSchema#string"===a.type?""!=a.value:"http://www.w3.org/2001/XMLSchema#dateTime"===a.type?null!=new Date(a.value):t.isEbvError(a)?a:null==a.type?""!=a.value?!0:!1:t.ebvError()}return!0===a.value}};t.effectiveBooleanValue=t.ebv;t.ebvTrue=function(){return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0}};t.ebvFalse=function(){return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1}};t.ebvError=
function(){return{token:"literal",type:"https://github.com/antoniogarrote/js-tools/types#error",value:null}};t.isEbvError=function(a){return"object"==typeof a&&null!=a?"https://github.com/antoniogarrote/js-tools/types#error"===a.type:!1};t.ebvBoolean=function(a){return t.isEbvError(a)?a:!0===a?t.ebvTrue():t.ebvFalse()};t.runRelationalFilter=function(a,b,d,e,f,g,k){a=a.operator;if("="===a)return t.runEqualityFunction(b,d,e,f,g,k);if("!="===a)return b=t.runEqualityFunction(b,d,e,f,g,k),t.isEbvError(b)||
(b.value=!b.value),b;if("<"===a)return t.runLtFunction(b,d,e);if(">"===a)return t.runGtFunction(b,d,e);if("<="===a)return t.runLtEqFunction(b,d,e);if(">="===a)return t.runGtEqFunction(b,d,e);throw"Error applying relational filter, unknown operator";};t.effectiveTypeValue=function(a){if("literal"==a.token){if("http://www.w3.org/2001/XMLSchema#integer"==a.type)return a=parseInt(a.value);if("http://www.w3.org/2001/XMLSchema#decimal"==a.type||"http://www.w3.org/2001/XMLSchema#float"==a.type||"http://www.w3.org/2001/XMLSchema#double"==
a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type)return a=parseFloat(a.value);if("http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==
a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type)return a=parseInt(a.value);if("http://www.w3.org/2001/XMLSchema#date"==a.type||"http://www.w3.org/2001/XMLSchema#dateTime"==a.type)try{return C.parseISO8601(a.value)}catch(b){return null}else return"http://www.w3.org/2001/XMLSchema#boolean"==a.type?!0===a.value||"true"===a.value||"1"===a.value||1===a.value||!0===a.value?
!0:!1===a.value||"false"===a.value||"0"===a.value||0===a.value||!1===a.value?!1:void 0:"http://www.w3.org/2001/XMLSchema#string"==a.type?null===a.value||void 0===a.value?void 0:""+a.value:a.value}else throw console.log("not implemented yet"),console.log(a),"value not supported in operations yet";};t.runOrFunction=function(a,b,d,e,f){for(var g=null,k=0;k<a.operands.length;k++){var l=t.runFilter(a.operands[k],b,d,e,f);0==t.isEbvError(l)&&(l=t.ebv(l));null==g?g=l:t.isEbvError(l)?g=t.isEbvError(g)?t.ebvError():
!0===g?!0:t.ebvError():!0===l?g=!0:t.isEbvError(g)&&(g=t.ebvError())}return t.ebvBoolean(g)};t.runAndFunction=function(a,b,d,e,f){for(var g=null,k=0;k<a.operands.length;k++){var l=t.runFilter(a.operands[k],b,d,e,f);0==t.isEbvError(l)&&(l=t.ebv(l));null==g?g=l:t.isEbvError(l)?g=t.isEbvError(g)?t.ebvError():!0===g?t.ebvError():!1:!0===l?t.isEbvError(g)&&(g=t.ebvError()):g=!1}return t.ebvBoolean(g)};t.runEqualityFunction=function(a,b,d,e,f,g){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();if(t.isNumeric(a)&&
t.isNumeric(b))return d=t.effectiveTypeValue(a),f=t.effectiveTypeValue(b),isNaN(d)||isNaN(f)?t.ebvBoolean(t.RDFTermEquality(a,b,e,g)):t.ebvBoolean(d==f);if((t.isSimpleLiteral(a)||t.isXsdType("string",a))&&(t.isSimpleLiteral(b)||t.isXsdType("string",b))||t.isXsdType("boolean",a)&&t.isXsdType("boolean",b))return t.ebvBoolean(t.effectiveTypeValue(a)==t.effectiveTypeValue(b));if((t.isXsdType("dateTime",a)||t.isXsdType("date",a))&&(t.isXsdType("dateTime",b)||t.isXsdType("date",b))){if(t.isXsdType("dateTime",
a)&&t.isXsdType("date",b)||t.isXsdType("date",a)&&t.isXsdType("dateTime",b))return t.ebvFalse();a=C.compareDateComponents(a.value,b.value);return null!=a?0==a?t.ebvTrue():t.ebvFalse():t.ebvError()}return t.isRDFTerm(a)&&t.isRDFTerm(b)?t.ebvBoolean(t.RDFTermEquality(a,b,e,g)):t.ebvFalse()};t.runGtFunction=function(a,b,d){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();if(t.isNumeric(a)&&t.isNumeric(b)||t.isSimpleLiteral(a)&&t.isSimpleLiteral(b)||t.isXsdType("string",a)&&t.isXsdType("string",
b)||t.isXsdType("boolean",a)&&t.isXsdType("boolean",b))return t.ebvBoolean(t.effectiveTypeValue(a)>t.effectiveTypeValue(b));if((t.isXsdType("dateTime",a)||t.isXsdType("date",a))&&(t.isXsdType("dateTime",b)||t.isXsdType("date",b))){if(t.isXsdType("dateTime",a)&&t.isXsdType("date",b)||t.isXsdType("date",a)&&t.isXsdType("dateTime",b))return t.ebvFalse();a=C.compareDateComponents(a.value,b.value);return null!=a?1==a?t.ebvTrue():t.ebvFalse():t.ebvError()}return t.ebvFalse()};t.runTotalGtFunction=function(a,
b){return t.isEbvError(a)||t.isEbvError(b)?t.ebvError():t.isNumeric(a)&&t.isNumeric(b)||t.isSimpleLiteral(a)&&t.isSimpleLiteral(b)||t.isXsdType("string",a)&&t.isSimpleLiteral("string",b)||t.isXsdType("boolean",a)&&t.isSimpleLiteral("boolean",b)||t.isXsdType("dateTime",a)&&t.isSimpleLiteral("dateTime",b)?t.runGtFunction(a,b,[]):a.token&&"uri"===a.token&&b.token&&"uri"===b.token?t.ebvBoolean(a.value>b.value):a.token&&"literal"===a.token&&b.token&&"literal"===b.token?t.ebvBoolean(""+a.value+a.type+a.lang>
""+b.value+b.type+b.lang):a.token&&"blank"===a.token&&b.token&&"blank"===b.token?t.ebvBoolean(a.value>b.value):a.value&&b.value?t.ebvBoolean(a.value>b.value):t.ebvTrue()};t.runLtFunction=function(a,b,d){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();if(t.isNumeric(a)&&t.isNumeric(b)||t.isSimpleLiteral(a)&&t.isSimpleLiteral(b)||t.isXsdType("string",a)&&t.isXsdType("string",b)||t.isXsdType("boolean",a)&&t.isXsdType("boolean",b))return t.ebvBoolean(t.effectiveTypeValue(a)<t.effectiveTypeValue(b));
if((t.isXsdType("dateTime",a)||t.isXsdType("date",a))&&(t.isXsdType("dateTime",b)||t.isXsdType("date",b))){if(t.isXsdType("dateTime",a)&&t.isXsdType("date",b)||t.isXsdType("date",a)&&t.isXsdType("dateTime",b))return t.ebvFalse();a=C.compareDateComponents(a.value,b.value);return null!=a?-1==a?t.ebvTrue():t.ebvFalse():t.ebvError()}return t.ebvFalse()};t.runGtEqFunction=function(a,b,d){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();if(t.isNumeric(a)&&t.isNumeric(b)||t.isSimpleLiteral(a)&&t.isSimpleLiteral(b)||
t.isXsdType("string",a)&&t.isXsdType("string",b)||t.isXsdType("boolean",a)&&t.isXsdType("boolean",b))return t.ebvBoolean(t.effectiveTypeValue(a)>=t.effectiveTypeValue(b));if((t.isXsdType("dateTime",a)||t.isXsdType("date",a))&&(t.isXsdType("dateTime",b)||t.isXsdType("date",b))){if(t.isXsdType("dateTime",a)&&t.isXsdType("date",b)||t.isXsdType("date",a)&&t.isXsdType("dateTime",b))return t.ebvFalse();a=C.compareDateComponents(a.value,b.value);return null!=a?-1!=a?t.ebvTrue():t.ebvFalse():t.ebvError()}return t.ebvFalse()};
t.runLtEqFunction=function(a,b,d){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();if(t.isNumeric(a)&&t.isNumeric(b)||t.isSimpleLiteral(a)&&t.isSimpleLiteral(b)||t.isXsdType("string",a)&&t.isXsdType("string",b)||t.isXsdType("boolean",a)&&t.isXsdType("boolean",b))return t.ebvBoolean(t.effectiveTypeValue(a)<=t.effectiveTypeValue(b));if((t.isXsdType("dateTime",a)||t.isXsdType("date",a))&&(t.isXsdType("dateTime",b)||t.isXsdType("date",b))){if(t.isXsdType("dateTime",a)&&t.isXsdType("date",b)||t.isXsdType("date",
a)&&t.isXsdType("dateTime",b))return t.ebvFalse();a=C.compareDateComponents(a.value,b.value);return null!=a?1!=a?t.ebvTrue():t.ebvFalse():t.ebvError()}return t.ebvFalse()};t.runAddition=function(a,b,d,e,f,g){var k=t.runFilter(a,d,e,f,g);if(t.isEbvError(k))return t.ebvError();a=k;if(t.isNumeric(k)){for(k=0;k<b.length;k++){var l=t.runFilter(b[k].expression,d,e,f,g);if(t.isNumeric(l))"+"===b[k].operator?a=t.runSumFunction(a,l):"-"===b[k].operator&&(a=t.runSubFunction(a,l));else return t.ebvFalse()}return a}return t.ebvFalse()};
t.runSumFunction=function(a,b){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();var d=t.effectiveTypeValue(a)+t.effectiveTypeValue(b);return t.isDouble(a)||t.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:t.isFloat(a)||t.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:t.isDecimal(a)||t.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",
value:d}};t.runSubFunction=function(a,b){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();var d=t.effectiveTypeValue(a)-t.effectiveTypeValue(b);return t.isDouble(a)||t.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:t.isFloat(a)||t.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:t.isDecimal(a)||t.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",
value:d}};t.runMultiplication=function(a,b,d,e,f,g){a=t.runFilter(a,d,e,f,g);if(t.isEbvError(a))return a;var k=a;if(t.isNumeric(a)){for(var l=0;l<b.length;l++){var s=t.runFilter(b[l].expression,d,e,f,g);if(t.isEbvError(s))return a;if(t.isNumeric(s))"*"===b[l].operator?k=t.runMulFunction(k,s):"/"===b[l].operator&&(k=t.runDivFunction(k,s));else return t.ebvFalse()}return k}return t.ebvFalse()};t.runMulFunction=function(a,b){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();var d=t.effectiveTypeValue(a)*
t.effectiveTypeValue(b);return t.isDouble(a)||t.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:t.isFloat(a)||t.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:t.isDecimal(a)||t.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};t.runDivFunction=function(a,b){if(t.isEbvError(a)||t.isEbvError(b))return t.ebvError();var d=
t.effectiveTypeValue(a)/t.effectiveTypeValue(b);return t.isDouble(a)||t.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:t.isFloat(a)||t.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:t.isDecimal(a)||t.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};t.runBuiltInCall=function(a,b,d,e,f,g){if("notexists"===a||"exists"===
a){var k=JSON.parse(JSON.stringify(b[0])),k=e.abstractQueryTree.parseSelect({pattern:k},d),k=e.abstractQueryTree.bind(k.pattern,d);d=e.executeSelectUnit([{kind:"*"}],f,k,g);return"exists"===a?t.ebvBoolean(0!==d.length):t.ebvBoolean(0===d.length)}for(var k=[],l=0;l<b.length;l++)if("var"===b[l].token)k.push(b[l]);else{var s=t.runFilter(b[l],d,e,f,g);if(t.isEbvError(s))return s;k.push(s)}if("str"===a)return"literal"===k[0].token?{token:"literal",type:null,value:""+k[0].value}:"uri"===k[0].token?{token:"literal",
type:null,value:k[0].value}:t.ebvFalse();if("lang"===a)return"literal"===k[0].token?null!=k[0].lang?{token:"literal",value:""+k[0].lang}:{token:"literal",value:""}:t.ebvError();if("datatype"===a)return"literal"===k[0].token?(a=k[0],null!=a.type?"string"===typeof a.type?{token:"uri",value:a.type,prefix:null,suffix:null}:a.type:null==a.lang?{token:"uri",value:"http://www.w3.org/2001/XMLSchema#string",prefix:null,suffix:null}:t.ebvError()):t.ebvError();if("isliteral"===a)return"literal"===k[0].token?
t.ebvTrue():t.ebvFalse();if("isblank"===a)return"blank"===k[0].token?t.ebvTrue():t.ebvFalse();if("isuri"===a||"isiri"===a)return"uri"===k[0].token?t.ebvTrue():t.ebvFalse();if("sameterm"===a)return a=t.RDFTermEquality(k[0],k[1],e,g),t.isEbvError(a)&&(a=!1),t.ebvBoolean(a);if("langmatches"===a)return a=k[0],d=k[1],"literal"===a.token&&"literal"===d.token?"*"===d.value&&""!=a.value?t.ebvTrue():t.ebvBoolean(0===a.value.toLowerCase().indexOf(d.value.toLowerCase())):t.ebvError();if("bound"===a)return a=
k[0].value,null==a?t.ebvError():null!=d[a]?t.ebvTrue():t.ebvFalse();if(null!=e.customFns[a])return e.customFns[a](t,k);throw"Builtin call "+a+" not implemented yet";};t.runUnaryExpression=function(a,b,d,e,f,g){b=t.runFilter(b,d,e,f,g);if(t.isEbvError(b))return b;if("!"===a){var k=t.ebv(b);return t.isEbvError(k)?t.ebvFalse():t.ebvBoolean(!k)}if("+"===a)return t.isNumeric(b)?b:t.ebvError();if("-"===a){if(t.isNumeric(b)){a={};for(k in b)a[k]=b[k];a.value=-a.value;return a}return t.ebvError()}};t.runRegex=
function(a,b,d,e,f,g,k){if(null!=a)a=t.runFilter(a,e,f,g,k);else return t.ebvError();if(null!=b)b=t.runFilter(b,e,f,g,k);else return t.ebvError();null!=d&&(d=t.runFilter(d,e,f,g,k));if(null==b||"literal"!==b.token||null!=d&&"literal"!==d.token)return t.ebvError();b=b.value;d=null==d?null:d.value;if(null!=a&&"var"==a.token)if(null!=e[a.value])a=e[a.value];else return t.ebvError();else if(null!=a&&"literal"===a.token)if(null==a.type||t.isXsdType("string",a))a=a.value;else return t.ebvError();else return t.ebvError();
return(null==d?new RegExp(b):new RegExp(b,d.toLowerCase())).exec(a)?t.ebvTrue():t.ebvFalse()};t.normalizeLiteralDatatype=function(a,b,d){null!=a.value.type&&"object"==typeof a.value.type&&(a.value.type=C.lexicalFormBaseUri(a.value.type,d));return a};t.runIriRefOrFunction=function(a,b,d,e,f,g){if(null==b)return a;for(var k=[],l=0;l<b.length;l++)k.push(t.runFilter(b[l],d,e,f,g));a=C.lexicalFormBaseUri(a,g);if("http://www.w3.org/2001/XMLSchema#integer"==a||"http://www.w3.org/2001/XMLSchema#decimal"==
a||"http://www.w3.org/2001/XMLSchema#double"==a||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a||"http://www.w3.org/2001/XMLSchema#long"==a||"http://www.w3.org/2001/XMLSchema#int"==a||"http://www.w3.org/2001/XMLSchema#short"==a||"http://www.w3.org/2001/XMLSchema#byte"==a||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a||"http://www.w3.org/2001/XMLSchema#unsignedShort"==
a||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a)if(k=k[0],"literal"===k.token){k=t.normalizeLiteralDatatype(k,e,g);if("http://www.w3.org/2001/XMLSchema#integer"==k.type||"http://www.w3.org/2001/XMLSchema#decimal"==k.type||"http://www.w3.org/2001/XMLSchema#double"==k.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==k.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==k.type||"http://www.w3.org/2001/XMLSchema#long"==k.type||
"http://www.w3.org/2001/XMLSchema#int"==k.type||"http://www.w3.org/2001/XMLSchema#short"==k.type||"http://www.w3.org/2001/XMLSchema#byte"==k.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==k.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==k.type)return k.type=
a,k;if("http://www.w3.org/2001/XMLSchema#boolean"==k.type)return 1==t.ebv(k)?(k.type=a,k.value=1):(k.type=a,k.value=0),k;if("http://www.w3.org/2001/XMLSchema#float"==k.type||"http://www.w3.org/2001/XMLSchema#double"==k.type)return k.type=a,k.value=parseInt(k.value),k;if("http://www.w3.org/2001/XMLSchema#string"==k.type||null==k.type){if(2<k.value.split(".").length||2<k.value.split("-").length||2<k.value.split("/").length||2<k.value.split("+").length||"http://www.w3.org/2001/XMLSchema#decimal"==a&&
(-1!=k.value.indexOf("e")||-1!=k.value.indexOf("E")))return t.ebvError();if("http://www.w3.org/2001/XMLSchema#int"==a||"http://www.w3.org/2001/XMLSchema#integer"==a)if(-1!=k.value.indexOf("e")||-1!=k.value.indexOf("E")||-1!=k.value.indexOf("."))return t.ebvError();try{k.value=parseInt(parseFloat(k.value));if(isNaN(k.value))return t.ebvError();k.type=a;return k}catch(s){return t.ebvError()}}else return t.ebvError()}else return t.ebvError();else{if("http://www.w3.org/2001/XMLSchema#boolean"==a)return k=
k[0],"literal"===k.token&&null==k.type?"true"===k.value||"1"===k.value?t.ebvTrue():"false"===k.value||"0"===k.value?t.ebvFalse():t.ebvError():"literal"===k.token?t.isEbvError(k)?k:t.ebvBoolean(k):t.ebvError();if("http://www.w3.org/2001/XMLSchema#string"==a)return k=k[0],"literal"===k.token?(k=t.normalizeLiteralDatatype(k,e,g),"http://www.w3.org/2001/XMLSchema#integer"==k.type||"http://www.w3.org/2001/XMLSchema#decimal"==k.type||"http://www.w3.org/2001/XMLSchema#double"==k.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==
k.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==k.type||"http://www.w3.org/2001/XMLSchema#long"==k.type||"http://www.w3.org/2001/XMLSchema#int"==k.type||"http://www.w3.org/2001/XMLSchema#short"==k.type||"http://www.w3.org/2001/XMLSchema#byte"==k.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==k.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==
k.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==k.type||"http://www.w3.org/2001/XMLSchema#float"==k.type?(k.type=a,k.value=""+k.value,k):"http://www.w3.org/2001/XMLSchema#string"==k.type?k:"http://www.w3.org/2001/XMLSchema#boolean"==k.type?(t.ebv(k)?(k.type=a,k.value="true"):(k.type=a,k.value="false"),k):"http://www.w3.org/2001/XMLSchema#dateTime"==k.type||"http://www.w3.org/2001/XMLSchema#date"==k.type?(k.type=a,"string"!=typeof k.value&&(k.value=C.iso8601(k.value)),k):null==k.type?(k.value=
""+k.value,k.type=a,k):t.ebvError()):"uri"===k.token?{token:"literal",value:C.lexicalFormBaseUri(k,g),type:a,lang:null}:t.ebvError();if("http://www.w3.org/2001/XMLSchema#dateTime"==a||"http://www.w3.org/2001/XMLSchema#date"==a){k=k[0];if("http://www.w3.org/2001/XMLSchema#dateTime"==k.type||"http://www.w3.org/2001/XMLSchema#date"==k.type)return k;if("http://www.w3.org/2001/XMLSchema#string"==k.type||null==k.type)try{return k.value=C.iso8601(C.parseStrictISO8601(k.value)),k.type=a,k}catch(q){return t.ebvError()}else return t.ebvError()}else if("http://www.w3.org/2001/XMLSchema#float"==
a)if(k=k[0],"literal"===k.token){k=t.normalizeLiteralDatatype(k,e,g);if("http://www.w3.org/2001/XMLSchema#decimal"==k.type||"http://www.w3.org/2001/XMLSchema#int"==k.type)return k.type=a,k.value=parseFloat(k.value),k;if("http://www.w3.org/2001/XMLSchema#boolean"==k.type)return 1==t.ebv(k)?(k.type=a,k.value=1):(k.type=a,k.value=0),k;if("http://www.w3.org/2001/XMLSchema#float"==k.type||"http://www.w3.org/2001/XMLSchema#double"==k.type)return k.type=a,k.value=parseFloat(k.value),k;if("http://www.w3.org/2001/XMLSchema#string"==
k.type)try{k.value=parseFloat(k.value);if(isNaN(k.value))return t.ebvError();k.type=a;return k}catch(B){return t.ebvError()}else if(null==k.type){if(2<k.value.split(".").length||2<k.value.split("-").length||2<k.value.split("/").length||2<k.value.split("+").length)return t.ebvError();try{k.value=parseFloat(k.value);if(isNaN(k.value))return t.ebvError();k.type=a;return k}catch(w){return t.ebvError()}}else return t.ebvError()}else return t.ebvError();else return t.ebvError()}};var b={variablesInBGP:function(a){var b=
a.variables;if(b)return b;var d=a.value||a,b=[],e;for(e in d)d[e]&&"var"===d[e].token?b.push(d[e].value):d[e]&&"blank"===d[e].token&&b.push("blank:"+d[e].value);return a.variables=b},connected:function(a,b){for(var d="/"+a.vars.join("/")+"/",e=0;e<b.vars.length;e++)if(-1!=d.indexOf("/"+b.vars[e]+"/"))return!0;return!1},variablesIntersectionBGP:function(a,d){for(var e=b.variablesInBGP(a).sort(),f=b.variablesInBGP(d).sort(),g=0,k=0,l=[];g<e.length&&k<f.length;)e[g]===f[k]?(l.push(e[g]),g++,k++):e[g]<
f[k]?g++:k++;return l},executeAndBGPsGroups:function(a){for(var b={},d={},e=0,f=0;f<a.length;f++){var g=a[f],k={},l={},s=[],q;for(q in g)"_cost"!=q&&("var"===g[q].token?s.push(g[q].value):"blank"===g[q].token&&s.push(g[q].value));var t=!1,w={},O;for(O in d){for(var C=d[O],t=!1,y=0;y<s.length;y++)if(-1!=C.indexOf("/"+s[y]+"/")){t=!0;break}t?w[O]=!0:(k[O]=b[O],l[O]=d[O])}if(t){var t=[],y=C="",D;for(D in w)C+=D,t=t.concat(b[D]),y=d[D];y=y+s.join("/")+"/";t.push(g);k[C]=t;l[C]=y}else k[e]=[g],l[e]="/"+
s.join("/")+"/",e++;b=k;d=l}a=[];for(e in b)a.push(b[e]);return a},intersectionSize:function(a,b){for(var d=b.i.split("_"),e=0;e<d.length;e++)if(""!=d[e]&&-1!=a.i.indexOf("_"+d[e]+"_"))return 1;return 0},createJoinTree:function(a,b){for(var d="/"+a.vars.join("/")+"/",e=a.vars.concat([]),f=[],g=0;g<b.vars.length;g++)-1!=d.indexOf("/"+b.vars[g]+"/")?0==b.vars[g].indexOf("_:")?f.push("blank:"+b.vars[g]):f.push(b.vars[g]):e.push(b.vars[g]);for(var k=b.i.split("_"),l=a.i.split("_"),d={},g=0;g<k.length;g++)""!=
k[g]&&(d[k[g]]=!0);for(g=0;g<l.length;g++)""!=l[g]&&(d[l[g]]=!0);var g=[],s;for(s in d)g.push(s);return{left:a,right:b,cost:a.cost+b.cost,i:"_"+g.sort().join("_")+"_",vars:e,join:f}},executeBushyTree:function(a,d,e,f){if(null==a.left)return b.executeEmptyJoinBGP(a.right,d,e,f);if(null==a.right)return b.executeEmptyJoinBGP(a.left,d,e,f);var g=b.executeBushyTree(a.left,d,e,f);if(null!=g)return d=b.executeBushyTree(a.right,d,e,f),null!=d?b.joinBindings2(a.join,g,d):null},executeAndBGPsDPSize:function(a,
d,e,f){var g=b.executeAndBGPsGroups(a);a=[];for(var k=0;k<g.length;k++){var l=g[k];e.computeCosts(l,f);var s={},q={},t={},B=1,w=null,C={};t["1"]=[];for(var y=0;y<l.length;y++){var B=[],D;for(D in l[y])"_cost"!=D&&("var"===l[y][D].token?B.push(l[y][D].value):"blank"===l[y][D].token&&B.push(l[y][D].value));q["_"+y+"_"]={left:l[y],right:null,cost:l[y]._cost,i:"_"+y+"_",vars:B};B={left:l[y],right:null,cost:l[y]._cost,i:"_"+y+"_",vars:B};s["_"+y+"_"]=B;delete l[y]._cost;C["_"+y+"_"]=!0;t["1"].push("_"+
y+"_");if(null==w||w.cost>B.cost)w=B}for(var sa=2;sa<=l.length;sa++)for(var I=1;I<sa;I++)for(var H=t[""+I]||[],T=t[""+(sa-I)]||[],y=0;y<H.length;y++)for(var F=0;F<T.length;F++)if(H[y]!==T[F]){var J=q[H[y]],K=q[T[F]];if(0==b.intersectionSize(J,K)&&b.connected(J,K)&&(B=sa,K=b.createJoinTree(s[J.i],s[K.i]),!C[K.i])){C[K.i]=!0;var L=K.cost+1;null!=s[K.i]&&(L=s[K.i].cost);J=t[sa]||[];J.push(K.i);q[K.i]=K;t[sa]=J;L>K.cost&&(B===sa&&(w=K),s[K.i]=K)}}a.push(w)}J=null;for(k=0;k<a.length;k++)D=b.executeBushyTree(a[k],
d,e,f),J=null==J?D:b.crossProductBindings(J,D);return J},executeEmptyJoinBGP:function(a,d,e,f){return b.executeBGPDatasets(a,d,e,f)},executeBGPDatasets:function(a,d,e,f){var g={};if(null==a.graph){for(var k=[],l=0;l<d.implicit.length;l++)if(null==g[d.implicit[l].oid]){g[d.implicit[l].oid]=!0;a.graph=d.implicit[l];var s=e.rangeQuery(a,f),s=b.buildBindingsFromRange(s,a);k.push(s)}return a=b.unionManyBindings(k)}if("var"===a.graph.token){for(var q=a.graph.value,k=[],l=0;l<d.named.length;l++)if(null==
g[d.named[l].oid])if(g[d.named[l].oid]=!0,a.graph=d.named[l],s=e.rangeQuery(a,f),null!=s){for(var s=b.buildBindingsFromRange(s,a),t=0;t<s.length;t++)s[t][q]=d.named[l].oid;k.push(s)}else return null;return a=b.unionManyBindings(k||[])}s=e.rangeQuery(a,f);return null!=s?s=b.buildBindingsFromRange(s,a):null},buildBindingsFromRange:function(a,d){b.variablesInBGP(d);var e={},f=d.value||d,e={};for(q in f)f[q]&&"var"===f[q].token?e[q]=f[q].value:f[q]&&"blank"===f[q].token&&(e[q]="blank:"+f[q].value);f=
[];if(null!=a)for(var g=0;g<a.length;g++){var k={},l=a[g],s=!1,q;for(q in e){var t=l[q];if(null==k[e[q]]||k[e[q]]===t)k[e[q]]=t;else{s=!0;break}}s||f.push(k)}return f},areCompatibleBindings:function(a,b){for(var d in a)if(null!=b[d]&&b[d]!=a[d])return!1;return!0},mergeBindings:function(a,b){var d={},e;for(e in a)d[e]=a[e];for(e in b)d[e]=b[e];return d},joinBindings2:function(a,d,e){for(var f={},g,k,l,s,q=[],t=0;t<d.length;t++){g=d[t];s=f;for(var B=0;B<a.length;B++)k=a[B],k=g[k],B==a.length-1?(l=s[k]||
[],l.push(g),s[k]=l):(l=s[k]||{},s=s[k]=l)}for(t=0;t<e.length;t++)for(g=e[t],s=f,B=0;B<a.length;B++)if(k=a[B],k=g[k],null!=s[k])if(B==a.length-1)for(d=0;d<s[k].length;d++)q.push(b.mergeBindings(s[k][d],g));else s=s[k];return q},joinBindings:function(a,d){for(var e=[],f=0;f<a.length;f++)for(var g=a[f],k=0;k<d.length;k++){var l=d[k];b.areCompatibleBindings(g,l)&&e.push(b.mergeBindings(g,l))}return e},augmentMissingBindings:function(a,b){for(var d in b)null==a[d]&&(a[d]=null);return a},leftOuterJoinBindings:function(a,
d){for(var e=[],f=0;f<a.length;f++){for(var g=a[f],k=!1,l=0;l<d.length;l++){var s=d[l];b.areCompatibleBindings(g,s)&&(k=!0,e.push(b.mergeBindings(g,s)))}!1===k&&(b.augmentMissingBindings(g,s),e.push(g))}return e},crossProductBindings:function(a,d){for(var e=[],f=0;f<a.length;f++)for(var g=a[f],k=0;k<d.length;k++)e.push(b.mergeBindings(g,d[k]));return e},unionBindings:function(a,b){return a.concat(b)},unionManyBindings:function(a){for(var d=[],e=0;e<a.length;e++)d=b.unionBindings(d,a[e]);return d}},
d;d=function(a){0!=arguments.length&&(this.backend=a.backend,this.lexicon=a.lexicon,this.eventsOnBatchLoad=a.eventsOnBatchLoad||!1,this.defaultPrefixes={},this.abstractQueryTree=new Q.AbstractQueryTree,this.rdfLoader=new X(a.communication),this.callbacksBackend=new e.CallbacksBackend(this),this.customFns=a.customFns||{})};d.prototype.setCustomFunctions=function(a){this.customFns=a};d.prototype.registerNsInEnvironment=function(a,b){var d=[];null!=a&&null!=a.prefixes&&(d=a.prefixes);var e={},f;for(f in this.defaultPrefixes)e[f]=
this.defaultPrefixes[f];for(f=0;f<d.length;f++){var g=d[f];"prefix"===g.token&&(e[g.prefix]=g.local)}b.namespaces=e;b.base=null!=a&&a.base&&"object"===typeof a.base?a.base.value:null};d.prototype.applyModifier=function(a,b){if("DISTINCT"==a){for(var d={},e=[],f=0;f<b.length;f++){var g=b[f],k="",l;for(l in g){var s=g[l];null==s?k=k+l+"null":"literal"==s.token?(null!=s.value&&(k+=s.value),null!=s.lang&&(k+=s.lang),null!=s.type&&(k+=s.type)):k=s.value?k+l+s.value:k+l+s}null==d[k]&&(e.push(g),d[k]=!0)}return e}return b};
d.prototype.applyLimitOffset=function(a,b,d){if(null==b&&null==a)return d;null==a&&(a=0);b=null==b?d.length:a+b;return d.slice(a,b)};d.prototype.applySingleOrderBy=function(a,b,d,e){for(var f=[],g=0;g<a.length;g++){var k=t.collect(a[g].expression,[b],d,e,this);f.push(k[0].value)}return{binding:b,value:f}};d.prototype.applyOrderBy=function(a,b,d,e){var f=this,g=[];if(null!=a&&0<a.length){for(var k=0;k<b.length;k++){var l=f.applySingleOrderBy(a,b[k],d,e);g.push(l)}g.sort(function(b,d){return f.compareFilteredBindings(b,
d,a,e)});b=[];for(k=0;k<g.length;k++)b.push(g[k].binding)}return b};d.prototype.compareFilteredBindings=function(a,b,d,e){for(var f=0;;){if(f==a.value.length)return 0;var g=d[f].direction;if(null==a.value[f]&&null==b.value[f])f++;else{if(null==a.value[f])a={value:!1};else if(null==b.value[f])a={value:!0};else if("blank"===a.value[f].token&&"blank"===b.value[f].token){f++;continue}else if("blank"===a.value[f].token)a={value:!1};else if("blank"===b.value[f].token)a={value:!0};else if("uri"===a.value[f].token&&
"uri"===b.value[f].token)if(1==t.runEqualityFunction(a.value[f],b.value[f],[],this,e).value){f++;continue}else a=t.runTotalGtFunction(a.value[f],b.value[f],[]);else if("uri"===a.value[f].token)a={value:!1};else if("uri"===b.value[f].token)a={value:!0};else if("literal"===a.value[f].token&&"literal"===b.value[f].token&&null==a.value[f].type&&null==b.value[f].type)if(1==t.runEqualityFunction(a.value[f],b.value[f],[],this,e).value){f++;continue}else a=t.runTotalGtFunction(a.value[f],b.value[f],[]);else if("literal"===
a.value[f].token&&null==a.value[f].type)a={value:!1};else if("literal"===b.value[f].token&&null==b.value[f].type)a={value:!0};else if(1==t.runEqualityFunction(a.value[f],b.value[f],[],this,e).value){f++;continue}else a=t.runTotalGtFunction(a.value[f],b.value[f],[]);return 1==a.value?"ASC"===g?1:-1:"ASC"===g?-1:1}}};d.prototype.removeDefaultGraphBindings=function(a,b){for(var d=[],e={},f=0;f<b.named.length;f++)e[b.named[f].oid]=!0;for(f=0;f<b.implicit.length;f++)null==e[b.implicit[f].oid]&&d.push(b.implicit[f].oid);
d=[];for(f=0;f<a.length;f++){var g=a[f],k=!1,l;for(l in g){for(var s=0;s<e.length;s++)if(g[l]===e[s]){k=!0;break}if(k)break}k||d.push(g)}return d};d.prototype.aggregateBindings=function(a,b,d,e){b=this.copyDenormalizedBindings(b,e.outCache);for(var f={},g=0;g<a.length;g++){var k=t.runAggregator(a[g],b,this,d,e);a[g].alias?f[a[g].alias.value]=k:f[a[g].value.value]=k}return f};d.prototype.projectBindings=function(a,b,d){if("*"===a[0].kind)return b;for(var e=[],f=0;f<b.length;f++){for(var g=b[f],k={},
l=!0,s=0;s<a.length;s++)if("variable"==a[s].token&&"aliased"!=a[s].kind)k[a[s].value.value]=g[a[s].value.value];else if("variable"==a[s].token&&"aliased"==a[s].kind){var q=t.runFilter(a[s].expression,g,this,d,{blanks:{},outCache:{}});if(t.isEbvError(q)){l=!1;break}else k[a[s].alias.value]=q}!0===l&&e.push(k)}return e};d.prototype.resolveNsInEnvironment=function(a,b){return b.namespaces[a]};d.prototype.termCost=function(a,b){if("uri"===a.token){var d=C.lexicalFormBaseUri(a,b);return null==d?0:this.lexicon.resolveUriCost(d)}return"literal"===
a.token?(d=C.lexicalFormLiteral(a,b),this.lexicon.resolveLiteralCost(d)):"blank"===a.token?this.lexicon.resolveBlankCost(a.value):"var"===a.token?this.lexicon.oidCounter/3:null};d.prototype.normalizeTerm=function(a,b,d){if("uri"===a.token)return b=C.lexicalFormBaseUri(a,b),null==b?null:d?this.lexicon.registerUri(b):this.lexicon.resolveUri(b);if("literal"===a.token)return b=C.lexicalFormLiteral(a,b),a=d?this.lexicon.registerLiteral(b):this.lexicon.resolveLiteral(b);if("blank"===a.token){var e=a.value;
a=b.blanks[e];null==a&&(a=d?this.lexicon.registerBlank(e):this.lexicon.resolveBlank(e),b.blanks[e]=a);return a}return"var"===a.token?a.value:null};d.prototype.normalizeDatasets=function(a,b,d){for(d=0;d<a.length;d++){var e=a[d];if(e.value===this.lexicon.defaultGraphUri)e.oid=this.lexicon.defaultGraphOid;else{var f=this.normalizeTerm(e,b,!1);if(null!=f)e.oid=f;else return null}}return!0};d.prototype.normalizeQuad=function(a,b,d){var e=null,f=null,g=null,k;if(null==a.graph)g=0;else if(k=this.normalizeTerm(a.graph,
b,d),null!=k)g=k,!0===d&&"var"!=a.graph.token&&this.lexicon.registerGraph(k);else return null;k=this.normalizeTerm(a.subject,b,d);if(null!=k)e=k;else return null;k=this.normalizeTerm(a.predicate,b,d);if(null!=k)f=k;else return null;k=this.normalizeTerm(a.object,b,d);return null==k?null:{subject:e,predicate:f,object:k,graph:g}};d.prototype.quadCost=function(a,b,d){var e=d=null,f=null,g=null,g=null==a.graph?this.lexicon.oidCounter/4:this.termCost(a.graph,b);d=this.termCost(a.subject,b);e=this.termCost(a.predicate,
b);f=this.termCost(a.object,b);return g+d+e+f};d.prototype.denormalizeBindingsList=function(a,b){for(var d=[],e=0;e<a.length;e++){var f=this.denormalizeBindings(a[e],b);d.push(f)}return d};d.prototype.copyDenormalizedBindings=function(a,b,d){d=[];for(var e=0;e<a.length;e++){for(var f={},g=a[e],k=C.keys(g),l=0;l<k.length;l++){var s=g[k[l]];if(null==s)f[k[l]]=null;else if("object"===typeof s)f[k[l]]=s;else{var q=b[s];null==q&&(q=this.lexicon.retrieve(s),b[s]=q);f[k[l]]=q}}d.push(f)}return d};d.prototype.denormalizeBindings=
function(a,b,d){d=C.keys(a);for(var e=b.outCache,f=0;f<d.length;f++){var g=a[d[f]];if(null==g)a[d[f]]=null;else if(null!=e[g])a[d[f]]=e[g];else{var k=this.lexicon.retrieve(g);a[d[f]]=k;"blank"===k.token&&(b.blanks[k.value]=g)}}return a};d.prototype.execute=function(a,b,d,e){a=C.normalizeUnicodeLiterals(a);a=this.abstractQueryTree.parseQueryString(a);if(null==a)b(!1,"Error parsing query string");else if("query"===a.token&&"update"==a.kind){this.callbacksBackend.startGraphModification();var f=this;
this.executeUpdate(a,function(a,d){f.lexicon.updateAfterWrite&&f.lexicon.updateAfterWrite();a?f.callbacksBackend.endGraphModification(function(){b(a,d)}):(f.callbacksBackend.cancelGraphModification(),b(a,d))})}else"query"===a.token&&"query"==a.kind&&this.executeQuery(a,b,d,e)};d.prototype.executeQuery=function(a,b,d,e){var f=a.units,g=this,k={blanks:{},outCache:{}};this.registerNsInEnvironment(a.prologue,k);var l=g.abstractQueryTree.parseExecutableUnit(f[0]);"select"===l.kind?this.executeSelect(l,
k,d,e,function(a,d){a?"object"===typeof d&&!0===d.denorm?b(!0,d.bindings):(d=g.denormalizeBindingsList(d,k),null!=d?b(!0,d):b(!1,d)):b(!1,d)}):"ask"===l.kind?(l.projection=[{token:"variable",kind:"*"}],this.executeSelect(l,k,d,e,function(a,d){a?a?0<d.length?b(!0,!0):b(!0,!1):b(!1,d):b(!1,d)})):"construct"===l.kind&&(l.projection=[{token:"variable",kind:"*"}],g=this,this.executeSelect(l,k,d,e,function(a,d){if(a)if(a)if(d=g.denormalizeBindingsList(d,k),null!=d){var e=new y.Graph;null==l.template&&(l.template=
{triplesContext:l.pattern});for(var f=1,n=[],s=0;s<d.length;s++){for(var v=d[s],q=0;q<n.length;q++)delete n[q].valuetmp;for(q=0;q<l.template.triplesContext.length;q++){for(var z=["subject","predicate","object"],t=l.template.triplesContext[q],w=0;w<z.length;w++){var C=z[w];if("blank"===t[C].token&&(!t[C].valuetmp||null==t[C].valuetmp)){var D="_:b"+f;f++;t[C].valuetmp=D;n.push(t[C])}}z=y.buildRDFResource(t.subject,v,g,k);w=y.buildRDFResource(t.predicate,v,g,k);t=y.buildRDFResource(t.object,v,g,k);null!=
z&&null!=w&&null!=t&&(w=new y.Triple(z,w,t),e.add(w))}}b(!0,e)}else b(!1,d);else b(!1,d);else b(!1,d)}))};d.prototype.executeSelect=function(a,b,d,e,f){if("select"===a.kind||"ask"===a.kind||"construct"===a.kind||"modify"===a.kind){var g=a.projection,k=a.dataset,l=a.modifier,s=a.limit,q=a.offset,t=a.order;if(null!=d||null!=e)k.implicit=d||[],k.named=e||[];null!=k.implicit&&0===k.implicit.length&&null!=k.named&&0===k.named.length&&k.implicit.push(this.lexicon.defaultGraphUriTerm);if(null!=this.normalizeDatasets(k.implicit.concat(k.named),
b))if(e=this.executeSelectUnit(g,k,a.pattern,b),null!=e){if(null!=a.group&&""===a.group){var w=!1;for(d=0;d<a.projection.length;d++)if(null!=a.projection[d].expression&&"aggregate"===a.projection[d].expression.expressionType){w=!0;break}!0===w&&(a.group="singleGroup")}if(a.group&&""!=a.group)if(this.checkGroupSemantics(a.group,g)){s=this.groupSolution(e,a.group,k,b);q=[];for(d=0;d<s.length;d++)l=this.aggregateBindings(g,s[d],k,b),q.push(l);f(!0,{bindings:q,denorm:!0})}else f(!1,"Incompatible Group and Projection variables");
else b=this.applyOrderBy(t,e,k,b),g=this.projectBindings(g,b,k),g=this.applyModifier(l,g),g=this.applyLimitOffset(q,s,g),k=this.removeDefaultGraphBindings(g,k),f(!0,k)}else f(!1,e);else f(!1,"Error normalizing datasets")}else f(!1,"Cannot execute "+a.kind+" query as a select query")};d.prototype.groupSolution=function(a,b,d,e){var f=[],g=[],k=!1;if("singleGroup"===b)return[a];for(var l=0;l<a.length;l++){for(var s=a[l],q=!0,B=0;B<b.length;B++){var w=b[B],y=null;"var"===w.token?(y=w.value,0==k&&f.push(y)):
"aliased_expression"===w.token?(y=w.alias.value,0==k&&f.push(y),"var"===w.expression.primaryexpression?s[w.alias.value]=s[w.expression.value.value]:(y=this.copyDenormalizedBindings([s],e.outCache),y=t.runFilter(w.expression,y[0],this,d,e),t.isEbvError(y)?q=!1:(null!=y.value&&(y.value=""+y.value),s[w.alias.value]=y))):(y=this.copyDenormalizedBindings([s],e.outCache),y=t.runFilter(w,y[0],this,e),t.isEbvError(y)?q=!1:(s["groupCondition"+env._i]=y,y="groupCondition"+env._i,0==k&&f.push(y)))}0==k&&(k=
!0);!0===q&&g.push(s)}a={};for(l=0;l<g.length;l++){b=g[l];d="";for(B=0;B<f.length;B++)e=b[f[B]],d="object"===typeof e?d+e.value:d+e;null==a[d]?a[d]=[b]:a[d].push(b)}var f=[],C;for(C in a)f.push(a[C]);return f};d.prototype.executeSelectUnit=function(a,b,d,e){if("BGP"===d.kind)return this.executeAndBGP(a,b,d,e);if("UNION"===d.kind)return this.executeUNION(a,b,d.value,e);if("JOIN"===d.kind)return this.executeJOIN(a,b,d,e);if("LEFT_JOIN"===d.kind)return this.executeLEFT_JOIN(a,b,d,e);if("FILTER"===d.kind)return a=
this.executeSelectUnit(a,b,d.value,e),null!=a?a=t.checkFilters(d,a,!1,b,e,this):[];if("EMPTY_PATTERN"===d.kind)return[];if("ZERO_OR_MORE_PATH"===d.kind||"ONE_OR_MORE_PATH"===d.kind)return this.executeZeroOrMorePath(d,b,e);console.log("Cannot execute query pattern "+d.kind+". Not implemented yet.");return null};d.prototype.executeZeroOrMorePath=function(a,b,d){var e=[];"var"===a.x.token&&e.push({token:"variable",kind:"var",value:a.x.value});"var"===a.y.token&&e.push({token:"variable",kind:"var",value:a.y.value});
0===e.length&&e.push({token:"variable",kind:"*"});if("var"===a.x.token&&"var"===a.y.token){var f=this.executeAndBGP(e,b,a.path,d),g={},e=[],k,l,s,q,t=a.x.value;l=a.x;for(var w=a.path,y=0;y<f.length;y++)if(k=f[y][t],null==g[k]){q=this.lexicon.retrieve(k);a.x=q;a.path=this.abstractQueryTree.replace(w,l,q,d);w=C.clone(a.path);l=this.executeZeroOrMorePath(a,b,d);for(var D=0;D<l.length;D++)s=l[D],s[t]=k,e.push(s);l=q}return e}if("var"!==a.x.token&&"var"===a.y.token){g={};k=!0;q=[];for(t=[];1==k||0!==q.length;)for(!0===
k?(f=this.executeAndBGP(e,b,a.path,d),l=a.x,k=!1):(f=q.pop(),w=this.lexicon.retrieve(f),f=a.path,f=this.abstractQueryTree.replace(f,l,w,d),f=this.executeAndBGP(e,b,f,d),l=w),y=0;y<f.length;y++)w=f[y][a.y.value],!0!==g[w]&&(s={},s[a.y.value]=w,t.push(s),g[w]=!0,q.push(w));return t}throw"Kind of path not supported!";};d.prototype.executeUNION=function(a,d,e,f){var g=e[0],k=e[1],l=null,s=null;if(2!=e.length)throw"SPARQL algebra UNION with more than two components";l=this.executeSelectUnit(a,d,g,f);if(null==
l)return null;s=this.executeSelectUnit(a,d,k,f);if(null==s)return null;a=b.unionBindings(l,s);return a=t.checkFilters(e,a,!1,d,f,this)};d.prototype.executeAndBGP=function(a,d,e,f){a=b.executeAndBGPsDPSize(e.value,d,this,f);return null!=a?t.checkFilters(e,a,!1,d,f,this):null};d.prototype.executeLEFT_JOIN=function(a,d,e,f){var g=e.rvalue,k=null,l=null,k=this.executeSelectUnit(a,d,e.lvalue,f);if(null==k)return null;l=this.executeSelectUnit(a,d,g,f);if(null==l)return null;a=b.leftOuterJoinBindings(k,
l);d=t.checkFilters(e,a,!0,d,f,this);if(1<k.length&&1<l.length){e=[];f={};for(var s in k[0])f[s]=!0;for(s in l[0])1!=f[s]&&e.push(s);k=[];l={};for(f=0;f<d.length;f++)if(!0===d[f].__nullify__){for(g=0;g<e.length;g++)d[f].bindings[e[g]]=null;g=[];a=[];for(s in d[f].bindings)null!=d[f].bindings[s]&&(g.push(s+d[f].bindings[s]),g.sort(),a.push(g.join("")));if(null==l[g.join("")]){for(g=0;g<a.length;g++)l[a[g]]=!0;k.push(d[f].bindings)}}else for(s in k.push(d[f]),g=[],d[f])g.push(s+d[f][s]),g.sort(),l[g.join("")]=
!0;return k}return d};d.prototype.executeJOIN=function(a,d,e,f){var g=e.lvalue,k=e.rvalue,l=null,s=null,l=this.executeSelectUnit(a,d,g,f);if(null==l)return null;s=this.executeSelectUnit(a,d,k,f);if(null==s)return null;a=null;if(0===l.length||0===s.length)a=[];else{a={};var q=[],E;for(E in l[0])a[E]=!1;for(E in s[0])!1===a[E]&&q.push(E);a=0==q.length?b.joinBindings(l,s):this.abstractQueryTree.treeWithUnion(g)||this.abstractQueryTree.treeWithUnion(k)?b.joinBindings(l,s):b.joinBindings2(q,l,s)}return a=
t.checkFilters(e,a,!1,d,f,this)};d.prototype.rangeQuery=function(a,b){var d=this.normalizeQuad(a,b,!1);if(null!=d)return d=this.backend.range(new U(d)),null==d||0==d.length?[]:d;console.log("ERROR normalizing quad");return null};d.prototype.executeUpdate=function(a,b){var d=a.units,e=this,f={blanks:{},outCache:{}};this.registerNsInEnvironment(a.prologue,f);for(var g=0;g<d.length;g++){var k=e.abstractQueryTree.parseExecutableUnit(d[g]);if("insertdata"===k.kind){for(var l=0;l<k.quads.length;l++){var s=
k.quads[l];if(!0!==e._executeQuadInsert(s,f))return b(!1,error)}b(!0)}else if("deletedata"===k.kind){for(l=0;l<k.quads.length;l++)s=k.quads[l],this._executeQuadDelete(s,f);b(!0)}else if("modify"===k.kind)this._executeModifyQuery(k,f,b);else if("create"===k.kind)b(!0);else if("load"===k.kind)l={uri:C.lexicalFormBaseUri(k.sourceGraph,f)},null!=k.destinyGraph&&(l={uri:C.lexicalFormBaseUri(k.destinyGraph,f)}),e=this,this.rdfLoader.load(k.sourceGraph.value,l,function(a,d){0==a?(console.log("Error loading graph"),
console.log(d),b(!1,"error batch loading quads")):(d=e.batchLoad(d),b(null!=d,d||"error batch loading quads"))});else if("drop"===k.kind)this._executeClearGraph(k.destinyGraph,f,b);else if("clear"===k.kind)this._executeClearGraph(k.destinyGraph,f,b);else throw Error("not supported execution unit");}};d.prototype.batchLoad=function(a,b){var d=null,f=null,g=null,k=null,l=0,s=!0,q={},t,B;this.eventsOnBatchLoad&&this.callbacksBackend.startGraphModification();for(var w=0;w<a.length;w++)if(B=a[w],B.subject.uri||
"uri"===B.subject.token?(t=this.lexicon.registerUri(B.subject.uri||B.subject.value),null!=B.subject.uri&&(B.subject={token:"uri",value:B.subject.uri},delete B.subject.uri)):B.subject.literal||"literal"===B.subject.token?(t=this.lexicon.registerLiteral(B.subject.literal||B.subject.value),null!=B.subject.literal&&(B.subject=this.lexicon.parseLiteral(B.subject.literal),delete B.subject.literal)):(t=q[B.subject.blank||B.subject.value],null==t&&(t=this.lexicon.registerBlank(B.subject.blank||B.subject.value),
q[B.subject.blank||B.subject.value]=t),null==B.subject.token&&(B.subject.token="blank",B.subject.value=B.subject.blank,delete B.subject.blank)),d=t,B.predicate.uri||"uri"===B.predicate.token?(t=this.lexicon.registerUri(B.predicate.uri||B.predicate.value),null!=B.predicate.uri&&(B.predicate={token:"uri",value:B.predicate.uri},delete B.subject.uri)):B.predicate.literal||"literal"===B.predicate.token?(t=this.lexicon.registerLiteral(B.predicate.literal||B.predicate.value),null!=B.predicate.literal&&(B.predicate=
this.lexicon.parseLiteral(B.predicate.literal),delete B.predicate.literal)):(t=q[B.predicate.blank||B.predicate.value],null==t&&(t=this.lexicon.registerBlank(B.predicate.blank||B.predicate.value),q[B.predicate.blank||B.predicate.value]=t),null==B.predicate.token&&(B.predicate.token="blank",B.predicate.value=B.predicate.blank,delete B.predicate.blank)),f=t,B.object.uri||"uri"===B.object.token?(t=this.lexicon.registerUri(B.object.uri||B.object.value),null!=B.object.uri&&(B.object={token:"uri",value:B.object.uri},
delete B.subject.uri)):B.object.literal||"literal"===B.object.token?("literal"===B.object.token&&(B.object.value=null!=B.object.type?'"'+B.object.value+'"^^<'+B.object.type+">":null!=B.object.lang?'"'+B.object.value+'"@'+B.object.lang:'"'+B.object.value+'"'),t=this.lexicon.registerLiteral(B.object.literal||B.object.value),null!=B.object.literal&&(B.object=this.lexicon.parseLiteral(B.object.literal),delete B.object.literal)):(t=q[B.object.blank||B.object.value],null==t&&(t=this.lexicon.registerBlank(B.object.blank||
B.object.value),q[B.object.blank||B.object.value]=t),null==B.object.token&&(B.object.token="blank",B.object.value=B.object.blank,delete B.object.blank)),g=t,B.graph.uri||"uri"===B.graph.token?(t=this.lexicon.registerUri(B.graph.uri||B.graph.value),null!=B.graph.uri&&(B.graph={token:"uri",value:B.graph.uri},delete B.subject.uri),this.lexicon.registerGraph(t)):B.graph.literal||"literal"===B.graph.token?(t=this.lexicon.registerLiteral(B.graph.literal||B.graph.value),null!=B.predicate.literal&&(B.predicate=
this.lexicon.parseLiteral(B.predicate.literal),delete B.predicate.literal)):(t=q[B.graph.blank||B.graph.value],null==t&&(t=this.lexicon.registerBlank(B.graph.blank||B.graph.value),q[B.graph.blank||B.graph.value]=t),null==B.graph.token&&(B.graph.token="blank",B.graph.value=B.graph.blank,delete B.graph.blank)),k=t,t=B,B={subject:d,predicate:f,object:g,graph:k},d=new V(B),f=this.backend.search(d),!f)if(f=this.backend.index(d),1==f)this.eventsOnBatchLoad&&this.callbacksBackend.nextGraphModification(e.added,
[t,B]),l+=1;else{s=!1;break}null!=this.lexicon.updateAfterWrite&&this.lexicon.updateAfterWrite();var y=function(){s?b&&b(!0,l):b&&b(!1,null)};this.eventsOnBatchLoad?this.callbacksBackend.endGraphModification(function(){y()}):y();return s?l:null};d.prototype.computeCosts=function(a,b){for(var d=0;d<a.length;d++)a[d]._cost=this.quadCost(a[d],b);return a};d.prototype._executeModifyQuery=function(a,b,d){var e=this,f=!0,g=null,k=["subject","predicate","object","graph"];a.insert=null==a.insert?[]:a.insert;
a["delete"]=null==a["delete"]?[]:a["delete"];C.seq(function(d){var k=[],l=[];null!=a["with"]&&k.push(a["with"]);if(null!=a.using)for(var l=[],n=0;n<a.using.length;n++){var s=a.using[n];"named"===s.kind?l.push(s.uri):k.push(s.uri)}a.dataset={};a.projection=[{token:"variable",kind:"*"}];e.executeSelect(a,b,k,l,function(a,k){a?(k=e.denormalizeBindingsList(k,b),null!=k?g=k:f=!1):f=!1;return d()})},function(d){var l=a["with"];if(f){for(var n=[],s=0;s<a["delete"].length;s++)for(var q=a["delete"][s],t=0;t<
g.length;t++){for(var w={},y=g[t],C=0;C<k.length;C++){var D=k[C];"graph"==D&&null==q[D]?w.graph=l:w[D]="var"===q[D].token?y[q[D].value]:q[D]}n.push(w)}for(t=0;t<n.length;t++)w=n[t],e._executeQuadDelete(w,b)}d()},function(d){var l=a["with"];if(f){for(var n=[],s=0;s<a.insert.length;s++)for(var q=a.insert[s],t=0;t<g.length;t++){for(var w={},y=g[t],C=0;C<k.length;C++){var D=k[C];"graph"==D&&null==q[D]?w.graph=l:w[D]="var"===q[D].token?y[q[D].value]:q[D]}n.push(w)}for(s=0;s<n.length;s++)w=n[s],e._executeQuadInsert(w,
b)}d()})(function(){d(f)})};d.prototype._executeQuadInsert=function(a,b){var d=this.normalizeQuad(a,b,!0);if(null!=d){var f=new V(d),g=this.backend.search(f);if(g)return g;g=this.backend.index(f);if(1==g)return this.callbacksBackend.nextGraphModification(e.added,[a,d]),!0;console.log("ERROR inserting quad");return!1}console.log("ERROR normalizing quad");return!1};d.prototype._executeQuadDelete=function(a,b){var d=this.normalizeQuad(a,b,!1);if(null!=d){var f=new V(d);this.backend["delete"](f);if(1==
this.lexicon.unregister(a,f))return this.callbacksBackend.nextGraphModification(e.deleted,[a,d]),!0;console.log("ERROR unregistering quad");return!1}console.log("ERROR normalizing quad");return!1};d.prototype._executeClearGraph=function(a,b,d){if("default"===a)this.execute("DELETE { ?s ?p ?o } WHERE { ?s ?p ?o }",d);else if("named"===a){var e=this,f=this.lexicon.registeredGraphs(!0);if(null!=f){var g=!1;C.repeat(0,f.length,function(a,b){var d=f[b._i],k=arguments.callee;g?a(k,b):e.execute("DELETE { GRAPH <"+
d+"> { ?s ?p ?o } } WHERE { GRAPH <"+d+"> { ?s ?p ?o } }",function(d,e){g=!d;a(k,b)})},function(a){d(!g)})}else d(!1,"Error deleting named graphs")}else"all"===a?(e=this,this.execute("CLEAR DEFAULT",function(a,b){a?e.execute("CLEAR NAMED",d):d(!1,b)})):"uri"==a.token?(a=C.lexicalFormBaseUri(a,b),null!=a?this.execute("DELETE { GRAPH <"+a+"> { ?s ?p ?o } } WHERE { GRAPH <"+a+"> { ?s ?p ?o } }",d):d(!1,"wrong graph URI")):d(!1,"wrong graph URI")};d.prototype.checkGroupSemantics=function(a,b){if("singleGroup"===
a)return!0;for(var d={},e=0;e<a.length;e++){var f=a[e];"var"===f.token?d[f.value]=!0:"aliased_expression"===f.token&&(d[f.alias.value]=!0)}for(e=0;e<b.length;e++)if(f=b[e],"var"===f.kind){if(null==d[f.value.value])return!1}else if("aliased"===f.kind&&f.expression&&"var"===f.expression.primaryexpression&&null==d[f.expression.value.value])return!1;return!0};d.prototype.registerDefaultNamespace=function(a,b){this.defaultPrefixes[a]=b};var e={ANYTHING:{token:"var",value:"_"},added:"added",deleted:"deleted",
eventsFlushed:"eventsFlushed",CallbacksBackend:function(a){this.aqt=new Q.AbstractQueryTree;this.engine=a;this.indexMap={};this.observersMap={};this.queriesIndexMap={};this.emptyNotificationsMap={};this.queriesList=[];this.pendingQueries=[];this.matchedQueries=[];this.updateInProgress=null;this.indices="SPOG GP OGS POG GSP OS".split(" ");this.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate",
"object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]};this.callbackCounter=0;this.callbacksMap={};this.callbacksInverseMap={};this.queryCounter=0;this.queriesMap={};this.queriesCallbacksMap={};this.queriesInverseMap={};for(a=0;a<this.indices.length;a++){var b=this.indices[a];this.indexMap[b]={};this.queriesIndexMap[b]={}}}};e.CallbacksBackend.prototype.startGraphModification=function(){this.pendingQueries=[].concat(this.queriesList);
this.matchedQueries=[];null==this.updateInProgress&&(this.updateInProgress={added:[],deleted:[]})};e.CallbacksBackend.prototype.nextGraphModification=function(a,b){this.updateInProgress[a].push(b)};e.CallbacksBackend.prototype.endGraphModification=function(a){var b=this;if(null!=this.updateInProgress){var d=b.updateInProgress;b.updateInProgress=null;this.sendNotification(e.deleted,d[e.deleted],function(){b.sendNotification(e.added,d[e.added],function(){b.sendEmptyNotification(e.eventsFlushed,null,
function(){b.dispatchQueries(function(){a(!0)})})})})}else a(!0)};e.CallbacksBackend.prototype.cancelGraphModification=function(){this.updateInProgress=null};e.CallbacksBackend.prototype.sendNotification=function(a,b,d){for(var e={},f=0;f<b.length;f++){var g=b[f],k;for(k in this.indexMap){var l=this.indexMap[k],s=this.componentOrders[k];this._searchCallbacksInIndex(l,s,a,g,e);0!=this.pendingQueries.length&&(l=this.queriesIndexMap[k],this._searchQueriesInIndex(l,s,g))}}this.dispatchNotifications(e);
null!=d&&d(!0)};e.CallbacksBackend.prototype.sendEmptyNotification=function(a,b,d){for(var e=this.emptyNotificationsMap[a]||[],f=0;f<e.length;f++)e[f](a,b);d()};e.CallbacksBackend.prototype.dispatchNotifications=function(a){for(var b in a){var d=this.callbacksMap[b],f=a[b][e.deleted];if(null!=f)try{d(e.deleted,f)}catch(g){}for(var k in a[b])if(k!=e.deleted)try{d(k,a[b][k])}catch(l){}}};e.CallbacksBackend.prototype._searchCallbacksInIndex=function(a,b,d,e,f){var g=e[1];e=e[0];for(var k=0;k<b.length+
1;k++){for(var l=a._||[],s=[],q=0;q<l.length;q++){var t=l[q];null!=this.callbacksMap[t]&&(f[t]=f[t]||{},f[t][d]=f[t][d]||[],f[t][d].push(e),s.push(t))}a._=s;l=b[k];if(null!=a[""+g[l]])a=a[""+g[l]];else break}};e.CallbacksBackend.prototype.subscribeEmpty=function(a,b){var d=this.emptyNotificationsMap[a]||[];d.push(b);this.emptyNotificationsMap[a]=d};e.CallbacksBackend.prototype.unsubscribeEmpty=function(a,b){var d=this.emptyNotificationsMap[a];null!=d&&(d=C.remove(d,b));this.emptyNotificationsMap[a]=
d};e.CallbacksBackend.prototype.subscribe=function(a,b,d,e,f,g){a=this._tokenizeComponents(a,b,d,e);b={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,b);a=this.engine.normalizeQuad(a,b,!0);b=new U(a);d=this._indexForPattern(b);b=this.componentOrders[d];d=this.indexMap[d];for(e=0;e<b.length;e++){var k=a[b[e]];if("_"===k){null==d._&&(d._=[]);this.callbackCounter++;d._.push(this.callbackCounter);this.callbacksMap[this.callbackCounter]=f;this.callbacksInverseMap[f]=this.callbackCounter;
break}else e===b.length-1?(d[k]=d[k]||{_:[]},this.callbackCounter++,d[k]._.push(this.callbackCounter),this.callbacksMap[this.callbackCounter]=f,this.callbacksInverseMap[f]=this.callbackCounter):(d[k]=d[k]||{},d=d[k])}null!=g&&g(!0)};e.CallbacksBackend.prototype.unsubscribe=function(a){var b=this.callbacksInverseMap[a];null!=b&&(delete this.callbacksInverseMap[a],delete this.callbacksMap[b])};e.CallbacksBackend.prototype._tokenizeComponents=function(a,b,d,f){var g={};null==a?g.subject=e.ANYTHING:0==
a.indexOf("_:")?g.subject={token:"blank",value:a}:g.subject={token:"uri",value:a};g.predicate=null==b?e.ANYTHING:{token:"uri",value:b};g.object=null==d?e.ANYTHING:{token:"uri",value:d};g.graph=null==f?e.ANYTHING:{token:"uri",value:f};return g};e.CallbacksBackend.prototype._indexForPattern=function(a){a=a.indexKey;for(var b=this.indices,d=0;d<b.length;d++)for(var e=b[d],f=this.componentOrders[e],g=0;g<f.length&&!1!==C.include(a,f[g]);g++)if(g==a.length-1)return e;return"SPOG"};e.CallbacksBackend.prototype.observeNode=
function(){var a,b,d,f;4===arguments.length?(a=arguments[0],b=arguments[1],d=arguments[2],f=arguments[3]):(a=arguments[0],b=this.engine.lexicon.defaultGraphUri,d=arguments[1],f=arguments[2]);b="CONSTRUCT { <"+a+"> ?p ?o } WHERE { GRAPH <"+b+"> { <"+a+"> ?p ?o } }";var g=this,k={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,k);var l=[];this.engine.execute(b,function(b,m){if(b){var s=!1,q=function(a,b){if("eventsFlushed"===a&&s){s=!1;try{d(m)}catch(f){}}else if("eventsFlushed"!==a){s=
!0;for(var q=0;q<b.length;q++){var v=b[q],t=y.buildRDFResource(v.subject,l,g.engine,k),A=y.buildRDFResource(v.predicate,l,g.engine,k),v=y.buildRDFResource(v.object,l,g.engine,k);null!=t&&null!=A&&null!=v&&(v=new y.Triple(t,A,v),a===e.added?m.add(v):a===e.deleted&&m.remove(v))}}};g.observersMap[d]=q;g.subscribeEmpty(e.eventsFlushed,q);g.subscribe(a,null,null,null,q,function(){try{d(m)}catch(a){}f&&f(!0)})}else f&&f(!1)})};e.CallbacksBackend.prototype.stopObservingNode=function(a){return(a=this.observersMap[a])?
(this.unsubscribe(a),this.unsubscribeEmpty(e.eventsFlushed,a),!0):!1};e.CallbacksBackend.prototype.observeQuery=function(a,b,d){var e=this.aqt.parseQueryString(a),e=this.aqt.parseSelect(e.units[0]),e=this.aqt.collectBasicTriples(e),f={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,f);var g,k,l,s=this.queryCounter;this.queryCounter++;this.queriesMap[s]=a;this.queriesInverseMap[a]=s;this.queriesList.push(s);this.queriesCallbacksMap[s]=b;for(var q=0;q<e.length;q++){k=e[q];null==k.graph&&
(k.graph=this.engine.lexicon.defaultGraphUriTerm);k=this.engine.normalizeQuad(k,f,!0);g=new U(k);l=this._indexForPattern(g);g=this.componentOrders[l];l=this.queriesIndexMap[l];for(var t=0;t<g.length;t++){var w=k[g[t]];if("string"===typeof w){null==l._&&(l._=[]);l._.push(s);break}else t===g.length-1?(l[w]=l[w]||{_:[]},l[w]._.push(s)):(l[w]=l[w]||{},l=l[w])}}this.engine.execute(a,function(a,d){a?b(d):console.log("ERROR in query callback "+d)});null!=d&&d()};e.CallbacksBackend.prototype.stopObservingQuery=
function(a){var b=this.queriesInverseMap[a];null!=b&&(delete this.queriesInverseMap[a],delete this.queriesMap[b],this.queriesList=C.remove(this.queriesList,b))};e.CallbacksBackend.prototype._searchQueriesInIndex=function(a,b,d){d=d[1];for(var e=0;e<b.length+1;e++){for(var f=a._||[],g=[],k=0;k<f.length;k++){var l=f[k];C.include(this.pendingQueries,l)&&(C.remove(this.pendingQueries,l),this.matchedQueries.push(l));null!=this.queriesMap[l]&&g.push(l)}a._=g;f=b[e];if(null!=a[""+d[f]])a=a[""+d[f]];else break}};
e.CallbacksBackend.prototype.dispatchQueries=function(a){var b=this,d,e,f,g,k={};C.repeat(0,this.matchedQueries.length,function(a,l){d=arguments.callee;f=b.matchedQueries[l._i];null==k[f]?(k[f]=!0,e=b.queriesMap[f],g=b.queriesCallbacksMap[f],C.recur(function(){b.engine.execute(e,function(b,e){if(b)try{g(e)}catch(f){}a(d,l)})})):a(d,l)},function(b){a()})};var f;try{"undefined"==typeof Worker&&(Worker=null)}catch(g){Worker=null}Worker&&(f=function(a,b,d){console.log("trying to load "+a);this.connection=
Worker.Worker?new Worker.Worker(a):new Worker(a);this.callbacksCounter=1;var e=this;this.rdf=y.rdf;console.log("The worker");console.log(this.connection);e=this;this.connection.onmessage=function(a){e.receive(a)};this.observingCallbacks={};this.callbacks={0:{cb:function(a,b){!0===a?d(!0,e):d(!1,b)},fn:"create"}};this.connection.postMessage({fn:"create",args:b,callback:"0"})},f.prototype.receive=function(a){a=a.data||a;if("workerRequest:NetworkTransport:load"===a.fn){var b=this,d=a.callback;a=a.arguments.concat(function(a,
e){b.connection.postMessage({fn:"workerRequestResponse",results:[a,e],callback:d})});K.load.apply(K,a)}else{var e=this.callbacks[a.callback];e&&("create"===e.fn||"execute"===e.fn||"insert"===e.fn||"graph"==e.fn||"node"===e.fn||"insert"===e.fn||"delete"===e.fn||"clear"===e.fn||"load"===e.fn||"startObservingQueryEndCb"===e.fn||"registeredGraphs"===e.fn?(delete this.callbacks[a.callback],e.cb(a.success,a.result)):"startObservingQuery"===e.fn?e.cb(a.result):"startObservingNode"===e.fn?e.cb(a.result):
"subscribe"===e.fn&&e.cb(a.event,a.result))}},f.prototype.registerCallback=function(a,b){var d=""+this.callbacksCounter;this.callbacks[d]={fn:a,cb:b};this.callbacksCounter++;return d},f.prototype.execute=function(){if(3===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2]);else if(4===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]);else{var a,b;1===arguments.length?(a=arguments[0],b=function(){}):2===arguments.length&&
(a=arguments[0],b=arguments[1]);b=this.registerCallback("execute",b);this.connection.postMessage({fn:"execute",args:[a],callback:b})}},f.prototype.insert=function(){var a,b,d;if(1===arguments.length)b=arguments[0],this.connection.postMessage({fn:"insert",args:[b]});else if(2===arguments.length)b=arguments[0],d=arguments[1]||function(){},d=this.registerCallback("insert",d),this.connection.postMessage({fn:"insert",args:[b],callback:d});else if(3===arguments.length)b=arguments[0],a=arguments[1],d=arguments[2]||
function(){},d=this.registerCallback("insert",d),this.connection.postMessage({fn:"insert",args:[b,a],callback:d});else throw"The triples to insert, an optional graph and callback must be provided";},f.prototype.graph=function(){var a=null,b=null;if(1===arguments.length)b=arguments[0]||function(){};else if(2===arguments.length)b=arguments[1]||function(){},a=arguments[0];else throw"An optional graph URI and a callback function must be provided";var d=this,e=this.registerCallback("insert",function(a,
e){if(a){for(var f,g=0;g<e.triples.length;g++)f=e.triples[g],e.triples[g]=new y.Triple(d.adaptJSInterface(f.subject),d.adaptJSInterface(f.predicate),d.adaptJSInterface(f.object));b(a,d.rdf.createGraph(e.triples))}else b(a,e)});null==a?this.connection.postMessage({fn:"graph",args:[],callback:e}):this.connection.postMessage({fn:"graph",args:[a],callback:e})},f.prototype.node=function(){var a=null,b=null,d=null;if(2===arguments.length)d=arguments[0],b=arguments[1]||function(){};else if(3===arguments.length)d=
arguments[0],a=arguments[1],b=arguments[2]||function(){};else throw"An optional graph URI and a callback function must be provided";var e=this,f=this.registerCallback("insert",function(a,d){if(a){for(var f,g=0;g<d.triples.length;g++)f=d.triples[g],d.triples[g]=new y.Triple(e.adaptJSInterface(f.subject),e.adaptJSInterface(f.predicate),e.adaptJSInterface(f.object));b(a,e.rdf.createGraph(d.triples))}else b(a,d)});null==a?this.connection.postMessage({fn:"node",args:[d],callback:f}):this.connection.postMessage({fn:"node",
args:[d,a],callback:f})},f.prototype.setPrefix=function(a,b){this.rdf.setPrefix(a,b);this.connection.postMessage({fn:"rdf/setPrefix",args:[a,b],callback:null})},f.prototype.setDefaultPrefix=function(a){this.rdf.setDefaultPrefix(a);this.connection.postMessage({fn:"rdf/setDefaultPrefix",args:[a],callback:null})},f.prototype["delete"]=function(){var a,b,d;if(1===arguments.length)b=arguments[0],this.connection.postMessage({fn:"delete",args:[b]});else if(2===arguments.length)b=arguments[0],d=arguments[1]||
function(){},d=this.registerCallback("delete",d),this.connection.postMessage({fn:"delete",args:[b],callback:d});else if(3===arguments.length)b=arguments[0],a=arguments[1],d=arguments[2]||function(){},d=this.registerCallback("delete",d),this.connection.postMessage({fn:"delete",args:[b,a],callback:d});else throw"The triples to delete, an optional graph and callback must be provided";},f.prototype.clear=function(){var a,b;if(1===arguments.length)b=arguments[0]||function(){},b=this.registerCallback("clear",
b),this.connection.postMessage({fn:"clear",args:[],callback:b});else if(2===arguments.length)a=arguments[0],b=arguments[1]||function(){},b=this.registerCallback("clear",b),this.connection.postMessage({fn:"clear",args:[a],callback:b});else throw"The optional graph and a callback must be provided";},f.prototype.setBatchLoadEvents=function(a){this.connection.postMessage({fn:"setBatchLoadEvents",args:[a]})},f.prototype.registerDefaultNamespace=function(a,b){this.connection.postMessage({fn:"registerDefaultNamespace",
args:[a,b]})},f.prototype.registerDefaultProfileNamespaces=function(){this.connection.postMessage({fn:"registerDefaultProfileNamespaces",args:[]})},f.prototype.load=function(){var a,b,d,e;if(3===arguments.length)a=arguments[0],b=arguments[1],e=arguments[2]||function(){},e=this.registerCallback("load",e),this.connection.postMessage({fn:"load",args:[a,b],callback:e});else if(4===arguments.length)a=arguments[0],b=arguments[1],d=arguments[2],e=arguments[3]||function(){},e=this.registerCallback("load",
e),this.connection.postMessage({fn:"load",args:[a,b,d],callback:e});else if(2===arguments.length)throw"The mediaType of the parser, the data a callback and an optional graph must be provided";},f.prototype.startObservingQuery=function(a,b,d){null!=d?(b=this.registerCallback("startObservingQuery",b),this.observingCallbacks[a]=b,d=this.registerCallback("startObservingQueryEndCb",d),this.connection.postMessage({fn:"startObservingQuery",args:[a],callback:[b,d]})):(b=this.registerCallback("startObservingQuery",
b),this.observingCallbacks[a]=b,this.connection.postMessage({fn:"startObservingQuery",args:[a],callback:[b]}))},f.prototype.stopObservingQuery=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a];delete this.callbacks[b];this.connection.postMessage({fn:"stopObservingQuery",args:[a],callback:[]})},f.prototype.startObservingNode=function(){var a,b,d;if(2===arguments.length){a=arguments[0];d=arguments[1];var e=this,f=function(a){for(var b,f=0;f<a.triples.length;f++)b=a.triples[f],
a.triples[f]=new y.Triple(e.adaptJSInterface(b.subject),e.adaptJSInterface(b.predicate),e.adaptJSInterface(b.object));d(e.rdf.createGraph(a.triples))},f=this.registerCallback("startObservingNode",f);this.observingCallbacks[d]=f;this.connection.postMessage({fn:"startObservingNode",args:[a],callback:f})}else 3===arguments.length&&(a=arguments[0],b=arguments[1],d=arguments[2],e=this,f=function(a){for(var b,f=0;f<a.triples.length;f++)b=a.triples[f],a.triples[f]=new y.Triple(e.adaptJSInterface(b.subject),
e.adaptJSInterface(b.predicate),e.adaptJSInterface(b.object));d(e.rdf.createGraph(a.triples))},f=this.registerCallback("startObservingNode",f),this.observingCallbacks[d]=f,this.connection.postMessage({fn:"startObservingNode",args:[a,b],callback:f}))},f.prototype.stopObservingNode=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a];delete this.callbacks[b];this.connection.postMessage({fn:"stopObservingNode",args:[b],callback:[]})},f.prototype.subscribe=function(a,b,d,e,f){var g=
this,k=this.registerCallback("subscribe",function(a,b){for(var d,e=0;e<b.length;e++)d=b[e],b[e]=new y.Triple(g.adaptJSInterface(d.subject),g.adaptJSInterface(d.predicate),g.adaptJSInterface(d.object));f(a,b)});this.observingCallbacks[f]=k;this.connection.postMessage({fn:"subscribe",args:[a,b,d,e],callback:k})},f.prototype.unsubscribe=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a];delete this.callbacks[b];this.connection.postMessage({fn:"unsubscribe",args:[b],callback:[]})},
f.prototype.registeredGraphs=function(a){var b=this,d=this.registerCallback("registeredGraphs",function(d,e){if(d)for(var f=0;f<e.length;f++)e[f]=b.adaptJSInterface(e[f]);a(d,e)});this.connection.postMessage({fn:"registeredGraphs",args:[],callback:d})},f.prototype.adaptJSInterface=function(a){if("BlankNode"===a.interfaceName)return new y.BlankNode(a.bnodeId);if("Literal"===a.interfaceName)return new y.Literal(a.nominalValue,a.language,a.datatype);if("NamedNode"===a.interfaceName)return new y.NamedNode(a.nominalValue)},
f.prototype.isWebWorkerConnection=!0);var k={},l=function(){throw"MongoDB backend not supported in the browser version";};k.VERSION="0.8.1";k.connect=function(){var a,b,d;1==arguments.length?(a=__dirname,b={},d=arguments[0]):2==arguments.length?("string"===typeof arguments[0]?(a=arguments[0],b={}):(a=__dirname+"/index.js",b=arguments[0]),d=arguments[1]):(a=arguments[0],b=arguments[1],d=arguments[2]);try{Worker?new f(a,b,function(a,b){d(a,b)}):k.create(b,function(a){d(!1,a)})}catch(e){k.create(b,function(a){d(!1,
a)})}};k.create=function(){return 1==arguments.length?new k.Store(arguments[0]):2==arguments.length?new k.Store(arguments[0],arguments[1]):new k.Store};k.Store=function(a,b){var e=null,f=null;if(0==arguments.length)f={};else if(1==arguments.length)f={},e=a;else if(1<arguments.length)f=a,e=b;else throw"An optional argument map and a callback must be provided";null==f.treeOrder&&(f.treeOrder=15);this.functionMap={};var g=this;this.customFns={};"mongodb"===f.engine?(this.isMongodb=!0,this.engine=new l(f),
this.engine.readConfiguration(function(){!0===f.overwrite?g.engine.clean(function(){e(g)}):e(g)})):new H(function(a){!0===f.overwrite&&a.clear();new N(f,function(b){!0===f.overwrite&&b.clear();f.backend=b;f.lexicon=a;g.engine=new d(f);e&&e(g)})},f.name)};k.Store.prototype.rdf=y.rdf;k.Store.prototype.rdf.api=y;k.Store.prototype.registerCustomFunction=function(a,b){this.customFns[a]=b;this.engine.setCustomFunctions(this.customFns)};k.Store.prototype.execute=function(){if(3===arguments.length)this.executeWithEnvironment(arguments[0],
arguments[1],arguments[2]);else if(4===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]);else{var a,b;1===arguments.length?(a=arguments[0],b=function(){}):2===arguments.length&&(a=arguments[0],b=arguments[1]);this.engine.execute(a,b)}};k.Store.prototype.executeWithEnvironment=function(){var a,b,d;if(3===arguments.length){a=arguments[0];var e=function(){};b=arguments[1];d=arguments[2]}else 4===arguments.length&&(a=arguments[0],e=arguments[3],b=arguments[1],
d=arguments[2]);for(var f=[],g=[],k=0;k<b.length;k++)f.push({token:"uri",value:b[k]});for(k=0;k<d.length;k++)g.push({token:"uri",value:d[k]});this.engine.execute(a,e,f,g)};k.Store.prototype.graph=function(){var a=null,b=null;if(1===arguments.length)b=arguments[0]||function(){},a=this.engine.lexicon.defaultGraphUri;else if(2===arguments.length)b=arguments[1]||function(){},a=arguments[0];else throw"An optional graph URI and a callback function must be provided";null!=this.rdf.resolve(a)&&(a=this.rdf.resolve(a));
this.engine.execute("CONSTRUCT { ?s ?p ?o } WHERE { GRAPH <"+a+"> { ?s ?p ?o } }",b)};k.Store.prototype.node=function(){var a=null,b=null,d=null;if(2===arguments.length)d=arguments[0],b=arguments[1]||function(){},a=this.engine.lexicon.defaultGraphUri;else if(3===arguments.length)d=arguments[0],a=arguments[1],b=arguments[2]||function(){};else throw"An optional graph URI, node URI and a callback function must be provided";null!=this.rdf.resolve(a)&&(a=this.rdf.resolve(a));null!=this.rdf.resolve(d)&&
(d=this.rdf.resolve(d));this.engine.execute("CONSTRUCT { <"+d+"> ?p ?o } WHERE { GRAPH <"+a+"> { <"+d+"> ?p ?o } }",b)};k.Store.prototype.startObservingNode=function(){var a,b,d;2===arguments.length?(a=arguments[0],d=arguments[1],this.engine.callbacksBackend.observeNode(a,d,function(){})):3===arguments.length&&(a=arguments[0],b=arguments[1],d=arguments[2],this.engine.callbacksBackend.observeNode(a,b,d,function(){}))};k.Store.prototype.stopObservingNode=function(a){this.engine.callbacksBackend.stopObservingNode(a)};
k.Store.prototype.startObservingQuery=function(a,b,d){null!=d?this.engine.callbacksBackend.observeQuery(a,b,d):this.engine.callbacksBackend.observeQuery(a,b,function(){})};k.Store.prototype.stopObservingQuery=function(a){this.engine.callbacksBackend.stopObservingQuery(a)};k.Store.prototype.subscribe=function(a,b,d,e,f){var g=this,k=function(a,b){for(var d=[],e={blanks:{},outCache:{}},k=[],m=0;m<b.length;m++){var l=b[m],n=y.buildRDFResource(l.subject,k,g.engine,e),s=y.buildRDFResource(l.predicate,
k,g.engine,e),l=y.buildRDFResource(l.object,k,g.engine,e);null!=n&&null!=s&&null!=l&&(l=new y.Triple(n,s,l),d.push(l))}f(a,d)};this.functionMap[f]=k;this.engine.callbacksBackend.subscribe(a,b,d,e,k,function(){})};k.Store.prototype.unsubscribe=function(a){this.engine.callbacksBackend.unsubscribe(this.functionMap[a]);delete this.functionMap[a]};k.Store.prototype.setPrefix=function(a,b){this.rdf.setPrefix(a,b)};k.Store.prototype.setDefaultPrefix=function(a){this.rdf.setDefaultPrefix(a)};k.Store.prototype.insert=
function(){var a,b,d;if(1===arguments.length)b=arguments[0];else if(2===arguments.length)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0],d=arguments[1]||function(){};else if(3===arguments.length)b=arguments[0],a=this.rdf.createNamedNode(arguments[1]),d=arguments[2]||function(){};else throw"The triples to insert, an optional graph and callback must be provided";var e="",f=this;b.forEach(function(a){e=e+f._nodeToQuery(a.subject)+f._nodeToQuery(a.predicate)+f._nodeToQuery(a.object)+
"."});e=null!=a?"INSERT DATA { GRAPH "+this._nodeToQuery(a)+" { "+e+" } }":"INSERT DATA { "+this._nodeToQuery(a)+" { "+e+" }";this.engine.execute(e,d)};k.Store.prototype._nodeToQuery=function(a){if("NamedNode"===a.interfaceName){var b=this.rdf.resolve(a.valueOf());return null!=b?"<"+b+">":"<"+a.valueOf()+">"}if(""!==a.interfaceName){if(null!=a.lang)return'"'+a.valueOf()+'"@'+a.lang;if(null!=a.datatype)return'"'+a.valueOf()+'"^^<'+a.datatype+">"}return a.toString()};k.Store.prototype["delete"]=function(){var a,
b,d;if(1===arguments.length)b=arguments[0];else if(2===arguments.length)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0],d=arguments[1]||function(){};else if(3===arguments.length)b=arguments[0],a=this.rdf.createNamedNode(arguments[1]),d=arguments[2]||function(){};else throw"The triples to delete, an optional graph and callback must be provided";var e="",f=this;b.forEach(function(a){e=e+f._nodeToQuery(a.subject)+f._nodeToQuery(a.predicate)+f._nodeToQuery(a.object)+"."});
e=null!=a?"DELETE DATA { GRAPH "+this._nodeToQuery(a)+" { "+e+" } }":"DELETE DATA { "+this._nodeToQuery(a)+" { "+e+" }";this.engine.execute(e,d)};k.Store.prototype.clear=function(){var a,b;if(0===arguments.length)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=function(){};else if(1===arguments.length)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0]||function(){};else if(2===arguments.length)a=this.rdf.createNamedNode(arguments[0]),b=arguments[1]||function(){};
else throw"The optional graph and a callback must be provided";a="CLEAR GRAPH "+this._nodeToQuery(a);this.engine.execute(a,b)};k.Store.prototype.setBatchLoadEvents=function(a){this.engine.eventsOnBatchLoad=a};k.Store.prototype.registerDefaultNamespace=function(a,b){this.rdf.prefixes.set(a,b);this.engine.registerDefaultNamespace(a,b)};k.Store.prototype.registerDefaultProfileNamespaces=function(){var a=this.rdf.prefixes.values(),b;for(b in a)this.registerDefaultNamespace(b,a[b])};k.Store.prototype.load=
function(){var a,b,d,e,f={};if(3===arguments.length)d=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),a=arguments[0],b=arguments[1],e=arguments[2]||function(){};else if(4===arguments.length)a=arguments[0],b=arguments[1],f=arguments[2],"string"===typeof f?(d=this.rdf.createNamedNode(f),f={}):(d=this.rdf.createNamedNode(f.graph||this.engine.lexicon.defaultGraphUri),delete f.graph),e=arguments[3]||function(){};else if(2===arguments.length)throw"The mediaType of the parser, the data a callback and an optional graph must be provided";
if("remote"===a)b=this.rdf.createNamedNode(b),this.engine.execute("LOAD <"+b.valueOf()+"> INTO GRAPH <"+d.valueOf()+">",e);else if(b&&"string"===typeof b&&0===b.indexOf("file://")){a=this.engine.rdfLoader.parsers[a];var g=this;this.engine.rdfLoader.loadFromFile(a,{token:"uri",value:d.valueOf()},b,function(a,b){a?g.engine.batchLoad(b,e):e(a,b)})}else a=this.engine.rdfLoader.parsers[a],g=this,this.engine.rdfLoader.tryToParse(a,{token:"uri",value:d.valueOf()},b,f,function(a,b){a?g.engine.batchLoad(b,
e):e(a,b)})};k.Store.prototype.registerParser=function(a,b){this.engine.rdfLoader.registerParser(a,b)};k.Store.prototype.registeredGraphs=function(a){if(this.isMongodb)this.engine.registeredGraphs(!0,function(b){for(var d=[],e=0;e<b.length;e++){var f=new y.NamedNode(b[e]);d.push(f)}return a(!0,d)});else{for(var b=this.engine.lexicon.registeredGraphs(!0),d=[],e=0;e<b.length;e++){var f=new y.NamedNode(b[e]);d.push(f)}return a(!0,d)}};k.Store.prototype._nodeToQuery=function(a){if("NamedNode"===a.interfaceName){var b=
this.rdf.resolve(a.valueOf());return null!=b?"<"+b+">":"<"+a.valueOf()+">"}return a.toString()};k.Store.prototype.getNetworkTransport=function(){return K};k.Store.prototype.setNetworkTransport=function(a){K=a};k.Store.prototype.close=function(a){null==a&&(a=function(){});this.engine.close?this.engine.close(a):a()};RDFStoreWorker={observingCallbacks:{},workerCallbacksCounter:0,workerCallbacks:{},registerCallback:function(a){var b=""+RDFStoreWorker.workerCallbacksCounter;RDFStoreWorker.workerCallbacksCounter++;
RDFStoreWorker.workerCallbacks[b]=a;return b},handleCreate:function(a,b){"undefined"!=typeof K&&null!=K&&(K={load:function(a,b,d){var e=RDFStoreWorker.registerCallback(function(a){d.apply(d,a)});postMessage({fn:"workerRequest:NetworkTransport:load",callback:e,arguments:[a,b]})},loadFromFile:function(a,b,d,e){}});var d=[a];d.push(function(a){RDFStoreWorker.store=a;postMessage({callback:b,result:"created",success:!0})});k.create.apply(k,d)},receive:function(a){var b=a.data||a;if("workerRequestResponse"===
b.fn){var d=b.callback,e=RDFStoreWorker.workerCallbacks[d];null!=e&&(delete RDFStoreWorker.workerCallbacks[d],e(b.results))}else if("create"===b.fn&&null!=b.args)RDFStoreWorker.handleCreate(b.args,b.callback);else if("setBatchLoadEvents"===b.fn)RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if("registerDefaultNamespace"===b.fn)RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if("registerDefaultProfileNamespaces"===b.fn)RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,
b.args);else if("execute"!==b.fn&&"executeWithEnvironment"!==b.fn&&"graph"!==b.fn&&"node"!==b.fn&&"clear"!==b.fn&&"load"!==b.fn||null==b.args)if("insert"!==b.fn&&"delete"!==b.fn||null==b.args)"rdf/setPrefix"===b.fn&&null!=b.args?RDFStoreWorker.store.rdf.setPrefix(b.args[0],b.args[1]):"rdf/setDefaultPrefix"===b.fn&&null!=b.args?RDFStoreWorker.store.rdf.setDefaultPrefix(b.args[0]):"startObservingQuery"===b.fn&&null!=b.args?(d=function(a,d){postMessage({callback:b.callback[0],result:d,success:a})},RDFStoreWorker.observingCallbacks[b.args[0]]=
d,b.args.push(d),b.args.push(function(a,d){b.callback&&null!=b.callback[1]&&postMessage({callback:b.callback[1],result:d,success:a})}),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)):"stopObservingQuery"===b.fn?((d=RDFStoreWorker.observingCallbacks[b.args[0]])&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[d]),delete RDFStoreWorker.observingCallbacks[b.args[0]]):"startObservingNode"===b.fn&&null!=b.args?(d=function(a){postMessage({callback:b.callback,result:a})},RDFStoreWorker.observingCallbacks[b.callback]=
d,b.args.push(d),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)):"stopObservingNode"===b.fn&&null!=b.args?((d=RDFStoreWorker.observingCallbacks[b.args[0]])&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[d]),delete RDFStoreWorker.observingCallbacks[b.args[0]]):"subscribe"===b.fn&&null!=b.args?(d=function(a,d){postMessage({callback:b.callback,event:a,result:d})},RDFStoreWorker.observingCallbacks[b.callback]=d,b.args.push(d),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,
b.args)):"stopObservingNode"===b.fn&&null!=b.args?((d=RDFStoreWorker.observingCallbacks[b.args[0]])&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[d]),delete RDFStoreWorker.observingCallbacks[b.args[0]]):"registeredGraphs"===b.fn&&null!=b.args&&(d=function(a,d){null!=b.callback&&postMessage({callback:b.callback,result:d,success:a})},RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[d]));else try{b.args.push(function(a,d){null!=b.callback&&postMessage({callback:b.callback,result:d,success:a})});
e=b.args[0];for(a=0;a<e.triples.length;a++)d=e.triples[a],e.triples[a]=new y.Triple(RDFStoreWorker.adaptJSInterface(d.subject),RDFStoreWorker.adaptJSInterface(d.predicate),RDFStoreWorker.adaptJSInterface(d.object));null!=b.args[1].interfaceName&&(b.args[1]=RDFStoreWorker.adaptJSInterface(b.args[1]));b.args[0]=RDFStoreWorker.store.rdf.createGraph(e.triples);RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}catch(g){console.log("Error executing method through connection"),console.log(g)}else{b.args.push(function(a,
d){null!=b.callback&&postMessage({callback:b.callback,result:d,success:a})});try{RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}catch(f){console.log("Error executing method through connection"),console.log(f)}}},adaptJSInterface:function(a){if("BlankNode"===a.interfaceName)return new y.BlankNode(a.bnodeId);if("Literal"===a.interfaceName)return new y.Literal(a.nominalValue,a.language,a.datatype);if("NamedNode"===a.interfaceName)return new y.NamedNode(a.nominalValue)}};onmessage=RDFStoreWorker.receive;
try{window.rdfstore=k}catch(s){}})();(function(){this.$jit=function(b){b=b||window;for(var d in $jit)$jit[d].$extend&&(b[d]=$jit[d])};$jit.version="2.0.1";var q=function(b){return document.getElementById(b)};q.empty=function(){};q.extend=function(b,d){for(var e in d||{})b[e]=d[e];return b};q.lambda=function(b){return"function"==typeof b?b:function(){return b}};q.time=Date.now||function(){return+new Date};q.splat=function(b){var d=q.type(b);return d?"array"!=d?[b]:b:[]};q.type=function(b){var d=q.type.s.call(b).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
return"object"!=d?d:b&&b.$$family?b.$$family:b&&9==b.nodeType?"htmldocument":b&&b.nodeName&&1==b.nodeType?"element":d};q.type.s=Object.prototype.toString;q.each=function(b,d){if("object"==q.type(b))for(var e in b)d(b[e],e);else{e=0;for(var f=b.length;e<f;e++)d(b[e],e)}};q.indexOf=function(b,d){if(b.indexOf)return b.indexOf(d);for(var e=0,f=b.length;e<f;e++)if(b[e]===d)return e;return-1};q.map=function(b,d){var e=[];q.each(b,function(b,g){e.push(d(b,g))});return e};q.reduce=function(b,d,e){var f=b.length;
if(0==f)return e;for(var g=3==arguments.length?e:b[--f];f--;)g=d(g,b[f]);return g};q.merge=function(){for(var b={},d=0,e=arguments.length;d<e;d++){var f=arguments[d];if("object"==q.type(f))for(var g in f){var k=f[g],l=b[g];b[g]=l&&"object"==q.type(k)&&"object"==q.type(l)?q.merge(l,k):q.unlink(k)}}return b};q.unlink=function(b){var d;switch(q.type(b)){case "object":d={};for(var e in b)d[e]=q.unlink(b[e]);break;case "array":d=[];e=0;for(var f=b.length;e<f;e++)d[e]=q.unlink(b[e]);break;default:return b}return d};
q.zip=function(){if(0===arguments.length)return[];for(var b=0,d=[],e=arguments.length,f=arguments[0].length;b<f;b++){for(var g=0,k=[];g<e;g++)k.push(arguments[g][b]);d.push(k)}return d};q.rgbToHex=function(b,d){if(3>b.length)return null;if(4==b.length&&0==b[3]&&!d)return"transparent";for(var e=[],f=0;3>f;f++){var g=(b[f]-0).toString(16);e.push(1==g.length?"0"+g:g)}return d?e:"#"+e.join("")};q.hexToRgb=function(b){if(7!=b.length){b=b.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);b.shift();if(3!=b.length)return null;
for(var d=[],e=0;3>e;e++){var f=b[e];1==f.length&&(f+=f);d.push(parseInt(f,16))}return d}b=parseInt(b.slice(1),16);return[b>>16,b>>8&255,b&255]};q.destroy=function(b){q.clean(b);b.parentNode&&b.parentNode.removeChild(b);b.clearAttributes&&b.clearAttributes()};q.clean=function(b){b=b.childNodes;for(var d=0,e=b.length;d<e;d++)q.destroy(b[d])};q.addEvent=function(b,d,e){b.addEventListener?b.addEventListener(d,e,!1):b.attachEvent("on"+d,e)};q.addEvents=function(b,d){for(var e in d)q.addEvent(b,e,d[e])};
q.hasClass=function(b,d){return-1<(" "+b.className+" ").indexOf(" "+d+" ")};q.addClass=function(b,d){q.hasClass(b,d)||(b.className=b.className+" "+d)};q.removeClass=function(b,d){b.className=b.className.replace(new RegExp("(^|\\s)"+d+"(?:\\s|$)"),"$1")};q.getPos=function(b){var d=function(b){for(var d={x:0,y:0};b&&!/^(?:body|html)$/i.test(b.tagName);)d.x+=b.offsetLeft,d.y+=b.offsetTop,b=b.offsetParent;return d}(b);b=function(b){for(var d={x:0,y:0};b&&!/^(?:body|html)$/i.test(b.tagName);)d.x+=b.scrollLeft,
d.y+=b.scrollTop,b=b.parentNode;return d}(b);return{x:d.x-b.x,y:d.y-b.y}};q.getDir=function(b){b=document.getElementById(b)||document.body;if(b.currentStyle)var d=b.currentStyle.direction;else window.getComputedStyle&&(d=document.defaultView.getComputedStyle(b,null).getPropertyValue("direction"));return d};q.event={get:function(b,d){d=d||window;return b||d.event},getWheel:function(b){return b.wheelDelta?b.wheelDelta/120:-(b.detail||0)/3},isRightClick:function(b){return 3==b.which||2==b.button},getPos:function(b,
d){d=d||window;b=b||d.event;var e=d.document,e=e.documentElement||e.body;b.touches&&b.touches.length&&(b=b.touches[0]);return{x:b.pageX||b.clientX+e.scrollLeft,y:b.pageY||b.clientY+e.scrollTop}},stop:function(b){b.stopPropagation&&b.stopPropagation();b.cancelBubble=!0;b.preventDefault?b.preventDefault():b.returnValue=!1}};$jit.util=$jit.id=q;var w=function(b){b=b||{};var d=function(){for(var b in this)"function"!=typeof this[b]&&(this[b]=q.unlink(this[b]));this.constructor=d;if(w.prototyping)return this;
b=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return b},e;for(e in w.Mutators)b[e]&&(b=w.Mutators[e](b,b[e]),delete b[e]);q.extend(d,this);d.constructor=w;d.prototype=b;return d};w.Mutators={Implements:function(b,d){q.each(q.splat(d),function(d){w.prototyping=d;d="function"==typeof d?new d:d;for(var f in d)f in b||(b[f]=d[f]);delete w.prototyping});return b}};q.extend(w,{inherit:function(b,d){for(var e in d){var f=d[e],g=b[e],k=q.type(f);g&&"function"==k?f!=g&&
w.override(b,e,f):b[e]="object"==k?q.merge(g,f):f}return b},override:function(b,d,e){var f=w.prototyping;f&&b[d]!=f[d]&&(f=null);b[d]=function(){var g=this.parent;this.parent=f?f[d]:b[d];var k=e.apply(this,arguments);this.parent=g;return k}}});w.prototype.implement=function(){var b=this.prototype;q.each(Array.prototype.slice.call(arguments||[]),function(d){w.inherit(b,d)});return this};$jit.Class=w;$jit.json={prune:function(b,d){this.each(b,function(b,f){f==d&&b.children&&(delete b.children,b.children=
[])})},getParent:function(b,d){if(b.id==d)return!1;var e=b.children;if(e&&0<e.length)for(var f=0;f<e.length;f++){if(e[f].id==d)return b;var g=this.getParent(e[f],d);if(g)return g}return!1},getSubtree:function(b,d){if(b.id==d)return b;for(var e=0,f=b.children;f&&e<f.length;e++){var g=this.getSubtree(f[e],d);if(null!=g)return g}return null},eachLevel:function(b,d,e,f){if(d<=e&&(f(b,d),b.children)){var g=0;for(b=b.children;g<b.length;g++)this.eachLevel(b[g],d+1,e,f)}},each:function(b,d){this.eachLevel(b,
0,Number.MAX_VALUE,d)}};$jit.Trans={$extend:!0,linear:function(b){return b}};var F=$jit.Trans;(function(){var b=function(b,e){e=q.splat(e);return q.extend(b,{easeIn:function(f){return b(f,e)},easeOut:function(f){return 1-b(1-f,e)},easeInOut:function(f){return.5>=f?b(2*f,e)/2:(2-b(2*(1-f),e))/2}})};q.each({Pow:function(b,e){return Math.pow(b,e[0]||6)},Expo:function(b){return Math.pow(2,8*(b-1))},Circ:function(b){return 1-Math.sin(Math.acos(b))},Sine:function(b){return 1-Math.sin((1-b)*Math.PI/2)},
Back:function(b,e){e=e[0]||1.618;return Math.pow(b,2)*((e+1)*b-e)},Bounce:function(b){for(var e=0,f=1;;e+=f,f/=2)if(b>=(7-4*e)/11){b=f*f-Math.pow((11-6*e-11*b)/4,2);break}return b},Elastic:function(b,e){return Math.pow(2,10*--b)*Math.cos(20*b*Math.PI*(e[0]||1)/3)}},function(d,e){F[e]=b(d)});q.each(["Quad","Cubic","Quart","Quint"],function(d,e){F[d]=b(function(b){return Math.pow(b,[e+2])})})})();var C=new w({initialize:function(b){this.setOptions(b)},setOptions:function(b){this.opt=q.merge({duration:2500,
fps:40,transition:F.Quart.easeInOut,compute:q.empty,complete:q.empty,link:"ignore"},b||{});return this},step:function(){var b=q.time(),d=this.opt;b<this.time+d.duration?(b=d.transition((b-this.time)/d.duration),d.compute(b)):(this.timer=clearInterval(this.timer),d.compute(1),d.complete())},start:function(){if(!this.check())return this;this.time=0;this.startTimer();return this},startTimer:function(){var b=this,d=this.opt.fps;if(this.timer)return!1;this.time=q.time()-this.time;this.timer=setInterval(function(){b.step()},
Math.round(1E3/d));return!0},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer)return!1;this.time=q.time()-this.time;this.timer=clearInterval(this.timer);return!0},check:function(){return this.timer?"cancel"==this.opt.link?(this.stopTimer(),!0):!1:!0}}),J=function(){for(var b=arguments,d=0,e=b.length,f={};d<e;d++){var g=J[b[d]];g.$extend?q.extend(f,g):f[b[d]]=g}return f};J.AreaChart={$extend:!0,animate:!0,labelOffset:3,
type:"stacked",Tips:{enable:!1,onShow:q.empty,onHide:q.empty},Events:{enable:!1,onClick:q.empty},selectOnHover:!0,showAggregates:!0,showLabels:!0,filterOnClick:!1,restoreOnRightClick:!1};J.Margin={$extend:!1,top:0,left:0,right:0,bottom:0};J.Canvas={$extend:!0,injectInto:"id",type:"2D",width:!1,height:!1,useCanvas:!1,withLabels:!0,background:!1,Scene:{Lighting:{enable:!1,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}};J.Tree={$extend:!0,orientation:"left",subtreeOffset:8,
siblingOffset:5,indent:10,multitree:!1,align:"center",levelSpacing:"even"};J.Node={$extend:!1,overridable:!1,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:!1,autoWidth:!1,lineWidth:1,transform:!0,align:"center",angularWidth:1,span:1,CanvasStyles:{}};J.Edge={$extend:!1,overridable:!1,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};J.Fx={$extend:!0,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:!0};J.Label={$extend:!1,overridable:!1,
type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};J.Tips={$extend:!1,enable:!1,type:"auto",offsetX:20,offsetY:20,force:!1,onShow:q.empty,onHide:q.empty};J.NodeStyles={$extend:!1,enable:!1,type:"auto",stylesHover:!1,stylesClick:!1};J.Events={$extend:!1,enable:!1,enableForEdges:!1,type:"auto",onClick:q.empty,onRightClick:q.empty,onMouseMove:q.empty,onMouseEnter:q.empty,onMouseLeave:q.empty,onDragStart:q.empty,onDragMove:q.empty,onDragCancel:q.empty,
onDragEnd:q.empty,onTouchStart:q.empty,onTouchMove:q.empty,onTouchEnd:q.empty,onTouchCancel:q.empty,onMouseWheel:q.empty};J.Navigation={$extend:!1,enable:!1,type:"auto",panning:!1,zooming:!1};J.Controller={$extend:!0,onBeforeCompute:q.empty,onAfterCompute:q.empty,onCreateLabel:q.empty,onPlaceLabel:q.empty,onComplete:q.empty,onBeforePlotLine:q.empty,onAfterPlotLine:q.empty,onBeforePlotNode:q.empty,onAfterPlotNode:q.empty,onBeforeRemoveNode:q.empty,request:!1};var I={initialize:function(b,d){this.viz=
d;this.canvas=d.canvas;this.config=d.config[b];this.nodeTypes=d.fx.nodeTypes;var e=this.config.type;this.labelContainer=(this.dom="auto"==e?"Native"!=d.config.Label.type:"Native"!=e)&&d.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:q.empty,setAsProperty:q.lambda(!1),isEnabled:function(){return this.config.enable},isLabel:function(b,d,e){b=q.event.get(b,d);d=this.labelContainer;var f=b.target||b.srcElement;b=b.relatedTarget;return e?b&&b==this.viz.canvas.getCtx().canvas&&
!!f&&this.isDescendantOf(f,d):this.isDescendantOf(f,d)},isDescendantOf:function(b,d){for(;b&&b.parentNode;){if(b.parentNode==d)return b;b=b.parentNode}return!1}},V={onMouseUp:q.empty,onMouseDown:q.empty,onMouseMove:q.empty,onMouseOver:q.empty,onMouseOut:q.empty,onMouseWheel:q.empty,onTouchStart:q.empty,onTouchMove:q.empty,onTouchEnd:q.empty,onTouchCancel:q.empty},U=new w({initialize:function(b){this.viz=b;this.canvas=b.canvas;this.edge=this.node=!1;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var b=
this.canvas.getElement(),d=this;b.oncontextmenu=q.lambda(!1);q.addEvents(b,{mouseup:function(b,e){var k=q.event.get(b,e);d.handleEvent("MouseUp",b,e,d.makeEventObject(b,e),q.event.isRightClick(k))},mousedown:function(b,e){var k=q.event.get(b,e);d.handleEvent("MouseDown",b,e,d.makeEventObject(b,e),q.event.isRightClick(k))},mousemove:function(b,e){d.handleEvent("MouseMove",b,e,d.makeEventObject(b,e))},mouseover:function(b,e){d.handleEvent("MouseOver",b,e,d.makeEventObject(b,e))},mouseout:function(b,
e){d.handleEvent("MouseOut",b,e,d.makeEventObject(b,e))},touchstart:function(b,e){d.handleEvent("TouchStart",b,e,d.makeEventObject(b,e))},touchmove:function(b,e){d.handleEvent("TouchMove",b,e,d.makeEventObject(b,e))},touchend:function(b,e){d.handleEvent("TouchEnd",b,e,d.makeEventObject(b,e))}});var e=function(b,e){var k=q.event.get(b,e),k=q.event.getWheel(k);d.handleEvent("MouseWheel",b,e,k)};document.getBoxObjectFor||null!=window.mozInnerScreenX?b.addEventListener("DOMMouseScroll",e,!1):q.addEvent(b,
"mousewheel",e)},register:function(b){this.registeredObjects.push(b)},handleEvent:function(){for(var b=Array.prototype.slice.call(arguments),d=b.shift(),e=0,f=this.registeredObjects,g=f.length;e<g;e++)f[e]["on"+d].apply(f[e],b)},makeEventObject:function(b,d){var e=this,f=this.viz.graph,g=this.viz.fx,k=g.nodeTypes,l=g.edgeTypes;return{pos:!1,node:!1,edge:!1,contains:!1,getNodeCalled:!1,getEdgeCalled:!1,getPos:function(){var f=e.viz.canvas,a=f.getSize(),g=f.getPos(),k=f.translateOffsetX,l=f.translateOffsetY,
t=f.scaleOffsetX,f=f.scaleOffsetY,w=q.event.getPos(b,d);return this.pos={x:1*(w.x-g.x-a.width/2-k)/t,y:1*(w.y-g.y-a.height/2-l)/f}},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=!0;for(var b in f.nodes){var a=f.nodes[b],d=a&&k[a.getData("type")];if(d=d&&d.contains&&d.contains.call(g,a,this.getPos()))return this.contains=d,e.node=this.node=a}return e.node=this.node=!1},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=!0;var b={},a;for(a in f.edges){var d=
f.edges[a];b[a]=!0;for(var k in d)if(!(k in b)){var q=d[k],t=q&&l[q.getData("type")];if(t=t&&t.contains&&t.contains.call(g,q,this.getPos()))return this.contains=t,e.edge=this.edge=q}}return e.edge=this.edge=!1},getContains:function(){if(this.getNodeCalled)return this.contains;this.getNode();return this.contains}}}}),L={initializeExtras:function(){var b=new U(this),d=this;q.each(["NodeStyles","Tips","Navigation","Events"],function(e){var f=new L.Classes[e](e,d);f.isEnabled()&&b.register(f);f.setAsProperty()&&
(d[e.toLowerCase()]=f)})},Classes:{}};L.Classes.Events=new w({Implements:[I,V],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.moved=this.touchMoved=this.touched=this.pressed=this.hovered=!1},setAsProperty:q.lambda(!0),onMouseUp:function(b,d,e,f){b=q.event.get(b,d);if(!this.moved)if(f)this.config.onRightClick(this.hovered,e,b);else this.config.onClick(this.pressed,e,b);if(this.pressed){if(this.moved)this.config.onDragEnd(this.pressed,
e,b);else this.config.onDragCancel(this.pressed,e,b);this.pressed=this.moved=!1}},onMouseOut:function(b,d,e){var f=q.event.get(b,d),g;if(this.dom&&(g=this.isLabel(b,d,!0)))this.config.onMouseLeave(this.viz.graph.getNode(g.id),e,f),this.hovered=!1;else{b=f.relatedTarget;for(d=this.canvas.getElement();b&&b.parentNode;){if(d==b.parentNode)return;b=b.parentNode}this.hovered&&(this.config.onMouseLeave(this.hovered,e,f),this.hovered=!1)}},onMouseOver:function(b,d,e){var f=q.event.get(b,d),g;this.dom&&(g=
this.isLabel(b,d,!0))&&(this.hovered=this.viz.graph.getNode(g.id),this.config.onMouseEnter(this.hovered,e,f))},onMouseMove:function(b,d,e){b=q.event.get(b,d);if(this.pressed)this.moved=!0,this.config.onDragMove(this.pressed,e,b);else if(this.dom)this.config.onMouseMove(this.hovered,e,b);else{if(this.hovered){d=this.hovered;var f=d.nodeFrom?this.etypes[d.getData("type")]:this.ntypes[d.getData("type")];if(f&&f.contains&&f.contains.call(this.fx,d,e.getPos())){this.config.onMouseMove(d,e,b);return}this.config.onMouseLeave(d,
e,b);this.hovered=!1}if(this.hovered=e.getNode()||this.config.enableForEdges&&e.getEdge())this.config.onMouseEnter(this.hovered,e,b);else this.config.onMouseMove(!1,e,b)}},onMouseWheel:function(b,d,e){this.config.onMouseWheel(e,q.event.get(b,d))},onMouseDown:function(b,d,e){var f=q.event.get(b,d);if(this.dom){if(b=this.isLabel(b,d))this.pressed=this.viz.graph.getNode(b.id)}else this.pressed=e.getNode()||this.config.enableForEdges&&e.getEdge();this.pressed&&this.config.onDragStart(this.pressed,e,f)},
onTouchStart:function(b,d,e){var f=q.event.get(b,d),g;this.dom&&(g=this.isLabel(b,d))?this.touched=this.viz.graph.getNode(g.id):this.touched=e.getNode()||this.config.enableForEdges&&e.getEdge();this.touched&&this.config.onTouchStart(this.touched,e,f)},onTouchMove:function(b,d,e){b=q.event.get(b,d);this.touched&&(this.touchMoved=!0,this.config.onTouchMove(this.touched,e,b))},onTouchEnd:function(b,d,e){b=q.event.get(b,d);if(this.touched){if(this.touchMoved)this.config.onTouchEnd(this.touched,e,b);else this.config.onTouchCancel(this.touched,
e,b);this.touched=this.touchMoved=!1}}});L.Classes.Tips=new w({Implements:[I,V],initializePost:function(){if(document.body){var b=q("_tooltip")||document.createElement("div");b.id="_tooltip";b.className="tip";q.extend(b.style,{position:"absolute",display:"none",zIndex:13E3});document.body.appendChild(b);this.tip=b;this.node=!1}},setAsProperty:q.lambda(!0),onMouseOut:function(b,d){q.event.get(b,d);if(this.dom&&this.isLabel(b,d,!0))this.hide(!0);else{for(var e=b.relatedTarget,f=this.canvas.getElement();e&&
e.parentNode;){if(f==e.parentNode)return;e=e.parentNode}this.hide(!1)}},onMouseOver:function(b,d){var e;this.dom&&(e=this.isLabel(b,d,!1))&&(this.node=this.viz.graph.getNode(e.id),this.config.onShow(this.tip,this.node,e))},onMouseMove:function(b,d,e){this.dom&&this.isLabel(b,d)&&this.setTooltipPosition(q.event.getPos(b,d));if(!this.dom){var f=e.getNode();if(f){if(this.config.force||!this.node||this.node.id!=f.id)this.node=f,this.config.onShow(this.tip,f,e.getContains());this.setTooltipPosition(q.event.getPos(b,
d))}else this.hide(!0)}},setTooltipPosition:function(b){var d=this.tip,e=d.style,f=this.config;e.display="";var g="CSS1Compat"===document.compatMode&&document.documentElement||document.body||document.documentElement,k=g.clientWidth,l=window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body&&document.body.scrollLeft||0,s=d.offsetWidth,d=d.offsetHeight,a=f.offsetX,f=f.offsetY;e.top=(b.y+d+f>g.clientHeight+(window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||
document.body&&document.body.scrollTop||0)?b.y-d-f:b.y+f)+"px";e.left=(b.x+s+a>k+l?b.x-s-a:b.x+a)+"px"},hide:function(b){this.tip.style.display="none";b&&this.config.onHide()}});L.Classes.NodeStyles=new w({Implements:[I,V],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=!1;this.fx.nodeFxAnimation=new C;this.move=this.down=!1},onMouseOut:function(b,
d){this.down=this.move=!1;if(this.hoveredNode){this.dom&&this.isLabel(b,d,!0)&&this.toggleStylesOnHover(this.hoveredNode,!1);for(var e=b.relatedTarget,f=this.canvas.getElement();e&&e.parentNode;){if(f==e.parentNode)return;e=e.parentNode}this.toggleStylesOnHover(this.hoveredNode,!1);this.hoveredNode=!1}},onMouseOver:function(b,d){var e;this.dom&&(e=this.isLabel(b,d,!0))&&(e=this.viz.graph.getNode(e.id),e.selected||(this.hoveredNode=e,this.toggleStylesOnHover(this.hoveredNode,!0)))},onMouseDown:function(b,
d,e,f){if(!f){var g;this.dom&&(g=this.isLabel(b,d))?this.down=this.viz.graph.getNode(g.id):this.dom||(this.down=e.getNode());this.move=!1}},onMouseUp:function(b,d,e,f){if(!f){if(!this.move)this.onClick(e.getNode());this.down=this.move=!1}},getRestoredStyles:function(b,d){var e={},f=this["nodeStylesOn"+d],g;for(g in f)e[g]=b.styles["$"+g];return e},toggleStylesOnHover:function(b,d){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",b,d)},toggleStylesOnClick:function(b,d){this.nodeStylesOnClick&&this.toggleStylesOn("Click",
b,d)},toggleStylesOn:function(b,d,e){var f=this.viz;if(e){d.styles||(d.styles=q.merge(d.data,{}));for(var g in this["nodeStylesOn"+b])e="$"+g,e in d.styles||(d.styles[e]=d.getData(g));f.fx.nodeFx(q.extend({elements:{id:d.id,properties:this["nodeStylesOn"+b]},transition:F.Quart.easeOut,duration:300,fps:40},this.config))}else b=this.getRestoredStyles(d,b),f.fx.nodeFx(q.extend({elements:{id:d.id,properties:b},transition:F.Quart.easeOut,duration:300,fps:40},this.config))},onClick:function(b){if(b){var d=
this.nodeStylesOnClick;d&&(b.selected?(this.toggleStylesOnClick(b,!1),delete b.selected):(this.viz.graph.eachNode(function(b){if(b.selected){for(var f in d)b.setData(f,b.styles["$"+f],"end");delete b.selected}}),this.toggleStylesOnClick(b,!0),b.selected=!0,delete b.hovered,this.hoveredNode=!1))}},onMouseMove:function(b,d,e){this.down&&(this.move=!0);if(!this.dom||!this.isLabel(b,d)){var f=this.nodeStylesOnHover;if(f&&!this.dom){if(this.hoveredNode&&(b=this.types[this.hoveredNode.getData("type")])&&
b.contains&&b.contains.call(this.fx,this.hoveredNode,e.getPos()))return;e=e.getNode();!this.hoveredNode&&!e||e.hovered||(e&&!e.selected?(this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(b){if(b.hovered&&!b.selected){for(var d in f)b.setData(d,b.styles["$"+d],"end");delete b.hovered}}),e.hovered=!0,this.hoveredNode=e,this.toggleStylesOnHover(e,!0)):this.hoveredNode&&!this.hoveredNode.selected&&(this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,!1),delete this.hoveredNode.hovered,
this.hoveredNode=!1))}}}});L.Classes.Navigation=new w({Implements:[I,V],initializePost:function(){this.pressed=this.pos=!1},onMouseWheel:function(b,d,e){this.config.zooming&&(q.event.stop(q.event.get(b,d)),b=1+this.config.zooming/1E3*e,this.canvas.scale(b,b))},onMouseDown:function(b,d,e){if(this.config.panning&&(b.preventDefault?b.preventDefault():b.returnValue=!1,q.addClass(this.canvas.getElement(),"grabbing"),!("avoid nodes"==this.config.panning&&(this.dom?this.isLabel(b,d):e.getNode()||e.getEdge())))){this.pressed=
!0;this.pos=e.getPos();b=this.canvas;d=b.translateOffsetX;e=b.translateOffsetY;var f=b.scaleOffsetY;this.pos.x*=b.scaleOffsetX;this.pos.x+=d;this.pos.y*=f;this.pos.y+=e}},onMouseMove:function(b,d,e){if(this.config.panning&&this.pressed&&("avoid nodes"!=this.config.panning||(this.dom?!this.isLabel(b,d):!e.getNode()))){b=this.pos;e=e.getPos();var f=this.canvas,g=f.translateOffsetX,k=f.translateOffsetY;d=f.scaleOffsetX;f=f.scaleOffsetY;e.x*=d;e.y*=f;e.x+=g;e.y+=k;g=e.x-b.x;b=e.y-b.y;this.pos=e;this.canvas.translate(1*
g/d,1*b/f)}},onMouseUp:function(b,d,e,f){this.config.panning&&(q.removeClass(this.canvas.getElement(),"grabbing"),this.pressed=!1)}});var N;(function(){function b(b,d){var k=document.createElement(b),l;for(l in d)"object"==typeof d[l]?q.extend(k[l],d[l]):k[l]=d[l];"canvas"==b&&!e&&G_vmlCanvasManager&&(k=G_vmlCanvasManager.initElement(document.body.appendChild(k)));return k}var d=typeof HTMLCanvasElement,e="object"==d||"function"==d;$jit.Canvas=N=new w({canvases:[],pos:!1,element:!1,labelContainer:!1,
translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(d,e){this.viz=d;this.opt=this.config=e;var k="string"==q.type(e.injectInto)?e.injectInto:e.injectInto.id,l=e.type,s=k+"-label",a=q(k),m=e.width||a.offsetWidth,n=e.height||a.offsetHeight;this.id=k;var v={injectInto:k,width:m,height:n};this.element=b("div",{id:k+"-canvaswidget",style:{position:"relative",width:m+"px",height:n+"px"}});this.labelContainer=this.createLabelContainer(e.Label.type,s,v);this.canvases.push(new N.Base[l]({config:q.extend({idSuffix:"-canvas"},
v),plot:function(a){d.fx.plot()},resize:function(){d.refresh()}}));if(k=e.background)v=new N.Background[k.type](d,q.extend(k,v)),this.canvases.push(new N.Base[l](v));for(l=this.canvases.length;l--;)this.element.appendChild(this.canvases[l].canvas),0<l&&this.canvases[l].plot();this.element.appendChild(this.labelContainer);a.appendChild(this.element);var t=null,w=this;q.addEvent(window,"scroll",function(){clearTimeout(t);t=setTimeout(function(){w.getPos(!0)},500)})},getCtx:function(b){return this.canvases[b||
0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(b){return this.canvases[b||0].getSize()},resize:function(b,d){this.getPos(!0);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var e=0,l=this.canvases.length;e<l;e++)this.canvases[e].resize(b,d);e=this.element.style;e.width=b+"px";e.height=d+"px";this.labelContainer&&(this.labelContainer.style.width=b+"px")},translate:function(b,d,e){this.translateOffsetX+=
b*this.scaleOffsetX;this.translateOffsetY+=d*this.scaleOffsetY;for(var l=0,s=this.canvases.length;l<s;l++)this.canvases[l].translate(b,d,e)},scale:function(b,d,e){var l=this.scaleOffsetX*b,s=this.scaleOffsetY*d;e=this.translateOffsetX*(b-1)/l;var a=this.translateOffsetY*(d-1)/s;this.scaleOffsetX=l;this.scaleOffsetY=s;l=0;for(s=this.canvases.length;l<s;l++)this.canvases[l].scale(b,d,!0);this.translate(e,a,!1)},getZoom:function(){return new K(this.scaleOffsetX,this.scaleOffsetY)},setZoom:function(b,
d,e){var l=this.getZoom();this.scale(b/l.x,d/l.y,e)},getPos:function(b){return b||!this.pos?this.pos=q.getPos(this.getElement()):this.pos},clear:function(b){this.canvases[b||0].clear()},path:function(b,d){var e=this.canvases[0].getCtx();e.beginPath();d(e);e[b]();e.closePath()},createLabelContainer:function(d,e,k){if("HTML"==d||"Native"==d)return b("div",{id:e,style:{overflow:"visible",position:"absolute",top:0,left:0,width:k.width+"px",height:0}});if("SVG"==d){d=document.createElementNS("http://www.w3.org/2000/svg",
"svg:svg");d.setAttribute("width",k.width);d.setAttribute("height",k.height);var l=d.style;l.position="absolute";l.left=l.top="0px";l=document.createElementNS("http://www.w3.org/2000/svg","svg:g");l.setAttribute("width",k.width);l.setAttribute("height",k.height);l.setAttribute("x",0);l.setAttribute("y",0);l.setAttribute("id",e);d.appendChild(l);return d}}});N.Base={};N.Base["2D"]=new w({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(b){this.viz=b;this.opt=
b.config;this.size=!1;this.createCanvas();this.translateToCenter()},createCanvas:function(){var d=this.opt,e=d.width,k=d.height;this.canvas=b("canvas",{id:d.injectInto+d.idSuffix,width:e,height:k,style:{position:"absolute",top:0,left:0,width:e+"px",height:k+"px"}})},getCtx:function(){return this.ctx?this.ctx:this.ctx=this.canvas.getContext("2d")},getSize:function(){if(this.size)return this.size;var b=this.canvas;return this.size={width:b.width,height:b.height}},translateToCenter:function(b){var d=
this.getSize(),e=b?d.width-b.width-2*this.translateOffsetX:d.width;height=b?d.height-b.height-2*this.translateOffsetY:d.height;d=this.getCtx();b&&d.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);d.translate(e/2,height/2)},resize:function(b,d){var k=this.getSize(),l=this.canvas,s=l.style;this.size=!1;l.width=b;l.height=d;s.width=b+"px";s.height=d+"px";e?this.translateToCenter():this.translateToCenter(k);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();
this.viz.resize(b,d,this)},translate:function(b,d,e){var l=this.scaleOffsetY;this.translateOffsetX+=b*this.scaleOffsetX;this.translateOffsetY+=d*l;this.getCtx().translate(b,d);!e&&this.plot()},scale:function(b,d,e){this.scaleOffsetX*=b;this.scaleOffsetY*=d;this.getCtx().scale(b,d);!e&&this.plot()},clear:function(){var b=this.getSize(),d=this.translateOffsetX,e=this.translateOffsetY,l=this.scaleOffsetX,s=this.scaleOffsetY;this.getCtx().clearRect(1*(-b.width/2-d)/l,1*(-b.height/2-e)/s,1*b.width/l,1*
b.height/s)},plot:function(){this.clear();this.viz.plot(this)}});N.Background={};N.Background.Circles=new w({initialize:function(b,d){this.viz=b;this.config=q.merge({idSuffix:"-bkcanvas",levelDistance:200,numberOfCircles:10,CanvasStyles:{},offset:0},d)},resize:function(b,d,e){this.plot(e)},plot:function(b){b=b.getCtx();var d=this.config,e=d.CanvasStyles,l;for(l in e)b[l]=e[l];l=d.numberOfCircles;d=d.levelDistance;for(e=1;e<=l;e++)b.beginPath(),b.arc(0,0,d*e,0,2*Math.PI,!1),b.stroke(),b.closePath()}})})();
var H=function(b,d){this.theta=b||0;this.rho=d||0};$jit.Polar=H;H.prototype={getc:function(b){return this.toComplex(b)},getp:function(){return this},set:function(b){b=b.getp();this.theta=b.theta;this.rho=b.rho},setc:function(b,d){this.rho=Math.sqrt(b*b+d*d);this.theta=Math.atan2(d,b);0>this.theta&&(this.theta+=2*Math.PI)},setp:function(b,d){this.theta=b;this.rho=d},clone:function(){return new H(this.theta,this.rho)},toComplex:function(b){var d=Math.cos(this.theta)*this.rho,e=Math.sin(this.theta)*
this.rho;return b?{x:d,y:e}:new K(d,e)},add:function(b){return new H(this.theta+b.theta,this.rho+b.rho)},scale:function(b){return new H(this.theta,this.rho*b)},equals:function(b){return this.theta==b.theta&&this.rho==b.rho},$add:function(b){this.theta+=b.theta;this.rho+=b.rho;return this},$madd:function(b){this.theta=(this.theta+b.theta)%(2*Math.PI);this.rho+=b.rho;return this},$scale:function(b){this.rho*=b;return this},isZero:function(){var b=Math.abs;return 1E-4>b(this.theta)&&1E-4>b(this.rho)},
interpolate:function(b,d){var e=Math.PI,f=2*e,g=function(a){return 0>a?a%f+f:a%f},k=this.theta,l=b.theta,s=Math.abs(k-l);return{theta:s==e?k>l?g(l+(k-f-l)*d):g(l-f+(k-l)*d):s>=e?k>l?g(l+(k-f-l)*d):g(l-f+(k-(l-f))*d):g(l+(k-l)*d),rho:(this.rho-b.rho)*d+b.rho}}};H.KER=new H(0,0);var K=function(b,d){this.x=b||0;this.y=d||0};$jit.Complex=K;K.prototype={getc:function(){return this},getp:function(b){return this.toPolar(b)},set:function(b){b=b.getc(!0);this.x=b.x;this.y=b.y},setc:function(b,d){this.x=b;
this.y=d},setp:function(b,d){this.x=Math.cos(b)*d;this.y=Math.sin(b)*d},clone:function(){return new K(this.x,this.y)},toPolar:function(b){var d=this.norm(),e=Math.atan2(this.y,this.x);0>e&&(e+=2*Math.PI);return b?{theta:e,rho:d}:new H(e,d)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(b){return new K(this.x+b.x,this.y+b.y)},prod:function(b){return new K(this.x*b.x-this.y*b.y,this.y*b.x+this.x*b.y)},conjugate:function(){return new K(this.x,
-this.y)},scale:function(b){return new K(this.x*b,this.y*b)},equals:function(b){return this.x==b.x&&this.y==b.y},$add:function(b){this.x+=b.x;this.y+=b.y;return this},$prod:function(b){var d=this.x,e=this.y;this.x=d*b.x-e*b.y;this.y=e*b.x+d*b.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(b){this.x*=b;this.y*=b;return this},$div:function(b){var d=this.x,e=this.y,f=b.squaredNorm();this.x=d*b.x+e*b.y;this.y=e*b.x-d*b.y;return this.$scale(1/f)},isZero:function(){var b=
Math.abs;return 1E-4>b(this.x)&&1E-4>b(this.y)}};var R=function(b,d){return new K(b,d)};K.KER=R(0,0);K.IM=R(0,1);$jit.Graph=new w({initialize:function(b,d,e,f){var g={klass:K,Node:{}};this.Node=d;this.Edge=e;this.Label=f;this.opt=q.merge(g,b||{});this.nodes={};this.edges={};this.roots={};var k=this;this.nodeList={};for(var l in W)k.nodeList[l]=function(b){return function(){var a=Array.prototype.slice.call(arguments);k.eachNode(function(d){d[b].apply(d,a)})}}(l)},getNode:function(b){return this.hasNode(b)?
this.nodes[b]:!1},get:function(b){return this.getNode(b)},getByName:function(b){for(var d in this.nodes){var e=this.nodes[d];if(e.name==b)return e}return!1},getAdjacence:function(b,d){return b in this.edges?this.edges[b][d]:!1},addNode:function(b){if(!this.nodes[b.id]){var d=this.edges[b.id]={};this.nodes[b.id]=new D.Node(q.extend({id:b.id,name:b.name,data:q.merge(b.data||{},{}),adjacencies:d},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[b.id]},addAdjacence:function(b,
d,e){this.hasNode(b.id)||this.addNode(b);this.hasNode(d.id)||this.addNode(d);b=this.nodes[b.id];d=this.nodes[d.id];if(!b.adjacentTo(d)){var f=this.edges[b.id]=this.edges[b.id]||{},g=this.edges[d.id]=this.edges[d.id]||{};f[d.id]=g[b.id]=new D.Adjacence(b,d,e,this.Edge,this.Label);return f[d.id]}return this.edges[b.id][d.id]},removeNode:function(b){if(this.hasNode(b)){delete this.nodes[b];var d=this.edges[b],e;for(e in d)delete this.edges[e][b];delete this.edges[b]}},removeAdjacence:function(b,d){delete this.edges[b][d];
delete this.edges[d][b]},hasNode:function(b){return b in this.nodes},empty:function(){this.nodes={};this.edges={}}});var D=$jit.Graph,W;(function(){var b=function(b,d,e,l,s){var a;e=e||"current";"current"==e?a=this.data:"start"==e?a=this.startData:"end"==e&&(a=this.endData);b="$"+(b?b+"-":"")+d;return l?a[b]:this.Config.overridable?b in a?a[b]:b in this.data?this.data[b]:s[d]||0:s[d]||0},d=function(b,d,e,l){l=l||"current";var s;"current"==l?s=this.data:"start"==l?s=this.startData:"end"==l&&(s=this.endData);
s["$"+(b?b+"-":"")+d]=e},e=function(b,d){b="$"+(b?b+"-":"");var e=this;q.each(d,function(d){d=b+d;delete e.data[d];delete e.endData[d];delete e.startData[d]})};W={getData:function(d,e,k){return b.call(this,"",d,e,k,this.Config)},setData:function(b,e,k){d.call(this,"",b,e,k)},setDataset:function(b,d){b=q.splat(b);for(var e in d)for(var l=0,s=q.splat(d[e]),a=b.length;l<a;l++)this.setData(e,s[l],b[l])},removeData:function(){e.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(d,
e,k){return b.call(this,"canvas",d,e,k,this.Config.CanvasStyles)},setCanvasStyle:function(b,e,k){d.call(this,"canvas",b,e,k)},setCanvasStyles:function(b,d){b=q.splat(b);for(var e in d)for(var l=0,s=q.splat(d[e]),a=b.length;l<a;l++)this.setCanvasStyle(e,s[l],b[l])},removeCanvasStyle:function(){e.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(d,e,k){return b.call(this,"label",d,e,k,this.Label)},setLabelData:function(b,e,k){d.call(this,"label",b,e,k)},setLabelDataset:function(b,
d){b=q.splat(b);for(var e in d)for(var l=0,s=q.splat(d[e]),a=b.length;l<a;l++)this.setLabelData(e,s[l],b[l])},removeLabelData:function(){e.call(this,"label",Array.prototype.slice.call(arguments))}}})();D.Node=new w({initialize:function(b,d,e,f,g){d={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},pos:new d,startPos:new d,endPos:new d};q.extend(this,q.extend(d,b));this.Config=this.Node=e;this.Edge=f;this.Label=g},adjacentTo:function(b){return b.id in
this.adjacencies},adjacentWithDirectionTo:function(b){return b.id in this.adjacencies?this.adjacencies[b.id].data.$direction[0]===this.id:!1},getAdjacency:function(b){return this.adjacencies[b]},getPos:function(b){b=b||"current";if("current"==b)return this.pos;if("end"==b)return this.endPos;if("start"==b)return this.startPos},setPos:function(b,d){d=d||"current";var e;"current"==d?e=this.pos:"end"==d?e=this.endPos:"start"==d&&(e=this.startPos);e.set(b)}});D.Node.implement(W);D.Adjacence=new w({initialize:function(b,
d,e,f,g){this.nodeFrom=b;this.nodeTo=d;this.data=e||{};this.startData={};this.endData={};this.Config=this.Edge=f;this.Label=g}});D.Adjacence.implement(W);D.Util={filter:function(b){if(!b||"string"!=q.type(b))return function(){return!0};var d=b.split(" ");return function(b){for(var f=0;f<d.length;f++)if(b[d[f]])return!1;return!0}},getNode:function(b,d){return b.nodes[d]},eachNode:function(b,d,e){e=this.filter(e);for(var f in b.nodes)e(b.nodes[f])&&d(b.nodes[f])},each:function(b,d,e){this.eachNode(b,
d,e)},eachAdjacency:function(b,d,e){var f=b.adjacencies;e=this.filter(e);for(var g in f){var k=f[g];if(e(k)){if(k.nodeFrom!=b){var l=k.nodeFrom;k.nodeFrom=k.nodeTo;k.nodeTo=l}d(k,g)}}},computeLevels:function(b,d,e,f){var g=function(a){for(var b in a)return!1;return!0};e=e||0;var k=this.filter(f),l={};if(!g(this.roots)){var s=b.getNode(this.roots.superRoot);s&&this.eachAdjacency(s,function(a){a.getData("_rootsAdj")&&b.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)})}this.roots={};this.eachNode(b,function(a){a._flag=
!1;a._depth=-1;l[a.id]=a},f);d=b.getNode(d);d._depth=e;var a=[d];this.roots[d.id]=d;for(this.roots.superRoot=d.id;!g(l);){for(;0!=a.length;){var m=a.pop();delete l[m.id];m._flag=!0;this.eachAdjacency(m,function(b){var d=b.nodeTo;0==d._flag&&k(d)&&!b._hiding&&(0>d._depth&&(d._depth=m._depth+1+e,console.log("Node to queue "+d.id+":"+d._depth)),a.unshift(d))},f)}g(l)||(s=l[Object.keys(l).pop()],this.roots[s.id]=s,b.addAdjacence(d,s,{$alpha:0}).setData("_rootsAdj",!0),a.unshift(s),s._depth=d._depth+1,
console.log("Newroot "+s.id+":"+s._depth))}},eachBFS:function(b,d,e,f){var g=this.filter(f);this.clean(b);for(var k=[b.getNode(d)];0!=k.length;){b=k.pop();if(!b)break;b._flag=!0;e(b,b._depth);this.eachAdjacency(b,function(b){var d=b.nodeTo;0==d._flag&&g(d)&&!b._hiding&&(d._flag=!0,k.unshift(d))},f)}},eachLevel:function(b,d,e,f,g){var k=b._depth,l=this.filter(g),s=this,a=!0;e=!1===e?Number.MAX_VALUE-k:e;(function n(b,d,e){if(a){var g=b._depth,k;g>=d&&g<=e&&l(b)&&(k=f(b,g));"undefined"!==typeof k&&
(a=k);a&&g<e&&s.eachAdjacency(b,function(a){a=a.nodeTo;a._depth>g&&n(a,d,e)})}})(b,d+k,e+k)},eachSubgraph:function(b,d,e){this.eachLevel(b,0,!1,d,e)},eachSubnode:function(b,d,e){this.eachLevel(b,1,1,d,e)},anySubnode:function(b,d,e){var f=!1;d=d||q.lambda(!0);var g="string"==q.type(d)?function(b){return b[d]}:d;this.eachSubnode(b,function(b){g(b)&&(f=!0)},e);return f},getSubnodes:function(b,d,e){var f=[];d=d||0;var g;"array"==q.type(d)?(g=d[0],d=d[1]):(g=d,d=Number.MAX_VALUE-b._depth);this.eachLevel(b,
g,d,function(b){f.push(b)},e);return f},getParents:function(b){var d=[];this.eachAdjacency(b,function(e){e=e.nodeTo;e._depth<b._depth&&d.push(e)});return d},isDescendantOf:function(b,d){if(b.id==d)return!0;for(var e=this.getParents(b),f=!1,g=0;!f&&g<e.length;g++)f=f||this.isDescendantOf(e[g],d);return f},clean:function(b){this.eachNode(b,function(b){b._flag=!1})},getClosestNodeToOrigin:function(b,d,e){return this.getClosestNodeToPos(b,H.KER,d,e)},getClosestNodeToPos:function(b,d,e,f){var g=null;e=
e||"current";d=d&&d.getc(!0)||K.KER;var k=function(b,d){var a=b.x-d.x,e=b.y-d.y;return a*a+e*e};this.eachNode(b,function(b){g=null==g||k(b.getPos(e).getc(!0),d)<k(g.getPos(e).getc(!0),d)?b:g},f);return g}};q.each("get getNode each eachNode computeLevels eachBFS clean getClosestNodeToPos getClosestNodeToOrigin".split(" "),function(b){D.prototype[b]=function(){return D.Util[b].apply(D.Util,[this].concat(Array.prototype.slice.call(arguments)))}});q.each("eachAdjacency eachLevel eachSubgraph eachSubnode anySubnode getSubnodes getParents isDescendantOf".split(" "),
function(b){D.Node.prototype[b]=function(){return D.Util[b].apply(D.Util,[this].concat(Array.prototype.slice.call(arguments)))}});D.Op={options:{type:"nothing",duration:2E3,hideLabels:!0,fps:30},initialize:function(b){this.viz=b},removeNode:function(b,d){var e=this.viz,f=q.merge(this.options,e.controller,d),g=q.splat(b),k,l,s;switch(f.type){case "nothing":for(k=0;k<g.length;k++)f.onBeforeRemoveNode(e.graph.getNode(g[k])),e.graph.removeNode(g[k]);break;case "replot":this.removeNode(g,{type:"nothing"});
e.labels.clearLabels();e.refresh(!0);break;case "fade:seq":case "fade":l=this;for(k=0;k<g.length;k++)s=e.graph.getNode(g[k]),s.setData("alpha",0,"end");e.fx.animate(q.merge(f,{modes:["node-property:alpha"],onComplete:function(){l.removeNode(g,{type:"nothing"});e.labels.clearLabels();e.reposition();e.fx.animate(q.merge(f,{modes:["linear"]}))}}));break;case "fade:con":l=this;for(k=0;k<g.length;k++)s=e.graph.getNode(g[k]),s.setData("alpha",0,"end"),s.ignore=!0;e.reposition();e.fx.animate(q.merge(f,{modes:["node-property:alpha",
"linear"],onComplete:function(){l.removeNode(g,{type:"nothing"});f.onComplete&&f.onComplete()}}));break;case "iter":l=this;e.fx.sequence({condition:function(){return 0!=g.length},step:function(){l.removeNode(g.shift(),{type:"nothing"});e.labels.clearLabels()},onComplete:function(){f.onComplete&&f.onComplete()},duration:Math.ceil(f.duration/g.length)});break;default:this.doError()}},removeEdge:function(b,d){var e=this.viz,f=q.merge(this.options,e.controller,d),g="string"==q.type(b[0])?[b]:b,k,l,s;
switch(f.type){case "nothing":for(k=0;k<g.length;k++)e.graph.removeAdjacence(g[k][0],g[k][1]);break;case "replot":this.removeEdge(g,{type:"nothing"});e.refresh(!0);break;case "fade:seq":case "fade":l=this;for(k=0;k<g.length;k++)(s=e.graph.getAdjacence(g[k][0],g[k][1]))&&s.setData("alpha",0,"end");e.fx.animate(q.merge(f,{modes:["edge-property:alpha"],onComplete:function(){l.removeEdge(g,{type:"nothing"});e.reposition();e.fx.animate(q.merge(f,{modes:["linear"]}))}}));break;case "fade:con":l=this;for(k=
0;k<g.length;k++)if(s=e.graph.getAdjacence(g[k][0],g[k][1]))s.setData("alpha",0,"end"),s.ignore=!0;e.reposition();e.fx.animate(q.merge(f,{modes:["edge-property:alpha","linear"],onComplete:function(){l.removeEdge(g,{type:"nothing"});f.onComplete&&f.onComplete()}}));break;case "iter":l=this;e.fx.sequence({condition:function(){return 0!=g.length},step:function(){l.removeEdge(g.shift(),{type:"nothing"});e.labels.clearLabels()},onComplete:function(){f.onComplete()},duration:Math.ceil(f.duration/g.length)});
break;default:this.doError()}},sum:function(b,d){var e=this.viz,f=q.merge(this.options,e.controller,d),g=e.root,k;e.root=d.id||e.root;switch(f.type){case "nothing":k=e.construct(b);k.eachNode(function(b){b.eachAdjacency(function(a){e.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data)})});break;case "replot":e.refresh(!0);this.sum(b,{type:"nothing"});e.refresh(!0);break;case "fade:seq":case "fade":case "fade:con":that=this;k=e.construct(b);var l=this.preprocessSum(k)?["node-property:alpha","edge-property:alpha"]:
["node-property:alpha"];e.reposition();"fade:con"!=f.type?e.fx.animate(q.merge(f,{modes:["linear"],onComplete:function(){e.fx.animate(q.merge(f,{modes:l,onComplete:function(){f.onComplete()}}))}})):(e.graph.eachNode(function(b){b.id!=g&&b.pos.isZero()&&(b.pos.set(b.endPos),b.startPos.set(b.endPos))}),e.fx.animate(q.merge(f,{modes:["linear"].concat(l)})));break;default:this.doError()}},morph:function(b,d,e){e=e||{};var f=this.viz,g=q.merge(this.options,f.controller,d),k=f.root,l;f.root=d.id||f.root;
switch(g.type){case "nothing":l=f.construct(b);l.eachNode(function(a){var b=f.graph.hasNode(a.id);a.eachAdjacency(function(a){var b=!!f.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id);f.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data);if(b){var b=f.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id),d;for(d in a.data||{})b.data[d]=a.data[d]}});if(b){var b=f.graph.getNode(a.id),d;for(d in a.data||{})b.data[d]=a.data[d]}});f.graph.eachNode(function(a){a.eachAdjacency(function(a){l.getAdjacence(a.nodeFrom.id,
a.nodeTo.id)||f.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)});l.hasNode(a.id)||f.graph.removeNode(a.id)});break;case "replot":f.labels.clearLabels(!0);this.morph(b,{type:"nothing"});f.refresh(!0);f.refresh(!0);break;case "fade:seq":case "fade":case "fade:con":that=this;l=f.construct(b);var s="node-property"in e&&q.map(q.splat(e["node-property"]),function(a){return"$"+a});f.graph.eachNode(function(a){var b=l.getNode(a.id);if(b){var b=b.data,d;for(d in b)s&&-1<q.indexOf(s,d)?a.endData[d]=b[d]:
a.data[d]=b[d]}else a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end"),a.ignore=!0});f.graph.eachNode(function(b){b.ignore||b.eachAdjacency(function(b){if(!b.nodeFrom.ignore&&!b.nodeTo.ignore){var d=l.getNode(b.nodeFrom.id),e=l.getNode(b.nodeTo.id);d.adjacentTo(e)?b.data.$direction&&b.data.$direction[0]===d.id&&!d.adjacentWithDirectionTo(e)&&(b._reversing=!0):(b=f.graph.getAdjacence(d.id,e.id),a=!0,b.setData("alpha",1),b.setData("alpha",1,"start"),b.setData("alpha",0,"end"),
b._hiding=!0)}})});var a=this.preprocessSum(l);b=a?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];b[0]+="node-property"in e?":"+q.splat(e["node-property"]).join(":"):"";b[1]=(b[1]||"edge-property:alpha")+("edge-property"in e?":"+q.splat(e["edge-property"]).join(":"):"");"label-property"in e&&b.push("label-property:"+q.splat(e["label-property"]).join(":"));f.reposition?f.reposition():f.compute("end");this._updateDirectedEdges();f.graph.eachNode(function(a){a.id!=k&&a.pos.getp().equals(H.KER)&&
(a.pos.set(a.endPos),a.startPos.set(a.endPos))});f.fx.animate(q.merge(g,{modes:[e.position||"polar"].concat(b),onComplete:function(){f.graph.eachNode(function(a){a.ignore&&f.graph.removeNode(a.id)});f.graph.eachNode(function(a){a.eachAdjacency(function(a){a.ignore&&f.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)})});g.onComplete()}}))}},_updateDirectedEdges:function(){var b=this.viz.graph;b.eachNode(function(d){d.eachAdjacency(function(d){if(!d.data.$direction||d.nodeFrom.id===d.data.$direction[0])if(d._hiding&&
b.removeAdjacence(d.nodeFrom.id,d.nodeTo.id),d._reversing){var f=d.nodeFrom.id,g=d.nodeTo.id,k=b.edges[g][f];b.edges[f][g].data.$direction=[g,f];k.data.$direction=[g,f];d._reversing=void 0}})})},contract:function(b,d){var e=this.viz;!b.collapsed&&b.anySubnode(q.lambda(!0))&&(d=q.merge(this.options,e.config,d||{},{modes:["node-property:alpha:span","linear"]}),b.collapsed=!0,function g(b){b.eachSubnode(function(b){b.ignore=!0;b.setData("alpha",0,"animate"==d.type?"end":"current");g(b)})}(b),"animate"==
d.type?(e.compute("end"),e.rotated&&e.rotate(e.rotated,"none",{property:"end"}),function k(d){d.eachSubnode(function(d){d.setPos(b.getPos("end"),"end");k(d)})}(b),e.fx.animate(d)):"replot"==d.type&&e.refresh())},expand:function(b,d){if("collapsed"in b){var e=this.viz;d=q.merge(this.options,e.config,d||{},{modes:["node-property:alpha:span","linear"]});delete b.collapsed;(function g(b){b.eachSubnode(function(b){delete b.ignore;b.setData("alpha",1,"animate"==d.type?"end":"current");g(b)})})(b);"animate"==
d.type?(e.compute("end"),e.rotated&&e.rotate(e.rotated,"none",{property:"end"}),e.fx.animate(d)):"replot"==d.type&&e.refresh()}},preprocessSum:function(b){var d=this.viz;b.eachNode(function(b){d.graph.hasNode(b.id)||(d.graph.addNode(b),b=d.graph.getNode(b.id),b.setData("alpha",0),b.setData("alpha",0,"start"),b.setData("alpha",1,"end"))});var e=!1;b.eachNode(function(b){b.eachAdjacency(function(b){var f=d.graph.getNode(b.nodeFrom.id),l=d.graph.getNode(b.nodeTo.id);f.adjacentTo(l)||(b=d.graph.addAdjacence(f,
l,b.data),f.startAlpha==f.endAlpha&&l.startAlpha==l.endAlpha&&(e=!0,b.setData("alpha",0),b.setData("alpha",0,"start"),b.setData("alpha",1,"end")))})});return e}};var fa={none:{render:q.empty,contains:q.lambda(!1)},circle:{render:function(b,d,e,f){f=f.getCtx();f.beginPath();f.arc(d.x,d.y,e,0,2*Math.PI,!0);f.closePath();f[b]()},contains:function(b,d,e){var f=b.x-d.x;b=b.y-d.y;return f*f+b*b<=e*e}},ellipse:{render:function(b,d,e,f,g){g=g.getCtx();var k=1,l=1,s=1,a=1,m=0;e>f?(m=e/2,l=f/e,a=e/f):(m=f/
2,k=e/f,s=f/e);g.save();g.scale(k,l);g.beginPath();g.arc(d.x*s,d.y*a,m,0,2*Math.PI,!0);g.closePath();g[b]();g.restore()},contains:function(b,d,e,f){var g=0,k=1,l=1,s=0,a=0;e>f?(g=e/2,l=f/e):(g=f/2,k=e/f);s=1/k*(b.x-d.x);a=1/l*(b.y-d.y);return s*s+a*a<=g*g}},square:{render:function(b,d,e,f){f.getCtx()[b+"Rect"](d.x-e,d.y-e,2*e,2*e)},contains:function(b,d,e){return Math.abs(d.x-b.x)<=e&&Math.abs(d.y-b.y)<=e}},rectangle:{render:function(b,d,e,f,g){g.getCtx()[b+"Rect"](d.x-e/2,d.y-f/2,e,f)},contains:function(b,
d,e,f){return Math.abs(d.x-b.x)<=e/2&&Math.abs(d.y-b.y)<=f/2}},triangle:{render:function(b,d,e,f){f=f.getCtx();var g=d.x,k=d.y-e,l=g-e;d=d.y+e;e=g+e;f.beginPath();f.moveTo(g,k);f.lineTo(l,d);f.lineTo(e,d);f.closePath();f[b]()},contains:function(b,d,e){return fa.circle.contains(b,d,e)}},star:{render:function(b,d,e,f){f=f.getCtx();var g=Math.PI/5;f.save();f.translate(d.x,d.y);f.beginPath();f.moveTo(e,0);for(d=0;9>d;d++)f.rotate(g),0==d%2?f.lineTo(e/.525731*.200811,0):f.lineTo(e,0);f.closePath();f[b]();
f.restore()},contains:function(b,d,e){return fa.circle.contains(b,d,e)}}},ga={line:{render:function(b,d,e){e=e.getCtx();e.beginPath();e.moveTo(b.x,b.y);e.lineTo(d.x,d.y);e.stroke()},contains:function(b,d,e,f){var g=Math.min,k=Math.max,l=g(b.x,d.x)-f,s=k(b.x,d.x)+f,g=g(b.y,d.y)-f,k=k(b.y,d.y)+f;return e.x>=l&&e.x<=s&&e.y>=g&&e.y<=k?Math.abs(d.x-b.x)<=f?!0:Math.abs((d.y-b.y)/(d.x-b.x)*(e.x-b.x)+b.y-e.y)<=f:!1}},arrow:{render:function(b,d,e,f,g,k){g=g.getCtx();f&&(f=b,b=d,d=f);f=new K(d.x-b.x,d.y-b.y);
f.$scale(e/f.norm());var l;switch(k){case "end":l=f;break;case "center":l=new K((d.x-b.x)/2,(d.y-b.y)/2)}e=new K(d.x-l.x,d.y-l.y);k=new K(-f.y/2,f.x/2);l=e.add(f);f=e.add(k);e=e.$add(k.$scale(-1));g.beginPath();g.moveTo(b.x,b.y);g.lineTo(d.x,d.y);g.stroke();g.beginPath();g.moveTo(f.x,f.y);g.moveTo(f.x,f.y);g.lineTo(e.x,e.y);g.lineTo(l.x,l.y);g.closePath();g.fill()},contains:function(b,d,e,f){return ga.line.contains(b,d,e,f)}},hyperline:{render:function(b,d,e,f){function g(b,d){return b<d?b+Math.PI>
d?!1:!0:d+Math.PI>b?!0:!1}f=f.getCtx();var k=function(b,d){var a=b.x*d.y-b.y*d.x,e=b.squaredNorm(),f=d.squaredNorm();if(0==a)return{x:0,y:0,ratio:-1};var g=(b.y*f-d.y*e+b.y-d.y)/a,a=(d.x*e-b.x*f+d.x-b.x)/a,e=-g/2,f=-a/2,k=(g*g+a*a)/4-1;if(0>k)return{x:0,y:0,ratio:-1};k=Math.sqrt(k);return{x:e,y:f,ratio:1E3<k?-1:k,a:g,b:a}}(b,d);1E3<k.a||1E3<k.b||0>k.ratio?(f.beginPath(),f.moveTo(b.x*e,b.y*e),f.lineTo(d.x*e,d.y*e)):(d=Math.atan2(d.y-k.y,d.x-k.x),b=Math.atan2(b.y-k.y,b.x-k.x),g=g(d,b),f.beginPath(),
f.arc(k.x*e,k.y*e,k.ratio*e,d,b,g));f.stroke()},contains:q.lambda(!1)}};D.Plot={initialize:function(b,d){this.viz=b;this.config=b.config;this.node=b.config.Node;this.edge=b.config.Edge;this.animation=new C;this.nodeTypes=new d.Plot.NodeTypes;this.edgeTypes=new d.Plot.EdgeTypes;this.labels=b.labels},nodeHelper:fa,edgeHelper:ga,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",
dimArray:"array-number",vertices:"polygon"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(b,d,e){return b+(d-b)*e},moebius:function(b,d,e,f){d=f.scale(-e);if(1>d.norm()){e=d.x;f=d.y;var g=b.startPos.getc().moebiusTransformation(d);b.pos.setc(g.x,g.y);d.x=e;d.y=f}},linear:function(b,d,e){d=b.startPos.getc(!0);
var f=b.endPos.getc(!0);b.pos.setc(this.compute(d.x,f.x,e),this.compute(d.y,f.y,e))},polar:function(b,d,e){d=b.startPos.getp(!0);e=b.endPos.getp().interpolate(d,e);b.pos.setp(e.theta,e.rho)},number:function(b,d,e,f,g){var k=b[f](d,"start");f=b[f](d,"end");b[g](d,this.compute(k,f,e))},color:function(b,d,e,f,g){var k=q.hexToRgb(b[f](d,"start"));f=q.hexToRgb(b[f](d,"end"));var l=this.compute;e=q.rgbToHex([parseInt(l(k[0],f[0],e)),parseInt(l(k[1],f[1],e)),parseInt(l(k[2],f[2],e))]);b[g](d,e)},"array-number":function(b,
d,e,f,g){var k=b[f](d,"start");f=b[f](d,"end");for(var l=[],s=0,a=k.length;s<a;s++){var m=k[s],n=f[s];if(m.length){for(var q=0,t=m.length,w=[];q<t;q++)w.push(this.compute(m[q],n[q],e));l.push(w)}else l.push(this.compute(m,n,e))}b[g](d,l)},node:function(b,d,e,f,g,k){f=this[f];if(d)for(var l=d.length,s=0;s<l;s++){var a=d[s];this[f[a]](b,a,e,g,k)}else for(a in f)this[f[a]](b,a,e,g,k)},edge:function(b,d,e,f,g,k){b=b.adjacencies;for(var l in b)this.node(b[l],d,e,f,g,k)},"node-property":function(b,d,e){this.node(b,
d,e,"map","getData","setData")},"edge-property":function(b,d,e){this.edge(b,d,e,"map","getData","setData")},"label-property":function(b,d,e){this.node(b,d,e,"label","getLabelData","setLabelData")},"node-style":function(b,d,e){this.node(b,d,e,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(b,d,e){this.edge(b,d,e,"canvas","getCanvasStyle","setCanvasStyle")},polygon:function(b,d,e,f,g){var k=b[f](d,"start");f=b[f](d,"end");var l=[];if("undefined"==typeof k.offset)if(0===k)k=q.map(f,
function(){return new $jit.Complex(0,0)}),k.offset=0;else{for(0==k.length&&k.push(new $jit.Complex(0,0));k.length<f.length;)k.push(k[0]);for(;k.length>f.length;)f.push(f[0]||new $jit.Complex(0,0));if(0==k.length)return;for(var s=k.length,a=1E300,m=0;m<s;m++){for(var n=0,v=0;v<s;v++)n+=Geometry.dist2(k[(m+v)%s],f[v]);n<a&&(k.offset=m,a=n)}}v=0;for(s=k.length;v<s;v++)a=k[(v+k.offset)%s],m=f[v],l.push(new $jit.Complex(this.compute(a.x,m.x,e),this.compute(a.y,m.y,e)));b[g](d,l)}},sequence:function(b){var d=
this;b=q.merge({condition:q.lambda(!1),step:q.empty,onComplete:q.empty,duration:200},b||{});var e=setInterval(function(){b.condition()?b.step():(clearInterval(e),b.onComplete());d.viz.refresh(!0)},b.duration)},prepare:function(b){var d=this.viz.graph,e={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},f={};if("array"==
q.type(b))for(var g=0,k=b.length;g<k;g++){var l=b[g].split(":");f[l.shift()]=l}else for(g in b)"position"==g?f[b.position]=[]:f[g]=q.splat(b[g]);d.eachNode(function(b){b.startPos.set(b.pos);q.each(["node-property","node-style"],function(a){if(a in f)for(var d=f[a],g=0,k=d.length;g<k;g++)b[e[a].setter](d[g],b[e[a].getter](d[g]),"start")});q.each(["edge-property","edge-style"],function(a){if(a in f){var d=f[a];b.eachAdjacency(function(b){for(var f=0,g=d.length;f<g;f++)b[e[a].setter](d[f],b[e[a].getter](d[f]),
"start")})}})});return f},animate:function(b,d){b=q.merge(this.viz.config,b||{});var e=this,f=this.viz.graph,g=this.Interpolator,k="nodefx"===b.type?this.nodeFxAnimation:this.animation,l=this.prepare(b.modes);b.hideLabels&&this.labels.hideLabels(!0);k.setOptions(q.extend(b,{$animating:!1,compute:function(k){f.eachNode(function(a){for(var b in l)g[b](a,l[b],k,d)});e.plot(b,this.$animating,k);this.$animating=!0},complete:function(){b.hideLabels&&e.labels.hideLabels(!1);e.plot(b);b.onComplete()}})).start()},
nodeFx:function(b){void 0==this.nodeFxAnimation&&(this.nodeFxAnimation=new C);var d=this.viz,e=d.graph,f=this.nodeFxAnimation,g=q.merge(this.viz.config,{elements:{id:!1,properties:{}},reposition:!1});b=q.merge(g,b||{},{onBeforeCompute:q.empty,onAfterCompute:q.empty});f.stopTimer();var k=b.elements.properties;b.elements.id?(f=q.splat(b.elements.id),q.each(f,function(b){if(b=e.getNode(b))for(var a in k)b.setData(a,k[a],"end")})):e.eachNode(function(b){for(var a in k)b.setData(a,k[a],"end")});var f=
[],l;for(l in k)f.push(l);l=["node-property:"+f.join(":")];b.reposition&&(l.push("linear"),d.compute("end"));this.animate(q.merge(b,{modes:l,type:"nodefx"}))},plot:function(b,d){var e=this.viz,f=e.graph,g=e.canvas,e=e.root,k=this;g.getCtx();b=b||this.viz.controller;b.clearCanvas&&g.clear();if(e=f.getNode(e)){var l=!!e.visited;f.eachNode(function(e){var a=e.getData("alpha");e.eachAdjacency(function(a){var f=a.nodeTo;!!f.visited===l&&e.drawn&&f.drawn&&(!d&&b.onBeforePlotLine(a),k.plotLine(a,g,d),!d&&
b.onAfterPlotLine(a))});e.drawn&&(!d&&b.onBeforePlotNode(e),k.plotNode(e,g,d),!d&&b.onAfterPlotNode(e));!k.labelsHidden&&b.withLabels&&(e.drawn&&.95<=a?k.labels.plotLabel(g,e,b):k.labels.hideLabel(e,!1));e.visited=!l})}},plotTree:function(b,d,e){var f=this,g=this.viz.canvas;g.getCtx();var k=b.getData("alpha");b.eachSubnode(function(k){if(d.plotSubtree(b,k)&&k.exist&&k.drawn){var s=b.getAdjacency(k.id);!e&&d.onBeforePlotLine(s);f.plotLine(s,g,e);!e&&d.onAfterPlotLine(s);f.plotTree(k,d,e)}});b.drawn?
(!e&&d.onBeforePlotNode(b),this.plotNode(b,g,e),!e&&d.onAfterPlotNode(b),!d.hideLabels&&d.withLabels&&.95<=k?this.labels.plotLabel(g,b,d):this.labels.hideLabel(b,!1)):this.labels.hideLabel(b,!0)},plotNode:function(b,d,e){var f=b.getData("type"),g=this.node.CanvasStyles;if("none"!=f){var k=b.getData("lineWidth"),l=b.getData("color"),s=b.getData("alpha"),a=d.getCtx();a.save();a.lineWidth=k;a.fillStyle=a.strokeStyle=l;a.globalAlpha=s;for(var m in g)a[m]=b.getCanvasStyle(m);this.nodeTypes[f].render.call(this,
b,d,e);a.restore()}},plotLine:function(b,d,e){var f=b.getData("type"),g=this.edge.CanvasStyles;if("none"!=f){var k=b.getData("lineWidth"),l=b.getData("color"),s=d.getCtx(),a=b.nodeFrom,m=b.nodeTo;s.save();s.lineWidth=k;s.fillStyle=s.strokeStyle=l;s.globalAlpha=Math.min(a.getData("alpha"),m.getData("alpha"),b.getData("alpha"));for(var n in g)s[n]=b.getCanvasStyle(n);this.edgeTypes[f].render.call(this,b,d,e);s.restore()}}};D.Plot3D=q.merge(D.Plot,{Interpolator:{linear:function(b,d,e){d=b.startPos.getc(!0);
var f=b.endPos.getc(!0);b.pos.setc(this.compute(d.x,f.x,e),this.compute(d.y,f.y,e),this.compute(d.z,f.z,e))}},plotNode:function(b,d){"none"!=b.getData("type")&&this.plotElement(b,d,{getAlpha:function(){return b.getData("alpha")}})},plotLine:function(b,d){"none"!=b.getData("type")&&this.plotElement(b,d,{getAlpha:function(){return Math.min(b.nodeFrom.getData("alpha"),b.nodeTo.getData("alpha"),b.getData("alpha"))}})},plotElement:function(b,d,e){var f=d.getCtx(),g=new Matrix4,k=d.config.Scene.Lighting,
l=d.canvases[0];d=l.program;l=l.camera;b.geometry||(b.geometry=new (O3D[b.getData("type")]));b.geometry.update(b);if(!b.webGLVertexBuffer){for(var s=[],a=[],m=[],n=0,v=b.geometry,t=0,w=v.vertices,v=v.faces,x=v.length;t<x;t++){var A=v[t],y=w[A.a],E=w[A.b],B=w[A.c],C=A.d?w[A.d]:!1,A=A.normal;s.push(y.x,y.y,y.z);s.push(E.x,E.y,E.z);s.push(B.x,B.y,B.z);C&&s.push(C.x,C.y,C.z);m.push(A.x,A.y,A.z);m.push(A.x,A.y,A.z);m.push(A.x,A.y,A.z);C&&m.push(A.x,A.y,A.z);a.push(n,n+1,n+2);C?(a.push(n,n+2,n+3),n+=4):
n+=3}b.webGLVertexBuffer=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,b.webGLVertexBuffer);f.bufferData(f.ARRAY_BUFFER,new Float32Array(s),f.STATIC_DRAW);b.webGLFaceBuffer=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.webGLFaceBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),f.STATIC_DRAW);b.webGLFaceCount=a.length;b.webGLNormalBuffer=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,b.webGLNormalBuffer);f.bufferData(f.ARRAY_BUFFER,new Float32Array(m),f.STATIC_DRAW)}g.multiply(l.matrix,
b.geometry.matrix);f.uniformMatrix4fv(d.viewMatrix,!1,g.flatten());f.uniformMatrix4fv(d.projectionMatrix,!1,l.projectionMatrix.flatten());g=Matrix4.makeInvert(g);g.$transpose();f.uniformMatrix4fv(d.normalMatrix,!1,g.flatten());g=q.hexToRgb(b.getData("color"));g.push(e.getAlpha());f.uniform4f(d.color,g[0]/255,g[1]/255,g[2]/255,g[3]);f.uniform1i(d.enableLighting,k.enable);k.enable&&(k.ambient&&(e=k.ambient,f.uniform3f(d.ambientColor,e[0],e[1],e[2])),k.directional&&(k=k.directional,g=k.color,k=k.direction,
k=(new Vector3(k.x,k.y,k.z)).normalize().$scale(-1),f.uniform3f(d.lightingDirection,k.x,k.y,k.z),f.uniform3f(d.directionalColor,g[0],g[1],g[2])));f.bindBuffer(f.ARRAY_BUFFER,b.webGLVertexBuffer);f.vertexAttribPointer(d.position,3,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,b.webGLNormalBuffer);f.vertexAttribPointer(d.normal,3,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.webGLFaceBuffer);f.drawElements(f.TRIANGLES,b.webGLFaceCount,f.UNSIGNED_SHORT,0)}});D.Label={};D.Label.Native=new w({initialize:function(b){this.viz=
b},plotLabel:function(b,d,e){var f=b.getCtx();d.pos.getc(!0);f.font=d.getLabelData("style")+" "+d.getLabelData("size")+"px "+d.getLabelData("family");f.textAlign=d.getLabelData("textAlign");f.fillStyle=f.strokeStyle=d.getLabelData("color");f.textBaseline=d.getLabelData("textBaseline");this.renderLabel(b,d,e)},renderLabel:function(b,d,e){b=b.getCtx();e=d.pos.getc(!0);b.fillText(d.name,e.x,e.y+d.getData("height")/2)},hideLabel:function(b,d){b=q.splat(b);var e=d?!1:!0;q.each(b,function(b){b._hideLabel=
e})},hideLabels:q.empty});D.Label.DOM=new w({labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(b){return b in this.labels&&null!=this.labels[b]?this.labels[b]:this.labels[b]=document.getElementById(b)},hideLabels:function(b){this.getLabelContainer().style.display=b?"none":"";this.labelsHidden=b},clearLabels:function(b){for(var d in this.labels)if(b||
!this.viz.graph.hasNode(d))this.disposeLabel(d),delete this.labels[d]},disposeLabel:function(b){(b=this.getLabel(b))&&b.parentNode&&b.parentNode.removeChild(b)},hideLabel:function(b,d){b=q.splat(b);var e=d?"":"none",f,g=this;q.each(b,function(b){if(f=g.getLabel(b.id))f.style.display=e})},fitsInCanvas:function(b,d){var e=d.getSize();if(b.w&&b.h){if(b.x>=e.width||b.x<-b.w||b.y>=e.height||b.y<-b.h)return!1}else if(b.x>=e.width||0>b.x||b.y>=e.height||0>b.y)return!1;return!0}});D.Label.HTML=new w({Implements:D.Label.DOM,
plotLabel:function(b,d,e){b=d.id;var f=this.getLabel(b);if(!f&&!(f=document.getElementById(b))){var f=document.createElement("div"),g=this.getLabelContainer();f.id=b;f.className="node";f.style.position="absolute";e.onCreateLabel(f,d);g.appendChild(f);this.labels[d.id]=f}this.placeLabel(f,d,e)}});D.Label.SVG=new w({Implements:D.Label.DOM,plotLabel:function(b,d,e){b=d.id;var f=this.getLabel(b);if(!f&&!(f=document.getElementById(b))){var f=document.createElementNS("http://www.w3.org/2000/svg","svg:text"),
g=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");f.appendChild(g);g=this.getLabelContainer();f.setAttribute("id",b);f.setAttribute("class","node");g.appendChild(f);e.onCreateLabel(f,d);this.labels[d.id]=f}this.placeLabel(f,d,e)}});D.Geom=new w({initialize:function(b){this.viz=b;this.config=b.config;this.node=b.config.Node;this.edge=b.config.Edge},translate:function(b,d){d=q.splat(d);this.viz.graph.eachNode(function(e){q.each(d,function(d){e.getPos(d).$add(b)})})},setRightLevelToShow:function(b,
d,e){var f=this.getRightLevelToShow(b,d),g=this.viz.labels,k=q.merge({execShow:!0,execHide:!0,onHide:q.empty,onShow:q.empty},e||{});b.eachLevel(0,this.config.levelsToShow,function(d){d._depth-b._depth>f?(k.onHide(d),k.execHide&&(d.drawn=!1,d.exist=!1,g.hideLabel(d,!1))):(k.onShow(d),k.execShow&&(d.exist=!0))});b.drawn=!0},getRightLevelToShow:function(b,d){var e=this.config,f=e.levelsToShow;if(!e.constrained)return f;for(;!this.treeFitsInCanvas(b,d,f)&&1<f;)f--;return f}});var Y={construct:function(b){var d=
"array"==q.type(b),e=new D(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);d?function(b,d){for(var e=function(a){for(var e=0,k=d.length;e<k;e++)if(d[e].id==a)return d[e];return b.addNode({id:a,name:a})},l=0,s=d.length;l<s;l++){b.addNode(d[l]);var a=d[l].adjacencies;if(a)for(var m=0,n=a.length;m<n;m++){var v=a[m],t={};"string"!=typeof a[m]&&(t=q.merge(v.data,{}),v=v.nodeTo);b.addAdjacence(d[l],e(v),t)}}}(e,b):function(b,d){b.addNode(d);if(d.children)for(var e=0,l=d.children;e<
l.length;e++)b.addAdjacence(d,l[e]),arguments.callee(b,l[e])}(e,b);return e},loadJSON:function(b,d){this.json=b;this.labels&&this.labels.clearLabels&&this.labels.clearLabels(!0);this.graph=this.construct(b);"array"!=q.type(b)?this.root=b.id:this.root=b[d?d:0].id},toJSON:function(b){if("tree"==(b||"tree"))var d={},d=function g(b){var d={};d.id=b.id;d.name=b.name;d.data=b.data;var e=[];b.eachSubnode(function(a){e.push(g(a))});d.children=e;return d}(this.graph.getNode(this.root));else{var d=[],e=!!this.graph.getNode(this.root).visited;
this.graph.eachNode(function(b){var k={};k.id=b.id;k.name=b.name;k.data=b.data;var l=[];b.eachAdjacency(function(b){var a=b.nodeTo;if(!!a.visited===e){var d={};d.nodeTo=a.id;d.data=b.data;l.push(d)}});k.adjacencies=l;d.push(k);b.visited=!e})}return d}},S=$jit.Layouts={},la={label:null,compute:function(b,d,e){this.initializeLabel(e);var f=this.label,g=f.style;b.eachNode(function(b){var d=b.getData("autoWidth"),e=b.getData("autoHeight");if(d||e){delete b.data.$width;delete b.data.$height;delete b.data.$dim;
var a=b.getData("width"),m=b.getData("height");g.width=d?"auto":a+"px";g.height=e?"auto":m+"px";f.innerHTML=b.name;d=f.offsetWidth;e=f.offsetHeight;a=b.getData("type");-1===q.indexOf(["circle","square","triangle","star"],a)?(b.setData("width",d),b.setData("height",e)):(d=d>e?d:e,b.setData("width",d),b.setData("height",d),b.setData("dim",d))}})},initializeLabel:function(b){this.label||(this.label=document.createElement("div"),document.body.appendChild(this.label));this.setLabelStyles(b)},setLabelStyles:function(b){q.extend(this.label.style,
{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};S.Tree=function(){function b(a,b,d,e,f){var g=b.Node,k=b.multitree;if(g.overridable){var l=-1,m=-1;a.eachNode(function(a){if(a._depth==d&&(!k||"$orn"in a.data&&a.data.$orn==e)){var b=a.getData("width",f);a=a.getData("height",f);l=l<b?b:l;m=m<a?a:m}});return{width:0>l?g.width:l,height:0>m?g.height:m}}return g}function d(a,b,d,e){e="left"==e||"right"==e?"y":"x";a.getPos(b)[e]+=d}function e(a,
b){var d=[];q.each(a,function(a){a=n.call(a);a[0]+=b;a[1]+=b;d.push(a)});return d}function f(a,b){if(0==a.length)return b;if(0==b.length)return a;var d=a.shift(),e=b.shift();return[[d[0],e[1]]].concat(f(a,b))}function g(a,b){b=b||[];if(0==a.length)return b;var d=a.pop();return g(a,f(d,b))}function k(a,b,d,e,f){if(a.length<=f||b.length<=f)return 0;var g=a[f][1],l=b[f][0];return Math.max(k(a,b,d,e,++f)+d,g-l+e)}function l(a,b,d){function g(a,l,m){if(l.length<=m)return[];var n=l[m],s=k(a,n,b,d,0);return[s].concat(g(f(a,
e(n,s)),l,++m))}return g([],a,0)}function s(a,b,d){function g(a,l,m){if(l.length<=m)return[];var n=l[m],s=-k(n,a,b,d,0);return[s].concat(g(f(e(n,s),a),l,++m))}a=n.call(a);return g([],a.reverse(),0).reverse()}function a(a,b,d,e){var f=l(a,b,d);a=s(a,b,d);"left"==e?a=f:"right"==e&&(f=a);e=0;for(b=[];e<f.length;e++)b[e]=(f[e]+a[e])/2;return b}function m(f,k,l,m,n){function s(k,t,z){var w=k.getData(I,l),B=[],y=[],O=!1,ha=(t||k.getData(H,l))+m.levelDistance;k.eachSubnode(function(a){a.exist&&(!q||"$orn"in
a.data&&a.data.$orn==n)&&("even"==m.levelSpacing?O||(O=b(f,m,a._depth,n,l)):O={width:a.getData("width"),height:a.getData("height")},a=s(a,O[H],z+ha),B.push(a.tree),y.push(a.extent))});t=a(y,J,F,K);for(var L=0,N=[];L<B.length;L++)d(B[L],l,t[L],n),N.push(e(y[L],t[L]));w=[[-w/2,w/2]].concat(g(N));k.getPos(l)[C]=0;"top"==n||"left"==n?k.getPos(l)[D]=z:k.getPos(l)[D]=-z;return{tree:k,extent:w}}var q=m.multitree,t=["x","y"],w=["width","height"],y=+("left"==n||"right"==n),C=t[y],D=t[1-y],I=w[y],H=w[1-y],
F=m.siblingOffset,J=m.subtreeOffset,K=k.getData("align")||m.align;s(k,!1,0)}var n=Array.prototype.slice;return new w({compute:function(a,b){var d=a||"start",e=this.graph.getNode(this.root);q.extend(e,{drawn:!0,exist:!0,selected:!0});la.compute(this.graph,d,this.config);!b&&"_depth"in e||this.graph.computeLevels(this.root,0,"ignore");this.computePositions(e,d)},computePositions:function(a,b){var d=this.config,e=d.multitree,f=a.getData("align")||d.align,g="center"!==f&&d.indent,d=d.orientation,k=this;
q.each(e?["top","right","bottom","left"]:[d],function(d){m(k.graph,a,b,k.config,d,b);var l=["x","y"][+("left"==d||"right"==d)];(function Ca(a){a.eachSubnode(function(k){k.exist&&(!e||"$orn"in k.data&&k.data.$orn==d)&&(k.getPos(b)[l]+=a.getPos(b)[l],g&&(k.getPos(b)[l]+="left"==f?g:-g),Ca(k))})})(a)})}})}();$jit.ST=function(){function b(b){b=b||this.clickedNode;if(!this.config.constrained)return[];var d=this.geom,k=this.canvas,l=b._depth,s=[];this.graph.eachNode(function(a){a.exist&&!a.selected&&(a.isDescendantOf(b.id)?
a._depth<=l&&s.push(a):s.push(a))});d=d.getRightLevelToShow(b,k);b.eachLevel(d,d,function(a){a.exist&&!a.selected&&s.push(a)});for(d=0;d<e.length;d++)k=this.graph.getNode(e[d]),k.isDescendantOf(b.id)||s.push(k);return s}function d(b){var d=[],e=this.config;this.clickedNode.eachLevel(0,e.levelsToShow,function(b){!e.multitree||"$orn"in b.data||!b.anySubnode(function(b){return b.exist&&!b.drawn})?b.drawn&&!b.anySubnode("drawn")&&d.push(b):d.push(b)});return d}var e=[];return new w({Implements:[Y,L,S.Tree],
initialize:function(b){var d=$jit.ST;b=this.controller=this.config=q.merge(J("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),{levelsToShow:2,levelDistance:30,constrained:!0,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0},b);b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(b.background&&(b.background=q.merge({type:"Circles"},b.background)),this.canvas=new N(this,b),this.config.labelContainer=("string"==
typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");this.graphOptions={klass:K};this.graph=new D(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new d.Label[b.Label.type](this);this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.group=new d.Group(this);this.geom=new d.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(b,d,e){var l=this.geom,s=this.fx,a=this;s.busy||(s.busy=!0,this.contract({onComplete:function(){l.switchOrientation(b);
a.compute("end",!1);s.busy=!1;if("animate"==d)a.onClick(a.clickedNode.id,e);else"replot"==d&&a.select(a.clickedNode.id,e)}},b))},switchAlignment:function(b,d,e){this.config.align=b;if("animate"==d)this.select(this.clickedNode.id,e);else if("replot"==d)this.onClick(this.clickedNode.id,e)},addNodeInPath:function(b){e.push(b);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(b){e.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();
this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(b){b.exist&&(b.drawn=!0)});this.compute("end");this.clickedNode&&this.geom.translate(this.clickedNode.endPos.add({x:this.canvas.translateOffsetX+this.config.offsetX||0,y:this.canvas.translateOffsetY+this.config.offsetY||0}).$scale(-1),"end")},requestNodes:function(b,d){var e=q.merge(this.controller,
d),l=this.config.levelsToShow;if(e.request){var s=[],a=b._depth;b.eachLevel(0,l,function(b){b.drawn&&!b.anySubnode()&&(s.push(b),b._level=l-(b._depth-a))});this.group.requestNodes(s,e)}else e.onComplete()},contract:function(d,e){var k=this.config.orientation,l=this.geom,s=this.group;e&&l.switchOrientation(e);var a=b.call(this);e&&l.switchOrientation(k);s.contract(a,q.merge(this.controller,d))},move:function(b,d){this.compute("end",!1);var e=d.Move,l={x:e.offsetX,y:e.offsetY};e.enable?this.geom.translate(b.endPos.add(l).$scale(-1),
"end"):this.geom.translate(R(l.x,l.y).$scale(-1),"end");this.fx.animate(q.merge(this.controller,{modes:["linear"]},d))},expand:function(b,e){var k=d.call(this,b);this.group.expand(k,q.merge(this.controller,e))},selectPath:function(b){function d(b){null==b||b.selected||(b.selected=!0,q.each(k.group.getSiblings([b])[b.id],function(a){a.exist=!0;a.drawn=!0}),b=b.getParents(),b=0<b.length?b[0]:null,d(b))}var k=this;this.graph.eachNode(function(b){b.selected=!1});var l=0;for(b=[b.id].concat(e);l<b.length;l++)d(this.graph.getNode(b[l]))},
setRoot:function(b,d,e){function l(){if(this.config.multitree&&n.data.$orn){var d={left:"right",right:"left",top:"bottom",bottom:"top"}[n.data.$orn];m.data.$orn=d;(function G(a){a.eachSubnode(function(a){a.id!=b&&(a.data.$orn=d,G(a))})})(m);delete n.data.$orn}this.root=b;this.clickedNode=n;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(n,a,{execHide:!1,onShow:function(a){a.drawn||(a.drawn=!0,a.setData("alpha",1,"end"),a.setData("alpha",0),a.pos.setc(n.pos.x,n.pos.y))}});
this.compute("end");this.busy=!0;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){s.busy=!1;s.onClick(b,{onComplete:function(){e&&e.onComplete()}})}})}if(!this.busy){this.busy=!0;var s=this,a=this.canvas,m=this.graph.getNode(this.root),n=this.graph.getNode(b);delete m.data.$orns;"animate"==d?(l.call(this),s.selectPath(n)):"replot"==d&&(l.call(this),this.select(this.root))}},addSubtree:function(b,d,e){"replot"==d?this.op.sum(b,q.extend({type:"replot"},e||{})):"animate"==
d&&this.op.sum(b,q.extend({type:"fade:seq"},e||{}))},removeSubtree:function(b,d,e,l){var s=[];this.graph.getNode(b).eachLevel(+!d,!1,function(a){s.push(a.id)});"replot"==e?this.op.removeNode(s,q.extend({type:"replot"},l||{})):"animate"==e&&this.op.removeNode(s,q.extend({type:"fade:seq"},l||{}))},select:function(e,g){var k=this.group,l=this.geom,s=this.graph.getNode(e),a=this.canvas;this.graph.getNode(this.root);var m=q.merge(this.controller,g),n=this;m.onBeforeCompute(s);this.selectPath(s);this.clickedNode=
s;this.requestNodes(s,{onComplete:function(){k.hide(k.prepare(b.call(n)),m);l.setRightLevelToShow(s,a);n.compute("current");n.graph.eachNode(function(a){var b=a.pos.getc(!0);a.startPos.setc(b.x,b.y);a.endPos.setc(b.x,b.y);a.visited=!1});n.geom.translate(s.endPos.add({x:m.offsetX,y:m.offsetY}).$scale(-1),["start","current","end"]);k.show(d.call(n));n.plot();m.onAfterCompute(n.clickedNode);m.onComplete()}})},onClick:function(b,d){var e=this.canvas,l=this,s=this.geom,a=this.config,m=q.merge(this.controller,
{Move:{enable:!0,offsetX:e.translateOffsetX+a.offsetX||0,offsetY:e.translateOffsetY+a.offsetY||0},setRightLevelToShowConfig:!1,onBeforeRequest:q.empty,onBeforeContract:q.empty,onBeforeMove:q.empty,onBeforeExpand:q.empty},d);if(!this.busy){this.busy=!0;var n=this.graph.getNode(b);this.selectPath(n,this.clickedNode);this.clickedNode=n;m.onBeforeCompute(n);m.onBeforeRequest(n);this.requestNodes(n,{onComplete:function(){m.onBeforeContract(n);l.contract({onComplete:function(){s.setRightLevelToShow(n,e,
m.setRightLevelToShowConfig);m.onBeforeMove(n);l.move(n,{Move:m.Move,onComplete:function(){m.onBeforeExpand(n);l.expand(n,{onComplete:function(){l.busy=!1;m.onAfterCompute(b);m.onComplete()}})}})}})}})}}})}();$jit.ST.$extend=!0;$jit.ST.Op=new w({Implements:D.Op});$jit.ST.Group=new w({initialize:function(b){this.viz=b;this.canvas=b.canvas;this.config=b.config;this.animation=new C;this.nodes=null},requestNodes:function(b,d){var e=0,f=b.length,g=this.viz;if(0==f)d.onComplete();for(var k=0;k<f;k++)d.request(b[k].id,
b[k]._level,{onComplete:function(b,k){k&&k.children&&(k.id=b,g.op.sum(k,{type:"nothing"}));++e==f&&(g.graph.computeLevels(g.root,0),d.onComplete())}})},contract:function(b,d){var e=this;b=this.prepare(b);this.animation.setOptions(q.merge(d,{$animating:!1,compute:function(b){1==b&&(b=.99);e.plotStep(1-b,d,this.$animating);this.$animating="contract"},complete:function(){e.hide(b,d)}})).start()},hide:function(b,d){for(var e=0;e<b.length;e++)b[e].eachLevel(1,!1,function(b){b.exist&&q.extend(b,{drawn:!1,
exist:!1})});d.onComplete()},expand:function(b,d){var e=this;this.show(b);this.animation.setOptions(q.merge(d,{$animating:!1,compute:function(b){e.plotStep(b,d,this.$animating);this.$animating="expand"},complete:function(){e.plotStep(void 0,d,!1);d.onComplete()}})).start()},show:function(b){var d=this.config;this.prepare(b);q.each(b,function(b){if(d.multitree&&!("$orn"in b.data)){delete b.data.$orns;var f=" ";b.eachSubnode(function(b){"$orn"in b.data&&0>f.indexOf(b.data.$orn)&&b.exist&&!b.drawn&&
(f+=b.data.$orn+" ")});b.data.$orns=f}b.eachLevel(0,d.levelsToShow,function(b){b.exist&&(b.drawn=!0)})})},prepare:function(b){return this.nodes=this.getNodesWithChildren(b)},getNodesWithChildren:function(b){var d=[],e=this.config;b.sort(function(b,d){return(b._depth<=d._depth)-(b._depth>=d._depth)});for(var f=0;f<b.length;f++)if(b[f].anySubnode("exist")){for(var g=f+1,k=!1;!k&&g<b.length;g++)if(!e.multitree||"$orn"in b[g].data)k=k||b[f].isDescendantOf(b[g].id);k||d.push(b[f])}return d},plotStep:function(b,
d,e){var f=this.viz,g=this.config,k=f.canvas.getCtx(),l=this.nodes,s,a,m={};for(s=0;s<l.length;s++){a=l[s];m[a.id]=[];var n=g.multitree&&!("$orn"in a.data),t=n&&a.data.$orns;a.eachSubgraph(function(b){n&&t&&0<t.indexOf(b.data.$orn)&&b.drawn?(b.drawn=!1,m[a.id].push(b)):n&&t||!b.drawn||(b.drawn=!1,m[a.id].push(b))});a.drawn=!0}0<l.length&&f.fx.plot();for(s in m)q.each(m[s],function(a){a.drawn=!0});for(s=0;s<l.length;s++)a=l[s],k.save(),f.fx.plotSubtree(a,d,b,e),k.restore()},getSiblings:function(b){var d=
{};q.each(b,function(b){var f=b.getParents();if(0==f.length)d[b.id]=[b];else{var g=[];f[0].eachSubnode(function(b){g.push(b)});d[b.id]=g}});return d}});$jit.ST.Geom=new w({Implements:D.Geom,switchOrientation:function(b){this.config.orientation=b},dispatch:function(){var b=Array.prototype.slice.call(arguments),d=b.shift(),e=b.length,f=function(b){return"function"==typeof b?b():b};if(2==e)return"top"==d||"bottom"==d?f(b[0]):f(b[1]);if(4==e)switch(d){case "top":return f(b[0]);case "right":return f(b[1]);
case "bottom":return f(b[2]);case "left":return f(b[3])}},getSize:function(b,d){var e=b.data,f=this.config,g=f.siblingOffset,e=f.multitree&&"$orn"in e&&e.$orn||f.orientation,f=b.getData("width")+g,g=b.getData("height")+g;return d?this.dispatch(e,f,g):this.dispatch(e,g,f)},getTreeBaseSize:function(b,d,e){var f=this.getSize(b,!0),g=0,k=this;if(e(d,b))return f;if(0===d)return 0;b.eachSubnode(function(b){g+=k.getTreeBaseSize(b,d-1,e)});return(f>g?f:g)+this.config.subtreeOffset},getEdge:function(b,d,e){var f=
function(d,a){return function(){return b.pos.add(new K(d,a))}},g=this.node,g=b.getData("align")||g.align,k=b.getData("width"),l=b.getData("height");if("begin"==d){if("center"==g)return this.dispatch(e,f(0,l/2),f(-k/2,0),f(0,-l/2),f(k/2,0));if("left"==g)return this.dispatch(e,f(0,l),f(0,0),f(0,0),f(k,0));if("right"==g)return this.dispatch(e,f(0,0),f(-k,0),f(0,-l),f(0,0));throw"align: not implemented";}if("end"==d){if("center"==g)return this.dispatch(e,f(0,-l/2),f(k/2,0),f(0,l/2),f(-k/2,0));if("left"==
g)return this.dispatch(e,f(0,0),f(k,0),f(0,l),f(0,0));if("right"==g)return this.dispatch(e,f(0,-l),f(0,0),f(0,0),f(-k,0));throw"align: not implemented";}},getScaledTreePosition:function(b,d){var e=this.node,e=b.getData("align")||e.align,f=b.getData("width"),g=b.getData("height"),k=this.config.multitree&&"$orn"in b.data&&b.data.$orn||this.config.orientation,l=function(e,a){return function(){return b.pos.add(new K(e,a)).$scale(1-d)}};if("left"==e)return this.dispatch(k,l(0,g),l(0,0),l(0,0),l(f,0));
if("center"==e)return this.dispatch(k,l(0,g/2),l(-f/2,0),l(0,-g/2),l(f/2,0));if("right"==e)return this.dispatch(k,l(0,0),l(-f,0),l(0,-g),l(0,0));throw"align: not implemented";},treeFitsInCanvas:function(b,d,e){d=d.getSize();d=this.dispatch(this.config.multitree&&"$orn"in b.data&&b.data.$orn||this.config.orientation,d.width,d.height);return this.getTreeBaseSize(b,e,function(b,d){return 0===b||!d.anySubnode()})<d}});$jit.ST.Plot=new w({Implements:D.Plot,plotSubtree:function(b,d,e,f){var g=this.viz,
k=g.canvas,l=g.config;e=Math.min(Math.max(.001,e),1);0<=e&&(b.drawn=!1,k=k.getCtx(),g=g.geom.getScaledTreePosition(b,e),k.translate(g.x,g.y),k.scale(e,e));this.plotTree(b,q.merge(d,{withLabels:!0,hideLabels:!!e,plotSubtree:function(d,a){var e=l.multitree&&!("$orn"in b.data),f=e&&b.getData("orns");return!e||-1<f.indexOf(b.getData("orn"))}}),f);0<=e&&(b.drawn=!0)},getAlignedPos:function(b,d,e){var f=this.node;if("center"==f.align)b={x:b.x-d/2,y:b.y-e/2};else if("left"==f.align)f=this.config.orientation,
b="bottom"==f||"top"==f?{x:b.x-d/2,y:b.y}:{x:b.x,y:b.y-e/2};else if("right"==f.align)f=this.config.orientation,b="bottom"==f||"top"==f?{x:b.x-d/2,y:b.y-e}:{x:b.x-d,y:b.y-e/2};else throw"align: not implemented";return b},getOrientation:function(b){var d=this.config,e=d.orientation;d.multitree&&(d=b.nodeFrom,b=b.nodeTo,e="$orn"in d.data&&d.data.$orn||"$orn"in b.data&&b.data.$orn);return e}});$jit.ST.Label={};$jit.ST.Label.Native=new w({Implements:D.Label.Native,renderLabel:function(b,d,e){b=b.getCtx();
var f=d.pos.getc(!0);e=d.getData("width");var g=d.getData("height"),f=this.viz.fx.getAlignedPos(f,e,g);b.fillText(d.name,f.x+e/2,f.y+g/2)}});$jit.ST.Label.DOM=new w({Implements:D.Label.DOM,placeLabel:function(b,d,e){var f=d.pos.getc(!0),g=this.viz.config,k=g.Node,l=d.getData("align")||k.align,k=this.viz.canvas,s=d.getData("width"),a=d.getData("height"),m=k.getSize(),n=f.x*k.scaleOffsetX+k.translateOffsetX,f=f.y*k.scaleOffsetY+k.translateOffsetY;if("center"==l)g={x:Math.round(n-s/2+m.width/2),y:Math.round(f-
a/2+m.height/2)};else if("left"==l)g=g.orientation,g="bottom"==g||"top"==g?{x:Math.round(n-s/2+m.width/2),y:Math.round(f+m.height/2)}:{x:Math.round(n+m.width/2),y:Math.round(f-a/2+m.height/2)};else if("right"==l)g=g.orientation,g="bottom"==g||"top"==g?{x:Math.round(n-s/2+m.width/2),y:Math.round(f-a+m.height/2)}:{x:Math.round(n-s+m.width/2),y:Math.round(f-a/2+m.height/2)};else throw"align: not implemented";g.w=s;g.h=a;s=b.style;s.left=g.x+"px";s.top=g.y+"px";s.display=this.fitsInCanvas(g,k)?"":"none";
e.onPlaceLabel(b,d)}});$jit.ST.Label.SVG=new w({Implements:[$jit.ST.Label.DOM,D.Label.SVG],initialize:function(b){this.viz=b}});$jit.ST.Label.HTML=new w({Implements:[$jit.ST.Label.DOM,D.Label.HTML],initialize:function(b){this.viz=b}});$jit.ST.Plot.NodeTypes=new w({none:{render:q.empty,contains:q.lambda(!1)},circle:{render:function(b,d){var e=b.getData("dim"),f=this.getAlignedPos(b.pos.getc(!0),e,e),e=e/2;this.nodeHelper.circle.render("fill",{x:f.x+e,y:f.y+e},e,d)},contains:function(b,d){var e=b.getData("dim"),
f=this.getAlignedPos(b.pos.getc(!0),e,e),e=e/2;return this.nodeHelper.circle.contains({x:f.x+e,y:f.y+e},d,e)}},square:{render:function(b,d){var e=b.getData("dim"),f=e/2,e=this.getAlignedPos(b.pos.getc(!0),e,e);this.nodeHelper.square.render("fill",{x:e.x+f,y:e.y+f},f,d)},contains:function(b,d){var e=b.getData("dim"),f=this.getAlignedPos(b.pos.getc(!0),e,e),e=e/2;return this.nodeHelper.square.contains({x:f.x+e,y:f.y+e},d,e)}},ellipse:{render:function(b,d){var e=b.getData("width"),f=b.getData("height"),
g=this.getAlignedPos(b.pos.getc(!0),e,f);this.nodeHelper.ellipse.render("fill",{x:g.x+e/2,y:g.y+f/2},e,f,d)},contains:function(b,d){var e=b.getData("width"),f=b.getData("height"),g=this.getAlignedPos(b.pos.getc(!0),e,f);return this.nodeHelper.ellipse.contains({x:g.x+e/2,y:g.y+f/2},d,e,f)}},rectangle:{render:function(b,d){var e=b.getData("width"),f=b.getData("height"),g=this.getAlignedPos(b.pos.getc(!0),e,f);this.nodeHelper.rectangle.render("fill",{x:g.x+e/2,y:g.y+f/2},e,f,d)},contains:function(b,
d){var e=b.getData("width"),f=b.getData("height"),g=this.getAlignedPos(b.pos.getc(!0),e,f);return this.nodeHelper.rectangle.contains({x:g.x+e/2,y:g.y+f/2},d,e,f)}}});$jit.ST.Plot.EdgeTypes=new w({none:q.empty,line:{render:function(b,d){var e=this.getOrientation(b),f=b.nodeFrom,g=b.nodeTo,k=f._depth<g._depth,l=this.viz.geom.getEdge(k?f:g,"begin",e),e=this.viz.geom.getEdge(k?g:f,"end",e);this.edgeHelper.line.render(l,e,d)},contains:function(b,d){var e=this.getOrientation(b),f=b.nodeFrom,g=b.nodeTo,
k=f._depth<g._depth,l=this.viz.geom.getEdge(k?f:g,"begin",e),e=this.viz.geom.getEdge(k?g:f,"end",e);return this.edgeHelper.line.contains(l,e,d,this.edge.epsilon)}},arrow:{render:function(b,d){var e=this.getOrientation(b),f=b.nodeFrom,g=b.nodeTo,k=f._depth<g._depth,l=b.getData("dim"),s=this.viz.geom.getEdge(k?f:g,"begin",e),e=this.viz.geom.getEdge(k?g:f,"end",e),g=b.data.$direction;this.edgeHelper.arrow.render(s,e,l,g&&1<g.length&&g[0]!=f.id,d)},contains:function(b,d){var e=this.getOrientation(b),
f=b.nodeFrom,g=b.nodeTo,k=f._depth<g._depth,l=this.viz.geom.getEdge(k?f:g,"begin",e),e=this.viz.geom.getEdge(k?g:f,"end",e);return this.edgeHelper.arrow.contains(l,e,d,this.edge.epsilon)}},"quadratic:begin":{render:function(b,d){var e=this.getOrientation(b),f=b.nodeFrom,g=b.nodeTo,k=f._depth<g._depth,l=this.viz.geom.getEdge(k?f:g,"begin",e),f=this.viz.geom.getEdge(k?g:f,"end",e),g=b.getData("dim"),k=d.getCtx();k.beginPath();k.moveTo(l.x,l.y);switch(e){case "left":k.quadraticCurveTo(l.x+g,l.y,f.x,
f.y);break;case "right":k.quadraticCurveTo(l.x-g,l.y,f.x,f.y);break;case "top":k.quadraticCurveTo(l.x,l.y+g,f.x,f.y);break;case "bottom":k.quadraticCurveTo(l.x,l.y-g,f.x,f.y)}k.stroke()}},"quadratic:end":{render:function(b,d){var e=this.getOrientation(b),f=b.nodeFrom,g=b.nodeTo,k=f._depth<g._depth,l=this.viz.geom.getEdge(k?f:g,"begin",e),f=this.viz.geom.getEdge(k?g:f,"end",e),g=b.getData("dim"),k=d.getCtx();k.beginPath();k.moveTo(l.x,l.y);switch(e){case "left":k.quadraticCurveTo(f.x-g,f.y,f.x,f.y);
break;case "right":k.quadraticCurveTo(f.x+g,f.y,f.x,f.y);break;case "top":k.quadraticCurveTo(f.x,f.y-g,f.x,f.y);break;case "bottom":k.quadraticCurveTo(f.x,f.y+g,f.x,f.y)}k.stroke()}},bezier:{render:function(b,d){var e=this.getOrientation(b),f=b.nodeFrom,g=b.nodeTo,k=f._depth<g._depth,l=this.viz.geom.getEdge(k?f:g,"begin",e),f=this.viz.geom.getEdge(k?g:f,"end",e),g=b.getData("dim"),k=d.getCtx();k.beginPath();k.moveTo(l.x,l.y);switch(e){case "left":k.bezierCurveTo(l.x+g,l.y,f.x-g,f.y,f.x,f.y);break;
case "right":k.bezierCurveTo(l.x-g,l.y,f.x+g,f.y,f.x,f.y);break;case "top":k.bezierCurveTo(l.x,l.y+g,f.x,f.y-g,f.x,f.y);break;case "bottom":k.bezierCurveTo(l.x,l.y-g,f.x,f.y+g,f.x,f.y)}k.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(b,d){var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height"),g=this.getAlignedPos(e,f,g),e=g.x,g=g.y,k=b.getData("stringArray"),l=b.getData("dimArray"),s=b.getData("valueArray"),a=q.reduce(s,function(a,b){return a+b[0]},0),
m=q.reduce(s,function(a,b){return a+b[1]},0),n=b.getData("colorArray"),t=n.length,z=b.getData("config"),w=b.getData("gradient"),x=z.showLabels,A=z.showAggregates,y=z.Label,E=b.getData("prev"),B=d.getCtx(),C=b.getData("border");if(n&&l&&k){for(var D=0,I=l.length,H=0,F=0,J=0;D<I;D++){B.fillStyle=B.strokeStyle=n[D%t];B.save();if(w&&(0<l[D][0]||0<l[D][1])){var K=H+l[D][0],T=F+l[D][1],L=Math.atan((T-K)/f),T=B.createLinearGradient(e+f/2,g-(K+T)/2,e+f/2+55*Math.sin(L),g-(K+T)/2+55*Math.cos(L)),K=q.rgbToHex(q.map(q.hexToRgb(n[D%
t].slice(1)),function(a){return.85*a>>0}));T.addColorStop(0,n[D%t]);T.addColorStop(1,K);B.fillStyle=T}B.beginPath();B.moveTo(e,g-H);B.lineTo(e+f,g-F);B.lineTo(e+f,g-F-l[D][1]);B.lineTo(e,g-H-l[D][0]);B.lineTo(e,g-H);B.fill();B.restore();if(C){var N=(T=C.name==k[D])?.7:.8,K=q.rgbToHex(q.map(q.hexToRgb(n[D%t].slice(1)),function(a){return a*N>>0}));B.strokeStyle=K;B.lineWidth=T?4:1;B.save();B.beginPath();0===C.index?(B.moveTo(e,g-H),B.lineTo(e,g-H-l[D][0])):(B.moveTo(e+f,g-F),B.lineTo(e+f,g-F-l[D][1]));
B.stroke();B.restore()}H+=l[D][0]||0;F+=l[D][1]||0;0<l[D][0]&&(J+=s[D][0]||0)}E&&"Native"==y.type&&(B.save(),B.beginPath(),B.fillStyle=B.strokeStyle=y.color,B.font=y.style+" "+y.size+"px "+y.family,B.textAlign="center",B.textBaseline="middle",k=A(b.name,a,m,b,J),!1!==k&&B.fillText(!0!==k?k:J,e,g-H-z.labelOffset-y.size/2,f),f=x(b.name,a,m,b),!1!==f&&B.fillText(!0!==f?f:b.name,e,g+y.size/2+z.labelOffset),B.restore())}},contains:function(b,d){var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height"),
e=this.getAlignedPos(e,f,g),k=e.x,l=e.y,e=b.getData("dimArray"),s=d.x-k;if(d.x<k||d.x>k+f||d.y>l||d.y<l-g)return!1;for(var g=0,k=e.length,a=l;g<k;g++){var m=e[g],a=a-m[0],l=l-m[1];if(d.y>=a+(l-a)*s/f)return f=+(s>f/2),{name:b.getData("stringArray")[g],color:b.getData("colorArray")[g],value:b.getData("valueArray")[g][f],index:f}}return!1}}});$jit.AreaChart=new w({st:null,colors:"#416D9C #70A35E #EBB056 #C74243 #83548B #909291 #557EAA".split(" "),selected:{},busy:!1,initialize:function(b){this.controller=
this.config=q.merge(J("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},b);b=this.config.showLabels;var d=q.type(b),e=this.config.showAggregates,f=q.type(e);this.config.showLabels="function"==d?b:q.lambda(b);this.config.showAggregates="function"==f?e:q.lambda(e);this.initializeViz()},initializeViz:function(){var b=this.config,d=this,e=b.type.split(":")[0],f={},e=new $jit.ST({injectInto:b.injectInto,width:b.width,height:b.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,
withLabels:"Native"!=b.Label.type,useCanvas:b.useCanvas,Label:{type:b.Label.type},Node:{overridable:!0,type:"areachart-"+e,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:b.Tips.enable,type:"Native",force:!0,onShow:function(d,e,a){b.Tips.onShow(d,a,e)}},Events:{enable:!0,type:"Native",onClick:function(e,f,a){if(b.filterOnClick||b.Events.enable)(e=f.getContains())&&b.filterOnClick&&d.filter(e.name),b.Events.enable&&b.Events.onClick(e,f,a)},onRightClick:function(e,f,a){b.restoreOnRightClick&&
d.restore()},onMouseMove:function(e,f,a){b.selectOnHover&&(e?(f=f.getContains(),d.select(e.id,f.name,f.index)):d.select(!1,!1,!1))}},onCreateLabel:function(d,e){var a=b.Label,g=e.getData("valueArray"),k=q.reduce(g,function(a,b){return a+b[0]},0),g=q.reduce(g,function(a,b){return a+b[1]},0);if(e.getData("prev")){var t={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},z=t.wrapper,w=t.label,x=t.aggregate,A=z.style,y=w.style,E=x.style;
f[e.id]=t;z.appendChild(w);z.appendChild(x);b.showLabels(e.name,k,g,e)||(w.style.display="none");b.showAggregates(e.name,k,g,e)||(x.style.display="none");A.position="relative";A.overflow="visible";A.fontSize=a.size+"px";A.fontFamily=a.family;A.color=a.color;A.textAlign="center";E.position=y.position="absolute";d.style.width=e.getData("width")+"px";d.style.height=e.getData("height")+"px";w.innerHTML=e.name;d.appendChild(z)}},onPlaceLabel:function(d,e){if(e.getData("prev")){var a=f[e.id],g=a.wrapper.style,
k=a.label.style,t=a.aggregate.style,z=e.getData("width");e.getData("height");var w=e.getData("dimArray"),x=e.getData("valueArray"),A=q.reduce(x,function(a,b){return a+b[0]},0),y=q.reduce(x,function(a,b){return a+b[1]},0),E=parseInt(g.fontSize,10);if(w&&x){b.showLabels(e.name,A,y,e)?k.display="":k.display="none";A=b.showAggregates(e.name,A,y,e);t.display=!1!==A?"":"none";g.width=t.width=k.width=d.style.width=z+"px";t.left=k.left=-z/2+"px";for(var z=0,y=x.length,B=0,C=0;z<y;z++)0<w[z][0]&&(B+=x[z][0],
C+=w[z][0]);t.top=-E-b.labelOffset+"px";k.top=b.labelOffset+C+"px";d.style.top=parseInt(d.style.top,10)-C+"px";d.style.height=g.height=C+"px";a.aggregate.innerHTML=!0!==A?A:B}}}}),g=e.canvas.getSize(),k=b.Margin;e.config.offsetY=-g.height/2+k.bottom+(b.showLabels&&b.labelOffset+b.Label.size);e.config.offsetX=(k.right-k.left)/2;this.delegate=e;this.canvas=this.delegate.canvas},loadJSON:function(b){var d=q.time(),e=[],f=this.delegate,g=q.splat(b.label),k=q.splat(b.color||this.colors),l=this.config,
s=!!l.type.split(":")[1],a=l.animate,m=0;b=b.values;for(var n=b.length;m<n-1;m++){var t=b[m],z=b[m-1],w=b[m+1],x=q.splat(b[m].values),A=q.splat(b[m+1].values),x=q.zip(x,A);e.push({id:d+t.label,name:t.label,data:{value:x,$valueArray:x,$colorArray:k,$stringArray:g,$next:w.label,$prev:z?z.label:!1,$config:l,$gradient:s},children:[]})}f.loadJSON({id:d+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:e});this.normalizeDims();f.compute();f.select(f.root);a&&f.fx.animate({modes:["node-property:height:dimArray"],
duration:1500})},updateJSON:function(b,d){if(!this.busy){this.busy=!0;for(var e=this.delegate,f=e.graph,g=b.label&&q.splat(b.label),k=b.values,l=this.config.animate,s=this,a={},m=0,n=k.length;m<n;m++)a[k[m].label]=k[m];f.eachNode(function(b){var d=a[b.name],e=b.getData("stringArray"),f=b.getData("valueArray"),k=b.getData("next");d&&(d.values=q.splat(d.values),q.each(f,function(a,b){a[0]=d.values[b];g&&(e[b]=g[b])}),b.setData("valueArray",f));k&&(d=a[k])&&q.each(f,function(a,b){a[1]=d.values[b]})});
this.normalizeDims();e.compute();e.select(e.root);l&&e.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){s.busy=!1;d&&d.onComplete()}})}},filter:function(b,d){if(!this.busy){this.busy=!0;this.config.Tips.enable&&this.delegate.tips.hide();this.select(!1,!1,!1);var e=q.splat(b),f=this.delegate.graph.getNode(this.delegate.root),g=this;this.normalizeDims();f.eachAdjacency(function(b){b=b.nodeTo;var d=b.getData("dimArray","end"),f=b.getData("stringArray");b.setData("dimArray",
q.map(d,function(a,b){return-1<q.indexOf(e,f[b])?a:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){g.busy=!1;d&&d.onComplete()}})}},restore:function(b){if(!this.busy){this.busy=!0;this.config.Tips.enable&&this.delegate.tips.hide();this.select(!1,!1,!1);this.normalizeDims();var d=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){d.busy=!1;b&&b.onComplete()}})}},select:function(b,
d,e){if(this.config.selectOnHover){var f=this.selected;if(f.id!=b||f.name!=d||f.index!=e)f.id=b,f.name=d,f.index=e,this.delegate.graph.eachNode(function(b){b.setData("border",!1)}),b&&(b=this.delegate.graph.getNode(b),b.setData("border",f),(f=b.getData(0===e?"prev":"next"))&&(b=this.delegate.graph.getByName(f))&&b.setData("border",{name:d,index:1-e})),this.delegate.plot()}},getLegend:function(){var b={},d;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(b){d=b.nodeTo});var e=
d.getData("colorArray"),f=e.length;q.each(d.getData("stringArray"),function(d,k){b[d]=e[k%f]});return b},getMaxValue:function(){var b=0;this.delegate.graph.eachNode(function(d){d=d.getData("valueArray");var e=0,f=0;q.each(d,function(b){e+=+b[0];f+=+b[1]});d=f>e?f:e;b=b>d?b:d});return b},normalizeDims:function(){var b=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){b++});var d=this.getMaxValue()||1,e=this.delegate.canvas.getSize(),f=this.config,g=f.Margin,k=f.labelOffset+
f.Label.size,l=(e.width-(g.left+g.right))/b,s=f.animate,a=e.height-(g.top+g.bottom)-(f.showAggregates&&k)-(f.showLabels&&k);this.delegate.graph.eachNode(function(b){var e=0,f=0,g=[];q.each(b.getData("valueArray"),function(a){e+=+a[0];f+=+a[1];g.push([0,0])});var k=f>e?f:e;b.setData("width",l);s?(b.setData("height",k*a/d,"end"),b.setData("dimArray",q.map(b.getData("valueArray"),function(b){return[b[0]*a/d,b[1]*a/d]}),"end"),b.getData("dimArray")||b.setData("dimArray",g)):(b.setData("height",k*a/d),
b.setData("dimArray",q.map(b.getData("valueArray"),function(b){return[b[0]*a/d,b[1]*a/d]})))})}});J.BarChart={$extend:!0,animate:!0,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:!0,showLabels:!0,Tips:{enable:!1,onShow:q.empty,onHide:q.empty},Events:{enable:!1,onClick:q.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(b,d){var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height"),k=this.getAlignedPos(e,f,
g),e=k.x,k=k.y,l=b.getData("dimArray"),s=b.getData("valueArray"),a=b.getData("colorArray"),m=a.length,n=b.getData("stringArray"),t=d.getCtx(),z,w,x=b.getData("border"),A=b.getData("gradient"),y=b.getData("config"),E="horizontal"==y.orientation,B=y.showAggregates,C=y.showLabels,D=y.Label;if(a&&l&&n){for(var H=0,I=l.length,F=0,J=0;H<I;H++){t.fillStyle=t.strokeStyle=a[H%m];if(A){var K;K=E?t.createLinearGradient(e+F+l[H]/2,k,e+F+l[H]/2,k+g):t.createLinearGradient(e,k-F-l[H]/2,e+f,k-F-l[H]/2);var T=q.rgbToHex(q.map(q.hexToRgb(a[H%
m].slice(1)),function(a){return.5*a>>0}));K.addColorStop(0,T);K.addColorStop(.5,a[H%m]);K.addColorStop(1,T);t.fillStyle=K}E?t.fillRect(e+F,k,l[H],g):t.fillRect(e,k-F-l[H],f,l[H]);x&&x.name==n[H]&&(z=F,w=l[H]);F+=l[H]||0;J+=s[H]||0}x&&(t.save(),t.lineWidth=2,t.strokeStyle=x.color,E?t.strokeRect(e+z+1,k+1,w-2,g-2):t.strokeRect(e+1,k-z-w+1,f-2,w-2),t.restore());"Native"==D.type&&(t.save(),t.fillStyle=t.strokeStyle=D.color,t.font=D.style+" "+D.size+"px "+D.family,t.textBaseline="middle",z=B(b.name,J,
b),!1!==z&&(z=!0!==z?z:J,E?(t.textAlign="right",t.fillText(z,e+F-y.labelOffset,k+g/2)):(t.textAlign="center",t.fillText(z,e+f/2,k-g-D.size/2-y.labelOffset))),C(b.name,J,b)&&(E?(t.textAlign="center",t.translate(e-y.labelOffset-D.size/2,k+g/2),t.rotate(Math.PI/2),t.fillText(b.name,0,0)):(t.textAlign="center",t.fillText(b.name,e+f/2,k+D.size/2+y.labelOffset))),t.restore())}},contains:function(b,d){var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height"),e=this.getAlignedPos(e,f,g),k=e.x,l=e.y,
e=b.getData("dimArray"),s="horizontal"==b.getData("config").orientation;if(s){if(d.x<k||d.x>k+f||d.y>l+g||d.y<l)return!1}else if(d.x<k||d.x>k+f||d.y>l||d.y<l-g)return!1;f=0;g=e.length;for(k=s?k:l;f<g;f++)if(l=e[f],s){if(l=k+=l,d.x<=l)return{name:b.getData("stringArray")[f],color:b.getData("colorArray")[f],value:b.getData("valueArray")[f],label:b.name}}else if(l=k-=l,d.y>=l)return{name:b.getData("stringArray")[f],color:b.getData("colorArray")[f],value:b.getData("valueArray")[f],label:b.name};return!1}},
"barchart-grouped":{render:function(b,d){var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height"),k=this.getAlignedPos(e,f,g),e=k.x,k=k.y,l=b.getData("dimArray"),s=b.getData("valueArray"),a=s.length,m=b.getData("colorArray"),n=m.length,t=b.getData("stringArray"),z=d.getCtx(),w,x,A=b.getData("border"),y=b.getData("gradient"),E=b.getData("config"),B="horizontal"==E.orientation,C=E.showAggregates,D=E.showLabels,H=E.Label,I=(B?g:f)/a;if(m&&l&&t){for(var F=0,J=0;F<a;F++){z.fillStyle=z.strokeStyle=
m[F%n];if(y){var K;K=B?z.createLinearGradient(e+l[F]/2,k+I*F,e+l[F]/2,k+I*(F+1)):z.createLinearGradient(e+I*F,k-l[F]/2,e+I*(F+1),k-l[F]/2);var T=q.rgbToHex(q.map(q.hexToRgb(m[F%n].slice(1)),function(a){return.5*a>>0}));K.addColorStop(0,T);K.addColorStop(.5,m[F%n]);K.addColorStop(1,T);z.fillStyle=K}B?z.fillRect(e,k+I*F,l[F],I):z.fillRect(e+I*F,k-l[F],I,l[F]);A&&A.name==t[F]&&(w=I*F,x=l[F]);J+=s[F]||0}A&&(z.save(),z.lineWidth=2,z.strokeStyle=A.color,B?z.strokeRect(e+1,k+w+1,x-2,I-2):z.strokeRect(e+
w+1,k-x+1,I-2,x-2),z.restore());"Native"==H.type&&(z.save(),z.fillStyle=z.strokeStyle=H.color,z.font=H.style+" "+H.size+"px "+H.family,z.textBaseline="middle",w=C(b.name,J,b),!1!==w&&(w=!0!==w?w:J,B?(z.textAlign="right",z.fillText(w,e+Math.max.apply(null,l)-E.labelOffset,k+g/2)):(z.textAlign="center",z.fillText(w,e+f/2,k-Math.max.apply(null,l)-H.size/2-E.labelOffset))),w=D(b.name,J,b),!1!==w&&(w=!0!==w?w:b.name,B?(z.textAlign="center",z.translate(e-E.labelOffset-H.size/2,k+g/2),z.rotate(Math.PI/2),
z.fillText(w,0,0)):(z.textAlign="center",z.fillText(w,e+f/2,k+H.size/2+E.labelOffset))),z.restore())}},contains:function(b,d){var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height"),k=this.getAlignedPos(e,f,g),e=k.x,k=k.y,l=b.getData("dimArray"),s=l.length,a="horizontal"==b.getData("config").orientation,s=(a?g:f)/s;if(a){if(d.x<e||d.x>e+f||d.y>k+g||d.y<k)return!1}else if(d.x<e||d.x>e+f||d.y>k||d.y<k-g)return!1;f=0;for(g=l.length;f<g;f++){var m=l[f];if(a){var n=k+s*f;if(d.x<=e+m&&d.y>=n&&d.y<=
n+s)return{name:b.getData("stringArray")[f],color:b.getData("colorArray")[f],value:b.getData("valueArray")[f],label:b.name}}else if(n=e+s*f,d.x>=n&&d.x<=n+s&&d.y>=k-m)return{name:b.getData("stringArray")[f],color:b.getData("colorArray")[f],value:b.getData("valueArray")[f],label:b.name}}return!1}}});$jit.BarChart=new w({st:null,colors:"#416D9C #70A35E #EBB056 #C74243 #83548B #909291 #557EAA".split(" "),selected:{},busy:!1,initialize:function(b){this.controller=this.config=q.merge(J("Canvas","Margin",
"Label","BarChart"),{Label:{type:"Native"}},b);b=this.config.showLabels;var d=q.type(b),e=this.config.showAggregates,f=q.type(e);this.config.showLabels="function"==d?b:q.lambda(b);this.config.showAggregates="function"==f?e:q.lambda(e);this.initializeViz()},initializeViz:function(){var b=this.config,d=this,e=b.type.split(":")[0],f="horizontal"==b.orientation,g={},e=new $jit.ST({injectInto:b.injectInto,width:b.width,height:b.height,orientation:f?"left":"bottom",levelDistance:0,siblingOffset:b.barsOffset,
subtreeOffset:0,withLabels:"Native"!=b.Label.type,useCanvas:b.useCanvas,Label:{type:b.Label.type},Node:{overridable:!0,type:"barchart-"+e,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:b.Tips.enable,type:"Native",force:!0,onShow:function(d,a,e){b.Tips.onShow(d,e,a)}},Events:{enable:!0,type:"Native",onClick:function(d,a,e){b.Events.enable&&(d=a.getContains(),b.Events.onClick(d,a,e))},onMouseMove:function(e,a,f){b.hoveredColor&&(e?(a=a.getContains(),d.select(e.id,a.name,a.index)):d.select(!1,
!1,!1))}},onCreateLabel:function(d,a){var e=b.Label,f=a.getData("valueArray"),f=q.reduce(f,function(a,b){return a+b},0),k={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},l=k.wrapper,t=k.label,x=k.aggregate,w=l.style,y=t.style,E=x.style;g[a.id]=k;l.appendChild(t);l.appendChild(x);b.showLabels(a.name,f,a)||(y.display="none");b.showAggregates(a.name,f,a)||(E.display="none");w.position="relative";w.overflow="visible";w.fontSize=e.size+
"px";w.fontFamily=e.family;w.color=e.color;w.textAlign="center";E.position=y.position="absolute";d.style.width=a.getData("width")+"px";d.style.height=a.getData("height")+"px";E.left=y.left="0px";t.innerHTML=a.name;d.appendChild(l)},onPlaceLabel:function(d,a){if(g[a.id]){var e=g[a.id],f=e.wrapper.style,k=e.label.style,l=e.aggregate.style,q="grouped"==b.type.split(":")[0],t="horizontal"==b.orientation,w=a.getData("dimArray"),y=a.getData("valueArray"),E=q&&t?Math.max.apply(null,w):a.getData("width"),
q=q&&!t?Math.max.apply(null,w):a.getData("height"),t=parseInt(f.fontSize,10);if(w&&y){f.width=l.width=k.width=d.style.width=E+"px";for(var B=0,C=y.length,E=0;B<C;B++)0<w[B]&&(E+=y[B]);b.showLabels(a.name,E,a)?k.display="":k.display="none";w=b.showAggregates(a.name,E,a);l.display=!1!==w?"":"none";"horizontal"==b.orientation?(l.textAlign="right",k.textAlign="left",k.textIndex=l.textIndent=b.labelOffset+"px",l.top=k.top=(q-t)/2+"px"):(l.top=-t-b.labelOffset+"px",k.top=b.labelOffset+q+"px",d.style.top=
parseInt(d.style.top,10)-q+"px");d.style.height=f.height=q+"px";e.aggregate.innerHTML=!0!==w?w:E}}}}),k=e.canvas.getSize(),l=b.Margin;f?(e.config.offsetX=k.width/2-l.left-(b.showLabels&&b.labelOffset+b.Label.size),e.config.offsetY=(l.bottom-l.top)/2):(e.config.offsetY=-k.height/2+l.bottom+(b.showLabels&&b.labelOffset+b.Label.size),e.config.offsetX=(l.right-l.left)/2);this.delegate=e;this.canvas=this.delegate.canvas},loadJSON:function(b){if(!this.busy){this.busy=!0;var d=q.time(),e=[],f=this.delegate,
g=q.splat(b.label),k=q.splat(b.color||this.colors),l=this.config,s=!!l.type.split(":")[1],a=l.animate,m="horizontal"==l.orientation,n=this,t=0;b=b.values;for(var w=b.length;t<w;t++){var y=b[t],x=q.splat(b[t].values);"undefined"==typeof y.id&&(y.id=y.label);e.push({id:d+y.id,name:y.label,data:{value:x,$valueArray:x,$colorArray:k,$stringArray:g,$gradient:s,$config:l},children:[]})}f.loadJSON({id:d+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:e});this.normalizeDims();f.compute();f.select(f.root);
a?m?f.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){n.busy=!1}}):f.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){n.busy=!1}}):this.busy=!1}},updateJSON:function(b,d){if(!this.busy){this.busy=!0;this.select(!1,!1,!1);var e=this.delegate,f=e.graph,g=this.config.animate,k=this,l="horizontal"==this.config.orientation;q.each(b.values,function(d){var a=f.getByName(d.label);a&&(a.setData("valueArray",q.splat(d.values)),b.label&&
a.setData("stringArray",q.splat(b.label)))});this.normalizeDims();e.compute();e.select(e.root);g&&(l?e.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){k.busy=!1;d&&d.onComplete()}}):e.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){k.busy=!1;d&&d.onComplete()}}))}},select:function(b,d){if(this.config.hoveredColor){var e=this.selected;if(e.id!=b||e.name!=d)e.id=b,e.name=d,e.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(d){b==
d.id?d.setData("border",e):d.setData("border",!1)}),this.delegate.plot()}},getLegend:function(){var b={},d;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(b){d=b.nodeTo});var e=d.getData("colorArray"),f=e.length;q.each(d.getData("stringArray"),function(d,k){b[d]=e[k%f]});return b},getMaxValue:function(){var b=0,d="stacked"==this.config.type.split(":")[0];this.delegate.graph.eachNode(function(e){e=e.getData("valueArray");var f=0;e&&(d?q.each(e,function(b){f+=+b}):f=Math.max.apply(null,
e),b=b>f?b:f)});return b},setBarType:function(b){this.config.type=b;this.delegate.config.Node.type="barchart-"+b.split(":")[0]},normalizeDims:function(){var b=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){b++});var d=this.getMaxValue()||1,e=this.delegate.canvas.getSize(),f=this.config,g=f.Margin,k=g.left+g.right,g=g.top+g.bottom,l="horizontal"==f.orientation,s=(e[l?"height":"width"]-(l?g:k)-(b-1)*f.barsOffset)/b,a=f.animate,m=e[l?"width":"height"]-(l?k:g)-(!l&&f.showAggregates&&
f.Label.size+f.labelOffset)-(f.showLabels&&f.Label.size+f.labelOffset),n=l?"height":"width",t=l?"width":"height";this.delegate.graph.eachNode(function(b){var e=0,f=[];q.each(b.getData("valueArray"),function(a){e+=+a;f.push(0)});b.setData(n,s);a?(b.setData(t,e*m/d,"end"),b.setData("dimArray",q.map(b.getData("valueArray"),function(a){return a*m/d}),"end"),b.getData("dimArray")||b.setData("dimArray",f)):(b.setData(t,e*m/d),b.setData("dimArray",q.map(b.getData("valueArray"),function(a){return a*m/d})))})}});
J.PieChart={$extend:!0,animate:!0,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:!1,onClick:q.empty},Tips:{enable:!1,onShow:q.empty,onHide:q.empty},showLabels:!0,resizeLabels:!1,updateHeights:!1};S.Radial=new w({compute:function(b){b=q.splat(b||["current","start","end"]);la.compute(this.graph,b,this.config);this.graph.computeLevels(this.root,0,"ignore");var d=this.createLevelDistanceFunc();this.computeAngularWidths(b);this.computePositions(b,d)},computePositions:function(b,
d){for(var e=this.graph,f=e.getNode(this.root),g=this.parent,k=0,l=b.length;k<l;k++){var s=b[k];f.setPos(new H(0,0),s);f.setData("span",2*Math.PI,s)}f.angleSpan={begin:0,end:2*Math.PI};e.eachBFS(this.root,function(a){var e=a.angleSpan.end-a.angleSpan.begin,f=a.angleSpan.begin,k=d(a),l=0,s=[],q={};a.eachSubnode(function(a){l+=a._treeAngularWidth;for(var d=0,e=b.length;d<e;d++){var f=b[d],g=a.getData("dim",f);q[f]=f in q?g>q[f]?g:q[f]:g}s.push(a)},"ignore");g&&g.id==a.id&&0<s.length&&s[0].dist&&s.sort(function(a,
b){return(a.dist>=b.dist)-(a.dist<=b.dist)});a=0;for(var t=s.length;a<t;a++){var w=s[a];if(!w._flag){for(var y=w._treeAngularWidth/l*e,B=f+y/2,C=0,D=b.length;C<D;C++){var F=b[C];w.setPos(new H(B,k),F);w.setData("span",y,F);w.setData("dim-quotient",w.getData("dim",F)/q[F],F)}w.angleSpan={begin:f,end:f+y};f+=y}}},"ignore")},setAngularWidthForNodes:function(b){this.graph.eachBFS(this.root,function(d,e){var f=d.getData("angularWidth",b[0])||5;d._angularWidth=f/e},"ignore")},setSubtreesAngularWidth:function(){var b=
this;this.graph.eachNode(function(d){b.setSubtreeAngularWidth(d)},"ignore")},setSubtreeAngularWidth:function(b){var d=this,e=b._angularWidth,f=0;b.eachSubnode(function(b){d.setSubtreeAngularWidth(b);f+=b._treeAngularWidth},"ignore");b._treeAngularWidth=Math.max(e,f)},computeAngularWidths:function(b){this.setAngularWidthForNodes(b);this.setSubtreesAngularWidth()}});$jit.Sunburst=new w({Implements:[Y,L,S.Radial],initialize:function(b){var d=$jit.Sunburst;b=this.controller=this.config=q.merge(J("Canvas",
"Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}},b);b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(b.background&&(b.background=q.merge({type:"Circles"},b.background)),this.canvas=new N(this,b),this.config.labelContainer=("string"==typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");
this.graphOptions={klass:H,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new D(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new d.Label[b.Label.type](this);this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.rotated=this.root=this.json=null;this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var b=this.config.levelDistance;return function(d){return(d._depth+1)*b}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},
rotate:function(b,d,e){var f=b.getPos(e.property||"current").getp(!0).theta;this.rotated=b;this.rotateAngle(-f,d,e)},rotateAngle:function(b,d,e){var f=q.merge(this.config,e||{},{modes:["polar"]}),g=e.property||("animate"===d?"end":"current");"animate"===d&&this.fx.animation.pause();this.graph.eachNode(function(d){d=d.getPos(g);d.theta+=b;0>d.theta&&(d.theta+=2*Math.PI)});"animate"==d?this.fx.animate(f):"replot"==d&&(this.fx.plot(),this.busy=!1)},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=
!0;(function(b){b.Op=new w({Implements:D.Op});b.Plot=new w({Implements:D.Plot});b.Label={};b.Label.Native=new w({Implements:D.Label.Native,initialize:function(b){this.viz=b;this.label=b.config.Label;this.config=b.config},renderLabel:function(b,e,f){f=e.getData("span");if(!(f<Math.PI/2&&10>Math.tan(f)*this.config.levelDistance*e._depth)){b=b.getCtx();f=b.measureText(e.name);if(e.id==this.viz.root)var g=-f.width/2,k=0,l=0;else{g=e.pos.clone();g.rho+=5;var s=g.getp(!0),k=g.getc(!0),g=k.x,k=k.y,l=Math.PI,
a=s.theta>l/2&&s.theta<3*l/2,l=a?s.theta+l:s.theta;a?(g-=Math.abs(Math.cos(s.theta)*f.width),k+=Math.sin(s.theta)*f.width):e.id==this.viz.root&&(g-=f.width/2)}b.save();b.translate(g,k);b.rotate(l);b.fillText(e.name,0,0);b.restore()}}});b.Label.SVG=new w({Implements:D.Label.SVG,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.getc(!0),k=this.viz,l=this.viz.canvas.getSize(),s=Math.round(g.x+l.width/2),g=Math.round(g.y+l.height/2);b.setAttribute("x",s);b.setAttribute("y",g);
var a=b.getBBox();if(a){var s=b.getAttribute("x"),g=b.getAttribute("y"),m=e.pos.getp(!0),l=Math.PI,n=m.theta>l/2&&m.theta<3*l/2;n?(b.setAttribute("x",s-a.width),b.setAttribute("y",g-a.height)):e.id==k.root&&b.setAttribute("x",s-a.width/2);k=n?m.theta+l:m.theta;e._depth&&b.setAttribute("transform","rotate("+360*k/(2*l)+" "+s+" "+g+")")}f.onPlaceLabel(b,e)}});b.Label.HTML=new w({Implements:D.Label.HTML,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.clone(),k=this.viz.canvas,
l=e.getData("height"),l=(l||0==e._depth?l:this.viz.config.levelDistance)/2,s=k.getSize();g.rho+=l;g=g.getc(!0);g={x:Math.round(g.x+s.width/2),y:Math.round(g.y+s.height/2)};l=b.style;l.left=g.x+"px";l.top=g.y+"px";l.display=this.fitsInCanvas(g,k)?"":"none";f.onPlaceLabel(b,e)}});b.Plot.NodeTypes=new w({none:{render:q.empty,contains:q.lambda(!1),anglecontains:function(b,e){var f=b.getData("span")/2,g=b.pos.theta,k=g-f,f=g+f;0>k&&(k+=2*Math.PI);g=Math.atan2(e.y,e.x);0>g&&(g+=2*Math.PI);return k>f?g>
k&&g<=2*Math.PI||g<f:g>k&&g<f}},pie:{render:function(b,e){var f=b.getData("span")/2,g=b.pos.theta,k=g-f,f=g+f,g=b.pos.getp(!0),l=new H(g.rho,k),s=l.getc(!0);l.theta=f;var l=l.getc(!0),a=e.getCtx();a.beginPath();a.moveTo(0,0);a.lineTo(s.x,s.y);a.moveTo(0,0);a.lineTo(l.x,l.y);a.moveTo(0,0);a.arc(0,0,g.rho*b.getData("dim-quotient"),k,f,!1);a.fill()},contains:function(b,e){return this.nodeTypes.none.anglecontains.call(this,b,e)?Math.sqrt(e.x*e.x+e.y*e.y)<=this.config.levelDistance*b._depth:!1}},multipie:{render:function(b,
e){var f=b.getData("height"),f=f?f:this.config.levelDistance,g=b.getData("span")/2,k=b.pos.theta,l=k-g,g=k+g,k=b.pos.getp(!0),s=new H(k.rho,l),a=s.getc(!0);s.theta=g;var m=s.getc(!0);s.rho+=f;var n=s.getc(!0);s.theta=l;var s=s.getc(!0),q=e.getCtx();q.moveTo(0,0);q.beginPath();q.arc(0,0,k.rho,l,g,!1);q.arc(0,0,k.rho+f,g,l,!0);q.moveTo(a.x,a.y);q.lineTo(s.x,s.y);q.moveTo(m.x,m.y);q.lineTo(n.x,n.y);q.fill();b.collapsed&&(q.save(),q.lineWidth=2,q.moveTo(0,0),q.beginPath(),q.arc(0,0,k.rho+f+5,g-.01,l+
.01,!0),q.stroke(),q.restore())},contains:function(b,e){if(this.nodeTypes.none.anglecontains.call(this,b,e)){var f=Math.sqrt(e.x*e.x+e.y*e.y),g=b.getData("height"),g=g?g:this.config.levelDistance,k=this.config.levelDistance,l=b._depth;return f>=k*l&&f<=k*l+g}return!1}},"gradient-multipie":{render:function(b,e){var f=e.getCtx(),g=b.getData("height"),g=g?g:this.config.levelDistance,g=f.createRadialGradient(0,0,b.getPos().rho,0,0,b.getPos().rho+g),k=q.hexToRgb(b.getData("color")),l=[];q.each(k,function(b){l.push(parseInt(.5*
b,10))});k=q.rgbToHex(l);g.addColorStop(0,k);g.addColorStop(1,b.getData("color"));f.fillStyle=g;this.nodeTypes.multipie.render.call(this,b,e)},contains:function(b,e){return this.nodeTypes.multipie.contains.call(this,b,e)}},"gradient-pie":{render:function(b,e){var f=e.getCtx(),g=f.createRadialGradient(0,0,0,0,0,b.getPos().rho),k=q.hexToRgb(b.getData("color")),l=[];q.each(k,function(b){l.push(parseInt(.5*b,10))});k=q.rgbToHex(l);g.addColorStop(1,k);g.addColorStop(0,b.getData("color"));f.fillStyle=g;
this.nodeTypes.pie.render.call(this,b,e)},contains:function(b,e){return this.nodeTypes.pie.contains.call(this,b,e)}}});b.Plot.EdgeTypes=new w({none:q.empty,line:{render:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);this.edgeHelper.line.render(f,g,e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(f,g,e,this.edge.epsilon)}},arrow:{render:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.getData("dim"),
l=b.data.$direction;this.edgeHelper.arrow.render(f,g,k,l&&1<l.length&&l[0]!=b.nodeFrom.id,e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(f,g,e,this.edge.epsilon)}},hyperline:{render:function(b,e){var f=b.nodeFrom.pos.getc(),g=b.nodeTo.pos.getc(),k=Math.max(f.norm(),g.norm());this.edgeHelper.hyperline.render(f.$scale(1/k),g.$scale(1/k),k,e)},contains:q.lambda(!1)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(b,
d){b.pos.getp(!0);var e=b.getData("dimArray");b.getData("valueArray");var f=b.getData("colorArray"),g=f.length,k=b.getData("stringArray"),l=b.getData("span")/2,s=b.pos.theta,a=s-l,m=s+l,s=new H,l=d.getCtx(),n,t,w,y,x=b.getData("gradient"),A=b.getData("border"),C=b.getData("config"),E=C.showLabels,B=C.resizeLabels,D=C.Label,F=C.sliceOffset*Math.cos((a+m)/2),I=C.sliceOffset*Math.sin((a+m)/2);if(f&&e&&k){for(var J=0,K=e.length,L=0;J<K;J++){var N=e[J],T=f[J%g];if(!(0>=N)){l.fillStyle=l.strokeStyle=T;
if(x&&N){var V=l.createRadialGradient(F,I,L+C.sliceOffset,F,I,L+N+C.sliceOffset),U=q.hexToRgb(T),U=q.map(U,function(a){return.8*a>>0}),U=q.rgbToHex(U);V.addColorStop(0,T);V.addColorStop(.5,T);V.addColorStop(1,U);l.fillStyle=V}s.rho=L+C.sliceOffset;s.theta=a;s.getc(!0);s.theta=m;s.getc(!0);s.rho+=N;s.getc(!0);s.theta=a;s.getc(!0);l.beginPath();l.arc(F,I,L+.01,a,m,!1);l.arc(F,I,L+N+.01,m,a,!0);l.fill();A&&A.name==k[J]&&(n=L,t=e[J],w=a,y=m);L+=N||0}}A&&(l.save(),l.globalCompositeOperation="source-over",
l.lineWidth=2,l.strokeStyle=A.color,l.beginPath(),l.arc(F,I,n+.01+1,w,y,!1),l.arc(F,I,n+t+.01-1,y,w,!0),l.closePath(),l.stroke(),l.restore());E&&"Native"==D.type&&(l.save(),l.fillStyle=l.strokeStyle=D.color,e=B?b.getData("normalizedDim"):1,e=D.size*e>>0,l.font=D.style+" "+(e<+B?+B:e)+"px "+D.family,l.textBaseline="middle",l.textAlign="center",s.rho=L+C.labelOffset+C.sliceOffset,s.theta=b.pos.theta,e=s.getc(!0),l.fillText(b.name,e.x,e.y),l.restore())}},contains:function(b,d){if(this.nodeTypes.none.anglecontains.call(this,
b,d)){var e=Math.sqrt(d.x*d.x+d.y*d.y),f=this.config.levelDistance,g=b._depth,k=b.getData("config");if(e<=f*g+k.sliceOffset)for(var f=b.getData("dimArray"),g=0,l=f.length,k=k.sliceOffset;g<l;g++){var q=f[g];if(e>=k&&e<=k+q)return{name:b.getData("stringArray")[g],color:b.getData("colorArray")[g],value:b.getData("valueArray")[g],label:b.name};k+=q}}return!1}}});$jit.PieChart=new w({sb:null,colors:"#416D9C #70A35E #EBB056 #C74243 #83548B #909291 #557EAA".split(" "),selected:{},busy:!1,initialize:function(b){this.controller=
this.config=q.merge(J("Canvas","PieChart","Label"),{Label:{type:"Native"}},b);this.initializeViz()},initializeViz:function(){var b=this.config,d=this,e=b.type.split(":")[0],e=new $jit.Sunburst({injectInto:b.injectInto,width:b.width,height:b.height,useCanvas:b.useCanvas,withLabels:"Native"!=b.Label.type,Label:{type:b.Label.type},Node:{overridable:!0,type:"piechart-"+e,width:1,height:1},Edge:{type:"none"},Tips:{enable:b.Tips.enable,type:"Native",force:!0,onShow:function(d,e,f){b.Tips.onShow(d,f,e)}},
Events:{enable:!0,type:"Native",onClick:function(d,e,f){b.Events.enable&&(d=e.getContains(),b.Events.onClick(d,e,f))},onMouseMove:function(e,f,g){b.hoveredColor&&(e?(f=f.getContains(),d.select(e.id,f.name,f.index)):d.select(!1,!1,!1))}},onCreateLabel:function(d,e){var f=b.Label;if(b.showLabels){var a=d.style;a.fontSize=f.size+"px";a.fontFamily=f.family;a.color=f.color;a.textAlign="center";d.innerHTML=e.name}},onPlaceLabel:function(e,f){if(b.showLabels){var g=f.pos.getp(!0),g=f.getData("dimArray"),
a=f.getData("span")/2,m=f.pos.theta,n=m-a,a=m+a,m=new H,q=b.resizeLabels,t=b.Label;if(g){for(var w=0,x=g.length,A=0;w<x;w++)A+=g[w];g=q?f.getData("normalizedDim"):1;g=t.size*g>>0;e.style.fontSize=(g<+q?+q:g)+"px";m.rho=A+b.labelOffset+b.sliceOffset;m.theta=(n+a)/2;g=m.getc(!0);a=d.canvas.getSize();n=Math.round(g.x+a.width/2);g=Math.round(g.y+a.height/2);e.style.left=n+"px";e.style.top=g+"px"}}}}),f=e.canvas.getSize(),g=Math.min;e.config.levelDistance=g(f.width,f.height)/2-b.offset-b.sliceOffset;this.delegate=
e;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(b){var d=q.time(),e=[],f=this.delegate,g=q.splat(b.label),k=g.length,l=q.splat(b.color||this.colors),s=l.length,a=this.config,m=!!a.type.split(":")[1],n=a.animate,k=1==k,t=0;b=b.values;for(var w=b.length;t<w;t++){var y=b[t],x=q.splat(y.values);e.push({id:d+y.label,name:y.label,data:{value:x,$valueArray:x,$colorArray:k?q.splat(l[t%s]):l,$stringArray:g,$gradient:m,$config:a,$angularWidth:q.reduce(x,
function(a,b){return a+b})},children:[]})}f.loadJSON({id:d+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:e});this.normalizeDims();f.refresh();n&&f.fx.animate({modes:["node-property:dimArray"],duration:1500})},updateJSON:function(b,d){if(!this.busy){this.busy=!0;var e=this.delegate,f=e.graph,g=this.config.animate,k=this;q.each(b.values,function(d){var e=f.getByName(d.label);d=q.splat(d.values);e&&(e.setData("valueArray",d),e.setData("angularWidth",q.reduce(d,function(a,b){return a+
b})),b.label&&e.setData("stringArray",q.splat(b.label)))});this.normalizeDims();g?(e.compute("end"),e.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){k.busy=!1;d&&d.onComplete()}})):e.refresh()}},select:function(b,d){if(this.config.hoveredColor){var e=this.selected;if(e.id!=b||e.name!=d)e.id=b,e.name=d,e.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(d){b==d.id?d.setData("border",e):d.setData("border",!1)}),this.delegate.plot()}},
getLegend:function(){var b={},d;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(b){d=b.nodeTo});var e=d.getData("colorArray"),f=e.length;q.each(d.getData("stringArray"),function(d,k){b[d]=e[k%f]});return b},getMaxValue:function(){var b=0;this.delegate.graph.eachNode(function(d){d=d.getData("valueArray");var e=0;q.each(d,function(b){e+=+b});b=b>e?b:e});return b},normalizeDims:function(){var b=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){b++});var d=
this.getMaxValue()||1,e=this.config,f=e.animate,g=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(b){var l=0,s=[];q.each(b.getData("valueArray"),function(a){l+=+a;s.push(1)});var a=1==s.length&&!e.updateHeights;f?(b.setData("dimArray",q.map(b.getData("valueArray"),function(b){return a?g:b*g/d}),"end"),b.getData("dimArray")||b.setData("dimArray",s)):b.setData("dimArray",q.map(b.getData("valueArray"),function(b){return a?g:b*g/d}));b.setData("normalizedDim",l/d)})}});S.TM={};
S.TM.SliceAndDice=new w({compute:function(b){var d=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(d);var e=this.canvas.getSize(),f=this.config,g=e.width,e=e.height;this.graph.computeLevels(this.root,0,"ignore");d.getPos(b).setc(-g/2,-e/2);d.setData("width",g,b);d.setData("height",e+f.titleHeight,b);this.computePositions(d,d,this.layout.orientation,b);this.controller.onAfterCompute(d)},computePositions:function(b,d,e,f){var g=0;b.eachSubnode(function(a){g+=
a.getData("area",f)});var k=this.config,l=b.getData("width",f),q=Math.max(b.getData("height",f)-k.titleHeight,0);b=b==d?1:d.getData("area",f)/g;var a,m,n,t,w;"h"==e?(e="v",l*=b,a="height",m="y",n="x",t=k.titleHeight,w=0):(e="h",q*=b,a="width",m="x",n="y",t=0,w=k.titleHeight);var y=d.getPos(f);d.setData("width",l,f);d.setData("height",q,f);var x=0,A=this;d.eachSubnode(function(b){var g=b.getPos(f);g[m]=x+y[m]+t;g[n]=y[n]+w;A.computePositions(d,b,e,f);x+=b.getData(a,f)})}});S.TM.Area={compute:function(b){b=
b||"current";var d=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(d);var e=this.config,f=this.canvas.getSize(),g=f.width,f=f.height,k=e.offset,l=g-k,q=f-k;this.graph.computeLevels(this.root,0,"ignore");d.getPos(b).setc(-g/2,-f/2);d.setData("width",g,b);d.setData("height",f,b);this.computePositions(d,{top:-f/2+e.titleHeight+k/2,left:-g/2+k/2,width:l,height:q-e.titleHeight},b);this.controller.onAfterCompute(d)},computeDim:function(b,d,e,f,g,k){if(1==
b.length+d.length)this.layoutLast(1==b.length?b:d,e,f,k);else if(2<=b.length&&0==d.length&&(d=[b.shift()]),0==b.length)0<d.length&&this.layoutRow(d,e,f,k);else{var l=b[0];g(d,e)>=g([l].concat(d),e)?this.computeDim(b.slice(1),d.concat([l]),e,f,g,k):(d=this.layoutRow(d,e,f,k),this.computeDim(b,[],d.dim,d,g,k))}},worstAspectRatio:function(b,d){if(!b||0==b.length)return Number.MAX_VALUE;for(var e=0,f=0,g=Number.MAX_VALUE,k=0,l=b.length;k<l;k++)var q=b[k]._area,e=e+q,g=g<q?g:q,f=f>q?f:q;k=d*d;e*=e;return Math.max(k*
f/e,e/(k*g))},avgAspectRatio:function(b,d){if(!b||0==b.length)return Number.MAX_VALUE;for(var e=0,f=0,g=b.length;f<g;f++)var k=b[f]._area/d,e=e+(d>k?d/k:k/d);return e/g},layoutLast:function(b,d,e,f){b=b[0];b.getPos(f).setc(e.left,e.top);b.setData("width",e.width,f);b.setData("height",e.height,f)}};S.TM.Squarified=new w({Implements:S.TM.Area,computePositions:function(b,d,e){var f=this.config,g=Math.max;this.layout.orientation=d.width>=d.height?"h":"v";var k=b.getSubnodes([1,1],"ignore");if(0<k.length){this.processChildrenLayout(b,
k,d,e);b=0;for(var l=k.length;b<l;b++){var q=k[b];d=f.offset;var a=g(q.getData("height",e)-d-f.titleHeight,0),m=g(q.getData("width",e)-d,0),n=q.getPos(e);d={width:m,height:a,top:n.y+f.titleHeight+d/2,left:n.x+d/2};this.computePositions(q,d,e)}}},processChildrenLayout:function(b,d,e,f){b=e.width*e.height;var g,k=d.length,l=0,q=[];for(g=0;g<k;g++)q[g]=parseFloat(d[g].getData("area",f)),l+=q[g];for(g=0;g<k;g++)d[g]._area=b*q[g]/l;b=this.layout.horizontal()?e.height:e.width;d.sort(function(a,b){var d=
b._area-a._area;return d?d:b.id==a.id?0:b.id<a.id?1:-1});g=[d[0]];d=d.slice(1);this.squarify(d,g,b,e,f)},squarify:function(b,d,e,f,g){this.computeDim(b,d,e,f,this.worstAspectRatio,g)},layoutRow:function(b,d,e,f){return this.layout.horizontal()?this.layoutV(b,d,e,f):this.layoutH(b,d,e,f)},layoutV:function(b,d,e,f){var g=0;q.each(b,function(a){g+=a._area});d=g/d||0;for(var k=0,l=0,s=b.length;l<s;l++){var a=b[l]._area/d||0,m=b[l],n="rtl"===q.getDir()?-1*e.left-d:e.left;m.getPos(f).setc(n,e.top+k);m.setData("width",
d,f);m.setData("height",a,f);k+=a}b={height:e.height,width:e.width-d,top:e.top,left:e.left+d};b.dim=Math.min(b.width,b.height);b.dim!=b.height&&this.layout.change();return b},layoutH:function(b,d,e,f){var g=0;q.each(b,function(a){g+=a._area});for(var k=g/d||0,l=e.top,s=0,a=0,m=b.length;a<m;a++){var n=b[a];d=n._area/k||0;var t="rtl"===q.getDir()?-1*(e.left+s)-d:e.left+s;n.getPos(f).setc(t,l);n.setData("width",d,f);n.setData("height",k,f);s+=d}b={height:e.height-k,width:e.width,top:e.top+k,left:e.left};
b.dim=Math.min(b.width,b.height);b.dim!=b.width&&this.layout.change();return b},layoutLast:function(b,d,e,f){b=b[0];d="rtl"===q.getDir()?-1*e.left-e.width:e.left;b.getPos(f).setc(d,e.top);b.setData("width",e.width,f);b.setData("height",e.height,f)}});S.TM.Strip=new w({Implements:S.TM.Area,computePositions:function(b,d,e){var f=b.getSubnodes([1,1],"ignore"),g=this.config,k=Math.max;if(0<f.length){this.processChildrenLayout(b,f,d,e);b=0;for(var l=f.length;b<l;b++){var q=f[b];d=g.offset;var a=k(q.getData("height",
e)-d-g.titleHeight,0),m=k(q.getData("width",e)-d,0),n=q.getPos(e);d={width:m,height:a,top:n.y+g.titleHeight+d/2,left:n.x+d/2};this.computePositions(q,d,e)}}},processChildrenLayout:function(b,d,e,f){b=e.width*e.height;var g,k=d.length,l=0,q=[];for(g=0;g<k;g++)q[g]=+d[g].getData("area",f),l+=q[g];for(g=0;g<k;g++)d[g]._area=b*q[g]/l;b=this.layout.horizontal()?e.width:e.height;g=[d[0]];d=d.slice(1);this.stripify(d,g,b,e,f)},stripify:function(b,d,e,f,g){this.computeDim(b,d,e,f,this.avgAspectRatio,g)},
layoutRow:function(b,d,e,f){return this.layout.horizontal()?this.layoutH(b,d,e,f):this.layoutV(b,d,e,f)},layoutV:function(b,d,e,f){var g=0;q.each(b,function(a){g+=a._area});for(var k=g/d||0,l=0,s=0,a=b.length;s<a;s++){var m=b[s],n=m._area/k||0;m.getPos(f).setc(e.left,e.top+(d-n-l));m.setData("width",k,f);m.setData("height",n,f);l+=n}return{height:e.height,width:e.width-k,top:e.top,left:e.left+k,dim:d}},layoutH:function(b,d,e,f){var g=0;q.each(b,function(a){g+=a._area});for(var k=g/d||0,l=e.height-
k,s=0,a=0,m=b.length;a<m;a++){var n=b[a],t=n._area/k||0;n.getPos(f).setc(e.left+s,e.top+l);n.setData("width",t,f);n.setData("height",k,f);s+=t}return{height:e.height-k,width:e.width,top:e.top,left:e.left,dim:d}}});S.TM.Voronoi=new w({Implements:S.TM.Area,compute:function(b){this.controller.onBeforeCompute(d);var d=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root),e=this.canvas.getSize(),f=this.config.offset,g=e.width,e=e.height;this.graph.computeLevels(this.root,0,0);d.getPos(b).setc(-5,
-5);d.histoPos||(d.histoPos=[]);d.histoPos[0]=R(0,0);g=[R(.5*-g,.5*-e),R(.5*g,.5*-e),R(.5*g,.5*e),R(.5*-g,.5*e)];g=Geometry.offsetConvex(g,.5*-f);d.setData("vertices",g,b);d.setData("width",0,b);d.setData("height",0,b);g=Geometry.offsetConvex(g,1.5*-f);this.computePositions(d,g,b,0);this.controller.onAfterCompute(d)},computePositions:function(b,d,e,f){var g=this,k=b.getSubnodes([1,1],"ignore"),l=this.config.offset,q=b.histoPos[f]||c(0,0),a;b.setData("width",0,e);b.setData("height",0,e);b.getPos(e).setc(q.x,
q.y);0<k.length&&(k[0].histoPos&&k[0].histoPos[f+1]||(b=$jit.util.map(k,function(a){var b=Geometry.randPointInPolygon(d);a.data&&a.data.$area&&(b.area=a.data.$area);return b}),b=g[g.config.centroidType](b,d),$jit.util.each(b,function(a,b){k[b].histoPos||(k[b].histoPos=[]);k[b].histoPos[f+1]=a})),b=$jit.util.map(k,function(a){return a.histoPos[f+1]}),a=Geometry.voronoi(b,d),$jit.util.each(k,function(b,d){var k=a[d],q=k.slice(0);0>Geometry.area(k)&&k.reverse();l&&(q=Geometry.offsetConvex(k,2*-l),k=
Geometry.offsetConvex(k,.5*-l),b.offset=l);b.setData("vertices",k,e);g.computePositions(b,q,e,f+1)}))},centroid:function(b,d){for(var e=2,f;.001<e;)f=Geometry.voronoi(b,d),e=0,b=f.map(function(d,f){var l=Geometry.centroid(d);e+=Geometry.dist2(l,b[f]);return l});return b},doLayoutPressure:function(){this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root).eachNode(function(){})},weightedCentroid:function(b,d){var e=[],f=2,g;g=Geometry.area(d);var k=0,l;q.each(b,function(a,b){k+=a.area});
l=g/k;g=Geometry.voronoi(b,d);q.each(g,function(a,d){e[d]=b[d].area*l/Geometry.area(a)});var s=0,a=0;q.each(e,function(b,d){s+=b;a+=b*b});for(console.log("from "+(a-s*s/e.length)/e.length);.001<f;)g=Geometry.voronoi(b,d),q.each(g,function(a,d){e[d]=b[d].area*l/Geometry.area(a)}),f=0,b=g.map(function(a,d){var g=R(0,0),k=0;q.each(a,function(f,l){var q=[b[d],f,a[l+1]||a[0]],s=f.attached?e[f.attached[0]]:1,s=Geometry.area(q)*Math.exp(2*(e[d]-s));k+=s;g.$add(f.add(q[2]).scale(.5*s))});g.$scale(1/k);g.area=
b[d].area;f+=Geometry.dist(g,b[d]);return g});a=s=0;q.each(e,function(b,d){s+=b;a+=b*b});console.log("to "+(a-s*s/e.length)/e.length);return b},byArea:function(b,d){b=this.centroid(b,d);var e=0,f=0,g,k;$jit.util.each(b,function(b){e+=b.area});for(e=Geometry.area(d)/e;100>f;f++){g=Geometry.voronoi(b,d);for(var l=0;l<b.length;l++)if(0==g[l].length){b=g.map(function(b,a){return Geometry.centroid(b)});break}k=g.map(function(b,a){return b.area*e/(Geometry.area(b)+1E-10)});g=Geometry.voronoi(b,d);b=g.map(function(d,
a){var e=R(b[a].x,b[a].y),f;e.area=b[a].area;f=R(0,0);$jit.util.each(d,function(b,e){var g=d[e+1]||d[0],l=k[a]-(b.attached?k[b.attached[0]]:1),m=g.x-b.x;f.x+=(g.y-b.y)*l;f.y-=m*l});e.x+=f.x/10;e.y+=f.y/10;e.tp=f;return e})}return b}});S.Icicle=new w({compute:function(b){b=b||"current";var d=this.graph.getNode(this.root),e=this.config,f=this.canvas.getSize(),g=f.width,f=f.height,e=e.constrained?e.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(d);D.Util.computeLevels(this.graph,d.id,
0,"ignore");var k=0;D.Util.eachLevel(d,0,!1,function(b,a){a>k&&(k=a)});var d=this.graph.getNode(this.clickedNode&&this.clickedNode.id||d.id),e=Math.min(k,e-1),l=d._depth;this.layout.horizontal()?this.computeSubtree(d,-g/2,-f/2,g/(e+1),f,l,e,b):this.computeSubtree(d,-g/2,-f/2,g,f/(e+1),l,e,b)},computeSubtree:function(b,d,e,f,g,k,l,s){b.getPos(s).setc(d,e);b.setData("width",f,s);b.setData("height",g,s);var a=0,m=D.Util.getSubnodes(b,[1,1],"ignore");if(m.length){q.each(m,function(b){a+=b.getData("dim")});
for(var n=0,t=m.length;n<t;n++)this.layout.horizontal()?(b=g*m[n].getData("dim")/a,this.computeSubtree(m[n],d+f,e,f,b,k,l,s),e+=b):(b=f*m[n].getData("dim")/a,this.computeSubtree(m[n],d,e+g,b,g,k,l,s),d+=b)}}});$jit.Icicle=new w({Implements:[Y,L,S.Icicle],layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(b){var d={animate:!1,orientation:"h",offset:2,
levelsToShow:Number.MAX_VALUE,constrained:!1,Node:{type:"rectangle",overridable:!0},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45},e=J("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=q.merge(e,d,b);this.layout.orientation=this.config.orientation;b=this.config;b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(this.canvas=new N(this,b),this.config.labelContainer=("string"==
typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");this.graphOptions={klass:K,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new D(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){if("Native"!=this.config.Label.type){var b=
this;this.graph.eachNode(function(d){b.labels.hideLabel(d,!1)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(b){if(!this.busy){this.busy=!0;var d=this,e=this.config,f={onComplete:function(){e.request&&d.compute();e.animate?(d.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]}),D.Util.eachSubgraph(b,function(b){b.setData("alpha",1,"end")},"ignore"),d.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){d.clickedNode=b;d.compute("end");
d.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){d.busy=!1;d.clickedNode=b}})}})):(d.clickedNode=b,d.busy=!1,d.refresh())}};if(e.request)this.requestNodes(b,f);else f.onComplete()}},out:function(){if(!this.busy){var b=this,d=D.Util,e=this.config,f=this.graph,g=d.getParents(f.getNode(this.clickedNode&&this.clickedNode.id||this.root))[0],k=this.clickedNode,l;this.busy=!0;this.events.hoveredNode=!1;if(g)if(l={onComplete:function(){b.clickedNode=g;e.request?
b.requestNodes(g,{onComplete:function(){b.compute();b.plot();b.busy=!1}}):(b.compute(),b.plot(),b.busy=!1)}},e.animate)this.clickedNode=g,this.compute("end"),this.clickedNode=k,this.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){b.clickedNode=g;f.nodeList.setDataset(["current","end"],{alpha:[0,1]});d.eachSubgraph(k,function(b){b.setData("alpha",1)},"ignore");b.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){l.onComplete()}})}});
else l.onComplete();else this.busy=!1}},requestNodes:function(b,d){var e=q.merge(this.controller,d),f=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE;if(e.request){var g=[],k=b._depth;D.Util.eachLevel(b,0,f,function(b){b.drawn&&!D.Util.anySubnode(b)&&(g.push(b),b._level=b._depth-k)});this.group.requestNodes(g,e)}else e.onComplete()}});$jit.Icicle.Op=new w({Implements:D.Op});$jit.Icicle.Group=new w({initialize:function(b){this.viz=b;this.canvas=b.canvas;this.config=b.config},requestNodes:function(b,
d){var e=0,f=b.length,g=this.viz;if(0==f)d.onComplete();for(var k=0;k<f;k++)d.request(b[k].id,b[k]._level,{onComplete:function(b,k){k&&k.children&&(k.id=b,g.op.sum(k,{type:"nothing"}));++e==f&&(D.Util.computeLevels(g.graph,g.root,0),d.onComplete())}})}});$jit.Icicle.Plot=new w({Implements:D.Plot,plot:function(b,d){b=b||this.viz.controller;var e=this.viz,f=e.graph.getNode(e.clickedNode&&e.clickedNode.id||e.root),g=f._depth;e.canvas.clear();this.plotTree(f,q.merge(b,{withLabels:!0,hideLabels:!1,plotSubtree:function(b,
d){return!e.config.constrained||d._depth-g<e.config.levelsToShow}}),d)}});$jit.Icicle.Label={};$jit.Icicle.Label.Native=new w({Implements:D.Label.Native,renderLabel:function(b,d,e){b=b.getCtx();e=d.getData("width");var f=d.getData("height"),g=d.getLabelData("size"),k=b.measureText(d.name);f<1.5*g||e<k.width||(g=d.pos.getc(!0),b.fillText(d.name,g.x+e/2,g.y+f/2))}});$jit.Icicle.Label.SVG=new w({Implements:D.Label.SVG,initialize:function(b){this.viz=b},placeLabel:function(b,d,e){var f=d.pos.getc(!0),
g=this.viz.canvas.getSize(),k=Math.round(f.x+g.width/2),f=Math.round(f.y+g.height/2);b.setAttribute("x",k);b.setAttribute("y",f);e.onPlaceLabel(b,d)}});$jit.Icicle.Label.HTML=new w({Implements:D.Label.HTML,initialize:function(b){this.viz=b},placeLabel:function(b,d,e){var f=d.pos.getc(!0),g=this.viz.canvas.getSize(),k=Math.round(f.x+g.width/2),f=Math.round(f.y+g.height/2),g=b.style;g.left=k+"px";g.top=f+"px";g.display="";e.onPlaceLabel(b,d)}});$jit.Icicle.Plot.NodeTypes=new w({none:{render:q.empty},
rectangle:{render:function(b,d,e){var f=this.viz.config;e=f.offset;var g=b.getData("width"),k=b.getData("height"),l=b.getData("border"),s=b.pos.getc(!0),a=s.x+e/2,m=s.y+e/2;d=d.getCtx();if(!(2>g-e||2>k-e)){if(f.cushion){b=b.getData("color");var f=d.createRadialGradient(a+(g-e)/2,m+(k-e)/2,1,a+(g-e)/2,m+(k-e)/2,g<k?k:g),n=q.rgbToHex(q.map(q.hexToRgb(b),function(a){return.3*a>>0}));f.addColorStop(0,b);f.addColorStop(1,n);d.fillStyle=f}l&&(d.strokeStyle=l,d.lineWidth=3);d.fillRect(a,m,Math.max(0,g-e),
Math.max(0,k-e));l&&d.strokeRect(s.x,s.y,g,k)}},contains:function(b,d){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(b,this.viz.clickedNode.id))return!1;var e=b.pos.getc(!0),f=b.getData("width"),g=b.getData("height");return this.nodeHelper.rectangle.contains({x:e.x+f/2,y:e.y+g/2},d,f,g)}}});$jit.Icicle.Plot.EdgeTypes=new w({none:q.empty});var ca=new w({com:[0,0],children:[null,null,null,null],hasChildren:!1,mass:null,fItem:null}),ra=new w({maxNodes:5E4,nodes:null,setup:function(){this.nodes=
[]},getQuadTreeNode:function(){return 0<this.nodes.length?this.nodes.pop():new ca},reclaim:function(b){b.mass=0;b.com[0]=0;b.com[1]=0;b.fItem=null;b.hasChildren=!1;b.children=[null,null,null,null];this.nodes.length<this.maxNodes&&this.nodes.push(b)}}),ja=new w({pnames:["GravitationalConstant","Distance","BarnesHutTheta"],DEFAULT_GRAV_CONSTANT:-1,DEFAULT_MIN_GRAV_CONSTANT:-10,DEFAULT_MAX_GRAV_CONSTANT:10,DEFAULT_DISTANCE:-1,DEFAULT_MIN_DISTANCE:-1,DEFAULT_MAX_DISTANCE:500,DEFAULT_THETA:.9,DEFAULT_MIN_THETA:0,
DEFAULT_MAX_THETA:1,GRAVITATIONAL_CONST:0,MIN_DISTANCE:1,BARNES_HUT_THETA:2,xMin:null,xMax:null,yMin:null,yMax:null,params:null,minValues:null,maxValues:null,factory:null,root:null,setup:function(){this.params=[this.DEFAULT_GRAV_CONSTANT,this.DEFAULT_DISTANCE,this.DEFAULT_THETA];this.minValues=[this.DEFAULT_MIN_GRAV_CONSTANT,this.DEFAULT_MIN_DISTANCE,this.DEFAULT_MIN_THETA];this.maxValues=[this.DEFAULT_MAX_GRAV_CONSTANT,this.DEFAULT_MAX_DISTANCE,this.DEFAULT_MAX_THETA];this.factory=new ra;this.factory.setup();
this.root=this.factory.getQuadTreeNode()},setBounds:function(b,d,e,f){this.xMin=b;this.yMin=d;this.xMax=e;this.yMax=f},insertHelper:function(b,d,e,f,g,k){var l=(e+g)/2,q=(f+k)/2,a=(b.location[0]>=l?1:0)+(b.location[1]>=q?2:0);null==d.children[a]&&(d.children[a]=this.factory.getQuadTreeNode(),d.hasChildren=!0);1==a||3==a?e=l:g=l;1<a?f=q:k=q;this.insert(b,d.children[a],e,f,g,k)},isSameLocation:function(b,d){var e=Math.abs(b.location[0]-d.location[0]),f=Math.abs(b.location[1]-d.location[1]);return.01>
e&&.01>f},insert:function(b,d,e,f,g,k){if(d.hasChildren)this.insertHelper(b,d,e,f,g,k);else if(null!=d.fItem){if(!this.isSameLocation(d.fItem,b)){var l=d.fItem;d.fItem=null;this.insertHelper(l,d,e,f,g,k)}this.insertHelper(b,d,e,f,g,k)}else d.fItem=b},calcMass:function(b){var d=0,e=0;b.mass=0;if(b.hasChildren)for(var f=0;f<b.children.length;f++)null!=b.children[f]&&(this.calcMass(b.children[f]),b.mass+=b.children[f].mass,d+=b.children[f].mass*b.children[f].com[0],e+=b.children[f].mass*b.children[f].com[1]);
null!=b.fItem&&(b.mass+=b.fItem.mass,d+=b.fItem.mass*b.fItem.location[0],e+=b.fItem.mass*b.fItem.location[1]);b.com[0]=d/b.mass;b.com[1]=e/b.mass},insertRoot:function(b){this.insert(b,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},clearHelper:function(b){for(var d=0;d<b.children.length;d++)null!=b.children[d]&&this.clearHelper(b.children[d]);this.factory.reclaim(b)},clear:function(){this.clearHelper(this.root);this.root=this.factory.getQuadTreeNode()},init:function(b){this.clear();for(var d=
Number.MAX_VALUE,e=Number.MAX_VALUE,f=Number.MIN_VALUE,g=Number.MIN_VALUE,k=0;k<b.items.length;k++){var l=b.items[k].location[0],q=b.items[k].location[1];l<d&&(d=l);q<e&&(e=q);l>f&&(f=l);q>g&&(g=q)}k=f-d;l=g-e;k>l?g=e+k:f=d+l;this.setBounds(d,e,f,g);for(k=0;k<b.items.length;k++)this.insertRoot(b.items[k]);this.calcMass(this.root)},getForce:function(b){this.forceHelper(b,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},forceHelper:function(b,d,e,f,g,k){var l=d.com[0]-b.location[0],q=d.com[1]-b.location[1],
a=Math.sqrt(l*l+q*q),m=!1;0==a&&(l=(Math.random()-.5)/50,q=(Math.random()-.5)/50,a=Math.sqrt(l*l+q*q),m=!0);var n=0<this.params[this.MIN_DISTANCE]&&a>this.params[this.MIN_DISTANCE];if(!d.hasChildren&&d.fItem!=b||!m&&(g-e)/a<this.params[this.BARNES_HUT_THETA])n||(d=this.params[this.GRAVITATIONAL_CONST]*b.mass*d.mass/(a*a*a),b.force[0]+=d*l,b.force[1]+=d*q);else if(d.hasChildren){for(var m=(e+g)/2,t=(f+k)/2,w=0;w<d.children.length;w++)null!=d.children[w]&&this.forceHelper(b,d.children[w],1==w||3==w?
m:e,1<w?t:f,1==w||3==w?g:m,1<w?k:t);n||null==d.fItem||d.fItem==b||(d=this.params[this.GRAVITATIONAL_CONST]*b.mass*d.fItem.mass/(a*a*a),b.force[0]+=d*l,b.force[1]+=d*q)}}}),ka=new w({pnames:["SpringCoefficient","DefaultSpringLength"],DEFAULT_SPRING_COEFF:1E-4,DEFAULT_MAX_SPRING_COEFF:.001,DEFAULT_MIN_SPRING_COEFF:1E-5,DEFAULT_SPRING_LENGTH:50,DEFAULT_MIN_SPRING_LENGTH:0,DEFAULT_MAX_SPRING_LENGTH:200,SPRING_COEFF:0,SPRING_LENGTH:1,params:null,minValues:null,maxValues:null,setup:function(){this.params=
[this.DEFAULT_SPRING_COEFF,this.DEFAULT_SPRING_LENGTH];this.minValues=[this.DEFAULT_MIN_SPRING_COEFF,this.DEFAULT_MIN_SPRING_LENGTH];this.maxValues=[this.DEFAULT_MAX_SPRING_COEFF,this.DEFAULT_MAX_SPRING_LENGTH]},getForce:function(b){var d=b.item1,e=b.item2,f=0>b.length?this.params[this.SPRING_LENGTH]:b.length,g=e.location[0]-d.location[0],k=e.location[1]-d.location[1],l=Math.sqrt(g*g+k*k);0==l&&(g=(Math.random()-.5)/50,k=(Math.random()-.5)/50,l=Math.sqrt(g*g+k*k));b=(0>b.coeff?this.params[this.SPRING_COEFF]:
b.coeff)*(l-f)/l;d.force[0]+=b*g;d.force[1]+=b*k;e.force[0]+=-b*g;e.force[1]+=-b*k},init:function(){}}),ba=new w({pnames:["DragCoefficient"],DEFAULT_DRAG_COEFF:.01,DEFAULT_MIN_DRAG_COEFF:0,DEFAULT_MAX_DRAG_COEFF:.1,DRAG_COEFF:0,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_DRAG_COEFF];this.minValues=[this.DEFAULT_MIN_DRAG_COEFF];this.maxValues=[this.DEFAULT_MAX_DRAG_COEFF]},getForce:function(b){b.force[0]-=this.params[this.DRAG_COEFF]*b.velocity[0];b.force[1]-=
this.params[this.DRAG_COEFF]*b.velocity[1]},init:function(){}}),X=new w({integrate:function(b,d){for(var e=b.speedLimit,f,g,k,l,q,a,m=0;m<b.items.length;m++){var n=b.items[m];l=d/n.mass;q=n.k;a=n.l;n.plocation[0]=n.location[0];n.plocation[1]=n.location[1];q[0][0]=d*n.velocity[0];q[0][1]=d*n.velocity[1];a[0][0]=l*n.force[0];a[0][1]=l*n.force[1];n.location[0]+=.5*q[0][0];n.location[1]+=.5*q[0][1]}b.accumulate();for(m=0;m<b.items.length;m++)n=b.items[m],l=d/n.mass,q=n.k,a=n.l,f=n.velocity[0]+.5*a[0][0],
g=n.velocity[1]+.5*a[0][1],k=Math.sqrt(f*f+g*g),k>e&&(f=e*f/k,g=e*g/k),q[1][0]=d*f,q[1][1]=d*g,a[1][0]=l*n.force[0],a[1][1]=l*n.force[1],n.location[0]=n.plocation[0]+.5*q[1][0],n.location[1]=n.plocation[1]+.5*q[1][1];b.accumulate();for(m=0;m<b.items.length;m++)n=b.items[m],l=d/n.mass,q=n.k,a=n.l,f=n.velocity[0]+.5*a[1][0],g=n.velocity[1]+.5*a[1][1],k=Math.sqrt(f*f+g*g),k>e&&(f=e*f/k,g=e*g/k),q[2][0]=d*f,q[2][1]=d*g,a[2][0]=l*n.force[0],a[2][1]=l*n.force[1],n.location[0]=n.plocation[0]+.5*q[2][0],
n.location[1]=n.plocation[1]+.5*q[2][1];b.accumulate();for(m=0;m<b.items.length;m++){n=b.items[m];l=d/n.mass;q=n.k;a=n.l;var t=n.plocation;f=n.velocity[0]+a[2][0];g=n.velocity[1]+a[2][1];k=Math.sqrt(f*f+g*g);k>e&&(f=e*f/k,g=e*g/k);q[3][0]=d*f;q[3][1]=d*g;a[3][0]=l*n.force[0];a[3][1]=l*n.force[1];n.location[0]=t[0]+(q[0][0]+q[3][0])/6+(q[1][0]+q[2][0])/3;n.location[1]=t[1]+(q[0][1]+q[3][1])/6+(q[1][1]+q[2][1])/3;f=(a[0][0]+a[3][0])/6+(a[1][0]+a[2][0])/3;g=(a[0][1]+a[3][1])/6+(a[1][1]+a[2][1])/3;k=
Math.sqrt(f*f+g*g);k>e&&(f=e*f/k,g=e*g/k);n.velocity[0]+=f;n.velocity[1]+=g}}}),Q=new w({speedLimit:1,iflen:0,sflen:0,integrator:null,items:null,springs:null,iforces:null,sforces:null,setup:function(){this.items=[];this.springs=[];this.iforces=[];this.sforces=[];this.integrator=new X},accumulate:function(){for(var b=0;b<this.iforces.length;b++)this.iforces[b].init(this);for(b=0;b<this.sforces.length;b++)this.sforces[b].init(this);for(b=0;b<this.items.length;b++){this.items[b].force[0]=0;for(var d=
this.items[b].force[1]=0;d<this.iforces.length;d++)this.iforces[d].getForce(this.items[b])}for(b=0;b<this.springs.length;b++)for(d=0;d<this.sforces.length;d++)this.sforces[d].getForce(this.springs[b])},runSimulator:function(b){this.accumulate();this.integrator.integrate(this,b)},addForce:function(b,d){d?(this.iforces.push(b),this.iflen++):(this.sforces.push(b),this.sflen++)},addItem:function(b){this.items.push(b)},addSpring:function(b){this.springs.push(b)}}),ma=new w({item1:null,item2:null,coeff:null,
length:null,setup:function(b,d,e,f){this.item1=b;this.item2=d;this.coeff=e;this.length=f}}),y=new w({mass:1,force:null,velocity:null,location:null,plocation:null,k:[[0,0],[0,0],[0,0],[0,0]],l:[[0,0],[0,0],[0,0],[0,0]],setup:function(){this.force=[];this.velocity=[];this.location=[];this.plocation=[]},init:function(b,d){this.force[0]=0;this.force[1]=0;this.velocity[0]=0;this.velocity[1]=0;this.location[0]=b;this.location[1]=d;this.plocation[0]=0;this.plocation[1]=0}});S.ForceDirected=new w({getOptions:function(b){var d=
this.canvas.getSize();b=d.width;var d=d.height,e=0;this.graph.eachNode(function(b){e++});var f=b*d/e,g=Math.sqrt(f),k=this.config.levelDistance;return{width:b-k,height:d-k,tstart:.1*b,nodef:function(b){return f/(b||1)},edgef:function(b){return g*(b-k)}}},compute:function(b,d){this.computeFast(b,d)},computeFast:function(b,d){var e=new Q;e.setup();var f=new ja;f.setup();var g=new ka;g.setup();var k=new ba;k.setup();e.addForce(f,!0);e.addForce(g,!1);e.addForce(k,!0);var l=1E3,s=q.splat(b||["current",
"start","end"]),a=this.getOptions(),m=[];la.compute(this.graph,s,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(b){q.each(s,function(d){d=b.getPos(d);d.x=a.width/2;d.y=a.height/2;b.forceItem=new y;b.forceItem.setup();b.forceItem.init(d.x,d.y);e.addItem(b.forceItem);b.disp={};q.each(s,function(a){b.disp[a]=R(0,0)})})});this.graph.eachNode(function(a){a.eachAdjacency(function(a){if(void 0===m[a.nodeTo.id]){var b=new ma;b.setup(a.nodeFrom.forceItem,a.nodeTo.forceItem,
-1,-1);e.addSpring(b);m[a.nodeFrom.id]=[];m[a.nodeFrom.id][a.nodeTo.id]=!0}})});Math.ceil(this.config.iterations/d.iter);var n=this.config.iterations,t=0,w=this.graph;(function x(){for(var b=d.iter,f=0;f<b;f++)if(a.t=a.tstart,n&&(a.t*=1-t++/(n-1)),l*=1-t/n,e.runSimulator(l+50),n&&t>=n){var g=a.width/2,k=a.height/2;w.eachNode(function(a){q.each(s,function(b){var d=a.forceItem.location[0],e=a.forceItem.location[1];a.getData("dim");a.getData("dim");a.disp[b].norm();b=a.getPos(b);b.x=d;b.y=e})});d.onComplete();
var m=-Number.MAX_VALUE,y=Number.MAX_VALUE,C=-Number.MAX_VALUE,D=Number.MAX_VALUE;w.eachNode(function(a){q.each(s,function(b){b=a.getPos(b);b.x>m&&(m=b.x);b.x<y&&(y=b.x);b.y>C&&(C=b.y);b.y<D&&(D=b.y)})});var F,H;H=0>m?Math.ceil(Math.floor(Math.abs(y))-Math.floor(Math.abs(m))):0<=y?Math.ceil(m-y):Math.ceil(m+Math.abs(y));F=0>C?Math.ceil(Math.floor(Math.abs(D))-Math.floor(Math.abs(C))):0<=D?Math.ceil(C-D):Math.ceil(C+Math.abs(D));g=a.width/2;k=a.height/2;w.eachNode(function(b){q.each(s,function(d){d=
b.getPos(d);var e=b.getData("dim");d.x=0>y?(d.x+Math.abs(y))*(a.width/H)-a.width/2:a.width/H*(d.x-y)-a.width/2;d.x<=-g+e&&(d.x=-g+2*e);d.x>=g-e&&(d.x=g-2*e);d.y=0>D?(d.y+Math.abs(D))*(a.height/F)-a.height/2:a.height/F*(d.y-D)-a.height/2;d.y<=-k+e&&(d.y=-k+2*e);d.y>=k-e&&(d.y=k-2*e)})});return}d.onStep(Math.round(t/(n-1)*100));setTimeout(x,1)})()}});$jit.ForceDirected=new w({Implements:[Y,L,S.ForceDirected],initialize:function(b){var d=$jit.ForceDirected;b=this.controller=this.config=q.merge(J("Canvas",
"Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{iterations:50,levelDistance:50},b);b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(b.background&&(b.background=q.merge({type:"Circles"},b.background)),this.canvas=new N(this,b),this.config.labelContainer=("string"==typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");this.graphOptions={klass:K,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new D(this.graphOptions,
this.config.Node,this.config.Edge);this.labels=new d.Label[b.Label.type](this);this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.json=null;this.busy=!1;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(b){b=q.merge({iter:20,property:"end",onStep:q.empty,onComplete:q.empty},b||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(b.property,b)},computePrefuse:function(b){b=q.merge({iter:20,
property:"end",onStep:q.empty,onComplete:q.empty},b||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.computeFast(b.property,b)},plot:function(){this.fx.plot()},animate:function(b){this.fx.animate(q.merge({modes:["linear"]},b||{}))}});$jit.ForceDirected.$extend=!0;(function(b){b.Op=new w({Implements:D.Op});b.Plot=new w({Implements:D.Plot});b.Label={};b.Label.Native=new w({Implements:D.Label.Native});b.Label.SVG=new w({Implements:D.Label.SVG,initialize:function(b){this.viz=b},placeLabel:function(b,
e,f){var g=e.pos.getc(!0),k=this.viz.canvas,l=k.translateOffsetX,q=k.translateOffsetY,a=k.scaleOffsetX,m=k.scaleOffsetY,k=k.getSize(),l=Math.round(g.x*a+l+k.width/2),g=Math.round(g.y*m+q+k.height/2);b.setAttribute("x",l);b.setAttribute("y",g);f.onPlaceLabel(b,e)}});b.Label.HTML=new w({Implements:D.Label.HTML,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.getc(!0),k=this.viz.canvas,l=k.translateOffsetX,q=k.translateOffsetY,a=k.scaleOffsetX,m=k.scaleOffsetY,n=k.getSize(),
g={x:Math.round(g.x*a+l+n.width/2),y:Math.round(g.y*m+q+n.height/2)},l=b.style;l.left=g.x+"px";l.top=g.y+"px";l.display=this.fitsInCanvas(g,k)?"":"none";f.onPlaceLabel(b,e)}});b.Plot.NodeTypes=new w({none:{render:q.empty,contains:q.lambda(!1)},circle:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.circle.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");return this.nodeHelper.circle.contains(f,e,g)}},ellipse:{render:function(b,e){var f=
b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");this.nodeHelper.ellipse.render("fill",f,g,k,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");return this.nodeHelper.ellipse.contains(f,e,g,k)}},square:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.square.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");return this.nodeHelper.square.contains(f,e,g)}},rectangle:{render:function(b,e){var f=
b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");this.nodeHelper.rectangle.render("fill",f,g,k,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");return this.nodeHelper.rectangle.contains(f,e,g,k)}},triangle:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.triangle.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");return this.nodeHelper.triangle.contains(f,e,g)}},star:{render:function(b,
e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.star.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");return this.nodeHelper.star.contains(f,e,g)}}});b.Plot.EdgeTypes=new w({none:q.empty,line:{render:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);this.edgeHelper.line.render(f,g,e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(f,g,e,this.edge.epsilon)}},arrow:{render:function(b,
e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.getData("dim"),l=b.data.$direction;this.edgeHelper.arrow.render(f,g,k,l&&1<l.length&&l[0]!=b.nodeFrom.id,e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(f,g,e,this.edge.epsilon)}}})})($jit.ForceDirected);$jit.TM={};var t=$jit.TM;$jit.TM.$extend=!0;t.Base={layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},
change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(b){this.controller=this.config=q.merge(J("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{orientation:"h",titleHeight:13,offset:2,levelsToShow:0,labelsToShow:[0,-1],constrained:!1,animate:!1,Node:{type:"rectangle",overridable:!0,width:3,height:3,color:"#444",props:"node-property:width:height"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45},
b);this.layout.orientation=this.config.orientation;b=this.config;b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(b.background&&(b.background=q.merge({type:"Circles"},b.background)),this.canvas=new N(this,b),this.config.labelContainer=("string"==typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");this.graphOptions={klass:K,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new D(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new t.Label[b.Label.type](this);
this.fx=new t.Plot(this);this.op=new t.Op(this);this.group=new t.Group(this);this.geom=new t.Geom(this);this.clickedNode=null;this.busy=!1;this.initializeExtras()},refresh:function(){if(!this.busy){this.busy=!0;var b=this;this.config.animate?(this.compute("end"),this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.fx.animate(q.merge(this.config,{modes:["linear",this.config.Node.props],onComplete:function(){b.busy=!1}}))):("Native"!=this.config.Label.type&&
this.graph.eachNode(function(d){b.labels.hideLabel(d,!1)}),this.busy=!1,this.compute(),this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.plot())}},plot:function(){this.fx.plot()},leaf:function(b){return 0==b.getSubnodes([1,1],"ignore").length},enter:function(b){if(!this.busy){this.busy=!0;var d=this,e=this.config,f=this.graph,g=this.clickedNode,k={onComplete:function(){d.geom.setRightLevelToShow(b);e.request&&d.compute();e.animate?(f.nodeList.setData("alpha",
0,"end"),b.eachSubgraph(function(b){b.setData("alpha",1,"end");b.selected=!1},"ignore"),b.selected=!0,d.fx.animate({duration:d.config.duration/3,modes:["node-property:alpha"],onComplete:function(){d.clickedNode=b;d.compute("end");d.clickedNode=g;d.fx.animate({duration:2*d.config.duration/3,modes:["linear",d.config.Node.props],onComplete:function(){d.busy=!1;d.clickedNode=b;d.geom.setRightLevelToShow(b)}})}})):(d.busy=!1,d.clickedNode=b,d.refresh())}};this.geom.setRightLevelToShow(b);if(e.request)this.requestNodes(b,
k);else k.onComplete()}},out:function(){if(!this.busy){this.busy=!0;this.events.hoveredNode=!1;var b=this,d=this.config,e=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents()[0],f=this.clickedNode;if(e){e.selected=!0;var g={onComplete:function(){f.selected=!1;b.clickedNode=e;d.request?b.requestNodes(e,{onComplete:function(){b.compute();b.plot();b.busy=!1}}):(b.compute(),b.plot(),b.busy=!1);b.geom.setRightLevelToShow(e);b.plot()}};this.geom.setRightLevelToShow(e);if(d.animate)this.clickedNode=
e,this.compute("end"),this.clickedNode=f,this.fx.animate({duration:2*this.config.duration/3,modes:["linear",this.config.Node.props],onComplete:function(){b.clickedNode=e;e.eachSubgraph(function(b){b.setDataset(["current","end"],{alpha:[0,1]})},"ignore");f.eachSubgraph(function(b){b.setData("alpha",1)},"ignore");b.geom.setRightLevelToShow(e);b.fx.animate({duration:b.config.duration/3,modes:["node-property:alpha"],onComplete:function(){g.onComplete()}})}});else g.onComplete()}else this.busy=!1}},requestNodes:function(b,
d){var e=q.merge(this.controller,d),f=this.config.levelsToShow;if(e.request){var g=[],k=b._depth;b.eachLevel(0,f,function(b){var d=f-(b._depth-k);b.drawn&&!b.anySubnode()&&0<d&&(g.push(b),b._level=d)});this.group.requestNodes(g,e)}else e.onComplete()},reposition:function(){this.compute("end")}};t.Op=new w({Implements:D.Op,initialize:function(b){this.viz=b}});t.Geom=new w({Implements:D.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(b){var d=this.getRightLevelToShow(),
e=this.viz.config.labelsToShow,f=this.viz.labels;b.eachLevel(0,!1,function(g){var k=g._depth-b._depth;g._hideLabel=0<=e[0]&&k<e[0]||0<=e[1]&&k>e[1];0<d&&k>d?(g.drawn=!1,g.exist=!1,g.ignore=!0,f.hideLabel(g,!1)):(g.drawn=!0,g.exist=!0,delete g.ignore)});b.drawn=!0;delete b.ignore}});t.Group=new w({initialize:function(b){this.viz=b;this.canvas=b.canvas;this.config=b.config},requestNodes:function(b,d){var e=0,f=b.length,g=this.viz;if(0==f)d.onComplete();for(var k=0;k<f;k++)d.request(b[k].id,b[k]._level,
{onComplete:function(b,k){k&&k.children&&(k.id=b,g.op.sum(k,{type:"nothing"}));++e==f&&(g.graph.computeLevels(g.root,0),d.onComplete())}})}});t.Plot=new w({Implements:D.Plot,initialize:function(b){this.viz=b;this.config=b.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new C;this.nodeTypes=new t.Plot.NodeTypes;this.edgeTypes=new t.Plot.EdgeTypes;this.labels=b.labels},plot:function(b,d){var e=this.viz,f=e.graph;e.canvas.clear();this.plotTree(f.getNode(e.clickedNode&&e.clickedNode.id||
e.root),q.merge(e.config,b||{},{withLabels:!0,hideLabels:!1,plotSubtree:function(b,d){return b.anySubnode("exist")}}),d)}});t.Label={};t.Label.Native=new w({Implements:D.Label.Native,initialize:function(b){this.config=b.config;this.leaf=b.leaf},renderLabel:function(b,d,e){if(!d._hideLabel&&(this.leaf(d)||this.config.titleHeight)){e=d.pos.getc(!0);b=b.getCtx();var f=d.getData("width");d.getData("height");var g=e.x+f/2;e=e.y;isNaN(f)||0===f?b.fillText(d.name,g,e):b.fillText(d.name,g,e,f)}}});t.Label.SVG=
new w({Implements:D.Label.SVG,initialize:function(b){this.viz=b;this.leaf=b.leaf;this.config=b.config},placeLabel:function(b,d,e){e=e||this.viz.controller;var f=d.pos.getc(!0),g=this.viz.canvas,k=g.translateOffsetX,l=g.translateOffsetY,q=g.scaleOffsetX,a=g.scaleOffsetY,g=g.getSize(),k=Math.round(f.x*q+k+g.width/2),f=Math.round(f.y*a+l+g.height/2);b.setAttribute("x",k);b.setAttribute("y",f);if(d._hideLabel||!this.leaf(d)&&!this.config.titleHeight)b.style.display="none";e.onPlaceLabel(b,d)}});t.Label.HTML=
new w({Implements:D.Label.HTML,initialize:function(b){this.viz=b;this.leaf=b.leaf;this.config=b.config},placeLabel:function(b,d,e){e=e||this.viz.controller;var f=d.pos.getc(!0),g=this.viz.canvas,k=g.translateOffsetX,l=g.translateOffsetY,q=g.scaleOffsetX,a=g.scaleOffsetY,g=g.getSize(),k=Math.round(f.x*q+k+g.width/2),f=Math.round(f.y*a+l+g.height/2),l=b.style;l.left=k+"px";l.top=f+"px";l.width=Math.max(0,d.getData("width")*q)+"px";l.height=Math.max(0,d.getData("height")*a)+"px";l.zIndex=100*d._depth;
l.display="";if(d._hideLabel||!this.leaf(d)&&!this.config.titleHeight)b.style.display="none";e.onPlaceLabel(b,d)}});t.Plot.NodeTypes=new w({none:{render:q.empty},rectangle:{render:function(b,d,e){var f=this.viz.leaf(b),g=this.config;e=g.offset;var k=g.titleHeight,l=b.pos.getc(!0),s=b.getData("width"),a=b.getData("height"),m=b.getData("border");d=d.getCtx();var n=l.x+e/2,t=l.y+e/2;s<=e||a<=e||(f?(g.cushion&&(f=d.createRadialGradient(n+(s-e)/2,t+(a-e)/2,1,n+(s-e)/2,t+(a-e)/2,s<a?a:s),b=b.getData("color"),
g=q.rgbToHex(q.map(q.hexToRgb(b),function(a){return.2*a>>0})),f.addColorStop(0,b),f.addColorStop(1,g),d.fillStyle=f),d.fillRect(n,t,s-e,a-e),m&&(d.save(),d.strokeStyle=m,d.strokeRect(n,t,s-e,a-e),d.restore())):0<k&&(d.fillRect(l.x+e/2,l.y+e/2,s-e,k-e),m&&(d.save(),d.strokeStyle=m,d.strokeRect(l.x+e/2,l.y+e/2,s-e,a-e),d.restore())))},contains:function(b,d){if(this.viz.clickedNode&&!b.isDescendantOf(this.viz.clickedNode.id)||b.ignore)return!1;var e=b.pos.getc(!0),f=b.getData("width"),g=this.viz.leaf(b)?
b.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:e.x+f/2,y:e.y+g/2},d,f,g)}}});t.Plot.EdgeTypes=new w({none:q.empty});t.SliceAndDice=new w({Implements:[Y,L,t.Base,S.TM.SliceAndDice]});t.Squarified=new w({Implements:[Y,L,t.Base,S.TM.Squarified]});t.Strip=new w({Implements:[Y,L,t.Base,S.TM.Strip]});$jit.RGraph=new w({Implements:[Y,L,S.Radial],initialize:function(b){var d=$jit.RGraph;b=this.controller=this.config=q.merge(J("Canvas","Node","Edge","Fx","Controller",
"Tips","NodeStyles","Events","Navigation","Label"),{interpolation:"linear",levelDistance:100},b);b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(b.background&&(b.background=q.merge({type:"Circles"},b.background)),this.canvas=new N(this,b),this.config.labelContainer=("string"==typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");this.graphOptions={klass:H,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new D(this.graphOptions,this.config.Node,this.config.Edge);
this.labels=new d.Label[b.Label.type](this);this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.root=this.json=null;this.parent=this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var b=this.config.levelDistance;return function(d){return(d._depth+1)*b}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(b){var d=!1,e=this.graph.getNode(b);b=e.getParents();if(b=0<b.length?b[0]:
!1)d=b.pos.getc(),e=e.pos.getc(),d=d.add(e.scale(-1)),d=Math.atan2(d.y,d.x),0>d&&(d+=2*Math.PI);return{parent:b,theta:d}},tagChildren:function(b,d){if(b.angleSpan){var e=[];b.eachAdjacency(function(b){e.push(b.nodeTo)},"ignore");for(var f=e.length,g=0;g<f&&d!=e[g].id;g++);for(var g=(g+1)%f,k=0;d!=e[g].id;g=(g+1)%f)e[g].dist=k++}},onClick:function(b,d){if(this.root!=b&&!this.busy){this.busy=!0;this.root=b;var e=this;this.controller.onBeforeCompute(this.graph.getNode(b));var f=this.getNodeAndParentAngle(b);
this.tagChildren(f.parent,b);this.parent=f.parent;this.compute("end");var g=f.theta-f.parent.endPos.theta;this.graph.eachNode(function(b){b.endPos.set(b.endPos.getp().add(new H(g,0)))});f=this.config.interpolation;d=q.merge({onComplete:q.empty},d||{});this.fx.animate(q.merge({hideLabels:!0,modes:[f]},d,{onComplete:function(){e.busy=!1;d.onComplete()}}))}}});$jit.RGraph.$extend=!0;(function(b){b.Op=new w({Implements:D.Op});b.Plot=new w({Implements:D.Plot});b.Label={};b.Label.Native=new w({Implements:D.Label.Native});
b.Label.SVG=new w({Implements:D.Label.SVG,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.getc(!0),k=this.viz.canvas,l=k.translateOffsetX,q=k.translateOffsetY,a=k.scaleOffsetX,m=k.scaleOffsetY,k=k.getSize(),l=Math.round(g.x*a+l+k.width/2),g=Math.round(g.y*m+q+k.height/2);b.setAttribute("x",l);b.setAttribute("y",g);f.onPlaceLabel(b,e)}});b.Label.HTML=new w({Implements:D.Label.HTML,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.getc(!0),k=this.viz.canvas,
l=k.translateOffsetX,q=k.translateOffsetY,a=k.scaleOffsetX,m=k.scaleOffsetY,n=k.getSize(),g={x:Math.round(g.x*a+l+n.width/2),y:Math.round(g.y*m+q+n.height/2)},l=b.style;l.left=g.x+"px";l.top=g.y+"px";l.display=this.fitsInCanvas(g,k)?"":"none";f.onPlaceLabel(b,e)}});b.Plot.NodeTypes=new w({none:{render:q.empty,contains:q.lambda(!1)},circle:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.circle.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");
return this.nodeHelper.circle.contains(f,e,g)}},ellipse:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");this.nodeHelper.ellipse.render("fill",f,g,k,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");return this.nodeHelper.ellipse.contains(f,e,g,k)}},square:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.square.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");
return this.nodeHelper.square.contains(f,e,g)}},rectangle:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");this.nodeHelper.rectangle.render("fill",f,g,k,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("width"),k=b.getData("height");return this.nodeHelper.rectangle.contains(f,e,g,k)}},triangle:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.triangle.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");
return this.nodeHelper.triangle.contains(f,e,g)}},star:{render:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");this.nodeHelper.star.render("fill",f,g,e)},contains:function(b,e){var f=b.pos.getc(!0),g=b.getData("dim");return this.nodeHelper.star.contains(f,e,g)}}});b.Plot.EdgeTypes=new w({none:q.empty,line:{render:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);this.edgeHelper.line.render(f,g,e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);
return this.edgeHelper.line.contains(f,g,e,this.edge.epsilon)}},arrow:{render:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.getData("dim"),l=b.data.$direction;this.edgeHelper.arrow.render(f,g,k,l&&1<l.length&&l[0]!=b.nodeFrom.id,e,this.edge.arrowPosition||"end")},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(f,g,e,this.edge.epsilon)}}})})($jit.RGraph);K.prototype.moebiusTransformation=function(b){var d=
this.add(b);b=b.$conjugate().$prod(this);b.x++;return d.$div(b)};D.Util.moebiusTransformation=function(b,d,e,f,g){this.eachNode(b,function(b){for(var g=0;g<e.length;g++){var q=d[g].scale(-1),a=f?f:e[g];b.getPos(e[g]).set(b.getPos(a).getc().moebiusTransformation(q))}},g)};$jit.Hypertree=new w({Implements:[Y,L,S.Radial],initialize:function(b){var d=$jit.Hypertree;b=this.controller=this.config=q.merge(J("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{radius:"auto",
offset:0,Edge:{type:"hyperline"},duration:1500,fps:35},b);b.useCanvas?(this.canvas=b.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(b.background&&(b.background=q.merge({type:"Circles"},b.background)),this.canvas=new N(this,b),this.config.labelContainer=("string"==typeof b.injectInto?b.injectInto:b.injectInto.id)+"-label");this.graphOptions={klass:H,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new D(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new d.Label[b.Label.type](this);
this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.root=this.json=null;this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var b=this.getRadius(),d=0,e=Math.max,f=this.config;this.graph.eachNode(function(b){d=e(b._depth,d)},"ignore");d++;for(var g=function(d){return function(e){e.scale=b;e=e._depth+1;for(var a=0,g=Math.pow;e;)a+=g(d,e--);return a-f.offset}},k=.51;1>=k;k+=.01)if(2<=(1-Math.pow(k,d))/(1-k))return g(k-.01);return g(.75)},getRadius:function(){var b=this.config.radius;
if("auto"!==b)return b;b=this.canvas.getSize();return Math.min(b.width,b.height)/2},refresh:function(b){b?(this.reposition(),this.graph.eachNode(function(b){b.startPos.rho=b.pos.rho=b.endPos.rho;b.startPos.theta=b.pos.theta=b.endPos.theta})):this.compute();this.plot()},reposition:function(){this.compute("end");var b=this.graph.getNode(this.root).pos.getc().scale(-1);D.Util.moebiusTransformation(this.graph,[b],["end"],"end","ignore");this.graph.eachNode(function(b){b.ignore&&(b.endPos.rho=b.pos.rho,
b.endPos.theta=b.pos.theta)})},plot:function(){this.fx.plot()},onClick:function(b,d){var e=this.graph.getNode(b).pos.getc(!0);this.move(e,d)},move:function(b,d){var e=R(b.x,b.y);if(!1===this.busy&&1>e.norm()){this.busy=!0;var f=this.graph.getClosestNodeToPos(e),g=this;this.graph.computeLevels(f.id,0);this.controller.onBeforeCompute(f);d=q.merge({onComplete:q.empty},d||{});this.fx.animate(q.merge({modes:["moebius"],hideLabels:!0},d,{onComplete:function(){g.busy=!1;d.onComplete()}}),e)}}});$jit.Hypertree.$extend=
!0;(function(b){b.Op=new w({Implements:D.Op});b.Plot=new w({Implements:D.Plot});b.Label={};b.Label.Native=new w({Implements:D.Label.Native,initialize:function(b){this.viz=b},renderLabel:function(b,e,f){b=b.getCtx();f=e.pos.getc(!0);var g=this.viz.getRadius();b.fillText(e.name,f.x*g,f.y*g)}});b.Label.SVG=new w({Implements:D.Label.SVG,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.getc(!0),k=this.viz.canvas,l=k.translateOffsetX,q=k.translateOffsetY,a=k.scaleOffsetX,m=k.scaleOffsetY,
k=k.getSize(),n=this.viz.getRadius(),l=Math.round(g.x*a*n+l+k.width/2),g=Math.round(g.y*m*n+q+k.height/2);b.setAttribute("x",l);b.setAttribute("y",g);f.onPlaceLabel(b,e)}});b.Label.HTML=new w({Implements:D.Label.HTML,initialize:function(b){this.viz=b},placeLabel:function(b,e,f){var g=e.pos.getc(!0),k=this.viz.canvas,l=k.translateOffsetX,q=k.translateOffsetY,a=k.scaleOffsetX,m=k.scaleOffsetY,n=k.getSize(),t=this.viz.getRadius(),g={x:Math.round(g.x*a*t+l+n.width/2),y:Math.round(g.y*m*t+q+n.height/2)},
l=b.style;l.left=g.x+"px";l.top=g.y+"px";l.display=this.fitsInCanvas(g,k)?"":"none";f.onPlaceLabel(b,e)}});b.Plot.NodeTypes=new w({none:{render:q.empty,contains:q.lambda(!1)},circle:{render:function(b,e){var f=this.node,g=b.getData("dim"),k=b.pos.getc(),g=f.transform?g*(1-k.squaredNorm()):g;k.$scale(b.scale);.2<g&&this.nodeHelper.circle.render("fill",k,g,e)},contains:function(b,e){var f=b.getData("dim"),g=b.pos.getc().$scale(b.scale);return this.nodeHelper.circle.contains(g,e,f)}},ellipse:{render:function(b,
e){var f=b.pos.getc().$scale(b.scale),g=b.getData("width"),k=b.getData("height");this.nodeHelper.ellipse.render("fill",f,g,k,e)},contains:function(b,e){var f=b.getData("width"),g=b.getData("height"),k=b.pos.getc().$scale(b.scale);return this.nodeHelper.circle.contains(k,e,f,g)}},square:{render:function(b,e){var f=this.node,g=b.getData("dim"),k=b.pos.getc(),g=f.transform?g*(1-k.squaredNorm()):g;k.$scale(b.scale);.2<g&&this.nodeHelper.square.render("fill",k,g,e)},contains:function(b,e){var f=b.getData("dim"),
g=b.pos.getc().$scale(b.scale);return this.nodeHelper.square.contains(g,e,f)}},rectangle:{render:function(b,e){var f=this.node,g=b.getData("width"),k=b.getData("height"),l=b.pos.getc(),g=f.transform?g*(1-l.squaredNorm()):g,k=f.transform?k*(1-l.squaredNorm()):k;l.$scale(b.scale);.2<g&&.2<k&&this.nodeHelper.rectangle.render("fill",l,g,k,e)},contains:function(b,e){var f=b.getData("width"),g=b.getData("height"),k=b.pos.getc().$scale(b.scale);return this.nodeHelper.rectangle.contains(k,e,f,g)}},triangle:{render:function(b,
e){var f=this.node,g=b.getData("dim"),k=b.pos.getc(),g=f.transform?g*(1-k.squaredNorm()):g;k.$scale(b.scale);.2<g&&this.nodeHelper.triangle.render("fill",k,g,e)},contains:function(b,e){var f=b.getData("dim"),g=b.pos.getc().$scale(b.scale);return this.nodeHelper.triangle.contains(g,e,f)}},star:{render:function(b,e){var f=this.node,g=b.getData("dim"),k=b.pos.getc(),g=f.transform?g*(1-k.squaredNorm()):g;k.$scale(b.scale);.2<g&&this.nodeHelper.star.render("fill",k,g,e)},contains:function(b,e){var f=b.getData("dim"),
g=b.pos.getc().$scale(b.scale);return this.nodeHelper.star.contains(g,e,f)}}});b.Plot.EdgeTypes=new w({none:q.empty,line:{render:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.nodeFrom.scale;this.edgeHelper.line.render({x:f.x*k,y:f.y*k},{x:g.x*k,y:g.y*k},e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.nodeFrom.scale;this.edgeHelper.line.contains({x:f.x*k,y:f.y*k},{x:g.x*k,y:g.y*k},e,this.edge.epsilon)}},arrow:{render:function(b,e){var f=
b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.nodeFrom.scale,l=b.getData("dim"),q=b.data.$direction;this.edgeHelper.arrow.render({x:f.x*k,y:f.y*k},{x:g.x*k,y:g.y*k},l,q&&1<q.length&&q[0]!=b.nodeFrom.id,e)},contains:function(b,e){var f=b.nodeFrom.pos.getc(!0),g=b.nodeTo.pos.getc(!0),k=b.nodeFrom.scale;this.edgeHelper.arrow.contains({x:f.x*k,y:f.y*k},{x:g.x*k,y:g.y*k},e,this.edge.epsilon)}},hyperline:{render:function(b,e){var f=b.nodeFrom.pos.getc(),g=b.nodeTo.pos.getc(),k=this.viz.getRadius();
this.edgeHelper.hyperline.render(f,g,k,e)},contains:q.lambda(!1)}})})($jit.Hypertree)})();var labelType,useGradients,nativeTextSupport,animate,moved=!0,pressed,node=!1,autoID=0;function drawTextBG(q,w,F,C,J){q.save();q.font=F.family;q.textBaseline="top";q.fillStyle="#222";var I=q.measureText(w).width;q.fillRect(C,J,I,parseInt(F,10));q.fillStyle=F.color;q.fillText(w,C,J);q.restore()}
function Sontgen(q,w,F){$jit.RGraph.Plot.EdgeTypes.implement({labeled:{render:function(q,w){this.edgeTypes.line.render.call(this,q,w);var C=q.data;if(C.labeltext){var F=w.getCtx(),J=q.nodeFrom.pos.getc(!0),H=q.nodeTo.pos.getc(!0);drawTextBG(F,C.labeltext,{color:"#ccc",family:"sans"},(J.x+H.x)/2,(J.y+H.y)/2)}}}});var C=this,J=new $jit.RGraph({injectInto:q,background:{CanvasStyles:{strokeStyle:"#222"}},Navigation:{enable:!0,panning:"avoid nodes",zooming:60},Node:{overridable:!0,color:"#284C94",dim:10},
Edge:{overridable:!0,color:"#3388CC",lineWidth:4,type:"arrow",dim:13},Label:{overridable:!0,type:"Native",color:"#fff",size:8},Tips:{enable:!0,type:"Native",offsetX:0,offsetY:0,onShow:function(q,w){C.hideTips();q.innerHTML='<div class="tip"><span>'+w.name+"</span></div>"}},Events:{enable:!0,enableForEdges:!0,type:"Native",onDragEnd:function(q,w,C){},onTouchStart:function(q,w,C){$jit.util.event.stop(C)},onTouchMove:function(q,w,C){$jit.util.event.stop(C);w=w.getPos();q.pos.setc(w.x,w.y);J.plot()},
onTouchEnd:function(q,w,C){$jit.util.event.stop(C);J.compute("end");J.fx.animate({modes:["linear"],duration:700,transition:$jit.Trans.Elastic.easeOut})}},levelDistance:600,fps:30,duration:1500});this.viz=J;this.canvas=q;this.mode=w;this.view=F;this.namespaces={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#"};console.log(J)}
Sontgen.prototype.fromJSON=function(q){this.namespaces=q.namespaces;this.viz.loadJSON(q.graph);this.viz.compute("end");this.viz.fx.animate({modes:["polar"],duration:1E3})};Sontgen.prototype.toJSON=function(q){return this.viz.toJSON(q)};
Sontgen.prototype.fromRDF=function(q,w){var F=this,C=rdfstore.create(),J={namespaces:{},graph:[]},I="";C.load(w,q.toString(),function(q,w){C.graph(function(q,w){J.namespaces=C.rdf.prefixes.values();J.graph.push({id:"_n_"+autoID,name:w.triples[0].subject.nominalValue,data:{},adjacencies:[]});F.fromJSON(J);w.forEach(function(q){I+=q.toString();var w=F.getNodeByName(q.subject.nominalValue)||F.addNode(q.subject.nominalValue),C=q.predicate.nominalValue;q=F.getNodeByName(q.object.nominalValue)||F.addNode(q.object.nominalValue);
F.addEdge(w,q,{name:C})})})});console.log(I);return I};Sontgen.prototype.objToStore=function(q,w){return w.data.literal?q.rdf.createLiteral(w.data.literal):w.data.iri?q.rdf.createNamedNode(q.rdf.resolve(w.data.namespace?w.data.namespace+":"+w.data.iri:w.data.iri)):q.rdf.createBlankNode()};
Sontgen.prototype.toRDF=function(q){var w=this,F=rdfstore.create(),C=F.rdf.createGraph();q=this.namespaces;for(var J in q)F.rdf.setPrefix(J,q[J]);this.viz.graph.each(function(q){q.eachAdjacency(function(J){var U=w.objToStore(F,q),L=w.objToStore(F,J);J=w.objToStore(F,J.nodeTo);C.add(F.rdf.createTriple(U,L,J))})});console.log(C);return C.toNT()};
Sontgen.prototype.openFile=function(q,w,F){that=this;if(q)if(F){console.log(q);if(window.File&&window.FileReader&&window.FileList&&window.Blob){var C=new FileReader;C.onload=function(q){"jit-json"==w?that.fromJSON(JSON.parse(C.result)):that.fromRDF(C.result,w)};C.readAsText(q);return!0}alert("The File APIs are not fully supported. Please upgrade your browser.")}else $.ajax({type:"GET",url:q,success:function(q){switch(w){case "jit-json":that.fromJSON(q);break;default:that.fromRDF(q,w)}return!0},error:function(){console.log("error to load data");
return!1}});return!1};Sontgen.prototype.saveAs=function(q){q=new Blob([this.toRDF("n3")],{type:"text/n3;charset=utf-8"});saveAs(q,"myfile.nt")};Sontgen.prototype.addNode=function(q,w){var F=this.viz.graph.addNode({id:"_n_"+autoID,name:q?q:"",data:w||{}});autoID++;this.animate("Elastic","easeOut");return F};
Sontgen.prototype.addEdge=function(q,w,F){F=F||{};var C=this.getEdge(q.id,w.id);C&&C.getData("_rootsAdj")&&this.viz.graph.removeAdjacence(C.nodeFrom.id,C.nodeTo.id);F.$direction=[q.id,w.id];C=this.viz.graph.addAdjacence(q,w,F);this.animate("Elastic","easeOut");return C};Sontgen.prototype.removeNode=function(q){return this.getNode(q)&&q!=this.viz.root?(this.viz.graph.removeNode(q),this.animate("Elastic","easeOut"),!0):!1};
Sontgen.prototype.removeEdge=function(q,w){return this.getEdge(q,w)?(this.viz.graph.removeAdjacence(q,w),this.animate("Elastic","easeOut"),!0):!1};Sontgen.prototype.remove=function(q){this.isNode(q)?this.removeNode(q.id):this.removeEdge(q.nodeFrom.id,q.nodeTo.id);return!0};Sontgen.prototype.getNode=function(q){return this.viz.graph.getNode(q)};Sontgen.prototype.getNodeByName=function(q){return this.viz.graph.getByName(q)};
Sontgen.prototype.getEdge=function(q,w){return this.viz.graph.getAdjacence(q,w)};Sontgen.prototype.editNode=function(q,w,F){return(q=this.getNode(q))?(q.name=w?w:"",q.data=F,this.animate("Elastic","easeOut"),q):!1};Sontgen.prototype.editEdge=function(q,w,F){var C=this.getEdge(q.id,w.id);return C?($.each(F,function(q,w){C.data[q]=w}),this.animate("Elastic","easeOut"),C):!1};Sontgen.prototype.addEventToObj=function(q,w,F){$jit.util.addEvent(q,w,F)};
Sontgen.prototype.addEvent=function(q,w){this.viz.config.Events[q]=w};Sontgen.prototype.animate=function(q,w,F){F=F||500;this.viz.compute("end");this.viz.fx.animate({modes:["linear"],duration:F,transition:$jit.Trans[q][w]})};Sontgen.prototype.showTip=function(q,w,F,C){q&&w&&(C||F&&(C=F.nodeFrom?'<div class="tip customtip" style="top:'+w+"px; left:"+q+'px;">'+F.data.name+"</div>":""),q=document.createElement("div"),q.innerHTML=C,document.getElementById("canvas-canvaswidget").appendChild(q))};
Sontgen.prototype.hideTips=function(){for(var q=document.getElementsByClassName("customtip"),w=0;w<q.length;w++)q[w].parentNode.remove()};Sontgen.prototype.isNode=function(q){return q?q.nodeFrom?!1:!0:!1};Sontgen.prototype.isEdge=function(q){return q?!this.isNode(q):!1};Sontgen.prototype.cursor=function(q,w){return"custom"==q?w?sog.viz.canvas.getElement().style.cursor='url("'+w+'")':!1:q?sog.viz.canvas.getElement().style.cursor=q:sog.viz.canvas.getElement().style.cursor};
Sontgen.prototype.root=function(q){return q?(this.getNode(this.viz.root).setData("color",this.viz.config.Node.color),this.getNode(q).setData("color","#7A6752"),sog.viz.onClick(q),this.getNode(q)):this.getNode(this.viz.root)};
